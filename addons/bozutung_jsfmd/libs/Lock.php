<?php
 goto BrZet; BrZet: interface Lock { function lock(); function tryLock($until = true); function unlock(); function clean(); } goto yuo6o; yuo6o: class FileLock implements Lock { private $fp; private $filename; function __construct($fileName) { goto UU6_H; Um6_B: $this->filename = $fileName; goto ZiXq2; UU6_H: $dir = dirname($fileName); goto wYmpJ; Y62oV: KSKte: goto Um6_B; ZiXq2: $this->fp = fopen($fileName, "\167\x2b"); goto UFJ3L; T9jFD: mkdir($dir, 0777, true); goto Y62oV; wYmpJ: if (file_exists($dir)) { goto KSKte; } goto T9jFD; UFJ3L: } function lock() { return flock($this->fp, LOCK_EX); } function tryLock($until = true) { return flock($this->fp, LOCK_NB | LOCK_EX); } function unlock() { flock($this->fp, LOCK_UN); } function clean() { unlink($this->filename); } } goto peRVP; peRVP: class MultiFileLock implements Lock { private $files; private $fileNames; function __construct(array $files) { goto ELXMx; ELXMx: $this->fileNames = $files; goto YSUne; YSUne: foreach ($files as $f) { goto nTkU_; y1zON: if (file_exists($dir)) { goto NVmi8; } goto nWWI0; J4eQE: NVmi8: goto gbRSl; FdaaS: kVbhC: goto aZoeW; gbRSl: $fileHandles[] = fopen($f, "\x77\x2b"); goto FdaaS; nWWI0: mkdir($dir, 0777, true); goto J4eQE; nTkU_: $dir = dirname($f); goto y1zON; aZoeW: } goto Maicj; DlHOW: $this->files = $fileHandles; goto nsMEK; Maicj: vw_vh: goto DlHOW; nsMEK: } function tryLock($until = true) { goto DfPEh; POLWv: ++$j; goto w1KSd; KcJRE: return !$failure; goto CJjju; xuwXo: goto gQu5d; goto GRZkF; y9Mim: GWsra: goto ec58D; Rtp0f: z_hHc: goto DH2so; kWLS5: goto ssJ9W; goto dO3D2; RKK16: dZZTO: goto POLWv; u4575: if (!($i < $size)) { goto gQu5d; } goto WDrEs; GRZkF: amrij: goto Za9cA; nMrhm: if ($failure) { goto hkHzv; } goto kWLS5; OtO4Z: $failure = true; goto PKLrb; gxlWL: gQu5d: goto nMrhm; PKLrb: $j = 0; goto y9Mim; DH2so: $failure = false; goto nTLjO; ec58D: if (!($j < $i)) { goto f_yzr; } goto fSpwo; w1KSd: goto GWsra; goto u5kiA; QUVKE: goto u4btX; goto gxlWL; Za9cA: V2mKI: goto n6QZ1; WDrEs: if (flock($files[$i], LOCK_NB | LOCK_EX)) { goto amrij; } goto OtO4Z; nTLjO: $i = 0; goto DbtTk; J1mEV: ssJ9W: goto KcJRE; DbtTk: u4btX: goto u4575; dO3D2: hkHzv: goto F2rGp; F2rGp: if ($until) { goto z_hHc; } goto J1mEV; u5kiA: f_yzr: goto xuwXo; fSpwo: flock($files[$j], LOCK_UN); goto RKK16; DfPEh: $files = $this->files; goto LYw3b; LYw3b: $size = count($files); goto Rtp0f; n6QZ1: ++$i; goto QUVKE; CJjju: } function unlock() { goto KnJ1y; aXPzu: $size = count($files); goto j1rYd; wpRTs: Ylym_: goto qBqUR; qBqUR: --$i; goto svv3b; j1rYd: $i = $size - 1; goto LJMit; U1j3t: if (!($i > -1)) { goto h5NrZ; } goto MEhIr; DCKPv: h5NrZ: goto UogWx; svv3b: goto C9_RG; goto DCKPv; KnJ1y: $files = $this->files; goto aXPzu; LJMit: C9_RG: goto U1j3t; MEhIr: flock($files[$i], LOCK_UN); goto wpRTs; UogWx: } function clean() { foreach ($this->fileNames as $fn) { unlink($fn); SRGVD: } OgThu: } function lock() { foreach ($this->files as $f) { flock($f, LOCK_EX); Fbw30: } JnTod: } }