<?php
 goto BlwLe; BlwLe: if (class_exists("\127\x65\151\130\x69\x6e\x50\x61\x79")) { goto KWiKw; } goto HCohJ; YbCkb: KWiKw: goto QSWU8; dOLh_: load()->classs("\x77\145\x69\170\151\156\x2e\160\141\171"); goto YbCkb; HCohJ: load()->classs("\x70\141\171"); goto dOLh_; QSWU8: class WxappPay extends WeiXinPay { function __construct() { goto Ffyt8; ltuw0: $this->wxpay = array("\141\160\x70\151\144" => $_W["\141\143\x63\157\x75\x6e\164"]["\153\145\171"], "\155\143\x68\x5f\x69\144" => $wxpay["\x6d\143\x68\151\144"], "\153\145\171" => $wxpay["\163\151\147\156\153\145\x79"], "\156\x6f\164\151\146\171\x5f\x75\162\x6c" => $_W["\163\x69\164\x65\x72\157\157\164"] . "\x70\x61\x79\155\x65\156\x74\x2f\167\x65\x63\150\141\x74\x2f\156\x6f\164\151\x66\171\56\x70\150\x70"); goto jXrMG; FMr9B: $setting = uni_setting($_W["\165\x6e\x69\141\143\151\x64"]); goto wInYY; wInYY: $wxpay = $setting["\160\141\x79\155\145\156\164"]["\167\x65\x63\x68\x61\x74"]; goto ltuw0; Ffyt8: global $_W; goto FMr9B; jXrMG: } static function refundHelp($tid, $fee, $reason, $moduleName) { goto iVkpe; xHBlj: if (!is_error($refund_id)) { goto Z9N0s; } goto MDBHA; MDBHA: return $refund_id; goto Z7l_2; fl3i1: global $_W; goto uP2j1; uP2j1: $refund_param = reufnd_wechat_build($refund_id); goto e9ndG; e9ndG: $wechat = new WxappPay(); goto Se7ew; jmgul: FzOAy: goto Dzqoh; onULh: return $response; goto QSTT8; VW1US: return $response; goto wRAYw; iVkpe: load()->model("\x72\145\146\165\156\144"); goto kNmGB; Z7l_2: Z9N0s: goto cCxzo; kNmGB: $refund_id = refund_create_order($tid, $moduleName, $fee, $reason); goto xHBlj; Se7ew: $response = $wechat->refund($refund_param); goto Z_LHc; QSTT8: goto I6Avu; goto jmgul; wRAYw: I6Avu: goto GRWzG; C349g: if (is_error($response)) { goto FzOAy; } goto onULh; cCxzo: load()->classs("\x70\x61\x79"); goto fl3i1; Dzqoh: pdo_update("\x63\157\162\x65\x5f\162\145\x66\165\x6e\x64\x6c\157\147", array("\x73\164\141\164\x75\x73" => "\55\x31"), array("\151\x64" => $refund_id)); goto VW1US; Z_LHc: unlink(ATTACHMENT_ROOT . $_W["\165\156\151\x61\x63\151\144"] . "\137\x77\x65\143\x68\141\164\137\162\145\146\x75\x6e\x64\137\141\x6c\154\56\x70\x65\x6d"); goto C349g; GRWzG: } function withdrawToWechat($openid, $money, $tradNo) { goto C56cZ; E29dn: $key = authcode($refund_setting["\153\145\x79"], "\x44\105\x43\x4f\104\x45"); goto ograH; w1ThC: return $result; goto msBiX; s_gge: $setting = uni_setting_load("\x70\141\x79\x6d\x65\x6e\x74", $_W["\x75\x6e\x69\141\x63\151\144"]); goto Qm0IP; WM0_v: return error(1, "\xe7\274\272\xe5\xb0\x91\345\276\256\xe4\xbf\xa1\xe8\xaf\x81\xe4\xb9\246\xef\xbc\201"); goto Gd7DZ; Qm0IP: $refund_setting = $setting["\160\x61\x79\x6d\145\x6e\164"]["\x77\145\143\x68\141\164\x5f\162\x65\x66\x75\x6e\144"]; goto P6nfI; v190I: return $result; goto LEs_s; JkU1h: file_put_contents($keyPath, $key); goto MfvcJ; Mvuj4: unlink($keyPath); goto zdY6P; LEs_s: HNQnF: goto w1ThC; s21l9: $params["\x73\x69\147\x6e"] = self::bulidSign($params); goto Vpmkg; KnXlB: goto q84MY; goto rp8ng; Vpmkg: $extra = [CURLOPT_SSLCERTTYPE => "\x50\x45\x4d", CURLOPT_SSLCERT => $certPath, CURLOPT_SSLKEYTYPE => "\120\105\x4d", CURLOPT_SSLKEY => $keyPath]; goto K8tek; zdY6P: unlink($certPath); goto nf1Qc; C56cZ: global $_W; goto s_gge; P6nfI: if (!(empty($refund_setting["\153\x65\x79"]) || empty($refund_setting["\x63\145\162\164"]))) { goto g342c; } goto WM0_v; ograH: $certPath = "\x2f\x74\155\160\x2f" . $tradNo . random(6); goto ZLK02; nf1Qc: if (!is_error($result)) { goto HNQnF; } goto v190I; DwCzv: $response = ihttp_request("\x68\164\x74\x70\x73\x3a\x2f\57\141\x70\151\x2e\x6d\x63\150\56\x77\x65\151\x78\151\156\x2e\x71\x71\x2e\143\x6f\x6d\x2f\x6d\x6d\160\141\x79\x6d\x6b\x74\x74\x72\x61\156\163\146\145\x72\x73\57\x70\x72\157\x6d\157\x74\151\157\x6e\57\x74\x72\x61\x6e\x73\x66\x65\162\163", $xml, $extra); goto zbnGG; ZLK02: $keyPath = "\x2f\x74\155\160\x2f" . $tradNo . random(6); goto iRbSu; zbnGG: if (is_error($response)) { goto z3USz; } goto yzXkC; XhZum: q84MY: goto Mvuj4; rp8ng: z3USz: goto snhIL; snhIL: $result = $response; goto XhZum; MfvcJ: $params = ["\x63\150\145\x63\153\x5f\156\141\155\145" => "\116\x4f\x5f\103\x48\x45\x43\x4b", "\x6f\x70\145\x6e\151\144" => $openid, "\160\141\x72\x74\x6e\x65\162\137\164\x72\141\144\x65\x5f\156\157" => $tradNo, "\x73\160\142\151\154\154\x5f\x63\162\x65\x61\164\145\x5f\x69\160" => $_SERVER["\x53\x45\x52\126\x45\122\137\x41\x44\104\122"], "\144\x65\x73\x63" => "\344\xbd\xa3\xe9\x87\x91\xe6\x8f\x90\347\x8e\260\345\x88\260\345\xbe\256\344\277\241\351\233\266\xe9\222\261", "\x61\x6d\x6f\165\156\x74" => $money, "\x6d\143\x68\x69\x64" => $this->wxpay["\x6d\143\150\x5f\x69\x64"], "\x6d\x63\150\x5f\141\x70\160\x69\144" => $this->wxpay["\x61\160\160\151\144"], "\x6e\x6f\x6e\x63\x65\137\x73\x74\x72" => random(32)]; goto s21l9; iRbSu: file_put_contents($certPath, $cert); goto JkU1h; JtFs9: $xml = array2xml($params); goto DwCzv; Gd7DZ: g342c: goto r0bI1; r0bI1: $cert = authcode($refund_setting["\143\145\x72\x74"], "\x44\x45\103\117\104\105"); goto E29dn; yzXkC: $result = self::parseResultWithoutSign($response["\x63\x6f\156\164\x65\x6e\164"]); goto KnXlB; K8tek: load()->func("\143\x6f\155\155\165\156\151\x63\141\x74\151\157\156"); goto JtFs9; msBiX: } function parseResultWithoutSign($result) { goto rakKb; QZTHq: return $result; goto S7FzF; S7FzF: JZ9Sz: goto NUAEW; uH1FH: yWGjb: goto DuuIJ; lXj0P: return error(-1, "\x78\155\x6c\xe7\xbb\223\xe6\x9e\204\351\x94\x99\xe8\xaf\257"); goto uH1FH; rakKb: if (!(substr($result, 0, 5) != "\x3c\170\x6d\154\76")) { goto JZ9Sz; } goto QZTHq; NUAEW: $result = json_decode(json_encode(isimplexml_load_string($result, "\x53\151\155\160\154\145\130\x4d\x4c\105\x6c\145\155\145\x6e\164", LIBXML_NOCDATA)), true); goto pU7RE; DuuIJ: if (!(isset($result["\162\145\164\x75\162\x6e\x5f\x63\x6f\x64\x65"]) && $result["\162\145\x74\x75\x72\x6e\x5f\143\157\x64\x65"] != "\123\125\103\x43\105\123\123" || $result["\145\x72\x72\x5f\143\x6f\x64\x65"] == "\x45\122\122\x4f\122" && !empty($result["\145\162\x72\x5f\x63\x6f\144\145\137\144\145\163"]))) { goto YvNfp; } goto rYbtf; irHhc: return $result; goto YNVnb; kScn2: YvNfp: goto irHhc; ZxB53: return error(-1, $msg); goto kScn2; pU7RE: if (is_array($result)) { goto yWGjb; } goto lXj0P; rYbtf: $msg = empty($result["\162\145\164\x75\x72\156\x5f\x6d\x73\147"]) ? $result["\x65\x72\162\137\x63\x6f\144\x65\137\144\145\x73"] : $result["\x72\145\x74\x75\162\156\137\x6d\x73\x67"]; goto ZxB53; YNVnb: } }