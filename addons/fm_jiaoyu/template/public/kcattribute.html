
<div class="modal-header">
	<h4 class="modal-title" id="myModalLabel">学生课程属性设置</h4>
</div>
<div class="modal-body" style="height:100%;overflow-y: scroll; max-height: 87%;">
   <form id="stukcattr_info">
		<div class="panel panel-default">
			<div class="panel-body" id="attribute_info">
                <input type="hidden" name="sid" value="{$sid}">
                <input type="hidden" name="kc_id" value="{$kc_id}">
				{loop $attributeList $row}
				<div class="form-group">
					<div class="form-group">
						<label class="col-xs-12 col-sm-12 col-md-12 control-label">{$row['name']}
							<div style="float: right;">
								<input type="radio" name="attr_content[{$row['id']}][is_lock]" value="0" {if $row['is_lock'] == 0}checked="true"{/if} /> 不锁定
								<input type="radio" name="attr_content[{$row['id']}][is_lock]" value="1" {if $row['is_lock'] == 1}checked="true"{/if} /> 锁定
							</div>
						</label>
					</div>
					{if $row['category'] == 'text'}
					<div class="form-group">
						<div class="col-sm-12">
							<input type="text" name="attr_content[{$row['id']}][content]" class="form-control" value="{$row['content']}"/>
							<input type="hidden" name="attr_content[{$row['id']}][name]" value="text">
						</div>
					</div>
					{elseif $row['category'] == 'idcard'}
					<div class="form-group">
						<div class="col-sm-12">
							<input type="text" name="attr_content[{$row['id']}][content]" class="form-control" onchange="checkIdcard(this)" value="{$row['content']}"/>
							<input type="hidden" name="attr_content[{$row['id']}][name]" value="idcard">
						</div>
					</div>
					{elseif $row['category'] == 'phone'}
					<div class="form-group">
						<div class="col-sm-12">
							<input type="text" name="attr_content[{$row['id']}][content]" class="form-control" onchange="checkPhone(this)" value="{$row['content']}"/>
							<input type="hidden" name="attr_content[{$row['id']}][name]" value="phone">
						</div>
					</div>
					{elseif $row['category'] == 'number'}
					<div class="form-group">
						<div class="col-sm-12">
							<input type="number" name="attr_content[{$row['id']}][content]" class="form-control" value="{$row['content']}"/>
							<input type="hidden" name="attr_content[{$row['id']}][name]" value="number">
						</div>
					</div>
					{elseif $row['category'] == 'date'}
					<div class="form-group">
						<div class="col-sm-12">
							{php $attr_id = $row['id'];}
							{php echo tpl_form_field_date("attr_content[$attr_id][content]",$row['content'])}
						</div>
						<input type="hidden" name="attr_content[{$row['id']}][name]" value="date">
					</div>
					{elseif $row['category'] == 'richtext'}
					<div class="form-group">
						<div class="col-sm-12">
							{php $attr_id = $row['id']}
							{php echo tpl_ueditor("attr_content[$attr_id][content]",$row['content']);}
						</div>
						<input type="hidden" name="attr_content[{$row['id']}][name]" value="richtext">
					</div>
					{elseif $row['category'] == 'file'}
					<div class="form-group">
						<div class="col-sm-12">
							<select id="file" style="width: 200px;">
								<option value="">请选择</option>
								<option value="1" {if $row['childCategory'] == 'image'}selected{/if}>图片</option>
								<option value="2" {if $row['childCategory'] == 'file'}selected{/if}>文档</option>
							</select>
						</div>
					</div>
					<div class="form-group fujianBox" id="imageBox" {if $row['childCategory'] == 'image'}style="display: block;"{else}style="display: none;"{/if}>
						<div class="col-sm-12">
							{php $attr_id = $row['id']}
							{php echo tpl_form_field_image("attr_content[$attr_id][content][image]",$row['content'])}
						</div>
					</div>
					<div class="form-group fujianBox" id="fileBox" {if $row['childCategory'] == 'file'}style="display: block;"{else}style="display: none;"{/if}>
						<div class="col-sm-12">
							{php $attr_id = $row['id']}
							{php echo tpl_form_field_video("attr_content[$attr_id][content][file]",$row['content'])}
						</div>
					</div>
					{/if}
				</div>
				{/loop}
			</div>
		</div>
	</form>
</div>
<div class="modal-foot">
	<a class="btn btn-primary" style="color: #fff;" onclick="setAttr();">提交</a>
	<button type="button" class="btn btn-danger" data-dismiss="modal">关闭</button>
</div>
<script>
    $("#file").change(function(){
		$(".fujianBox").hide()
		$(".fujianBox").find(":input").val('');
		if($(this).val() == 1){
			$("#imageBox").show()
		}else if($(this).val() == 2){
			$("#fileBox").show()
		}
	})
	/***********身份证验证***********/
	function checkIdcard(e){
		let card = $(e).val()
		let cardreg = /(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/;
		if(cardreg.test(card) === false) 
		{ 
			alert("身份证输入不合法"); 
			return false; 
		}
	}
	/***********身份证验证***********/

	/***********手机号验证***********/
	function checkPhone(e){
		let phone = $(e).val()
		let phonereg = /^1(3[0-9]|4[5,7]|5[0,1,2,3,5,6,7,8,9]|6[2,5,6,7]|7[0,1,7,8]|8[0-9]|9[1,8,9])\d{8}$/;
		if(phonereg.test(phone) === false) 
		{ 
			alert("手机号输入不合法"); 
			return false; 
		}
	}
	/***********手机号验证***********/
    function setAttr(){
        var form =  $("#stukcattr_info").serializeArray();
        $.ajax({
            url: "{php echo $this->createWebUrl('indexajax', array('op'=>'setAttribute','schoolid' => $_GPC['schoolid'],'weid' => $_GPC['weid']))}",
            type: "post",
            dataType: "json",
            data:form,
            success: function (res) {
                ReToastGlobal(res.msg)
                $('#attr_box').modal('toggle');
            }
        });
    }
</script>