<style>
.modal-open {overflow: hidden;}
.card_over{ max-height: 150px; overflow: hidden;}
.text_over{ height: 60px; display: -webkit-box; -webkit-box-orient: vertical; -webkit-line-clamp: 3; overflow: hidden;}
.tab_saidnav{ position: absolute; width: 48px;  left: -47px; top: 5%; text-align: center; background-color: #e7e7eb; border-top-left-radius: 5px; border-bottom-left-radius: 5px; cursor:pointer;overflow-y: auto; height: 600px; }
.tab_saidnav li{ list-style: none; width: 100%; height: 55px; border-right: 1px #e7e7eb solid; }
.tab_saidnav .acts{ background-color: #fff; border-right: 1px #fff solid; border-bottom: 1px #e7e7eb solid; }
.tab_saidnav li:first-child{ border-top-left-radius: 5px; }
.tab_saidnav li:last-child{ border-bottom-left-radius: 5px; }
.tab_saidnav li div{ width: 80%; margin-left: 10%; padding-top: 20%; -webkit-user-select:none; -moz-user-select:none; -ms-user-select:none; user-select:none;}
.btnGroup { position: absolute; top: 30%; width: 100%; left: 0px; text-align: center; } 
.bolder-l{ padding-left: 39px; border-left: 1px #ddd solid; }
.modal-backdrop { z-index: 1040 !important; }
.modal-backdrop ~.modal-backdrop{ z-index: 1055 !important; }
.modal-backdrop ~.modal-backdrop ~.modal-backdrop{ z-index: 1066 !important; }
/**模拟手机框**/
.preview-phone{ width: 300px; height: 600px;left: 14%;background: #fff; padding: 44px 15px 80px; border-radius: 44px; -webkit-box-shadow: 0 2px 30px 0 rgba(170,187,219,.6); box-shadow: 0 2px 30px 0 rgba(170,187,219,.6); position: relative; } .telephone { position: absolute; left: 50%; -webkit-transform: translateX(-50%); -ms-transform: translateX(-50%); transform: translateX(-50%); } .telephone { width: 74px; height: 5px; background: -webkit-gradient(linear,left top,left bottom,color-stop(0,#f5f6f7),to(#e3e4e5)); background: -webkit-linear-gradient(top,#f5f6f7,#e3e4e5); background: -o-linear-gradient(top,#f5f6f7 0,#e3e4e5 100%); background: linear-gradient(180deg,#f5f6f7,#e3e4e5); border-radius: 3px; top: 23px; } .preview-phone .document-title { height: 35px; width: 100%; line-height: 35px; background: -webkit-gradient(linear,left bottom,left top,color-stop(0,#2c2d31),to(#101013)); background: -webkit-linear-gradient(bottom,#2c2d31,#101013); background: -o-linear-gradient(bottom,#2c2d31 0,#101013 100%); background: linear-gradient(1turn,#2c2d31,#101013); text-align: center; color: #fff; font-weight: 700; } .preview-phone .phone-stage { width: 100%; height: 445px; background: #fff; overflow: auto; position: relative; border: 1px solid #e8e8e8; border-top: none; } .home-btn { width: 50px; height: 50px; background: #ecedee; border-radius: 50%; bottom: 21px; } .home-btn, .telephone { position: absolute; left: 50%; -webkit-transform: translateX(-50%); -ms-transform: translateX(-50%); transform: translateX(-50%); } .create-iframe { width: 100%; height: 100%; }
.content { display: -ms-flexbox; display: flex; -ms-flex-direction: column; flex-direction: column; margin-top: 5px; font-size: 12px; color: #b0b0b0; overflow-y: auto; }
/**模拟手机框end**/
.time-box { border: 1px solid #e8e8e8; height: 288px;}
.time-box li { padding: 0 20px; border-bottom: 1px solid #e8e8e8; line-height: 40px; height: 40px; position: relative; }
.time-box  li:first-child span { color: #ff8534;cursor: pointer; }
.opt_box{float:right;color: #ff8534;}
.opt_box .fa{font-size:15px;font-weight: 1;cursor: pointer}
.opt_box .fa:first-child{margin-right:15px}
.left_timebox{width: 30%; float: left;}
.left_timeboxbig{width: 70%; float: left;}
.add_new_time{cursor:pointer;}
.new_timesave{margin-top: 5px;height: 26px;}
.left_timeboxs{width: 20%; float: left;}
.input-group #daynumber{font-size: 20px;font-weight: blod;color: red;}
.clear{clear: both;}
</style>
<!-- 模板库 modal -->
<div class="uploader-modal modal right fade" style="z-index: 1050 !important;"  id="notex_temp" tabindex="-1" role="dialog" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog myModalleft" style="width: 30%;">
		<div class="loading-layer"><div><img  style="margin-top:40%" src="{OSSURL}public/web/images/blue_four_round.png"></div></div>
		<div class="tab_saidnav">
			<li opt="0" class="acts"><div>全部类型</div></li>
			{loop $tempcate $item}
			<li opt="{$item['id']}"><div>{$item['name']}</div></li>
			{/loop}
		</div>
		<div class="modal-content" id="ed_teabox" style="max-height:unset !important;">
			<div class="modal-header d-flex justify-content-between align-items-center border-bottom">                
				<h4 class="modal-title dark" id="myModalLabel">消息模板库</h4>
				<!-- <div class="chat-header-icons">
					<li class="dropdown cursor-pointer float-right">
						<span class="dropdown-toggle" data-toggle="dropdown" aria-expanded="true">
							<span class="badge badge-light-primary badge-xs">图文模式</span>
							<i class="pl-1 fa fa-ellipsis-v"></i>
						</span>
						<ul class="dropdown-menu color-gray dropdown-menu-right" role="menu">
							<li onclick="ChoseThisBj(`{$row['id']}`,'kc',this)">
								<a>图文模式</a>
							</li>
							<li class="divider"></li>
							<li onclick="ChoseThisBj(`{$row['id']}`,'kc',this)">
								<a>精简模式</a>
							</li>
						</ul>
					</li>
				</div> -->
			</div>
			<div class="modal-body tempContent" style="height:100%; overflow-y: auto;max-height:800px">
				
			</div>
			<div class="modal-foot">
				<button type="button" class="btn btn-danger" data-dismiss="modal">关闭</button>
			</div>
			<script type="text/javascript">
				function notictemp(type) {
					$('.loading-layer').show()
					$('#notex_temp').modal('toggle');
					setTimeout(function() {
						$('.loading-layer').hide()
					}, 500);
					getTemplibrary()
				}
				function use_temp(tempid){//预览
					getTempInfo(tempid,'use')
					$('#notex_temp').modal('toggle');
				}
				function preview(tempid){//预览
					getTempInfo(tempid,'preview')
					$('#temp_view').modal('toggle')	
				}
				$(".tab_saidnav li").click(function(){
					$(".tab_saidnav .acts").removeClass("acts")
					$(this).addClass("acts")
					getTemplibrary()
				});
			</script>
		</div>
	</div>
</div>
<div class="uploader-modal modal fade keyword ng-scope ng-isolate-scope in" style="min-width: 800px!important;z-index: 1060 !important;" id="temp_view" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog" style="left: 25%;top: 1%;">
		<div class="modal-content" style="border-radius: 10px;">
			<div class="modal-header">
				<h4 class="modal-title" id="modal-title-kc" style="text-align:center;color:#333;font-size: 17px;">预览模板</h4>
			</div>
			<div class="modal-body d-flex" style="width: 100%;padding: 34px;">
				<div class="ks_bigbox" style="width: 50%">
					<div class="preview-phone" id="preview_box">
						<div class="telephone"></div>
						<div class="document-title temp_name">国庆中秋放假通知</div>
						<div class="phone-stage">
							<div class="content temp_content">
							</div>
						</div>
						<div class="home-btn"></div>
					</div>
				</div>	
				<div class="bolder-l" style="width: 50%">
					<h5 class="card-title"><span class="bullet bullet-success bullet-sm"></span> 模板标题</h5>
					<h5 class="card-title temp_name"></h5></br></br>
					<h5 class="card-title"><span class="bullet bullet-warning bullet-sm"></span> 模板简介</h5>
					<h5 class="card-title temp_description"></h5></br></br>
					<h5 class="card-title"><span class="bullet bullet-info bullet-sm"></span> 所属分类</h5>
					<h5 class="card-title temp_catename"></h5></br></br>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="uploader-modal modal fade keyword ng-scope ng-isolate-scope in" style="min-width: 800px!important;z-index: 1060 !important;" id="add_temp" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog modal-lg ng-scope" style="left: 25%;top: 10%;">
		<div class="modal-content" style="border-radius: 10px;">
			<div class="modal-header">
				<h4 class="modal-title" id="modal-title-kc" style="text-align:center;color:#333;font-size: 17px;">创建模板</h4>
			</div>
			<div class="modal-body material-content clearfix">
				<div class="material-body" style="overflow-y: scroll;padding: 34px;height: 500px;">
					<div class="row display_fixed" style="width:100%">
						<div class="col-xs-6">
							<div class="col-xs-8">
								模板标题
								<input type="text" class="form-control" name="temp_name" placeholder="最长15个字，建议简短明了" value="">
							</div>
							<div class="col-xs-8">
								模板简介
								<input type="text" class="form-control" name="temp_jianjie" placeholder="非必填，输入50字以内..." value="">
							</div>
							<div class="col-xs-8">
								模板类型
								<select name="xq" id="select_nj" class="form-control">
									<option value="0">请选择分类</option>
									<option value="0">请选择分类</option>
								</select>
								<label class="control-label pzsd" onclick="pzzj()" style="color:#fc9c6b;cursor:pointer;">配置类型</label>
							</div>
						</div>
						<div class="col-xs-6">
							<div class="col-sm-8">
								{php echo tpl_form_field_image('temp_thumb', $item['thumb'])}
								<div class="timeline-content">缩略图:尺寸120*120方正</div>
							</div>
						</div>
						<div class="col-xs-12">
							<div class="help-block">如富文本编辑器未加载，请刷新本页重试</div>
							{php echo tpl_ueditor('temp_cont', $item['dagang']);}
						</div>	
					</div>
				</div>	
			</div>
			<div class="modal-footer">	
				<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
				<button type="button" class="btn btn-primary" onclick="add_newtemp()" >提交</button>
			</div>
		</div>
	</div>
</div>
<div class="modal fade" style="min-width: 400px!important;" id="Modal9" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static">
	<div class="modal-dialog" style="left: 35%;top: 30%;min-width: 320px !important;">
		<div class="modal-content" style="border-radius: 20px;">
			<div class="modal-header">
				<h4 class="modal-title" id="modal-title-kc" style="text-align:center;color:#333;font-size: 17px;">配置消息类型</h4>
			</div>
			<div class="modal-body" style="width: 100%;overflow-y: scroll;padding: 34px;height: 300px;">
				<div class="time-box" id="time-box">
					<li class="def_class">
						<div class="right">
							<span class="add_new_menu">+ 新增类型</span>
						</div>
					</li>
					<div id="new_menubox" style="display:none">
						<li class="def_class">
							<div class="left_timeboxbig"><input class="form-control new_timesave" placeholder="类型名称" name="catename" type="text" value=""/></div>
							<div class="right">
								<div class="opt_box">
									<i class="fa fa-save" onclick="save_menu(this,0)" data-id="new"></i>
									<i class="fa fa-times del_new_menu" data-id="new"></i>
								</div>
							</div>
						</li>
					</div>
					<div id="old_menubox">
					</div>
				</div>	
			</div>
			<div class="modal-footer" style="border-radius: 6px;">
				<button type="button" class="btn btn-danger" data-dismiss="modal">关闭</button>
			</div>
		</div>
	</div>
</div>
<script>
$('.add_new_menu').click(function(){
	$('#new_menubox').show(100)	
	$('.add_new_menu').text('编辑中......')
});
$('.del_new_menu').click(function() {
	$('#new_menubox').hide(100)
	$('.add_new_menu').text('+ 新增章节目录')	
});
function edit_menu(elm){
	$('.add_new_menu').text('编辑中......')
	$(elm).parent().parent().parent().hide()
	$(elm).parent().parent().parent().next().show()
}
function close_old_menu(elm){
	$('.add_new_menu').text('+ 新增章节目录')	
	$(elm).parent().parent().parent().hide()
	$(elm).parent().parent().parent().prev().show()
}
function save_menu(elm,sid){
	var catename = $(elm).parent().parent().parent().find("input[name='catename']").val()
	var sd_start = $(elm).parent().parent().parent().find("input[name='sd_start']").val()
	var sd_end = $(elm).parent().parent().parent().find("input[name='sd_end']").val()
	var kcid = $('#addks_nowkcid').val()
	$.ajax({
		url: "{php echo $this->createWebUrl('indexajax', array('op'=>'edit_menuset'))}",
		type: "post",
		dataType: "json",
		data: {
			sid:sid,
			kcid:kcid,
			catename:catename,
			schoolid:"{$schoolid}"
		},
		success: function (data) {
			if (data.result) {
				get_newmenu()
				$('#new_menubox').hide(100)
				$('.add_new_menu').text('+ 新增章节目录')	
			}
			alert(data.msg)
		}		
	});
}
function del_old_menu(elm,sid){
	$.ajax({
		url: "{php echo $this->createWebUrl('indexajax', array('op'=>'delet_menuset'))}",
		type: "post",
		dataType: "json",
		data: {
			sid:sid,
			schoolid:"{$schoolid}"
		},
		success: function (data) {
			if (data.result) {
				$(elm).parent().parent().parent().remove()
				$(elm).parent().parent().parent().prev().remove()
				get_newmenu()
			}else{
				
			}
			alert(data.msg)
		}		
	});
}
function pzzj(){//配置章节弹框
	$('#Modal9').modal('toggle');
	get_newmenu()
}
function get_newmenu(){//获取最新章节列表并渲染
	$('#old_menubox').empty()
	$('.allmenu_list').empty();
	var kcid = $('#addks_nowkcid').val()
	$.ajax({
		url: "{php echo $this->createWebUrl('indexajax', array('op'=>'getallmenulist'))}",
		type: "post",
		dataType: "json",
		data: {
			kcid:kcid,
			schoolid:"{$schoolid}"
		},
		success: function (data) {
			if (data.result) {
				var html = '';
				var html2 = '<option value="-1">默认章节</option>';
				var sddata = data.allmenu
				if(sddata.length>0){
					for (var i = 0; i < sddata.length; i++) {
							html +=	'<li>'+
									'	<div class="left_timeboxbig">'+sddata[i].name+'</div>'+
									'	<div class="right">'+
									'		<div class="opt_box">'+
									'			<i class="fa fa-edit" onclick="edit_menu(this)"></i>'+
									'			<i class="fa fa-trash-o" onclick="del_old_menu(this,'+sddata[i].id+')"></i>'+
									'		</div>'+
									'	</div>'+
									'</li>'+
									'<li style="display:none">'+
									'	<div class="left_timeboxbig"><input class="form-control new_timesave" name="catename" type="text" value="'+sddata[i].name+'"/></div>'+
									'	<div class="right">'+
									'		<div class="opt_box">'+
									'			<i class="fa fa-save" onclick="save_menu(this,'+sddata[i].id+')" data-id="new"></i>'+
									'			<i class="fa fa-times" onclick="close_old_menu(this)" data-id="new"></i>'+
									'		</div>'+
									'	</div>'+
									'</li>';
							html2 +='<option value="'+sddata[i].id+'">'+sddata[i].name+'</option>';				
					}
				}
				$('.allmenu_list').append(html2);
				$('#old_menubox').append(html);
			}
		}
	});
}

function getTemplibrary(){
	let cate_id = $(".tab_saidnav").find('.acts').attr('opt')
	$.ajax({
		url: "{php echo $this->createWebUrl('indexajax', array('op'=>'getTemplibrary','schoolid'=>$schoolid,'weid'=>$weid))}",
		type: "post",
		dataType: "html",
		data:{cate_id:cate_id},
		success: function (html) {
			$(".tempContent").html(html)
		}
	});
	// console.log($(".tab_saidnav").find('.acts').attr('opt'))
}

function getTempInfo(id,type){
	$.ajax({
		url: "{php echo $this->createWebUrl('indexajax', array('op'=>'getTempInfo','schoolid'=>$schoolid,'weid'=>$weid))}",
		type: "post",
		dataType: "json",
		data:{id:id},
		success: function (res) {
			var data = res.data
			if(type == 'preview'){
				$(".temp_catename").html(data.catename)
				$(".temp_description").html(data.description)
				$(".temp_name").html(data.name)
				$(".temp_content").html(data.content)
			}else{
				UE.getEditor('content').setContent(data.content);
				$("input[name='title']").val(data.name)
			}
		}
	});
}
</script>