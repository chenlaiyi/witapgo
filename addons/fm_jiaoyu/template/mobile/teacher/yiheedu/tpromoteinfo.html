<!DOCTYPE html>
<html>

<head>
    <title>{$school['title']}</title>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="viewport" content="width=device-width initial-scale=1.0 maximum-scale=1.0 user-scalable=0" />
        <link type="text/css" rel="stylesheet" href="{OSSURL}public/web/font-awesome5pro/css/all.min.css" />
        <link rel="stylesheet" type="text/css" href="{MODULE_URL}public/mobile/css/new_yab1.css?v=1?v=1111" />
        <script type="text/javascript" src="{MODULE_URL}public/mobile/js/autofitui.js?v=1.0.0"></script>
        <style>
            html::-webkit-scrollbar {display:none}
            html body{width: 100%;height: 100%;background-color: #efefef;padding:0;margin: 0;  }
            html body *{box-sizing: border-box;}
            .default-boxshadow{ box-shadow: 0.125rem 0.125rem 0.5rem 0rem rgba(218, 218, 218, 075)}
            .item-button { position: absolute; right: 0rem; border-radius: 0.3125rem; border: 0.0625rem solid #14c682; bottom: 0rem; }
            .item-button a { margin: 0.125rem; font-size: 0.8125rem; color: #6f6969; }
            .top-info-box{width:calc(100% - 1.25rem);background-color: #509ff1;margin: 0.625rem;border-radius: 0.3125rem;padding: 0.625rem;}
            .kcinfo-box{display: flex;align-items: center;}
            .kcthumb{ width: 3.75rem;height: 3.75rem;border-radius: 50%}
            .kcname-time{margin-left: 0.625rem;display: flex;flex-direction: column;flex:1;overflow: auto;}
            .kcname{line-height: 1.875rem;font-size: 1.125rem;color:white;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;width: 100%;}
            .kc-extra-info{line-height: 1.25rem;color:#efefef;font-size: 0.875rem;display: flex;}
            .kc-type{background-color: #ff5f5f;padding: 0rem 0.3125rem;font-size: 0.75rem;border-radius: 0.3125rem;margin-right: 0.3125rem;}
            .promote-root{display: flex;width: 100%;justify-content: space-between;padding: 0 0.625rem;margin: 0.9375rem 0 0.625rem 0;}
            .promote-info-box{color:white}
            .promote-info-box .promote-info-title{padding-left: 0.625rem;position: relative;margin-bottom: 0.3125rem;}
            .promote-info-box .promote-info-title:before{content:"";position: absolute;height:0.375rem;width: 0.375rem; left: 0; top: calc(50% - 0.1875rem);border-radius: 50%}
            .promote-info-box .promote-info-title.promotenum:before{background-color: #f95a5a;}
            .promote-info-box .promote-info-title.buynum:before{background-color: #80edff;}
            .promote-info-box .promote-info-title.percent:before{background-color: #1c55d4;}
            .promote-info-box .promote-info-number{width: 100%;text-align: center;}
            .middle-btn-box{display: flex;justify-content: space-between;padding:0.3125rem 0.625rem}
            .middle-btn-item{width: calc(50% - 0.1875rem);background-color: #fff;display: flex;flex-direction: row;align-items: center;padding:0.625rem 0.3125rem;border-radius: 0.1875rem;}
            .btn-img{width: 3.125rem;height: 3.125rem;background-color: red;border-radius: 0.1875rem;}
            .middle-btn-box .btn-desc{margin-left: 0.3125rem;line-height: 1.75rem;flex:1}
            .middle-btn-box .btn-title{font-size: 1rem;}
            .middle-btn-box .btn-tips{font-size: 0.75rem;color: gray;line-height: 1rem;}
            .btn-group-tri{display: flex;justify-content: space-between;padding: 0 0.625rem;}
            .btn-tri-item{background-color: #fff;display: flex;flex-direction: column;align-items: center;padding: 0.625rem;padding-bottom: 0.3125rem;border-radius: 0.3125rem;width: calc(33% - 0.375rem);}
            .btn-tri-item .item-img{width: 3.125rem;height: 3.125rem;position: relative;}
            .btn-tri-item .item-name{line-height: 1.875rem;margin-top: 0.3125rem;}
            .promote-log-box{display: flex;align-items: center;margin-bottom: 0.625rem;margin-top: 1.875rem; }
            .more-log{font-size: 0.875rem;color:gray}
            .promote-log{background-color: white;width: 100%;border-radius: 0.3125rem;display: flex;padding: 0.625rem;align-items: center;color:#2b2b2b;margin-bottom: 0.625rem;}
            .log-thumb{width: 2.5rem;height: 2.5rem;background-color: red;}
            .log-text-box{flex:1;padding-left:0.625rem;}
            .log-name-time{display: flex;align-items: center;}
            .log-name-time .name{font-size: 1rem;flex:1}
            .log-name-time .time{font-size: 0.75rem;color:gray}

            .share-btn-box{width: 2.5rem;height: 2.5rem;position: fixed;background-color: #1293de;bottom: 6.25rem;right: 1.25rem;border-radius: 50%;text-align: center;}
            .share-btn-group{position: fixed;right: 1.25rem;bottom: 10.625rem;color:#403e3e; transition: all .15s;transform: scale(0);transform-origin:right bottom}
            .share-btn-group.inshow{transform: scale(1); }
            .share-btn{background-color: #fff;margin-top: 1.25rem;border-radius: 0.3125rem;padding:0.5rem 0.625rem;}
            .share-mask{position: fixed;top:0;bottom: 0;height: 0;width: 0;background-color:rgba(0,0,0,0)}
            .share-mask.inshow{width: 100%;height: 100%;}

            .animate-four,.animate-four *{transition: all .15s;}
            .animate-four{position: absolute;top:0;bottom: 0;width: 100%;height: 100%;--CubeSize:0.4375rem;--CubeCloseRange:0.75rem;--CubeOpenRange:0.625rem;}
            .animate-four .cube{width:var(--CubeSize);height: var(--CubeSize);background-color: #fff;position: absolute;border-radius: 0.125rem;}
            .animate-four .cube.lt{top:var(--CubeCloseRange);left: var(--CubeCloseRange);}
            .animate-four .cube.rt{top:var(--CubeCloseRange);right: var(--CubeCloseRange);}
            .animate-four .cube.lb{bottom:var(--CubeCloseRange);left: var(--CubeCloseRange);}
            .animate-four .cube.rb{bottom:var(--CubeCloseRange);right: var(--CubeCloseRange);}
            .animate-four.inopen{transform: rotate(135deg);}
            .animate-four.inopen .cube{border-radius: 0.3125rem;}
            .animate-four.inopen .cube.lt{top:var(--CubeOpenRange);left: var(--CubeOpenRange);}
            .animate-four.inopen .cube.rt{top:var(--CubeOpenRange);right: var(--CubeOpenRange);}
            .animate-four.inopen .cube.lb{bottom:var(--CubeOpenRange);left: var(--CubeOpenRange);}
            .animate-four.inopen .cube.rb{bottom:var(--CubeOpenRange);right: var(--CubeOpenRange);}

            .family{text-align: center;width: 100%;} 
            .family img{width: 60%;} 
            .popContentBox {position: absolute;width: 88%;margin-left: 6%;max-height: 90%;top: 43%;transform: translateY(-50%);-webkit-transform: translateY(-50%);-moz-transform: translateY(-50%);-ms-transform: translateY(-50%); -o-transform: translateY(-50%);z-index: 101;background-color: white;border-radius: 10px;}
        </style>
    </head>
<body>
    <div id="main-box">
        <!-- 顶部信息 -->
        <div class="top-info-box default-boxshadow">
            <div class="kcinfo-box">
                <img class="kcthumb" src="{php echo tomedia($kcinfo['thumb'])}" alt="">
                <div class="kcname-time">
                    <div class="kcname">{$kcinfo['name']}</div>
                    <div class="kc-extra-info">
                        <span class="kc-type" >{$kcinfo['kc_type']}</span>
                        <span>{$kcinfo['start']} - {$kcinfo['end']}</span>
                    </div>
                </div>
            </div>
            <div
                style="width: 100%;height: 0.0625rem;margin: 0.625rem 0;background-image: linear-gradient(to right,#509ff1  , white ,#509ff1 );">
            </div>
            <!-- 推广人次/购买人次/转化率 -->
            <div class="promote-root">
                <div class="promote-info-box">
                    <div class="promote-info-title promotenum" >推广人次</div>
                    <div class="promote-info-number" >{$promoteinfo['promote_num']}</div>
                </div>
                <div class="promote-info-box">
                    <div class="promote-info-title buynum" >购买人次</div>
                    <div class="promote-info-number" >{$promoteinfo['buy_num']}</div>
                </div>
                <div class="promote-info-box">
                    <div class="promote-info-title percent" >转换率</div>
                    <div class="promote-info-number" >{$promoteinfo['percent']}%</div>
                </div>
            </div>
        </div>

        <!-- 三按钮 -->
        <div class="btn-group-tri" >
            <div class="btn-tri-item default-boxshadow" onclick="lookMore()">
                <div class="item-img"> 
                    <img  style="position: relative;height: 100%;width: 100%;" src="{MODULE_URL}public/mobile/img/share_svg.svg?v=2">
                </div>
                <div class="item-name">推广记录</div>
            </div>
            <div class="btn-tri-item default-boxshadow" onclick="level_center()">
                <div class="item-img"> 
                    <img  style="position: relative;height: 100%;width: 100%;" src="{MODULE_URL}public/mobile/img/peoples_leader.png">
                </div>
                <div class="item-name">层级关系</div>
            </div>
            <div class="btn-tri-item default-boxshadow" onclick="score_center()">
                <div class="item-img">
                    <img  style="position: relative;height: 100%;width: 100%;" src="{MODULE_URL}public/mobile/img/coin_pig.svg">    
                </div>
                <div class="item-name">积分中心</div>
            </div>
        </div>
        <!-- 推广记录 -->
        <div style="padding: 0.625rem;">
            <div class="promote-log-box" >
                <div style="flex:1">推广记录</div>
                <div class="more-log" onclick="lookMore()">查看更多 <i class="fas fa-angle-right"></i> </div>
            </div>
            <div>
                {loop $promote_log $item}
                <div class="promote-log">
                    <div > 
                        <img src="{$item['avatar']}" style="width: 2.5rem; height: 2.5rem; border-radius: 50%; border: 1px solid #ccc;">
                    </div>
                    <div class="log-text-box">
                        <div class="log-name-time">
                            <div class="name">{$item['nickname']}</div>
                            <div class="time">{$item['createtime']}</div>
                        </div>
                        {if $item['score'] != 0}
                        <div  style="font-size: 0.875rem;color:gray">
                            <span>购买课程</span>
                            <span style="color:red">+{$item['score']}</span>
                        </div>
                        {else}
                        <div  style="font-size: 0.875rem;color:gray">
                            <span>打开推广链接</span>
                        </div>
                        {/if}
                    </div>
                </div>
                {/loop}
            </div>
        </div>

        <!-- 生成海报的按钮 -->
        <div class="share-btn-box default-boxshadow" onclick="SwShow()" > 
            <div class="animate-four">
                <div class="cube lt"></div>
                <div class="cube rt"></div>
                <div class="cube rb"></div>
                <div class="cube lb"></div>
            </div>
        </div>

        <div class="share-mask" onclick="SwShow()"> </div>

        <div class="share-btn-group">
            {if $is_promote_level}
            <div class="default-boxshadow share-btn" onclick="get_kc_share(`{$_GPC['relation_id']}`,'tz');">
                <i class="fas fa-users"></i>
                <span style="font-size: 0.875rem">拓展海报</span>
            </div>
            {/if}
            <div class="default-boxshadow share-btn" onclick="get_kc_share(`{$_GPC['relation_id']}`,'kc');">
                <i class="fas fa-share-square"></i>
                <span style="font-size: 0.875rem;">课程海报</span>
            </div>
        </div>
    </div>

    <!--邀请卡弹框-->
    <div class="popUpBox" style="display: none">
        <div class="trackMatte"></div>
        <div class="popContentBox">
            <div class="poptitle">
            生成推广卡
            <p class="notifyCreateTime">长按保存您的邀请卡，邀请好友一起推广</p>
            </div>
            <div class="sectionContBox">
                <div class="family" id="family">
                </div>
                <div class="btnBox">
                    <div class="btnPass" onclick="refrash_pop();">刷新</div>
                    <div class="btnCancel">关闭</div>
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript" src="{MODULE_URL}public/mobile/js/jquery-1.11.3.min.js?v=4.6"></script>
    <script>
        function SwShow(){
            $(".share-btn-group").toggleClass("inshow")
            $(".share-mask").toggleClass("inshow")
            $(".animate-four").toggleClass("inopen")
        }
        //查看推广记录
        function lookMore(){
            location.href = "{php echo $this->createMobileUrl('tpromoteinfo_log', array('schoolid' => $schoolid,'myuserid'=>$_GPC['myuserid'],'kc_id'=>$_GPC['kc_id']), true)}"
        }

        //层级关系
        function level_center(){
            location.href = "{php echo $this->createMobileUrl('level_center', array('schoolid' => $schoolid,'myuserid'=>$_GPC['myuserid'],'kc_id'=>$_GPC['kc_id']))}"
        }
        
        //积分中心
        function score_center(){
            location.href = "{php echo $this->createMobileUrl('score_center', array('schoolid' => $schoolid,'myuserid'=>$_GPC['myuserid'],'kc_id'=>$_GPC['kc_id']))}"
        }
        /************拓展海报/分享海报***************/
        var relation_id = 0;
        var sharetype = '';
        //打开分享卡
        function get_kc_share(id,type){
            //关闭浮动按钮
            SwShow()
            relation_id = id
            sharetype = type
            $('.popUpBox').slideDown(200);
            $('#share_id').val(id)
            $('#family').empty()
            $('#family').append("<div class='conent_load'></div>");//加载动画
            $.ajax({
                url: "{php echo $this->createMobileUrl('kcajax', array('op' => 'get_kc_share'))}",
                type: "post",
                dataType: "json",
                data: {
                    id:id,
                    type:type,
                    schoolid:"{$schoolid}"
                },
                success: function (data) {
                    $('#family').empty()
                    let picurl = decodeURIComponent(data.poster)
                    let contet = '<img onclick="wxImageShow(this);" src="'+picurl+'" />';
                    $('#family').append(contet)
                },
                error: function (jqXHR, textStatus, errorThrown){
                    // let NewJson = JSON.stringify(jqXHR)
                    // alert(NewJson)
                    console.log(jqXHR)
                    console.log(textStatus)
                    console.log(errorThrown)
                    
                }
            });
        }
        $('.btnCancel').click(function() {
            $('.popUpBox').hide();
            $('html,body').removeClass('popNoscroll');
        });

        $(".trackMatte").on("click",function(){
            e = window.event;
            e.stopPropagation();
            e.preventDefault();
            $('.popUpBox').slideUp(200);
            $('html,body').removeClass('popNoscroll');
        })
        //刷新海报
        function refrash_pop(){
            $('#family').empty()
            let loadcont = "<div class='conent_load'></div>";
            $('#family').append(loadcont);//加载动画
            $.ajax({
                url: "{php echo $this->createMobileUrl('kcajax', array('op' => 'get_kc_share'))}",
                type: "post",
                dataType: "json",
                data: {
                    id:relation_id,
                    type:sharetype,
                    schoolid:"{$schoolid}"
                },
                success: function (data) {
                    $('#family').empty()
                    let picurl = decodeURIComponent(data.poster)
                    let contet = '<img onclick="wxImageShow(this);" src="'+picurl+'" />';
                    $('#family').append(contet)
                }
            });
        }
        function wxImageShow(elm){
            var srcList = new Array();
            var pic = $(elm).attr("src")
            srcList.push(pic);
            WeixinApi.imagePreview(pic, srcList);
        }
        var WeixinApi = (function () {
            return {
                imagePreview    :imagePreview
            }; 
            "use strict";
            function imagePreview(curSrc,srcList) {
                if(!curSrc || !srcList || srcList.length == 0) {
                    return;
                }
                WeixinJSBridge.invoke('imagePreview', {
                    'current' : curSrc,
                    'urls' : srcList
                });
            }
            return {
                version         :"2.5",
                imagePreview    :imagePreview
            };
        })();
        /************拓展海报/分享海报***************/

    </script>

</body>

 

</html>


