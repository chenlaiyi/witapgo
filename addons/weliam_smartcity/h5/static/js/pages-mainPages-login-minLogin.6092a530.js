(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-mainPages-login-minLogin"],{"25a6":function(n,e,t){"use strict";var a=t("4ea4");t("d3b7"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=a(t("5530")),i=a(t("2c7c")),r={data:function(){return{disabled:!1}},components:{},computed:{appInfo:function(){return this.$store.state.appInfo}},onLoad:function(n){},onShow:function(){},mounted:function(){},methods:{pasLogin:function(){uni.reLaunch({url:"/pages/mainPages/login/login"})},appLogin:function(){var n=this,e={};uni.getProvider({service:"oauth",success:function(t){uni.login({provider:"weixin",success:function(t){getCurrentPages();var a=t.authResult.access_token,o=t.authResult.openid;console.log("-------获取openid(unionid)-----"),console.log("token",a),console.log("openid",o),console.log(JSON.stringify(t)),uni.getUserInfo({provider:"weixin",success:function(i){console.log("-------获取微信用户所有-----"),console.log(JSON.stringify(i.userInfo)),e.head_id=uni.getStorageSync("head_id"),e=Object.assign(e,{nickName:i.userInfo.nickName||"",avatarUrl:i.userInfo.avatarUrl,access_token:a,openid:o,source1:"4"}),e=Object.assign(e,t.authResult,i.userInfo),n.getUserInfo(e)}})}})}})},vu:function(){},cancelLogin:function(){uni.navigateBack({delta:2})},authorLogin:function(n){var e=this,t=e.$store.state.clientType;if(e.disabled=!0,"2"===t&&"getUserInfo:ok"!==n.detail.errMsg)return i.default.showError("登录失败,请重试"),e.disabled=!1,!1;uni.getProvider({service:"oauth",success:function(t){console.log("getProvider",t.provider),e.userLogin(t.provider[0],n.detail)}})},getLoginData:function(n,e){return new Promise((function(t,a){e.iv&&e.encryptedData?t(e):uni.getUserInfo({withCredentials:!0,complete:function(e){console.log(e),e.iv||"alipay"===n?(!e.encryptedData&&e.data&&(e.encryptedData=e.data),t(e)):a()}})}))},userLogin:function(n,e){var t=this,a=i.default.getClientType(),o={};uni.showLoading({title:"正在登录"}),uni.login({provider:n,scopes:"auth_user",success:function(r){o.code=r.code,o.head_id=uni.getStorageSync("head_id"),t.getLoginData(n,e).then((function(n){"3"===a&&(o=Object.assign(o,{source:"3",mode:"2",encryptedData:n.encryptedData,iv:n.iv})),"7"===a&&(o=Object.assign(o,{nickName:n.userInfo.nickName||"",avatarUrl:n.userInfo.avatarUrl})),t.getUserInfo(o)})).catch((function(){t.disabled=!1,uni.navigateBack(),"9"===a?uni.showModal({title:"登录失败",content:"请点击确定允许授权后,重新登录",success:function(n){n.confirm&&uni.openSetting({success:function(n){n.authSetting["scope.userInfo"]&&i.default.showError("授权成功,请重新登录")}})}}):i.default.showError("登录失败,请重试")}))}})},getUserInfo:function(n){var e=this;console.log("登陆的参数",JSON.stringify(n)),i.default._post_form("&p=member&do=login",(0,o.default)({},n),(function(t){console.log(t),console.log("登陆的参数",n.source);var a=t.data.token;uni.setStorageSync("weliam_user_token",a),e.disabled=!1,e.$store.commit("WXLOGIN",1),e.navigateBack()}),!1,(function(){uni.hideLoading()}))},navigateBack:function(){var n=getCurrentPages(),e=n[n.length-2];uni.getStorageSync("currentPage").options;i.default.removeCurrentPage(),"pages/mainPages/write/write"===e.route?uni.reLaunch({url:"/pages/mainPages/index/index"}):uni.navigateBack()}}};e.default=r},"2e8d":function(n,e,t){"use strict";t.r(e);var a=t("25a6"),o=t.n(a);for(var i in a)"default"!==i&&function(n){t.d(e,n,(function(){return a[n]}))}(i);e["default"]=o.a},"4a6b":function(n,e,t){"use strict";var a;t.d(e,"b",(function(){return o})),t.d(e,"c",(function(){return i})),t.d(e,"a",(function(){return a}));var o=function(){var n=this,e=n.$createElement,t=n._self._c||e;return t("v-uni-view",{staticClass:"container"},[t("v-uni-view",{staticClass:"wechatapp"},[t("v-uni-view",{staticClass:"header"},[t("v-uni-image",{attrs:{src:n.appInfo.logo}}),t("v-uni-view",{staticClass:"app-name t-c f-26 col-3"},[n._v(n._s(n.appInfo.name))])],1)],1),t("v-uni-view",{staticClass:"auth-title"},[n._v("申请获取以下权限:")]),t("v-uni-view",{staticClass:"auth-subtitle"},[n._v("• 获得你的公开信息（昵称、头像等）")]),t("v-uni-view",{staticClass:"dis-flex flex-x-around"},[t("v-uni-button",{staticClass:"login-btn login-cancel",on:{click:function(e){arguments[0]=e=n.$handleEvent(e),n.cancelLogin.apply(void 0,arguments)}}},[n._v("暂不登录")]),t("v-uni-button",{staticClass:"login-btn",attrs:{disabled:n.disabled},on:{click:function(e){arguments[0]=e=n.$handleEvent(e),n.authorLogin.apply(void 0,arguments)}}},[n._v("授权登录")])],1)],1)},i=[]},5029:function(n,e,t){var a=t("24fb");e=a(!1),e.push([n.i,"uni-page-body[data-v-f3ddd8ba]{background:#fff;font-size:%?32?%}.container[data-v-f3ddd8ba]{padding:0 %?60?%}.wechatapp[data-v-f3ddd8ba]{padding:15% 0 10%;border-bottom:%?1?% solid #e3e3e3;margin-bottom:%?45?%;text-align:center}.wechatapp .header[data-v-f3ddd8ba]{margin:0 auto}.wechatapp .header .app-name[data-v-f3ddd8ba]{margin-top:%?30?%}.wechatapp .header uni-image[data-v-f3ddd8ba]{width:%?100?%;height:%?100?%;margin:0 auto;display:block;border-radius:50%;border:2px solid #fff;-webkit-box-shadow:1px 0 5px rgba(50,50,50,.3);box-shadow:1px 0 5px rgba(50,50,50,.3);background-size:100% 100%}.auth-title[data-v-f3ddd8ba]{color:#585858;font-size:%?28?%;margin-bottom:%?40?%}.auth-subtitle[data-v-f3ddd8ba]{color:#999;margin-bottom:%?72?%;font-size:%?22?%}.login-btn[data-v-f3ddd8ba]{border:none;height:%?80?%;line-height:%?80?%;background:#ffd940;color:#333;font-size:10pt;border-radius:%?6?%;width:45%}.login-btn[data-v-f3ddd8ba]::after{display:none}.login-btn.button-hover[data-v-f3ddd8ba]{\n\t/* box-shadow: inset 0 5upx 30upx rgba(0, 0, 0, 0.15); */}.login-btn.login-cancel[data-v-f3ddd8ba]{color:#999;background:#efefef}body.?%PAGE?%[data-v-f3ddd8ba]{background:#fff}",""]),n.exports=e},"8d40":function(n,e,t){"use strict";t.r(e);var a=t("4a6b"),o=t("2e8d");for(var i in o)"default"!==i&&function(n){t.d(e,n,(function(){return o[n]}))}(i);t("945c");var r,s=t("f0c5"),d=Object(s["a"])(o["default"],a["b"],a["c"],!1,null,"f3ddd8ba",null,!1,a["a"],r);e["default"]=d.exports},"945c":function(n,e,t){"use strict";var a=t("fe5e"),o=t.n(a);o.a},fe5e:function(n,e,t){var a=t("5029");"string"===typeof a&&(a=[[n.i,a,""]]),a.locals&&(n.exports=a.locals);var o=t("4f06").default;o("013c08e1",a,!0,{sourceMap:!1,shadowMode:!1})}}]);