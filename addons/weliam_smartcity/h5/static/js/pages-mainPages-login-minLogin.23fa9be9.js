(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-mainPages-login-minLogin"],{4918:function(e,t,n){"use strict";n.r(t);var a=n("9c5a"),i=n("73d8");for(var o in i)"default"!==o&&function(e){n.d(t,e,function(){return i[e]})}(o);n("80f6");var r,u=n("f0c5"),d=Object(u["a"])(i["default"],a["b"],a["c"],!1,null,"5e13f43d",null,!1,a["a"],r);t["default"]=d.exports},"4e38":function(e,t,n){t=e.exports=n("2350")(!1),t.push([e.i,"uni-page-body[data-v-5e13f43d]{background:#fff;font-size:%?32?%}.container[data-v-5e13f43d]{padding:0 %?60?%}.wechatapp[data-v-5e13f43d]{padding:15% 0 10%;border-bottom:%?1?% solid #e3e3e3;margin-bottom:%?45?%;text-align:center}.wechatapp .header[data-v-5e13f43d]{margin:0 auto}.wechatapp .header .app-name[data-v-5e13f43d]{margin-top:%?30?%}.wechatapp .header uni-image[data-v-5e13f43d]{width:%?100?%;height:%?100?%;margin:0 auto;display:block;border-radius:50%;border:2px solid #fff;box-shadow:1px 0 5px rgba(50,50,50,.3);background-size:100% 100%}.auth-title[data-v-5e13f43d]{color:#585858;font-size:%?28?%;margin-bottom:%?40?%}.auth-subtitle[data-v-5e13f43d]{color:#999;margin-bottom:%?72?%;font-size:%?22?%}.login-btn[data-v-5e13f43d]{border:none;height:%?80?%;line-height:%?80?%;background:#ffd940;color:#333;font-size:10pt;border-radius:%?6?%;width:45%}.login-btn[data-v-5e13f43d]::after{display:none}.login-btn.button-hover[data-v-5e13f43d]{\n\t/* box-shadow: inset 0 5upx 30upx rgba(0, 0, 0, 0.15); */}.login-btn.login-cancel[data-v-5e13f43d]{color:#999;background:#efefef}body.?%PAGE?%[data-v-5e13f43d]{background:#fff}",""])},"4f19":function(e,t,n){var a=n("4e38");"string"===typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);var i=n("4f06").default;i("44ea2b40",a,!0,{sourceMap:!1,shadowMode:!1})},"73d8":function(e,t,n){"use strict";n.r(t);var a=n("e3d8"),i=n.n(a);for(var o in a)"default"!==o&&function(e){n.d(t,e,function(){return a[e]})}(o);t["default"]=i.a},"80f6":function(e,t,n){"use strict";var a=n("4f19"),i=n.n(a);i.a},"9c5a":function(e,t,n){"use strict";var a,i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-uni-view",{staticClass:"container"},[n("v-uni-view",{staticClass:"wechatapp"},[n("v-uni-view",{staticClass:"header"},[n("v-uni-image",{attrs:{src:e.appInfo.logo}}),n("v-uni-view",{staticClass:"app-name t-c f-26 col-3"},[e._v(e._s(e.appInfo.name))])],1)],1),n("v-uni-view",{staticClass:"auth-title"},[e._v("申请获取以下权限:")]),n("v-uni-view",{staticClass:"auth-subtitle"},[e._v("• 获得你的公开信息（昵称、头像等）")]),n("v-uni-view",{staticClass:"dis-flex flex-x-around"},[n("v-uni-button",{staticClass:"login-btn login-cancel",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.cancelLogin.apply(void 0,arguments)}}},[e._v("暂不登录")]),n("v-uni-button",{staticClass:"login-btn",attrs:{disabled:e.disabled},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.authorLogin.apply(void 0,arguments)}}},[e._v("授权登录")])],1)],1)},o=[];n.d(t,"b",function(){return i}),n.d(t,"c",function(){return o}),n.d(t,"a",function(){return a})},e3d8:function(e,t,n){"use strict";var a=n("288e");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=a(n("cebc")),o=a(n("5176")),r=a(n("795b")),u=a(n("80bf")),d={data:function(){return{disabled:!1}},components:{},computed:{appInfo:function(){return this.$store.state.appInfo}},onLoad:function(e){},onShow:function(){},mounted:function(){},methods:{cancelLogin:function(){uni.navigateBack()},authorLogin:function(e){var t=this,n=t.$store.state.clientType;if(t.disabled=!0,"2"===n&&"getUserInfo:ok"!==e.detail.errMsg)return u.default.showError("登录失败,请重试"),t.disabled=!1,!1;uni.getProvider({service:"oauth",success:function(n){console.log("getProvider",n.provider),t.userLogin(n.provider[0],e.detail)}})},getLoginData:function(e,t){return new r.default(function(n,a){t.iv&&t.encryptedData?n(t):uni.getUserInfo({withCredentials:!0,complete:function(t){console.log(t),t.iv||"alipay"===e?(!t.encryptedData&&t.data&&(t.encryptedData=t.data),n(t)):a()}})})},userLogin:function(e,t){var n=this,a=u.default.getClientType(),i={};uni.showLoading({title:"正在登录"}),uni.login({provider:e,scopes:"auth_user",success:function(r){i.code=r.code,i.head_id=uni.getStorageSync("head_id"),n.getLoginData(e,t).then(function(e){"3"===a&&(i=(0,o.default)(i,{source:"3",mode:"2",encryptedData:e.encryptedData,iv:e.iv})),"7"===a&&(i=(0,o.default)(i,{nickName:e.userInfo.nickName||"",avatarUrl:e.userInfo.avatarUrl})),n.getUserInfo(i)}).catch(function(){n.disabled=!1,"9"===a?uni.showModal({title:"登录失败",content:"请点击确定允许授权后,重新登录",success:function(e){e.confirm&&uni.openSetting({success:function(e){e.authSetting["scope.userInfo"]&&u.default.showError("授权成功,请重新登录")}})}}):u.default.showError("登录失败,请重试")})}})},getUserInfo:function(e){var t=this;u.default._post_form("&p=member&do=login",(0,i.default)({},e),function(e){console.log(e);var n=e.data.token;uni.setStorageSync("weliam_user_token",n),t.disabled=!1,t.$store.commit("WXLOGIN",1),t.navigateBack()},!1,function(){uni.hideLoading()})},navigateBack:function(){var e=getCurrentPages(),t=e[e.length-2];uni.getStorageSync("currentPage").options;u.default.removeCurrentPage(),"pages/mainPages/write/write"===t.route?uni.reLaunch({url:"/pages/mainPages/index/index"}):uni.navigateBack()}}};t.default=d}}]);