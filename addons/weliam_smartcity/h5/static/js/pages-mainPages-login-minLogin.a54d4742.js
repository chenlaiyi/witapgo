(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-mainPages-login-minLogin"],{"02d4":function(t,n,e){var a=e("24fb");n=a(!1),n.push([t.i,"uni-page-body[data-v-4d29b366]{background:#fff;font-size:%?32?%}.container[data-v-4d29b366]{padding:0 %?60?%}.wechatapp[data-v-4d29b366]{padding:15% 0 10%;border-bottom:%?1?% solid #e3e3e3;margin-bottom:%?45?%;text-align:center}.wechatapp .header[data-v-4d29b366]{margin:0 auto}.wechatapp .header .app-name[data-v-4d29b366]{margin-top:%?30?%}.wechatapp .header uni-image[data-v-4d29b366]{width:%?100?%;height:%?100?%;margin:0 auto;display:block;border-radius:50%;border:2px solid #fff;box-shadow:1px 0 5px rgba(50,50,50,.3);background-size:100% 100%}.auth-title[data-v-4d29b366]{color:#585858;font-size:%?28?%;margin-bottom:%?40?%}.auth-subtitle[data-v-4d29b366]{color:#999;margin-bottom:%?72?%;font-size:%?22?%}.login-btn[data-v-4d29b366]{border:none;height:%?80?%;line-height:%?80?%;background:#ffd940;color:#333;font-size:10pt;border-radius:%?6?%;width:45%}.login-btn[data-v-4d29b366]::after{display:none}.login-btn.button-hover[data-v-4d29b366]{\n\t/* box-shadow: inset 0 5upx 30upx rgba(0, 0, 0, 0.15); */}.login-btn.login-cancel[data-v-4d29b366]{color:#999;background:#efefef}body.?%PAGE?%[data-v-4d29b366]{background:#fff}",""]),t.exports=n},"25a6":function(t,n,e){"use strict";var a=e("4ea4");e("d3b7"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i=a(e("5530")),o=a(e("2c7c")),r={data:function(){return{disabled:!1}},components:{},computed:{appInfo:function(){return this.$store.state.appInfo}},onLoad:function(t){},onShow:function(){},mounted:function(){},methods:{vu:function(){},cancelLogin:function(){uni.navigateBack({delta:2})},authorLogin:function(t){var n=this,e=n.$store.state.clientType;if(n.disabled=!0,"2"===e&&"getUserInfo:ok"!==t.detail.errMsg)return o.default.showError("登录失败,请重试"),n.disabled=!1,!1;uni.getProvider({service:"oauth",success:function(e){console.log("getProvider",e.provider),n.userLogin(e.provider[0],t.detail)}})},getLoginData:function(t,n){return new Promise((function(e,a){n.iv&&n.encryptedData?e(n):uni.getUserInfo({withCredentials:!0,complete:function(n){console.log(n),n.iv||"alipay"===t?(!n.encryptedData&&n.data&&(n.encryptedData=n.data),e(n)):a()}})}))},userLogin:function(t,n){var e=this,a=o.default.getClientType(),i={};uni.showLoading({title:"正在登录"}),uni.login({provider:t,scopes:"auth_user",success:function(r){i.code=r.code,i.head_id=uni.getStorageSync("head_id"),e.getLoginData(t,n).then((function(t){"3"===a&&(i=Object.assign(i,{source:"3",mode:"2",encryptedData:t.encryptedData,iv:t.iv})),"7"===a&&(i=Object.assign(i,{nickName:t.userInfo.nickName||"",avatarUrl:t.userInfo.avatarUrl})),e.getUserInfo(i)})).catch((function(){e.disabled=!1,uni.navigateBack(),"9"===a?uni.showModal({title:"登录失败",content:"请点击确定允许授权后,重新登录",success:function(t){t.confirm&&uni.openSetting({success:function(t){t.authSetting["scope.userInfo"]&&o.default.showError("授权成功,请重新登录")}})}}):o.default.showError("登录失败,请重试")}))}})},getUserInfo:function(t){var n=this;o.default._post_form("&p=member&do=login",(0,i.default)({},t),(function(t){console.log(t);var e=t.data.token;uni.setStorageSync("weliam_user_token",e),n.disabled=!1,n.$store.commit("WXLOGIN",1),n.navigateBack()}),!1,(function(){uni.hideLoading()}))},navigateBack:function(){var t=getCurrentPages(),n=t[t.length-2];uni.getStorageSync("currentPage").options;o.default.removeCurrentPage(),"pages/mainPages/write/write"===n.route?uni.reLaunch({url:"/pages/mainPages/index/index"}):uni.navigateBack()}}};n.default=r},"2e8d":function(t,n,e){"use strict";e.r(n);var a=e("25a6"),i=e.n(a);for(var o in a)"default"!==o&&function(t){e.d(n,t,(function(){return a[t]}))}(o);n["default"]=i.a},3608:function(t,n,e){"use strict";var a;e.d(n,"b",(function(){return i})),e.d(n,"c",(function(){return o})),e.d(n,"a",(function(){return a}));var i=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("v-uni-view",{staticClass:"container"},[e("v-uni-view",{staticClass:"wechatapp"},[e("v-uni-view",{staticClass:"header"},[e("v-uni-image",{attrs:{src:t.appInfo.logo}}),e("v-uni-view",{staticClass:"app-name t-c f-26 col-3"},[t._v(t._s(t.appInfo.name))])],1)],1),e("v-uni-view",{staticClass:"auth-title"},[t._v("申请获取以下权限:")]),e("v-uni-view",{staticClass:"auth-subtitle"},[t._v("• 获得你的公开信息（昵称、头像等）")]),e("v-uni-view",{staticClass:"dis-flex flex-x-around"},[e("v-uni-button",{staticClass:"login-btn login-cancel",on:{click:function(n){arguments[0]=n=t.$handleEvent(n),t.cancelLogin.apply(void 0,arguments)}}},[t._v("暂不登录")]),e("v-uni-button",{staticClass:"login-btn",attrs:{disabled:t.disabled},on:{click:function(n){arguments[0]=n=t.$handleEvent(n),t.authorLogin.apply(void 0,arguments)}}},[t._v("授权登录")])],1)],1)},o=[]},"8d40":function(t,n,e){"use strict";e.r(n);var a=e("3608"),i=e("2e8d");for(var o in i)"default"!==o&&function(t){e.d(n,t,(function(){return i[t]}))}(o);e("dc0d");var r,d=e("f0c5"),u=Object(d["a"])(i["default"],a["b"],a["c"],!1,null,"4d29b366",null,!1,a["a"],r);n["default"]=u.exports},"8eb8":function(t,n,e){var a=e("02d4");"string"===typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);var i=e("4f06").default;i("91c45fee",a,!0,{sourceMap:!1,shadowMode:!1})},dc0d:function(t,n,e){"use strict";var a=e("8eb8"),i=e.n(a);i.a}}]);