(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-mainPages-login-minLogin"],{"25a6":function(e,n,t){"use strict";var a=t("4ea4");t("d3b7"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var o=a(t("5530")),i=a(t("2c7c")),s={data:function(){return{disabled:!1}},components:{},computed:{appInfo:function(){return this.$store.state.appInfo}},onLoad:function(e){},onShow:function(){},mounted:function(){},methods:{pasLogin:function(){uni.reLaunch({url:"/pages/mainPages/login/login"})},appLogin:function(){setTimeout((function(){uni.showToast({title:"成功1"})}),1e3);var e=this,n={};uni.getProvider({service:"oauth",success:function(t){setTimeout((function(){uni.showToast({title:"成功2"})}),2e3),setTimeout((function(){uni.showToast({title:"成功6"})}),6e3),uni.login({provider:"weixin",success:function(t){setTimeout((function(){uni.showToast({title:"成功3"})}),3e3);getCurrentPages();var a=t.authResult.access_token,o=t.authResult.openid;console.log("-------获取openid(unionid)-----"),console.log("token",a),console.log("openid",o),console.log(JSON.stringify(t)),uni.getUserInfo({provider:"weixin",success:function(i){setTimeout((function(){uni.showToast({title:"成功4"})}),4e3),console.log("-------获取微信用户所有-----"),console.log(JSON.stringify(i.userInfo)),n.head_id=uni.getStorageSync("head_id"),n=Object.assign(n,{nickName:i.userInfo.nickName||"",avatarUrl:i.userInfo.avatarUrl,access_token:a,openid:o,source1:"4"}),n=Object.assign(n,t.authResult,i.userInfo),e.getUserInfo(n)}})}})}})},vu:function(){},cancelLogin:function(){uni.navigateBack({delta:2})},authorLogin:function(e){var n=this,t=n.$store.state.clientType;if(n.disabled=!0,"2"===t&&"getUserInfo:ok"!==e.detail.errMsg)return i.default.showError("登录失败,请重试"),n.disabled=!1,!1;uni.getProvider({service:"oauth",success:function(t){console.log("getProvider",t.provider),n.userLogin(t.provider[0],e.detail)}})},getLoginData:function(e,n){return new Promise((function(t,a){n.iv&&n.encryptedData?t(n):uni.getUserInfo({withCredentials:!0,complete:function(n){console.log(n),n.iv||"alipay"===e?(!n.encryptedData&&n.data&&(n.encryptedData=n.data),t(n)):a()}})}))},userLogin:function(e,n){var t=this,a=i.default.getClientType(),o={};uni.showLoading({title:"正在登录"}),uni.login({provider:e,scopes:"auth_user",success:function(s){o.code=s.code,o.head_id=uni.getStorageSync("head_id"),t.getLoginData(e,n).then((function(e){"3"===a&&(o=Object.assign(o,{source:"3",mode:"2",encryptedData:e.encryptedData,iv:e.iv})),"7"===a&&(o=Object.assign(o,{nickName:e.userInfo.nickName||"",avatarUrl:e.userInfo.avatarUrl})),t.getUserInfo(o)})).catch((function(){t.disabled=!1,uni.navigateBack(),"9"===a?uni.showModal({title:"登录失败",content:"请点击确定允许授权后,重新登录",success:function(e){e.confirm&&uni.openSetting({success:function(e){e.authSetting["scope.userInfo"]&&i.default.showError("授权成功,请重新登录")}})}}):i.default.showError("登录失败,请重试")}))}})},getUserInfo:function(e){var n=this;console.log("登陆的参数",JSON.stringify(e)),i.default._post_form("&p=member&do=login",(0,o.default)({},e),(function(t){console.log(t),console.log("登陆的参数",e.source);var a=t.data.token;uni.setStorageSync("weliam_user_token",a),n.disabled=!1,n.$store.commit("WXLOGIN",1),n.navigateBack()}),!1,(function(){uni.hideLoading()}))},navigateBack:function(){var e=getCurrentPages(),n=e[e.length-2];uni.getStorageSync("currentPage").options;i.default.removeCurrentPage(),"pages/mainPages/write/write"===n.route?uni.reLaunch({url:"/pages/mainPages/index/index"}):uni.navigateBack()}}};n.default=s},"2e8d":function(e,n,t){"use strict";t.r(n);var a=t("25a6"),o=t.n(a);for(var i in a)"default"!==i&&function(e){t.d(n,e,(function(){return a[e]}))}(i);n["default"]=o.a},"4e46":function(e,n,t){var a=t("24fb");n=a(!1),n.push([e.i,"uni-page-body[data-v-556d8e53]{background:#fff;font-size:%?32?%}.container[data-v-556d8e53]{padding:0 %?60?%}.wechatapp[data-v-556d8e53]{padding:15% 0 10%;border-bottom:%?1?% solid #e3e3e3;margin-bottom:%?45?%;text-align:center}.wechatapp .header[data-v-556d8e53]{margin:0 auto}.wechatapp .header .app-name[data-v-556d8e53]{margin-top:%?30?%}.wechatapp .header uni-image[data-v-556d8e53]{width:%?100?%;height:%?100?%;margin:0 auto;display:block;border-radius:50%;border:2px solid #fff;box-shadow:1px 0 5px rgba(50,50,50,.3);background-size:100% 100%}.auth-title[data-v-556d8e53]{color:#585858;font-size:%?28?%;margin-bottom:%?40?%}.auth-subtitle[data-v-556d8e53]{color:#999;margin-bottom:%?72?%;font-size:%?22?%}.login-btn[data-v-556d8e53]{border:none;height:%?80?%;line-height:%?80?%;background:#ffd940;color:#333;font-size:10pt;border-radius:%?6?%;width:45%}.login-btn[data-v-556d8e53]::after{display:none}.login-btn.button-hover[data-v-556d8e53]{\n\t/* box-shadow: inset 0 5upx 30upx rgba(0, 0, 0, 0.15); */}.login-btn.login-cancel[data-v-556d8e53]{color:#999;background:#efefef}body.?%PAGE?%[data-v-556d8e53]{background:#fff}",""]),e.exports=n},"879e":function(e,n,t){var a=t("4e46");"string"===typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);var o=t("4f06").default;o("3304ee4c",a,!0,{sourceMap:!1,shadowMode:!1})},"8d40":function(e,n,t){"use strict";t.r(n);var a=t("e6d1"),o=t("2e8d");for(var i in o)"default"!==i&&function(e){t.d(n,e,(function(){return o[e]}))}(i);t("e2b1");var s,r=t("f0c5"),u=Object(r["a"])(o["default"],a["b"],a["c"],!1,null,"556d8e53",null,!1,a["a"],s);n["default"]=u.exports},e2b1:function(e,n,t){"use strict";var a=t("879e"),o=t.n(a);o.a},e6d1:function(e,n,t){"use strict";var a;t.d(n,"b",(function(){return o})),t.d(n,"c",(function(){return i})),t.d(n,"a",(function(){return a}));var o=function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("v-uni-view",{staticClass:"container"},[t("v-uni-view",{staticClass:"wechatapp"},[t("v-uni-view",{staticClass:"header"},[t("v-uni-image",{attrs:{src:e.appInfo.logo}}),t("v-uni-view",{staticClass:"app-name t-c f-26 col-3"},[e._v(e._s(e.appInfo.name))])],1)],1),t("v-uni-view",{staticClass:"auth-title"},[e._v("申请获取以下权限:")]),t("v-uni-view",{staticClass:"auth-subtitle"},[e._v("• 获得你的公开信息（昵称、头像等）")]),t("v-uni-view",{staticClass:"dis-flex flex-x-around"},[t("v-uni-button",{staticClass:"login-btn login-cancel",on:{click:function(n){arguments[0]=n=e.$handleEvent(n),e.cancelLogin.apply(void 0,arguments)}}},[e._v("暂不登录")]),t("v-uni-button",{staticClass:"login-btn",attrs:{disabled:e.disabled},on:{click:function(n){arguments[0]=n=e.$handleEvent(n),e.authorLogin.apply(void 0,arguments)}}},[e._v("授权登录")])],1)],1)},i=[]}}]);