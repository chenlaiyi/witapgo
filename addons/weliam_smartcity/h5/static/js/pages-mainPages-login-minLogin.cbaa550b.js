(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-mainPages-login-minLogin"],{"3c8a":function(t,a,e){"use strict";var n=e("288e");Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var o=n(e("cebc")),i=n(e("5176")),c=n(e("795b")),r=n(e("3368")),u={data:function(){return{disabled:!1}},components:{},computed:{appInfo:function(){return this.$store.state.appInfo}},onLoad:function(t){},onShow:function(){},mounted:function(){},methods:{cancelLogin:function(){uni.navigateBack()},authorLogin:function(t){var a=this,e=a.$store.state.clientType;if(a.disabled=!0,"2"===e&&"getUserInfo:ok"!==t.detail.errMsg)return r.default.showError("登录失败,请重试"),a.disabled=!1,!1;uni.getProvider({service:"oauth",success:function(e){console.log("getProvider",e.provider),a.userLogin(e.provider[0],t.detail)}})},getLoginData:function(t,a){return new c.default(function(e,n){a.iv&&a.encryptedData?e(a):uni.getUserInfo({withCredentials:!0,complete:function(a){console.log(a),a.iv||"alipay"===t?(!a.encryptedData&&a.data&&(a.encryptedData=a.data),e(a)):n()}})})},userLogin:function(t,a){var e=this,n=r.default.getClientType(),o={};uni.showLoading({title:"正在登录"}),uni.login({provider:t,scopes:"auth_user",success:function(c){o.code=c.code,e.getLoginData(t,a).then(function(t){"3"===n&&(o=(0,i.default)(o,{source:"3",mode:"2",encryptedData:t.encryptedData,iv:t.iv})),"7"===n&&(o=(0,i.default)(o,{nickName:t.userInfo.nickName||"",avatarUrl:t.userInfo.avatarUrl})),e.getUserInfo(o)}).catch(function(){e.disabled=!1,"9"===n?uni.showModal({title:"登录失败",content:"请点击确定允许授权后,重新登录",success:function(t){t.confirm&&uni.openSetting({success:function(t){t.authSetting["scope.userInfo"]&&r.default.showError("授权成功,请重新登录")}})}}):r.default.showError("登录失败,请重试")})}})},getUserInfo:function(t){var a=this;r.default._post_form("&p=member&do=login",(0,o.default)({},t),function(t){console.log(t);var e=t.data.token;uni.setStorageSync("weliam_user_token",e),a.disabled=!1,a.$store.commit("WXLOGIN",1),a.navigateBack()},!1,function(){uni.hideLoading()})},navigateBack:function(){var t=getCurrentPages(),a=t[t.length-2];uni.getStorageSync("currentPage").options;r.default.removeCurrentPage(),"pages/mainPages/write/write"===a.route?uni.reLaunch({url:"/pages/mainPages/index/index"}):uni.navigateBack()}}};a.default=u},"499e":function(t,a,e){"use strict";e.r(a);var n=e("3c8a"),o=e.n(n);for(var i in n)"default"!==i&&function(t){e.d(a,t,function(){return n[t]})}(i);a["default"]=o.a},"8de2":function(t,a,e){"use strict";e.r(a);var n=e("cd1c2"),o=e("499e");for(var i in o)"default"!==i&&function(t){e.d(a,t,function(){return o[t]})}(i);e("a63c");var c=e("2877"),r=Object(c["a"])(o["default"],n["a"],n["b"],!1,null,"1469da2c",null);a["default"]=r.exports},a4c2:function(t,a,e){var n=e("c2f4");"string"===typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);var o=e("4f06").default;o("6cf0d9a4",n,!0,{sourceMap:!1,shadowMode:!1})},a63c:function(t,a,e){"use strict";var n=e("a4c2"),o=e.n(n);o.a},c2f4:function(t,a,e){a=t.exports=e("2350")(!1),a.push([t.i,"uni-page-body[data-v-1469da2c]{background:#fff;font-size:%?32?%}.container[data-v-1469da2c]{padding:0 %?60?%}.wechatapp[data-v-1469da2c]{padding:15% 0 10%;border-bottom:%?1?% solid #e3e3e3;margin-bottom:%?45?%;text-align:center}.wechatapp .header[data-v-1469da2c]{margin:0 auto}.wechatapp .header .app-name[data-v-1469da2c]{margin-top:%?30?%}.wechatapp .header uni-image[data-v-1469da2c]{width:%?100?%;height:%?100?%;margin:0 auto;display:block;border-radius:50%;border:2px solid #fff;-webkit-box-shadow:1px 0 5px rgba(50,50,50,.3);box-shadow:1px 0 5px rgba(50,50,50,.3);background-size:100% 100%}.auth-title[data-v-1469da2c]{color:#585858;font-size:%?28?%;margin-bottom:%?40?%}.auth-subtitle[data-v-1469da2c]{color:#999;margin-bottom:%?72?%;font-size:%?22?%}.login-btn[data-v-1469da2c]{border:none;height:%?80?%;line-height:%?80?%;background:#ffd940;color:#333;font-size:10pt;border-radius:%?6?%;width:45%}.login-btn[data-v-1469da2c]:after{display:none}.login-btn.button-hover[data-v-1469da2c]{\n\t/* box-shadow: inset 0 5upx 30upx rgba(0, 0, 0, 0.15); */}.login-btn.login-cancel[data-v-1469da2c]{color:#999;background:#efefef}body.?%PAGE?%[data-v-1469da2c]{background:#fff}",""])},cd1c2:function(t,a,e){"use strict";var n=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("v-uni-view",{staticClass:"container"},[e("v-uni-view",{staticClass:"wechatapp"},[e("v-uni-view",{staticClass:"header"},[e("v-uni-image",{attrs:{src:t.appInfo.logo}}),e("v-uni-view",{staticClass:"app-name t-c f-26 col-3"},[t._v(t._s(t.appInfo.name))])],1)],1),e("v-uni-view",{staticClass:"auth-title"},[t._v("申请获取以下权限:")]),e("v-uni-view",{staticClass:"auth-subtitle"},[t._v("• 获得你的公开信息（昵称、头像等）")]),e("v-uni-view",{staticClass:"dis-flex flex-x-around"},[e("v-uni-button",{staticClass:"login-btn login-cancel",on:{click:function(a){a=t.$handleEvent(a),t.cancelLogin(a)}}},[t._v("暂不登录")]),e("v-uni-button",{staticClass:"login-btn",attrs:{disabled:t.disabled},on:{click:function(a){a=t.$handleEvent(a),t.authorLogin(a)}}},[t._v("授权登录")])],1)],1)},o=[];e.d(a,"a",function(){return n}),e.d(a,"b",function(){return o})}}]);