



<!DOCTYPE html>

<html>

<head>

    <meta charset="utf-8">

    <title>预约分类</title>

    <meta name="renderer" content="webkit">

    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">

    <link rel="stylesheet" href="__PUBLIC__/static/layuiadmin/layui/css/layui.css" media="all">

    <link rel="stylesheet" href="__PUBLIC__/static/layuiadmin/style/admin.css" media="all">

</head>

<style>

.layui-table-cell, .layui-table-tool-panel li {

    overflow: hidden;

    text-overflow: ellipsis;

    white-space: nowrap;

}

</style>

<body>



<div class="layui-fluid">

    <div class="layui-row layui-col-space15">

        <div class="layui-col-md12">

            <div class="layui-card">

                <div class="layui-card-header">权益分类</div>

                <div class="layui-card-body">

					<div class="layui-btn-group test-table-operate-btn" style="margin-bottom: 10px;">

						<button class="layui-btn" data-type="addFirst">添加分类</button>

                    </div>

                    <table class="layui-hide" id="test-table-operate" lay-filter="test-table-operate"></table>

                    <script type="text/html" id="test-table-operate-barDemo">

						<a class="layui-btn layui-btn-xs " lay-event="view">查看导航</a>
						<a class="layui-btn layui-btn-xs layui-btn-primary " lay-event="edit">编辑</a>
                        <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
                    </script>

                    <script type="text/html" id="displayTpl">

  						{{#  if(d.is_display == 1){ }}

    						 <input type="checkbox" checked lay-skin="switch" lay-filter="encrypt"  lay-text="显示|隐藏" >

  						{{#  } else { }}

    						 <input type="checkbox" lay-skin="switch" lay-filter="encrypt" lay-text="显示|隐藏" >

  						{{#  } }}

					</script>


                </div>

            </div>

        </div>

    </div>

</div>



<script src="__PUBLIC__/static/layuiadmin/layui/layui.js"></script>

<script>

    layui.config({

        base: '__PUBLIC__/static/layuiadmin/'

    }).extend({

        index: 'lib/index' 

    }).use(['jquery','index', 'table','laydate','form'], function(){

        var $ = layui.$

        	,table = layui.table

            ,admin = layui.admin

            ,form = layui.form

            ,laydate = layui.laydate;



        table.render({

            elem: '#test-table-operate'

            ,url:"{:siteUrl('admin/digital/cate_list','','web')}"

            ,cols: [[
				{field:'sort',  title: '排序值', sort: true}
                ,{field:'name',  title: '分类名称' }
                ,{field:'desc',  title: '分类描述' }
                ,{field:'is_display',  title: '是否开启', sort: true,templet: '#displayTpl', event: 'setSign'}
                ,{ align:'center', title: '操作', toolbar: '#test-table-operate-barDemo'}

            ]]

        });


        table.on('tool(test-table-operate)', function(obj){

            var data = obj.data;

			if(obj.event === 'view'){
            	
            	layer.open({
                    type:2,
                    area : [ '80%', '70%' ],
                    title:"导航列表",
                    content:"{:siteUrl('admin/digital/navigation','','web')}&pid="+data.id,
                    success:function(){

                    }  
                });
            	
            } else if(obj.event === 'edit'){

            	window.location.href="{:siteUrl('admin/digital/edit_cate','','web')}&id="+data.id;

            } else if(obj.event === 'del'){

                layer.confirm('确定删除该分类吗？', function(index){

                	window.location.href="{:siteUrl('admin/digital/del_cate','','web')}&id="+data.id;

                });

            }  else if(obj.event === 'setSign'){

				$.ajax({
                    url:"{:siteUrl('admin/digital/change','','web')}&flag=1&id="+data.id,
                    type:"POST",
                    success: function(data){
                    	
                    	layer.close(index);
                    	
                    	var res = JSON.parse(data);
                    	console.log(res);
                    	if(res.code > 0 ){
                    		layer.msg(res.msg,{icon: 2,time:3000},function(){
                    			table.reload('test-table-operate');
                    		});
                    	}
                    }
                })

            	

            }   else if(obj.event === 'setSign2'){

                $.ajax({
                    url:"{:siteUrl('admin/digital/change_recommend','','web')}&id="+data.id,
                    type:"POST",
                    success: function(data){
                    	var res = JSON.parse(data);
                    	console.log(res);
                    	if(res.code > 0 ){
                    		layer.msg(res.msg,{icon: 2,time:3000},function(){
                    			table.reload('test-table-operate');
                    		});
                    	}
                    }
                })

            }

        });

        

        var $ = layui.$, active = {

       		addFirst: function(){ 

       			window.location.href="{:siteUrl('admin/digital/edit_cate','','web')}";

            }

            ,reload: function(){

                var demoReload = $('#test-table-demoReload');


                table.reload('test-table-operate', {

                  page: {

                    curr: 1 

                  }

                  ,where: {

                    'name': demoReload.val()

                  }

                });

              }

        };

        

        $('.test-table-operate-btn .layui-btn').on('click', function(){

            var type = $(this).data('type');

            active[type] ? active[type].call(this) : '';

        });



        $('.demoTable .layui-btn').on('click', function(){

            var type = $(this).data('type');

            active[type] ? active[type].call(this) : '';

        });



    });

</script>

</body>

<div class="layui-footer" style="margin-top:20px;display: flex;justify-content: center;align-items: flex-end;">

	{include file='../addons/wjyk_zqds/application/admin/view/index/footer.html' /}

</div>

</html>