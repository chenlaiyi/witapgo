<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>编辑门店</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="stylesheet" href="__PUBLIC__/static/layuiadmin/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="__PUBLIC__/static/layuiadmin/style/admin.css" media="all">
    <style>
        form{
            padding-right:15px ;
        }
	    .layui-form-label{
			width:115px;
        }
		.layui-input-block{
			margin-left:145px;
		}
    </style>
</head>
<body>
<form class="layui-form" style="margin-top:21px;">
  <input type="hidden" name="id" value="{$srdb['id']}">
	
  <div class="layui-form-item">
    <label class="layui-form-label">商品名称</label>
    <div class="layui-input-block">
      <input type="text" name="name" required lay-verify="required" placeholder="请输入商品名称" autocomplete="off" class="layui-input" value="{$srdb['name']}">
    </div>
  </div>
  
  <div class="layui-form-item">
    <label class="layui-form-label">所属分类</label>
    <div class="layui-input-block">
      <select name="categoryid">
      	{if empty($categoryList)}
	      	<option value="">暂无分类</option>
	    {else}
	    	{foreach  $categoryList as $v}
	        <option value="{$v.id}" {eq name="$srdb.categoryid" value="$v.id"} selected="" {/eq}>{$v.name}</option>
	        {/foreach}
	    {/if}
      </select>
    </div>
  </div>  <div class="layui-form-item">    <label class="layui-form-label">商品类型</label>    <div class="layui-input-block" id="type">      <input type="radio" name="type" value="1" title="实物" {if $srdb['type'] == '1' || $srdb['type'] == ''}checked{/if} lay-filter="aaa">      <input type="radio" name="type" value="2" title="虚拟商品" {if $srdb['type'] == '2'}checked{/if} lay-filter="aaa">    </div>  </div>
   <div class='type22' {if $srdb['type'] == '1' || $srdb['type'] == ''}style="display:none"{/if}>	  <div class="layui-form-item">	    <label class="layui-form-label">虚拟商品类型</label>	    <div class="layui-input-inline">	      <input type="text" name="virtual_type"   placeholder="卡密/序列号" autocomplete="off" class="layui-input" value="{$srdb['virtual_type']}">	    </div>	  </div> </div>
  <div class="layui-form-item">
    <label class="layui-form-label">商品轮播图</label>
    <button type="button" class="layui-btn" id="test2">多图片上传</button> 
    <div class="layui-form-mid layui-word-aux">建议上传375px * 375px尺寸，或者等比例图片</div>
	  <blockquote class="layui-elem-quote layui-quote-nm" style="margin-top: 10px;">
	    预览图：
	    <div class="layui-upload-list"  id="ImgPreview" style="display: flex;"> 
         	{if !empty($srdb['pic_url'])}
         		{foreach  $srdb['pic_url'] as $v}
	  			<div class="image-container" id="container{$v}">
			        <div class="delete-css">
	            		<div id="{$v}" class="upload_img layui-btn layui-btn-danger layui-btn-xs">删除</div>
	            	</div>
	                <img id="showImg" style="width: 150px; margin:10px;cursor:pointer;" src="{$v}"  >
	                <input value="{$v}" name="pic_url[]" class="pic_url" type="hidden">
	            </div>
		        {/foreach}
			{/if}
        </div>
	 </blockquote>
  </div>
  <div class="layui-form-item">
    <label class="layui-form-label">商品价格</label>
    <div class="layui-input-inline">
      <input type="number" name="price"   placeholder="请输入商品价格" autocomplete="off" class="layui-input" value="{$srdb['price']}">
    </div>
    <div class="layui-form-mid layui-word-aux">单位：元</div>
  </div>
  

  <div class="layui-form-item">
    <label class="layui-form-label">可用{$name}</label>
    <div class="layui-input-inline">
      <input type="number" name="integral"   placeholder="请输入可用{$name}" autocomplete="off" class="layui-input" value="{$srdb['integral']}">
    </div>
  </div>
  
  <div class="layui-form-item">
    <label class="layui-form-label">可抵扣金额</label>
    <div class="layui-input-inline">
      <input type="number" name="deduction"   placeholder="请输入可抵扣金额" autocomplete="off" class="layui-input" value="{$srdb['deduction']}">
    </div>
    <div class="layui-form-mid layui-word-aux">单位：元</div>
  </div>
     <div class='type11' {if $srdb['type'] == '2'}style="display:none"{/if}>	  <div class="layui-form-item">	    <label class="layui-form-label">库存</label>	    <div class="layui-input-inline">	      <input type="number" name="inventory"   placeholder="库存" autocomplete="off" class="layui-input" value="{$srdb['inventory']}">	    </div>	  </div> </div>    <div class="layui-form-item">    <label class="layui-form-label">限购数量</label>    <div class="layui-input-inline">      <input type="number" name="purchase"   placeholder="限购数量" autocomplete="off" class="layui-input" value="{$srdb['purchase']}">    </div>    <div class="layui-form-mid layui-word-aux">为0则不限购</div>  </div>
  <div class="layui-form-item">
    <label class="layui-form-label">商品详情</label>
    <div class="layui-input-block">
    	<script id="ueditor" name="detail" type="text/plain" >{$srdb['detail']|raw}</script>
    </div>
  </div>
  <div class="layui-form-item">
    <label class="layui-form-label">已售</label>
    <div class="layui-input-inline">
      <input type="number" name="sold"    autocomplete="off" class="layui-input" value="{$srdb['sold']}">
    </div>
  </div>
  
  <div class="layui-form-item">
    <label class="layui-form-label">排序</label>
    <div class="layui-input-block">
      <input type="number" name="sort" placeholder="请输入排序值 ，数值越高，越在前显示" autocomplete="off" class="layui-input" value="{$srdb['sort']}">
    </div>
  </div>
  
  <div class="layui-form-item">
    <label class="layui-form-label">是否推荐</label>
    <div class="layui-input-block">
      <input type="radio" name="is_recommend" value="1" title="推荐" {if $srdb['is_recommend'] == '1' || $srdb['is_recommend'] == ''}checked{/if}>
      <input type="radio" name="is_recommend" value="2" title="不推荐" {if $srdb['is_recommend'] == '2'}checked{/if}>
    </div>
  </div>
  <div class="layui-form-item">
    <div class="layui-input-block">
      <button class="layui-btn" lay-submit lay-filter="demo1">立即提交</button>
      <input type="button" class="layui-btn layui-btn-primary" onclick="history.go(-1)" value="返回列表"> 
    </div>
  </div>
  <!-- 更多表单结构排版请移步文档左侧【页面元素-表单】一项阅览 -->
</form>
<script src="__PUBLIC__/static/layuiadmin/layui/layui.js"></script>
<script type="text/javascript" src="__PUBLIC__/static/ueditor/ueditor.config.js"></script>
<script type="text/javascript" src="__PUBLIC__/static/ueditor/ueditor.all.js"></script>
<script>
	layui.config({
	    base: '__PUBLIC__/static/layuiadmin/' //静态资源所在路径
	}).extend({
	    index: 'lib/index' //主入口模块
	    	, layarea: '../layui/layui_exts/city-picker/layarea'
	}).use(['jquery','layer', 'index', 'table','upload', 'layarea','layedit'], function(){
		var $ = layui.$
		, layer = layui.layer
		, layedit = layui.layedit
	    , table = layui.table
	    , form = layui.form
	    , layarea = layui.layarea
	    , upload = layui.upload;				form.on('radio(aaa)', function (data) {        	if ($('#type input[name="type"]:checked ').val() == "1") {        		$(".type11").show();                $(".type22").hide();            } else if ($('#type input[name="type"]:checked ').val() == "2") {                $(".type22").show();                $(".type11").hide();            }             form.render();        });		form.on('radio(bbb)', function (data) {        	if ($('#payment_type input[name="payment_type"]:checked ').val() == "1") {                $(".type1").show();
                $(".type2").hide();            } else if ($('#payment_type input[name="payment_type"]:checked ').val() == "2") {                $(".type1").hide();                $(".type2").show();            } else if ($('#payment_type input[name="payment_type"]:checked ').val() == "3") {
                $(".type1").hide();
                $(".type2").hide();
            }            form.render();        });
    			upload.render({            elem: '#test1'            ,url: "{:siteUrl('admin/index/upload','','web')}"             ,done: function(res){                if(res.code < 0){                    return layer.msg('上传失败');                }else{                    $('#demo1').attr('src', res.msg);                     $('#icon').val(res.msg);                }            }        });
		var ue = UE.getEditor('ueditor', {
	         zIndex: 99,
	         maximumWords: 999,
	         scaleEnabled: true,
	         initialFrameWidth: 800,
	         initialFrameHeight: 300,
	         autoHeightEnabled: false,
 			}
         );
    	$('.upload_img').on('click',function () {
			var url = $(this).attr('id');
			$(this).parents('.image-container').remove();
		});
    	
    	$(document).on("click", ".image-container .delete-css .layui-btn", function(event){
    	    $(this).parent().parent().remove();
    	})
    	
    	upload.render({
           elem: '#test2'
          	,url: "{:siteUrl('admin/index/upload','','web')}" 
        	,multiple: true
        	, before: function (obj) {
                layer.msg('图片上传中...', {
                  icon: 16,
                  shade: 0.01,
                  time: 3000
                })
              }
         ,done: function(res){ 
        	 $('#ImgPreview').append('<div class="image-container"><div class="delete-css"><button class="layui-btn layui-btn-danger layui-btn-xs">删除</button></div>\n' +
                '<img  style="width: 150px; margin:10px;cursor:pointer;" src="'+  res.msg +'"><input value="'+ res.msg +'" name="pic_url[]" class="pic_url"  type="hidden">');
           }
         });
    	

        form.on('submit(demo1)', function(data){
            var admin = layui.admin

            $.ajax({
            	url:"{:siteUrl('admin/goods/edit_goods','','web')}",
                data:data.field,
                type:"POST",
                success: function(data){
                	console.log(data);
                	var res = JSON.parse(data);
                	if(res.code == 0 ){
                		layer.msg(res.msg,{icon: 1,time:3000},function(){
                			window.location.href="{:siteUrl('admin/goods/index','','web')}";
                		});
                	}else{
                		layer.msg(res.msg,{icon: 2,time:3000},function(){
                			window.location.href="{:siteUrl('admin/goods/index','','web')}";
                		});
                	}
                }
            })
            return false
  
        });


    });
</script>
</body>
<div class="layui-footer" style="margin-top:20px;display: flex;justify-content: center;align-items: flex-end;">
	{include file='../addons/wjyk_zqds/application/admin/view/index/footer.html' /}
</div>
</html>