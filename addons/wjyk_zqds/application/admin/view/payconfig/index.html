<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>支付设置</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="stylesheet" href="__PUBLIC__/static/layuiadmin/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="__PUBLIC__/static/layuiadmin/style/admin.css" media="all">
    <style>
        form{
            padding-right:15px ;
        }		.layui-form-label{			width:135px;        }		.layui-input-block{			margin-left:165px;		}
    </style>
</head>
<body>
<form class="layui-form" style="margin-top:21px;">
<div class="layui-form-item">        <label class="layui-form-label">支付类型</label>        <div class="layui-input-block" id="type">            <input type="radio" name="type" value="1" title="微信支付" {if $payconfig['type'] == '1' || $payconfig['type'] == ''}checked{/if} lay-filter="bbb">            <input type="radio" name="type" value="2" title="微信支付子商户" {if $payconfig['type'] == '2'}checked{/if} lay-filter="bbb">        </div>    </div>	<div class="type-2" {if $payconfig['type'] != '2'}style="display:none"{/if}>  <div class="layui-form-item">    <label class="layui-form-label">服务商小程序(AppId)</label>    <div class="layui-input-block">      <input type="text" name="service_appid"  autocomplete="off" class="layui-input" value="{$payconfig['service_appid']}">    </div>  </div>    <div class="layui-form-item">    <label class="layui-form-label">服务商支付商户号(Mch_Id)</label>    <div class="layui-input-block">      <input type="text" name="service_mchid"  autocomplete="off" class="layui-input" value="{$payconfig['service_mchid']}">    </div>  </div></div>
  <div class="layui-form-item">
    <label class="layui-form-label">小程序(AppId)</label>
    <div class="layui-input-block">
      <input type="text" name="appid" required lay-verify="required" autocomplete="off" class="layui-input" value="{$payconfig['appid']}">
    </div>
  </div>
  
  <div class="layui-form-item">
    <label class="layui-form-label">支付商户号(Mch_Id)</label>
    <div class="layui-input-block">
      <input type="text" name="mch_id" required lay-verify="required" autocomplete="off" class="layui-input" value="{$payconfig['mchid']}">
    </div>
  </div>
  
  <div class="layui-form-item">
    <label class="layui-form-label">支付密钥(APIKEY)</label>
    <div class="layui-input-block">
      <input type="text" name="api_key" required lay-verify="required" autocomplete="off" class="layui-input" value="{$payconfig['api_key']}">
    </div>    <div class="layui-input-block type-2" {if $payconfig['type'] != '2'}style="display:none"{/if}>  		<div class="layui-form-mid layui-word-aux">服务商的APIKEY，并不是子商户的APIKEY</div>  	</div>
  </div>
  <div class="layui-form-item">
  	<label class="layui-form-label">cert文件</label>
  	<button type="button" class="layui-btn" id="test3"><i class="layui-icon"></i>上传文件</button>
    {if $payconfig['cert'] == 1}
    <button type="button" class="layui-btn layui-btn-xs layui-btn-normal" >已上传</button>下载证书 cert.zip 中的 apiclient_cert.pem 文件
    {/if}
  </div>
  
  <div class="layui-form-item" id="keyContent">
    <label class="layui-form-label">key文件</label>
    <button type="button" class="layui-btn" id="test4"><i class="layui-icon"></i>上传文件</button>
    {if $payconfig['key'] == 1}
    <button type="button" class="layui-btn layui-btn-xs layui-btn-normal" >已上传</button>下载证书 cert.zip 中的 apiclient_key.pem 文件
    {/if}
  </div>
  
  <div class="layui-form-item">
    <div class="layui-input-block">
      <button class="layui-btn" lay-submit lay-filter="demo1">立即提交</button>
    </div>
  </div>
  <!-- 更多表单结构排版请移步文档左侧【页面元素-表单】一项阅览 -->
</form>
<script src="__PUBLIC__/static/layuiadmin/layui/layui.js"></script>
<script>    layui.config({        base: '__PUBLIC__/static/layuiadmin/' //静态资源所在路径    }).extend({        index: 'lib/index' //主入口模块    }).use('index');</script><script>    layui.use(['form', 'layedit', 'laydate','upload','jquery'], function(){        var form = layui.form            ,layer = layui.layer            ,layedit = layui.layedit            ,upload = layui.upload            ,$ = layui.$            ,laydate = layui.laydate;
              form.on('radio(bbb)', function (data) {            if ($('#type input[name="type"]:checked').val() == "2") {                $(".type-2").show();            }else{            	$(".type-2").hide();            }            form.render();        });
        
        upload.render({
          elem: '#test3'
          ,url: "{:siteUrl('admin/index/upload','','web')}" //改成您自己的上传接口
          ,accept: 'file' //普通文件
          ,done: function(res){
            layer.msg('上传成功');
            console.log(res);
          }
        });
        upload.render({
            elem: '#test4'
            ,url: "{:siteUrl('admin/index/upload','','web')}" //改成您自己的上传接口
            ,accept: 'file' //普通文件
            ,done: function(res){
              layer.msg('上传成功');
              console.log(res);
            }
          });
                
      //监听提交
        form.on('submit(demo1)', function(data){
            var admin = layui.admin

            admin.req({
                url:"{:siteUrl('admin/payconfig/set_payconfig','','web')}",
                data:data.field,
                type:"POST",
                done:res=>{
                    if(res.code == 0 ){
                		layer.msg("设置成功",function(){
                			window.location.href="{:siteUrl('admin/payconfig/index','','web')}";
                		});
                	}
                }
            })
            return false
  
        });
      


        //表单取值
        layui.$('#LAY-component-form-getval').on('click', function(){
            var data = form.val('example');
            alert(JSON.stringify(data));
        });

    });
</script>
</body>
</html>