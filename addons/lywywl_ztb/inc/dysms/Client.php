<?php
 namespace Flc\Dysms; use Flc\Dysms\Request\IRequest; use Flc\Dysms\Helper; class Client { protected $api_uri = "\x68\x74\x74\x70\x3a\x2f\57\x64\x79\x73\155\x73\141\x70\x69\56\x61\x6c\151\x79\x75\x6e\143\163\56\x63\x6f\155\x2f"; protected $format = "\x6a\163\x6f\156"; protected $signatureMethod = "\x48\115\101\103\55\123\110\101\61"; protected $httpMethod = "\x50\x4f\x53\x54"; protected $config = array(); public function __construct($config = array()) { $this->config = $config; } public function execute(IRequest $request) { goto UqTKg; UqTKg: $action = $request->getAction(); goto w0ekA; w0ekA: $reqParams = $request->getParams(); goto xCyue; codWh: $params["\123\x69\x67\156\x61\x74\165\x72\145"] = $this->generateSign($params); goto e3pt2; kWOZF: return json_decode($resp); goto eMkzY; e3pt2: $resp = $this->curl($this->api_uri, $params); goto kWOZF; bM1jV: $params = array_merge($pubParams, ["\101\x63\164\x69\157\x6e" => $action], $reqParams); goto codWh; xCyue: $pubParams = $this->getPublicParams(); goto bM1jV; eMkzY: } protected function generateSign($params = array()) { goto pJzgp; L7aV1: foreach ($params as $k => $v) { $arr[] = $this->percentEncode($k) . "\75" . $this->percentEncode($v); sOKK9: } goto nYiGJ; tDMtS: $queryStr = implode("\x26", $arr); goto z6yWL; nYiGJ: gqJb1: goto tDMtS; pJzgp: ksort($params); goto WihmY; j0TV4: return base64_encode(hash_hmac("\x73\x68\x61\x31", $strToSign, $this->config["\141\x63\143\x65\163\x73\113\145\171\123\x65\143\x72\x65\x74"] . "\x26", true)); goto JnNMg; z6yWL: $strToSign = $this->httpMethod . "\46\x25\62\106\x26" . $this->percentEncode($queryStr); goto j0TV4; WihmY: $arr = []; goto L7aV1; JnNMg: } protected function percentEncode($str) { goto mj2Yu; H19ww: $res = preg_replace("\x2f\134\53\x2f", "\45\62\x30", $res); goto aw5r8; WUYL4: $res = preg_replace("\57\45\x37\105\57", "\176", $res); goto vQqeI; aw5r8: $res = preg_replace("\57\134\x2a\57", "\x25\x32\x41", $res); goto WUYL4; mj2Yu: $res = urlencode($str); goto H19ww; vQqeI: return $res; goto F7JMh; F7JMh: } protected function getPublicParams() { return ["\x41\143\x63\x65\x73\163\113\145\x79\111\x64" => $this->config["\141\x63\x63\145\x73\x73\x4b\x65\x79\111\x64"], "\124\151\155\145\163\164\x61\x6d\x70" => $this->getTimestamp(), "\106\157\x72\x6d\141\164" => $this->format, "\123\x69\x67\156\141\164\x75\x72\x65\115\145\164\x68\x6f\144" => $this->signatureMethod, "\123\151\x67\x6e\141\x74\165\x72\145\x56\145\x72\163\x69\x6f\156" => "\x31\56\60", "\x53\x69\147\156\141\164\165\162\145\116\x6f\x6e\x63\x65" => uniqid(), "\x56\145\162\x73\151\157\x6e" => "\x32\60\61\67\55\x30\65\x2d\62\65", "\122\145\147\151\x6f\156\111\144" => "\x63\156\55\150\141\x6e\x67\172\150\x6f\165"]; } protected function getTimestamp() { goto Pv_kh; Pv_kh: $timezone = date_default_timezone_get(); goto PdNvT; PdNvT: date_default_timezone_set("\107\115\124"); goto JatrD; JatrD: $timestamp = date("\131\x2d\x6d\x2d\144\134\x54\x48\72\151\x3a\163\134\x5a"); goto reOU4; reOU4: date_default_timezone_set($timezone); goto zAFRU; zAFRU: return $timestamp; goto wwDMG; wwDMG: } protected function curl($url, $postFields = null) { goto AIGJ7; bXSZe: curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, false); goto xDOIx; wK3hk: $reponse = curl_exec($ch); goto I0vof; Tr_Br: curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false); goto bXSZe; sjgW_: unset($k, $v); goto xr1xm; fKjBH: foreach ($postFields as $k => $v) { $postBodyString .= "{$k}\75" . urlencode($v) . "\46"; marXo: } goto JUGJi; BGkcy: if (!(is_array($postFields) && 0 < count($postFields))) { goto W9md7; } goto zpsLi; xr1xm: curl_setopt($ch, CURLOPT_POST, true); goto npL76; I0vof: return $reponse; goto qLc1I; o8JJf: W9md7: goto wK3hk; ZWCAE: curl_setopt($ch, CURLOPT_URL, $url); goto Kacx3; NSSrT: curl_setopt($ch, CURLOPT_POSTFIELDS, substr($postBodyString, 0, -1)); goto o8JJf; AIGJ7: $ch = curl_init(); goto ZWCAE; xeQSU: if (!(strlen($url) > 5 && strtolower(substr($url, 0, 5)) == "\x68\x74\x74\x70\163")) { goto v2s9P; } goto Tr_Br; b5fpO: curl_setopt($ch, CURLOPT_HTTPHEADER, $header); goto NSSrT; Kacx3: curl_setopt($ch, CURLOPT_FAILONERROR, false); goto zQzWZ; zpsLi: $postBodyString = ''; goto fKjBH; JUGJi: c591Z: goto sjgW_; xDOIx: v2s9P: goto BGkcy; zQzWZ: curl_setopt($ch, CURLOPT_RETURNTRANSFER, true); goto xeQSU; npL76: $header = array("\x63\157\x6e\164\145\x6e\164\x2d\164\x79\160\x65\72\x20\x61\x70\160\154\x69\x63\141\x74\151\157\x6e\x2f\x78\55\167\167\x77\x2d\146\x6f\162\x6d\x2d\x75\162\x6c\145\x6e\143\x6f\144\145\x64\x3b\x20\143\x68\141\x72\x73\145\x74\x3d\x55\124\106\x2d\x38"); goto b5fpO; qLc1I: } }
