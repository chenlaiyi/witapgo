<?php
 class AllinPayService { private $config = array("\141\160\151\x75\x72\x6c" => "\x68\164\164\160\x73\x3a\57\57\166\x73\x70\x2e\141\x6c\154\x69\156\160\x61\171\56\x63\157\x6d\57\141\160\x69\167\145\x62\x2f\165\x6e\x69\x74\157\162\144\145\x72", "\166\145\x72\163\x69\x6f\x6e" => 11, "\x6c\151\x6d\151\x74\x5f\x70\141\x79" => "\x6e\x6f\x5f\143\x72\145\x64\151\x74", "\163\151\x67\156\x74\x79\160\145" => "\115\104\x35", "\166\141\x6c\151\x64\164\151\155\145" => "\x35"); public function __construct($config = array()) { goto ipobL; SQRA3: if (!empty($this->config["\141\160\x70\151\144"])) { goto F9rpv; } goto XwdH2; p1KRj: if (!empty($this->config["\143\165\163\151\x64"])) { goto Dr592; } goto K5TB3; F1ZAo: Dr592: goto SQRA3; XwdH2: throw new PayException("\141\160\x70\x69\x64\x20\345\217\202\xe6\225\260\351\x94\x99\xe8\257\257"); goto oCI21; a8CLi: if (!empty($this->config["\141\160\x69\165\x72\154"])) { goto qgYVD; } goto bCMQw; K5TB3: throw new PayException("\143\165\x73\151\144\x20\xe5\217\x82\xe6\x95\260\351\x94\231\xe8\xaf\257"); goto F1ZAo; bCMQw: throw new PayException("\141\x70\151\x75\x72\x6c\40\xe5\217\x82\346\225\xb0\xe9\x94\x99\350\xaf\xaf"); goto fgBlS; ipobL: $this->config = array_merge($this->config, $config); goto a8CLi; fgBlS: qgYVD: goto p1KRj; oCI21: F9rpv: goto PvTMJ; PvTMJ: } public function WechatJsapiPay($order, $callback = false) { goto NuYXn; z1qzS: if (!empty($order["\157\160\x65\156\x69\x64"])) { goto ejXHv; } goto R_8TY; ENaq_: gumEu: goto CX6C7; X8PEo: $params["\x76\145\x72\163\x69\x6f\x6e"] = $this->config["\166\145\x72\163\x69\157\156"]; goto yqWkz; VWztl: phnPv: goto VdBkT; R_8TY: throw new PayException("\157\x70\x65\156\x69\144\xe6\x9c\211\xe8\xaf\xaf"); goto udA6J; gDxN2: $params["\x61\143\x63\164"] = $openid; goto Xju4s; KggRh: return $res["\160\x61\171\x69\x6e\146\x6f"]; goto Mc2sl; Mc2sl: bViGO: goto BiSMo; SDsXs: if (!($res["\x74\162\170\163\x74\x61\164\x75\163"] == "\60\60\x30\x30")) { goto bViGO; } goto KggRh; VdBkT: goto lsx1Q; goto lBy89; salvt: $params["\141\163\151\156\x66\157"] = ''; goto KnwT6; ygXf5: call_user_func($callback, $res); goto sB2Z8; Kmpgx: if (empty($order["\162\145\x71\163\x6e"])) { goto RWWQV; } goto tBQuy; KnwT6: $params["\x66\x72\157\156\164\137\165\162\154"] = !empty($order["\x66\x72\157\156\164\x5f\165\162\154"]) ? $order["\146\x72\157\x6e\x74\137\x75\162\x6c"] : $this->config["\146\x72\x6f\156\164\137\x75\x72\x6c"]; goto XLFsy; p8V6e: $res = self::CurlPost($url, $paramsStr, true); goto AdQIb; wXnaM: c7qjx: goto q3ct6; tBQuy: if (!(strlen($order["\x72\145\161\163\x6e"]) > 32)) { goto phnPv; } goto QK9Be; QK9Be: throw new PayException("\xe8\xae\242\xe5\215\225\345\217\267\351\225\xbf\345\xba\xa6\346\x9c\211\xe8\257\xaf"); goto VWztl; XLFsy: $params["\x6e\157\x74\x69\146\171\137\x75\162\154"] = !empty($order["\156\157\164\x69\x66\171\137\x75\x72\154"]) ? $order["\156\157\x74\151\146\171\x5f\165\x72\x6c"] : $this->config["\x6e\x6f\164\x69\146\x79\137\x75\x72\154"]; goto jU4VS; p3R88: $url = $this->config["\x61\x70\151\x75\x72\154"] . "\x2f\160\141\171"; goto p8V6e; I9ghq: self::Log($res["\x72\145\164\155\x73\147"]); goto ubnjb; qAXql: $params["\142\157\144\171"] = !empty($order["\142\x6f\x64\x79"]) ? $order["\x62\157\144\171"] : ''; goto AOPr2; udA6J: ejXHv: goto iCtRq; NuYXn: if (!(empty($order["\164\x72\x78\x61\x6d\x74"]) || $order["\164\x72\170\x61\x6d\164"] <= 0)) { goto UVl8A; } goto uZEvH; uZEvH: throw new PayException("\346\224\xaf\344\xbb\x98\351\x87\x91\xe9\242\x9d\346\234\x89\xe8\xaf\xaf"); goto J0emX; lBy89: RWWQV: goto Q0vuE; e56Ei: $params["\x70\x61\171\x74\171\160\145"] = "\x57\x30\x32"; goto W_I1e; OLA20: $paramsStr = self::ToUrlParams($params); goto p3R88; AOPr2: $params["\x72\x65\x6d\141\x72\x6b"] = !empty($order["\x72\145\155\x61\x72\x6b"]) ? $order["\x72\145\x6d\141\x72\x6b"] : ''; goto gDxN2; J0emX: UVl8A: goto Kmpgx; PWXGf: if (!($res["\162\145\x74\x63\x6f\144\145"] == "\x53\125\x43\103\105\123\x53")) { goto zgk6n; } goto SDsXs; Xju4s: $params["\x6c\x69\x6d\x69\164\137\160\x61\x79"] = $this->config["\154\x69\155\151\x74\137\160\141\x79"]; goto Zlq3F; AdQIb: if (!($res["\x72\145\164\143\157\x64\x65"] == "\106\101\x49\114")) { goto c7qjx; } goto I9ghq; Q0vuE: throw new PayException("\xe8\256\xa2\345\x8d\225\345\x8f\267\xe6\x9c\x89\350\257\xaf"); goto YMxxQ; iCtRq: $openid = $order["\x6f\160\145\x6e\x69\144"]; goto ZXypn; Bt03U: $params["\x72\x65\x71\x73\156"] = $order["\162\x65\x71\x73\x6e"]; goto e56Ei; TNIIo: $params["\141\160\x70\151\144"] = $this->config["\141\160\x70\151\x64"]; goto X8PEo; jU4VS: $params["\163\151\147\156"] = self::SignArray($params, $this->config["\x61\x70\160\153\145\x79"]); goto OLA20; Zlq3F: $params["\x69\x64\156\157"] = ''; goto a8TfT; ZXypn: $trxamt = floatval($order["\164\162\x78\141\155\x74"]) * 100; goto Zuwsu; sB2Z8: k8eZ5: goto PWXGf; a8TfT: $params["\164\x72\x75\x65\156\x61\155\x65"] = ''; goto salvt; BiSMo: zgk6n: goto PsUef; q3ct6: if (!self::validSign($res, $this->config["\x61\160\x70\153\145\171"])) { goto gumEu; } goto u5hpm; lVWko: $params["\x63\165\163\x69\x64"] = $this->config["\143\x75\x73\151\144"]; goto TNIIo; Zuwsu: $params = array(); goto lVWko; ubnjb: throw new PayException("\344\270\213\xe5\x8d\225\345\xa4\xb1\xe8\264\245\xef\xbc\x9a" . $res["\x72\x65\x74\155\x73\x67"]); goto wXnaM; YMxxQ: lsx1Q: goto z1qzS; u5hpm: if (!(false !== $callback)) { goto k8eZ5; } goto ygXf5; PsUef: return false; goto ENaq_; W_I1e: $params["\x72\141\x6e\144\x6f\x6d\x73\164\162"] = self::GetNonceStr(); goto qAXql; yqWkz: $params["\164\x72\170\141\x6d\x74"] = $trxamt; goto Bt03U; CX6C7: } public function Notify() { goto NW6Rd; LDvbE: foreach ($_POST as $key => $val) { $params[$key] = $val; eFtiT: } goto RkZH0; rZ2JY: if (!(count($params) < 1)) { goto SK7Br; } goto pSMr1; RkZH0: DDJ0M: goto rZ2JY; hIcHe: SK7Br: goto TcZpI; zxPr1: RkEk0: goto Xch6G; pSMr1: echo "\x65\162\x72\x6f\x72"; goto SnToG; TcZpI: if (self::ValidSign($params, $this->config["\141\160\160\x6b\x65\171"])) { goto V41G9; } goto l3zBD; w7idv: exit; goto GjKsr; Ll33F: $params = array(); goto LDvbE; GOIst: V41G9: goto rKPX7; rKPX7: echo "\x73\165\143\143\x65\163\x73"; goto zd5ZA; GjKsr: goto RkEk0; goto GOIst; Xch6G: H8TtQ: goto KaVic; l3zBD: echo "\x65\162\162\x6f\x72"; goto w7idv; SnToG: exit; goto hIcHe; zd5ZA: return $params; goto zxPr1; NW6Rd: if (empty($_POST)) { goto H8TtQ; } goto Ll33F; KaVic: } public function QueryOrder($reqsn) { goto E_AbX; g6W0s: return false; goto tIUPL; t1noU: $params["\x73\151\147\x6e"] = self::SignArray($params, $this->config["\x61\160\160\x6b\145\x79"]); goto nE2mA; fGuar: return $res; goto yMbpT; rVDiz: $res = self::CurlPost($url, $paramsStr, true); goto pU7E0; pU7E0: if (!self::validSign($res, $this->config["\141\160\x70\153\145\171"])) { goto RtHtC; } goto RXGoH; OGmA8: dFUYx: goto Vmckj; G8iT2: $params["\166\x65\162\163\151\157\156"] = $this->config["\166\x65\x72\163\151\x6f\x6e"]; goto oBHbE; r4cZU: DAY16: goto g6W0s; paMpz: $params["\x61\160\x70\151\x64"] = $this->config["\x61\x70\160\151\x64"]; goto G8iT2; E_AbX: if (empty($reqsn)) { goto o1SB6; } goto w07hR; k3QJt: goto dFUYx; goto QiaeO; xeo53: throw new PayException("\xe8\256\xa2\345\x8d\x95\xe5\x8f\xb7\351\x95\xbf\xe5\xba\xa6\346\234\211\350\257\xaf"); goto nVP6k; L5ZBI: $params["\x63\165\x73\151\x64"] = $this->config["\x63\165\x73\151\x64"]; goto paMpz; wq9He: $url = $this->config["\x61\x70\151\165\x72\x6c"] . "\57\x71\x75\145\x72\x79"; goto rVDiz; JoYXd: if (!($res["\x74\x72\x78\x73\x74\141\x74\x75\163"] == "\x30\60\x30\60")) { goto CXTcC; } goto fGuar; nVP6k: VXbCG: goto k3QJt; Vmckj: $params = array(); goto L5ZBI; RXGoH: if (!($res["\162\x65\164\x63\157\144\x65"] == "\123\x55\x43\103\105\x53\123")) { goto DAY16; } goto JoYXd; oBHbE: $params["\x72\x65\x71\x73\x6e"] = $reqsn; goto Rv103; yMbpT: CXTcC: goto r4cZU; tIUPL: RtHtC: goto sT4vW; w07hR: if (!(strlen($reqsn) > 32)) { goto VXbCG; } goto xeo53; QiaeO: o1SB6: goto z3WWP; Rv103: $params["\x72\141\156\144\157\155\163\164\x72"] = self::GetNonceStr(); goto t1noU; z3WWP: throw new PayException("\350\256\xa2\345\215\x95\xe5\217\xb7\xe6\234\x89\350\xaf\xaf"); goto OGmA8; nE2mA: $paramsStr = self::ToUrlParams($params); goto wq9He; sT4vW: } public static function GetNonceStr($length = 32) { goto SsGmd; rUqsZ: aScqr: goto i_Y2W; XcZIm: FkRa8: goto h9ZYC; fx7yB: goto FkRa8; goto rUqsZ; i_Y2W: return $str; goto QvhHT; SsGmd: $chars = "\141\x62\143\x64\145\146\x67\150\151\152\x6b\x6c\155\x6e\157\x70\161\162\x73\164\165\x76\x77\170\171\172\x30\x31\x32\x33\x34\65\x36\x37\70\71"; goto IGxHf; PKsvA: $i = 0; goto XcZIm; h9ZYC: if (!($i < $length)) { goto aScqr; } goto nC4Si; IGxHf: $str = ''; goto PKsvA; oKoF0: $i++; goto fx7yB; JOrG9: BtB3G: goto oKoF0; nC4Si: $str .= substr($chars, mt_rand(0, strlen($chars) - 1), 1); goto JOrG9; QvhHT: } public static function SignArray(array $array, $appkey) { goto SKCtT; vlqjc: $blankStr = self::ToUrlParams($array); goto W5hXU; pPLpI: ksort($array); goto vlqjc; RUlqR: return $sign; goto hh7aI; SKCtT: $array["\x6b\x65\171"] = $appkey; goto pPLpI; W5hXU: $sign = md5($blankStr); goto RUlqR; hh7aI: } public static function ToUrlParams(array $array) { goto FHaQ0; a0OXR: CR3eR: goto fEs_a; Atv2f: return $buff; goto b5NmW; fEs_a: $buff = trim($buff, "\x26"); goto Atv2f; FHaQ0: $buff = ''; goto J1EUr; J1EUr: foreach ($array as $k => $v) { goto kMc40; RRIcB: $buff .= $k . "\75" . $v . "\46"; goto YswOj; YswOj: FTX9K: goto hf2Fw; hf2Fw: dEb3Z: goto ijpqb; kMc40: if (!($v != '' && !is_array($v))) { goto FTX9K; } goto RRIcB; ijpqb: } goto a0OXR; b5NmW: } public static function CurlPost($url, $params, $json = false) { goto wERhC; L85LV: return $output; goto Q23L8; Bscz8: curl_setopt($ch, CURLOPT_URL, $url); goto KXuEK; wERhC: $ch = curl_init(); goto TZMLk; ZIV6B: curl_setopt($ch, CURLOPT_POST, 1); goto guWYm; TZMLk: $this_header = array("\x63\157\x6e\x74\x65\156\x74\55\164\x79\160\145\72\40\141\x70\160\x6c\151\x63\x61\164\x69\x6f\x6e\x2f\170\55\167\167\167\x2d\146\x6f\x72\x6d\x2d\x75\162\154\x65\156\x63\x6f\144\x65\144\73\x63\150\141\162\x73\x65\164\75\x55\x54\106\x2d\70"); goto UTfZj; ECw4L: $output = curl_exec($ch); goto rDfcW; FnbC_: curl_setopt($ch, CURLOPT_USERAGENT, "\115\157\x7a\x69\x6c\x6c\x61\x2f\65\x2e\x30\40\x28\x63\157\x6d\160\141\x74\151\x62\154\145\x3b\x20\115\123\111\x45\x20\65\56\x30\61\73\x20\x57\151\156\x64\x6f\167\163\x20\x4e\124\40\65\56\60\x29"); goto idMXa; NeRJF: return json_decode($output, true); goto JbVkR; idMXa: curl_setopt($ch, CURLOPT_TIMEOUT, 30); goto ZIV6B; rDfcW: curl_close($ch); goto ndGI9; KXuEK: curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1); goto FnbC_; ndGI9: if (!$json) { goto SUeRv; } goto NeRJF; UTfZj: curl_setopt($ch, CURLOPT_HTTPHEADER, $this_header); goto Bscz8; Aa6Nm: curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, FALSE); goto mRdv1; JbVkR: SUeRv: goto L85LV; mRdv1: curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, FALSE); goto ECw4L; guWYm: curl_setopt($ch, CURLOPT_POSTFIELDS, $params); goto Aa6Nm; Q23L8: } public static function CurlGet($url, $json = false) { goto wopdh; Xko7x: curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, FALSE); goto F32yc; wopdh: $ch = curl_init(); goto T8Lth; RpH2P: return json_decode($output, true); goto tTtye; T8Lth: curl_setopt($ch, CURLOPT_TIMEOUT, 60); goto O5rKG; sRHtR: return $output; goto dfWwo; psFi1: $output = curl_exec($ch); goto fLM7F; J_nCg: curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, FALSE); goto Xko7x; O5rKG: curl_setopt($ch, CURLOPT_URL, $url); goto J_nCg; fLM7F: curl_close($ch); goto sBva1; F32yc: curl_setopt($ch, CURLOPT_HEADER, FALSE); goto FbQof; sBva1: if (!$json) { goto fZ5yp; } goto RpH2P; tTtye: fZ5yp: goto sRHtR; FbQof: curl_setopt($ch, CURLOPT_RETURNTRANSFER, TRUE); goto psFi1; dfWwo: } public static function ValidSign(array $array, $appkey) { goto leMAQ; leMAQ: $sign = $array["\x73\151\x67\x6e"]; goto OrTi4; qitAZ: return strtolower($sign) == strtolower($mySign); goto QjDKr; XsK38: $mySign = self::SignArray($array, $appkey); goto qitAZ; sDDLO: $array["\x6b\145\x79"] = $appkey; goto XsK38; OrTi4: unset($array["\163\x69\x67\156"]); goto sDDLO; QjDKr: } public static function Log($text) { goto r157C; Icxxq: file_put_contents($filename, $text . "\xd\xa", FILE_APPEND); goto aulK_; r157C: $filename = dirname(__FILE__) . "\x2f\154\x6f\x67\137\40\160\x61\x79\56\x6c\157\x67"; goto Ui4ou; Ui4ou: $text = "\133" . date("\x59\x2d\155\55\144\x20\x48\72\151\72\163", time()) . "\x5d\40" . $text; goto Icxxq; aulK_: } } class PayException extends Exception { public function errorMessage() { return $this->getMessage(); } }
