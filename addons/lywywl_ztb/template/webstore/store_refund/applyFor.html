<!DOCTYPE html>
<html lang="zh-cn">
{php include $this->template('common/header')}

<body class="skin-blue sidebar-mini fixed">
    <div class="wrapper">
        <!-- 头部菜单 -->
        {php include $this->template('common/top')}
        <!-- 左侧导航 -->
        {php include $this->template('common/sidebar')}
        <!-- 页面内容 -->
        <div class="content-wrapper">
            <section class="content-header">
                <i></i>
                <h1>
                    {$title}
                </h1>
                <ol class="breadcrumb">
                    <li><a href="{php echo $this->createWebAppUrl('home');}"><i class="fa fa-dashboard"></i> 首页</a>
                    </li>
                    <li class="active">资金管理</li>
                    <li class="active">{$title}</li>
                </ol>
            </section>
            <!-- 主体内容 -->
            <section class="content">
                <div class="row">
                    <div class="col-xs-12">
                        <div class="nav-tabs-custom">
                            <ul class="nav nav-tabs">
                                <li><a
                                        href="{php echo $this->createWebAppUrl('store_refund', array('act' => 'index'));}">提现列表</a>
                                </li>
                                <li class="active"><a href="#">申请提现</a></li>
                            </ul>
                            <div class="tab-content">
                                <form class="form-horizontal" name="form_content" id="form_content" method="post">
                                    <div class="box">
                                        <div class="box-header with-border">
                                            <h3 class="box-title"><i class="fa fa-circle-o"></i>申请提现</h3>
                                            <div class="box-tools pull-right">
                                                <button class="btn btn-box-tool" data-widget="collapse"><i
                                                        class="fa fa-minus"></i></button>
                                            </div>
                                        </div>
                                        <div class="box-body">
                                            <div class="form-group">
                                                <label for="storeMoney" class="col-sm-2 control-label"><span
                                                        class="text-red"></span>商家账户余额</label>
                                                <div class="col-sm-10">
                                                    <div class="input-group">
                                                        <input class="form-control" type="text" id="storeMoney"
                                                            value="{$store['money']}" disabled />
                                                        <span class="input-group-addon">元</span>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="form-group"
                                                style="display: {if intval($config['is_verify_refund'])==1} none {/if};">
                                                <label class="col-sm-2 control-label"><span
                                                        class="text-red">(*)</span>提现方式</label>
                                                <div class="col-sm-10">
                                                    <label>
                                                        <input type="radio" name="model[withdrawal_type]"
                                                            id="withdrawal_type0" class="flat-blue withdrawal_type"
                                                            {if $model['withdrawal_type']==0} checked {/if}
                                                            value="0"> 微信
                                                    </label>&nbsp;&nbsp;
                                                    <label   style="display: {if intval($config['is_verify_refund_show'])==0} none {/if};">
                                                        <input type="radio" name="model[withdrawal_type]"
                                                            id="withdrawal_type1" class="flat-blue withdrawal_type"
                                                            {if $model['withdrawal_type']==1} checked {/if}
                                                            value="1"> 支付宝
                                                    </label>&nbsp;&nbsp;
                                                    <label   style="display: {if intval($config['is_verify_refund_show'])==0} none {/if};">
                                                        <input type="radio" name="model[withdrawal_type]"
                                                            id="withdrawal_type2" class="flat-blue withdrawal_type"
                                                            {if $model['withdrawal_type']==2} checked {/if}
                                                            value="2"> 银行卡
                                                    </label>&nbsp;&nbsp;
                                                    <p class="help-block"><strong class="text-danger">提示：</strong>
                                                        请选择您要提现的渠道方式,</p>
                                                </div>
                                            </div>
                                            <div class="form-group" id = "withdrawal_name_div"   style="display: {if intval($model['withdrawal_type'])==0} none {/if};">
                                                <label for="withdrawal_name" class="col-sm-2 control-label"><span
                                                        class="text-red">(*)</span>银行卡开户名</label>
                                                <div class="col-sm-10">
                                                    <input class="form-control" id="withdrawal_name" name="model[withdrawal_name]"
                                                        type="text" value="{$model['withdrawal_name']}"   placeholder="请输入您的银行卡开户名"/>
                                                </div>
                                            </div>
                                            <div class="form-group" style="display: {if intval($config['is_verify_refund_show'])==0} none {/if};">
                                                <label for="withdrawal" class="col-sm-2 control-label"><span
                                                        class="text-red">(*)</span>收款账户</label>
                                                <div class="col-sm-10">
                                                    <input class="form-control" id="withdrawal" name="model[withdrawal]"
                                                        type="text" value="{$model['withdrawal']}" disabled  />
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label for="money" class="col-sm-2 control-label"><span
                                                        class="text-red">(*)</span>申请提现金额</label>
                                                <div class="col-sm-10">
                                                    <div class="input-group">
                                                        <input class="form-control" id="money" maxlength="10"
                                                            datatype="*" nullmsg="请输入申请提现金额！" name="model[money]"
                                                            placeholder="请输入申请提现金额" min="0.00" step="0.01" type="number"
                                                            onkeyup="if(isNaN(this.value)){this.value='0.00';}else{this.value}"
                                                            onblur="this.value=FloatMoney(this.value)"
                                                            value="{$model['money']}" />
                                                        <span class="input-group-addon">元</span>
                                                    </div>
                                                    <p class="help-block"><strong class="text-danger">提示：</strong>
                                                        单次提现金额限制<code>{$config['refund_min_money']}</code> -
                                                        <code>{if empty($config['refund_max_money'])}5000.00{else}{$config['refund_max_money']}{/if}</code>。
                                                    </p>
                                                </div>
                                            </div>
                                            <div class="form-group" id="openid_div"
                                                style="display: {if intval($config['is_verify_refund'])==0} none {/if};">
                                                <label for="openid" class="col-sm-2 control-label"><span
                                                        class="text-red">(*)</span>微信OPENID</label>
                                                <div class="col-sm-10">
                                                    <input class="form-control" id="openid" type="text"
                                                        value="{$store['openid']}" disabled />
                                                    <p class="help-block"><strong class="text-danger">提示：</strong>
                                                        如果没有配置商家微信OPENID，请先配置好。<a
                                                            href="{php echo $this->createWebAppUrl('store_account');}"
                                                            target="_blank"> &gt;&gt;设置商家微信OPENID</a></p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="box-body">
                                            <div class="form-group">
                                                <div class="col-sm-offset-2 col-sm-10">
                                                    <input type="hidden" name="token" value="{$_W['token']}" />
                                                    <input type="hidden" name="submit" value="submit" />
                                                    <button type="submit" class="btn btn-primary" id="SubmitBtn">
                                                        <i class="fa fa-pencil"></i> 提交
                                                    </button>
                                                    <button type="reset" class="btn btn-default"><i
                                                            class="fa fa-refresh"></i> 重置
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
        <!-- 底部版权 -->
        {php include $this->template('common/footer')}
    </div>
    <script>
        $(function () {
            SelectNav("账户资金提现");

            myrequire(['select2', 'bootstrap-switch', 'validform', 'icheck', 'bootstrap-slider'], function () {


                /*{if intval($config['is_verify_refund'])==0}*/
                
                //初始化icheck控件radio
                $('input[type="checkbox"].flat-blue, input[type="radio"].flat-blue').iCheck({
                    checkboxClass: 'icheckbox_flat-blue',
                    radioClass: 'iradio_flat-blue'
                });
                
                //选择提现账号是否显示
                $('.withdrawal_type').on('ifChecked', function (event) { //ifCreated 事件应该在插件初始化之前绑定
                    var obj_types = $(this).val();
                    if (obj_types == 0) {
                        $("#withdrawal").val($("#openid").val());
                        $("#withdrawal").attr("disabled",true);
                        $("#openid_div").hide();
                        $("#withdrawal_name_div").hide();
                    }
                    else if (obj_types == 1 ) {
                        $("#withdrawal").val("");
                        $("#withdrawal").attr("disabled",false);
                        $("#withdrawal").attr("placeholder","请输入您的支付宝账户");
                        $("#openid_div").hide();
                        $("#withdrawal_name_div").hide();
                    }else if (obj_types == 2 ){
                        $("#withdrawal").val("");
                        $("#withdrawal").attr("disabled",false);
                        $("#withdrawal").attr("placeholder","请输入您的银行卡号");
                        $("#openid_div").hide();
                        $("#withdrawal_name_div").show();
                    }
                });
                /*{/if}*/

                //为formContent 添加验证事件
                $("#form_content").Validform({
                    tiptype: function (msg, o, cssctl) {
                        if (!o.obj.is("form")) {
                            if (o.type == 2) {
                                //loading带文字
                                layer.open({
                                    type: 2
                                    , content: '数据提交中'
                                    , time: 999 //999秒后自动关闭
                                });
                            } else {
                                layer.closeAll();
                                layer.open({
                                    content: msg
                                    , skin: 'msg'
                                    , time: 2 //2秒后自动关闭
                                });
                            }
                        }
                    },
                    ajaxPost: true,
                    tipSweep: true,
                    beforeSubmit: function (curform) {
                        $("#SubmitBtn").attr("disabled", true);
                    },
                    callback: function (data) {
                        layer.closeAll();
                        if (data.status == 1) {
                            Command: toastr["success"](data.msg, "成功提示");
                            if (data.type == 1) {
                                setTimeout(function () {
                                    window.location.href = "{php echo $this->createWebAppUrl('store_refund', array('act' => 'index'));}";
                                }, 2000);
                            } else {
                                setTimeout(function () {
                                    window.location.reload();
                                }, 2000);
                            }
                        }
                        else if (data.status == "2") {
                            Command: toastr["warning"](data.msg, "验证提示");
                            $("#SubmitBtn").attr("disabled", false);
                        }
                        else {
                            Command: toastr["error"](data.msg, "错误提示");
                            setTimeout(function () {
                                window.location.href = window.location.href;
                            }, 2000);
                        }
                    }
                });

            });

        });
    </script>
</body>

</html>