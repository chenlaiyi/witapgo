<!DOCTYPE html>
<html lang="zh-cn">
{template 'web/common/header'}
<body class="skin-blue sidebar-mini fixed">
<div id="rightbox">
    <ul>
        <li>
            <a class="num" href="#1F" style="display:none">信息</a>
            <a class="word" href="#1F" style="display:block">活动信息</a>
        </li>
        <li>
            <a class="num" href="#2F">分享</a>
            <a class="word" href="#2F">分享设置</a>
        </li>
        <li>
            <a class="num" href="#3F">限制</a>
            <a class="word" href="#3F">参与限制</a>
        </li>
        <li>
            <a class="num" href="#4F">伪造</a>
            <a class="word" href="#4F">数据伪造</a>
        </li>
        <li>
            <a class="num" href="#5F">栏目</a>
            <a class="word" href="#5F">栏目设置</a>
        </li>
        <li style="display: {if $config['sms_obj']!=1}none{/if};">
            <a class="num" href="#6F">通知</a>
            <a class="word" href="#6F">通知设置</a>
        </li>
        <li>
            <a class="num" href="#7F">样式</a>
            <a class="word" href="#7F">样式设置</a>
        </li>
        <li>
            <a class="num" href="#8F">广告</a>
            <a class="word" href="#8F">广告设置</a>
        </li>
        <li class="last">
            <a class="num" href="javascript:window.scrollTo(0,0);">TOP</a>
            <a class="word" href="javascript:window.scrollTo(0,0);">返回顶部</a>
        </li>
    </ul>
</div>
<div class="wrapper">
    <!-- 头部菜单 -->
    {template 'web/common/top'}
    <!-- 左侧导航 -->
    {template 'web/common/sidebar'}
    <!-- 页面内容 -->
    <div class="content-wrapper">
        <section class="content-header">
            <i></i>
            <h1>
                {$title}
            </h1>
            <ol class="breadcrumb">
                <li><a href="{php echo $this->createWebUrl('home');}"><i class="fa fa-dashboard"></i> 首页</a>
                </li>
                <li class="active">活动</li>
                <li class="active">{$title}</li>
            </ol>
        </section>
        <!-- 主体内容 -->
        <section class="content">
            <div class="row">
                <div class="col-xs-12">
                    <div class="nav-tabs-custom">
                        <ul class="nav nav-tabs">
                            <li><a href="{php echo $this->createWebUrl('obj_wheel', array('act' => 'index'));}">活动列表</a>
                            </li>
                            <li class="active"><a href="#">{if !empty($model['id'])}编辑{else}创建{/if}活动</a></li>
                        </ul>
                        <div class="tab-content">
                            <form class="form-horizontal" name="form_content" id="form_content" method="post">
                                <div class="box">
                                    <div class="box-header with-border">
                                        <h3 class="box-title"><i class="fa fa-circle-o"></i> {if !empty($model['id'])}编辑{else}创建{/if}活动信息<a name="1F" id="1F"></a></h3>
                                        <div class="box-tools pull-right">
                                            <button class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
                                        </div>
                                    </div>
                                    <div class="box-body">
                                        <div class="form-group">
                                            <label for="title" class="col-sm-2 control-label"><span
                                                    class="text-red">(*)</span>抽奖活动名称</label>
                                            <div class="col-sm-10">
                                                <input class="form-control" datatype="*" id="title" maxlength="200"
                                                       name="model[title]" nullmsg="请输入抽奖活动名称！" placeholder="请输入抽奖活动名称"
                                                       type="text" value="{$model['title']}"/>
                                                <p class="help-block"><strong class="text-danger">提示：</strong> 抽奖活动名称作为区分活动的标识，将作为标题显示在浏览器标题栏</p>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-2 control-label">活动封面图片</label>
                                            <div class="col-sm-10">
                                                {php echo tpl_form_field_image('model[pic_url]',$model['pic_url']);}
                                                <span class="help-block">
                                                <p><strong class="text-danger">提示：</strong> 请上传活动封面图片,将展示在活动列表和用户参与记录中;建议尺寸200*200px</p>
                                                </span>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="status2" class="col-sm-2 control-label">当前活动状态</label>
                                            <div class="col-sm-10">
                                                <input data-off-text="关闭" data-on-text="开启" data-size="mini" id="status"
                                                       type="checkbox" value="true" {if $model['status']==1}checked{/if}/>
                                                <input id="status2" name="model[status]" type="hidden"
                                                       value="{$model['status']}"/>
                                                <p class="help-block"><strong class="text-danger">提示：</strong> 选择活动开启/关闭状态，关闭活动后用户将无法参与活动</p>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-2 control-label"><span class="text-red">(*)</span>活动规则/活动内容</label>
                                            <div class="col-sm-10">
                                                {php echo tpl_ueditor('model[content]',$model['content']);}
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="title" class="col-sm-2 control-label">活动咨询电话</label>
                                            <div class="col-sm-10">
                                                <input class="form-control" id="tel" maxlength="200" name="model[tel]" placeholder="请输入活动咨询电话" type="text" value="{$model['tel']}"/>
                                                <p class="help-block"><strong class="text-danger">提示：</strong>如不填写活动咨询电话，默认使用系统客服电话或商家联系电话</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="box">
                                    <div class="box-header with-border">
                                        <h3 class="box-title"><i class="fa fa-circle-o"></i> 活动分享设置<a name="2F" id="2F"></a></h3>
                                        <div class="box-tools pull-right">
                                            <button class="btn btn-box-tool" data-widget="collapse"><i
                                                    class="fa fa-minus"></i></button>
                                        </div>
                                    </div>
                                    <div class="box-body">
                                        <div class="form-group">
                                            <label for="share_title" class="col-sm-2 control-label"><span
                                                    class="text-red">(*)</span>活动分享标题</label>
                                            <div class="col-sm-10">
                                                <input class="form-control" id="share_title" maxlength="200"
                                                       name="model[share_title]" placeholder="请输入活动分享标题"
                                                       type="text" value="{$model['share_title']}"/>
                                                <p class="help-block"><strong class="text-danger">提示：</strong> 填写<code onclick="insertAtCursor('share_title',this);">{##NICKNAME##}</code>系统会自动替换为分享用户的昵称。</p>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-2 control-label">活动分享图标</label>
                                            <div class="col-sm-10">
                                                {php echo tpl_form_field_image('model[share_thumb]',$model['share_thumb']);}
                                                <span class="help-block">
                                            <p><strong class="text-danger">提示：</strong> 分享图片可不设置 不设置将用分享者头像</p>
                                        </span>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="share_desc" class="col-sm-2 control-label"><span class="text-red">(*)</span>活动分享描述</label>
                                            <div class="col-sm-10">
                                                <textarea rows = "3" name="model[share_desc]" id="share_desc" class="form-control" placeholder = "请输入活动分享描述..." maxlength="200">{$model['share_desc']}</textarea>
                                                <p class="help-block"><strong class="text-danger">提示：</strong>   填写<code onclick="insertAtCursor('share_desc',this);">{##NICKNAME##}</code>系统会自动替换为分享用户的昵称,活动分享描述请不要将内容换行，系统将自动过滤到换行符。</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="box">
                                    <div class="box-header with-border">
                                        <h3 class="box-title"><i class="fa fa-circle-o"></i> 活动参与限制<a name="3F" id="3F"></a></h3>
                                        <div class="box-tools pull-right">
                                            <button class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
                                        </div>
                                    </div>
                                    <div class="box-body">
                                        <div class="form-group">
                                            <label class="col-sm-2 control-label"><span
                                                    class="text-red">(*)</span>开始结束时间</label>
                                            <div class="col-sm-10">
                                                {php echo tpl_form_field_daterange('model[interim][startendtime]',$model['startendtime'],true)}
                                                <p class="help-block"><strong class="text-danger">提示：</strong> 请选择抽奖活动的开始和结束时间，活动只有在启动时间内有效。</p>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-2 control-label"><span class="text-red">(*)</span>活动抽奖模式</label>
                                            <div class="col-sm-10">
                                                <label>
                                                    <input type="radio" value="0" name="model[models]" id="models0"
                                                           class="flat-blue obj_models" {if $model['models']==0} checked
                                                    {/if}> 普通模式
                                                </label>&nbsp;&nbsp;
                                                <label>
                                                    <input type="radio" value="1" name="model[models]" id="models1"
                                                           class="flat-blue obj_models" {if $model['models']==1} checked
                                                    {/if}> 积分模式
                                                </label>&nbsp;&nbsp;&nbsp;
                                                <p class="help-block">
                                                    <code>普通模式：</code>用户访问即可参与抽奖，没有任何附加条件 ；<code>积分模式：</code>用户消耗指定账户积分后，参与一次抽奖活动。
                                                </p>
                                            </div>
                                        </div>
                                        <div id="obj_models_limit" style="display: {if $model['models'] == 1} none{/if};">
                                            <div class="form-group">
                                                <label class="col-sm-2 control-label"><span
                                                        class="text-red">(*)</span>领取红包方式</label>
                                                <div class="col-sm-10">
                                                    <label>
                                                        <input type="radio" name="model[get_types]" id="get_types0" class="flat-blue obj_get_types" value="0" {if $model['get_types']==0} checked {/if}> 活动期间
                                                    </label>&nbsp;&nbsp;
                                                    <label>
                                                        <input type="radio" name="model[get_types]" id="get_types1" class="flat-blue obj_get_types" value="1" {if $model['get_types']==1} checked {/if}> 活动每天
                                                    </label>&nbsp;&nbsp;
                                                    <label>
                                                        <input type="radio" name="model[get_types]" id="get_types2" class="flat-blue obj_get_types" value="2" {if $model['get_types']==2} checked {/if}> 随意领取
                                                    </label>&nbsp;&nbsp;
                                                    <p class="help-block"><strong class="text-danger">提示：</strong> 请选择限制用户领取红包的方式，选择“活动期间”，“活动每天”后，请完善“默认领取次数”选项信息。</p>
                                                </div>
                                            </div>
                                            <div class="form-group" id="limit_num_box" style="display: {if $model['get_types'] == 2} none{/if};">
                                                <label for="limit_num" class="col-sm-2 control-label"><span
                                                        class="text-red">(*)</span>默认领取次数</label>
                                                <div class="col-sm-10">
                                                    <input class="form-control" id="limit_num" maxlength="10"
                                                           name="model[limit_num]"  placeholder="请输入活动红包默认领取次数"
                                                           type="number" value="{$model['limit_num']}"/>
                                                    <p class="help-block"><strong class="text-danger">提示：</strong> 请输入活动红包默认领取次数，超过次数将无法参与活动，请和“领取红包方式”选项配合设置。</p>
                                                </div>
                                            </div>
                                            <div class="form-group" id="friend_box" style="display: {if $model['models'] != 0} none{/if};">
                                                <label class="col-sm-2 control-label"><span class="text-red">(*)</span>开启邀请模式</label>
                                                <div class="col-sm-10">
                                                    <label>
                                                        <input type="radio" value="1" name="model[is_invite_friend]" id="is_invite_friend1"
                                                               class="flat-blue invite_friend" {if $model['is_invite_friend']==1} checked
                                                        {/if}> 开启
                                                    </label>&nbsp;&nbsp;
                                                    <label>
                                                        <input type="radio" value="0" name="model[is_invite_friend]" id="is_invite_friend0"
                                                               class="flat-blue invite_friend" {if $model['is_invite_friend']==0} checked
                                                        {/if}> 关闭
                                                    </label>&nbsp;&nbsp;
                                                    <p class="help-block">
                                                        <strong class="text-danger">提示：</strong> 开启后每邀请一位好友参与抽奖活动 邀请用户可获得1次抽奖机会。
                                                    </p>
                                                </div>
                                            </div>
                                            <div class="form-group" id="invite_limit_box" style="display: {if $model['models'] != 0 || $model['is_invite_friend'] != 1} none{/if};">
                                                <label for="invite_limit_num" class="col-sm-2 control-label"><span
                                                        class="text-red">(*)</span>限制邀请次数</label>
                                                <div class="col-sm-10">
                                                    <input class="form-control" id="invite_limit_num" maxlength="10"
                                                           name="model[invite_limit_num]"  placeholder="请输入活动限制邀请次数"
                                                           type="number" value="{$model['invite_limit_num']}"/>
                                                    <p class="help-block"><strong class="text-danger">提示：</strong> 请输入活动邀请限制次数（0表示不限制），超过次数将无法参与活动，请和“领取红包方式”选项配合设置。</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div id="obj_models_score" style="display: {if $model['models'] != 1} none{/if};">
                                            <div class="form-group">
                                                <label for="cost_score" class="col-sm-2 control-label"><span
                                                        class="text-red">(*)</span>所需系统积分</label>
                                                <div class="col-sm-10">
                                                    <div class="input-group">
                                                        <input class="form-control" id="cost_score"
                                                               maxlength="10" name="model[cost_score]"
                                                               placeholder="请输入系统积分"
                                                               onkeyup="this.value=this.value.replace(/\D/g,'')"
                                                               onafterpaste="this.value=this.value.replace(/\D/g,'')"
                                                               step="1" max="1000"
                                                               type="number" value="{$model['cost_score']}"/>
                                                        <span class="input-group-addon">积分</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="max_draw" class="col-sm-2 control-label"><span
                                                    class="text-red">(*)</span>最大中奖数量</label>
                                            <div class="col-sm-10">
                                                <input class="form-control" id="max_draw" maxlength="10"
                                                       name="model[max_draw]"  placeholder="请输入活动最大中奖数量"
                                                       type="number" value="{$model['max_draw']}"/>
                                                <p class="help-block"><strong class="text-danger">提示：</strong> 请输入活动最大中奖数量，除谢谢参与外超过最大中奖数量后，将只会中“谢谢参与”奖项</p>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-2 control-label"><span
                                                    class="text-red">(*)</span>是否信息登记</label>
                                            <div class="col-sm-10">
                                                <label>
                                                    <input type="radio" name="model[is_register]" id="is_register1" class="flat-blue is_register" value="1" {if $model['is_register']==1} checked {/if}> 登记参与
                                                </label>&nbsp;&nbsp;
                                                <label>
                                                    <input type="radio" name="model[is_register]" id="is_register0" class="flat-blue is_register" value="0" {if $model['is_register']==0} checked {/if}> 无需登记
                                                </label>&nbsp;&nbsp;
                                                <p class="help-block"><strong class="text-danger">提示：</strong> 请选择用户参与活动是否需要登记个人信息。</p>
                                            </div>
                                        </div>
                                        <div class="form-group" id="register_field_box" style="display: {if $model['is_register'] == 0} none{/if};">
                                            <label class="col-sm-2 control-label"><span class="text-red">(*)</span>编辑登记字段</label>
                                            <div class="col-sm-10">
                                                <div class="box">
                                                    <div class="box-header">
                                                        <h3 class="box-title">用户登记信息所有为必填字段，“字段”必须为英文，且保证唯一性。</h3>
                                                        <div class="box-tools pull-right">
                                                            <input type="button" id="addregfieldbtn"
                                                                   class="btn btn-sm btn-info" value="添加字段" style="margin-bottom: 10px;" />
                                                        </div>
                                                    </div>
                                                    <div class="box-body">
                                                        <table class="table table-striped" id="addregfieldtable">
                                                            <tr>
                                                                <th>字段类型</th>
                                                                <th>名称</th>
                                                                <th>字段(必须英文)</th>
                                                                <th>提示信息/配置项</th>
                                                                <th>操作</th>
                                                            </tr>
                                                            {if !empty($model['id'])}
                                                            {loop $model['register_field'] $index $item}
                                                            <tr class="addfield">
                                                                <td>
                                                                    <select name="model[register_field][{$index}][Type]" class="form-control select2" style = "width: 100%;">
                                                                        <option value="text" {if $item['Type']=='text'} selected {/if}>文本字段</option>
                                                                        <option value="number" {php echo $index<2?"disabled":""} {if $item['Type']=='number'} selected {/if}>数字字段</option>
                                                                        <option value="radio" {php echo $index<2?"disabled":""} {if $item['Type']=='radio'} selected {/if}>单选按钮</option>
                                                                        <option value="checkbox" {php echo $index<2?"disabled":""} {if $item['Type']=='checkbox'} selected {/if}>复选按钮</option>
                                                                        <option value="select" {php echo $index<2?"disabled":""} {if $item['Type']=='select'} selected {/if}>下拉列表</option>
                                                                        <option value="textarea" {php echo $index<2?"disabled":""} {if $item['Type']=='textarea'} selected {/if}>文本域</option>
                                                                    </select>
                                                                </td>
                                                                <td>
                                                                    <input class="form-control" 
                                                                    name="model[register_field][{$index}][Explain]"  placeholder="请输入名称" value="{$item['Explain']}"
                                                                    type="text" />
                                                                </td>
                                                                <td>
                                                                    <input class="form-control" {php echo $index<2?"readonly":""}
                                                                    name="model[register_field][{$index}][Name]"  placeholder="请输入字段(仅支持英文)" onkeyup="value=value.replace(/[^a-zA-Z]/g,'')" value="{$item['Name']}"
                                                                    type="text"/>
                                                                </td>
                                                                <td>
                                                                    <input class="form-control"
                                                                    name="model[register_field][{$index}][Tips]"  placeholder="请输入提示信息/配置项" value="{$item['Tips']}"
                                                                    type="text"/>
                                                                </td>
                                                                <td>
                                                                    <input type="button" class="btn btn-sm btn-danger pull-right {php echo $index<2?"disabled":"delfielditem"}" value="删除字段" style="margin-right:10px" />
                                                                </td>
                                                            </tr>
                                                            {if $item['Name']=="Mobile" && $config['sms_obj']==1}
                                                            <tr class="issmsckfield">
                                                                <td>
                                                                    <div style="line-height: 34px;">
                                                                        <label>
                                                                            <input class="flat-blue" type="checkbox" name="model[register_field][{$index}][IsSmsCk]" {php echo $item['IsSmsCk']==1?"checked":""} value="1"/> 短信验证
                                                                        </label>
                                                                    </div>
                                                                </td>
                                                                <td colspan="3"><div style="line-height: 34px;">选择短信验证后，用户提交登记信息时需要发送短信验证码，填写正确后才能提交。</div></td>
                                                                <td></td>
                                                            </tr>
                                                            {/if}
                                                            {/loop}
                                                            {else}
                                                            <tr class="addfield">
                                                                <td>
                                                                    <select name="model[register_field][0][Type]" class="form-control select2" style = "width: 100%;">
                                                                        <option value="text" selected>文本字段</option>
                                                                        <option value="number" disabled>数字字段</option>
                                                                        <option value="radio" disabled>单选按钮</option>
                                                                        <option value="checkbox" disabled>复选按钮</option>
                                                                        <option value="select" disabled>下拉列表</option>
                                                                        <option value="textarea" disabled>文本域</option>
                                                                    </select>
                                                                </td>
                                                                <td>
                                                                    <input class="form-control" 
                                                                           name="model[register_field][0][Explain]"  placeholder="请输入名称" value="您的称呼"
                                                                           type="text" />
                                                                </td>
                                                                <td>
                                                                    <input class="form-control" readonly
                                                                           name="model[register_field][0][Name]"  placeholder="请输入字段(仅支持英文)" onkeyup="value=value.replace(/[^a-zA-Z]/g,'')" value="Name"
                                                                           type="text"/>
                                                                </td>
                                                                <td>
                                                                    <input class="form-control" 
                                                                           name="model[register_field][0][Tips]"  placeholder="请输入提示信息/配置项" value="请输入您的称呼"
                                                                           type="text"/>
                                                                </td>
                                                                <td>
                                                                    <input type="button" class="btn btn-sm btn-danger pull-right disabled" value="删除字段" style="margin-right:10px" />
                                                                </td>
                                                            </tr>
                                                            <tr class="addfield">
                                                                <td>
                                                                    <select name="model[register_field][1][Type]" class="form-control select2" style = "width: 100%;">
                                                                        <option value="text" selected>文本字段</option>
                                                                        <option value="number" disabled>数字字段</option>
                                                                        <option value="radio" disabled>单选按钮</option>
                                                                        <option value="checkbox" disabled>复选按钮</option>
                                                                        <option value="select" disabled>下拉列表</option>
                                                                        <option value="textarea" disabled>文本域</option>
                                                                    </select>
                                                                </td>
                                                                <td>
                                                                    <input class="form-control" 
                                                                           name="model[register_field][1][Explain]"  placeholder="请输入名称" value="手机号码"
                                                                           type="text" />
                                                                </td>
                                                                <td>
                                                                    <input class="form-control" readonly
                                                                           name="model[register_field][1][Name]"  placeholder="请输入字段(仅支持英文)" onkeyup="value=value.replace(/[^a-zA-Z]/g,'')" value="Mobile"
                                                                           type="text" />
                                                                </td>
                                                                <td>
                                                                    <input class="form-control" 
                                                                           name="model[register_field][1][Tips]"  placeholder="请输入提示信息/配置项" value="请输入您的手机号码"
                                                                           type="text"/>
                                                                </td>
                                                                <td>
                                                                    <input type="button" class="btn btn-sm btn-danger pull-right disabled" value="删除字段" style="margin-right:10px" />
                                                                </td>
                                                            </tr>
                                                            {if $config['sms_obj']==1}
                                                            <tr class="issmsckfield">
                                                                <td>
                                                                    <div style="line-height: 34px;">
                                                                        <label>
                                                                            <input class="flat-blue" type="checkbox" name="model[register_field][1][IsSmsCk]" value="1"/> 短信验证
                                                                        </label>
                                                                    </div>
                                                                </td>
                                                                <td colspan="3"><div style="line-height: 34px;">选择短信验证后，用户提交登记信息时需要发送短信验证码，填写正确后才能提交。</div></td>
                                                                <td></td>
                                                            </tr>
                                                            {/if}
                                                            {/if}
                                                        </table>
                                                    </div>
                                                </div>
                                                <p class="help-block"><strong class="text-danger">提示：</strong> 添加所有字段信息为必填字段，请按照要求填写，<code>为保证准确获取用户手机号码 手机号码字段名请使用“Mobile”</code>，如不清楚请咨询在线客服。
                                                    <br>具体设置如下：
                                                    <br>文本字段：适用于用户填写文本内容信息，例如：名称，标题，电话，传真等信息
                                                    <br>数字字段：适用于用户填写数字内容信息，例如：年龄，数量等信息
                                                    <br>单选按钮：适用于用户单选内容信息，例如：性别 ，请填写至“提示信息/配置项”格式如下：男,女
                                                    <br>复选按钮：适用于用户多选内容信息，例如：爱好 ，请填写至“提示信息/配置项”格式如下：音乐,足球,画画
                                                    <br>下拉列表：适用于用户多选项单选内容信息，例如：行业 ，请填写至“提示信息/配置项”格式如下：教育行业,餐饮行业,医疗行业
                                                    <br>文本域：适用于用户较多用户信息填充，例如：备注，个人简介等信息
                                                </p>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="area_limit" class="col-sm-2 control-label">活动区域限制</label>
                                            <div class="col-sm-10">
                                                <input class="form-control" id="area_limit" maxlength="255"
                                                       name="model[area_limit]"  placeholder="请输入允许参与活动的区域名称！"
                                                       type="text" value="{$model['area_limit']}"/>
                                                <p class="help-block"><strong class="text-danger">提示：</strong> 请填写允许参与活动的区域名称，例如：北京,上海,湖南,海南,海口等等,不要加省，市，县。多个地区用","分割。</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="box">
                                    <div class="box-header with-border">
                                        <h3 class="box-title"><i class="fa fa-circle-o"></i> 活动数据伪造<a name="4F" id="4F"></a></h3>
                                        <div class="box-tools pull-right">
                                            <button class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
                                        </div>
                                    </div>
                                    <div class="box-body">
                                        <div class="form-group">
                                            <label for="bogus_click_num" class="col-sm-2 control-label">
                                                <span class="text-red">(*)</span>伪造曝光人数
                                            </label>
                                            <div class="col-sm-10">
                                                <input class="form-control" datatype="n" id="bogus_click_num"
                                                       maxlength="10"
                                                       name="model[bogus_click_num]" nullmsg="请输入伪造曝光人数！"
                                                       placeholder="请输入伪造曝光人数"
                                                       type="number"
                                                       onkeyup="if(isNaN(this.value)){this.value='0';}"
                                                       value="{$model['bogus_click_num']}"/>
                                                <p class="help-block"><strong class="text-danger">提示：</strong>请输入伪造曝光人数 0表示不伪造 展示人数=伪造人数+实际人数</p>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="bogus_repost_num" class="col-sm-2 control-label">
                                                <span class="text-red">(*)</span>伪造转发人数
                                            </label>
                                            <div class="col-sm-10">
                                                <input class="form-control" datatype="n" id="bogus_repost_num"
                                                       maxlength="10"
                                                       name="model[bogus_repost_num]" nullmsg="请输入伪造转发人数！"
                                                       placeholder="请输入伪造转发人数"
                                                       type="number"
                                                       onkeyup="if(isNaN(this.value)){this.value='0';}"
                                                       value="{$model['bogus_repost_num']}"/>
                                                <p class="help-block"><strong class="text-danger">提示：</strong>请输入伪造转发人数 0表示不伪造 展示转发人数=伪造人数+实际人数</p>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="bogus_get_num" class="col-sm-2 control-label">
                                                <span class="text-red">(*)</span>伪造中奖人数
                                            </label>
                                            <div class="col-sm-10">
                                                <input class="form-control" datatype="n" id="bogus_get_num"
                                                       maxlength="10"
                                                       name="model[bogus_get_num]" nullmsg="请输入伪造中奖人数！"
                                                       placeholder="请输入伪造中奖人数"
                                                       type="number"
                                                       onkeyup="if(isNaN(this.value)){this.value='0';}"
                                                       value="{$model['bogus_get_num']}"/>
                                                <p class="help-block"><strong class="text-danger">提示：</strong>请输入伪造中奖人数 0表示不伪造 展示中奖人数=伪造人数+实际人数</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="box">
                                    <div class="box-header with-border">
                                        <h3 class="box-title"><i class="fa fa-circle-o"></i> 活动栏目设置<a name="5F" id="5F"></a></h3>
                                        <div class="box-tools pull-right">
                                            <button class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
                                        </div>
                                    </div>
                                    <div class="box-body">
                                        <div class="form-group">
                                            <label class="col-sm-2 control-label"><span
                                                    class="text-red">(*)</span>展示中奖记录</label>
                                            <div class="col-sm-10">
                                                <label>
                                                    <input type="radio" name="model[is_show_winners]" class="flat-blue" value="0" {if $model['is_show_winners']==0} checked {/if}> 关闭
                                                </label>&nbsp;&nbsp;
                                                <label>
                                                    <input type="radio" name="model[is_show_winners]" class="flat-blue" value="1" {if $model['is_show_winners']==1} checked {/if}> 开启
                                                </label>&nbsp;&nbsp;
                                                <p class="help-block"><strong class="text-danger">提示：</strong>开启后系统顶部会展示最新参与者名单，取前15名中奖者滚动展示。</p>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-2 control-label"><span
                                                    class="text-red">(*)</span>展示门店位置</label>
                                            <div class="col-sm-10">
                                                <label>
                                                    <input type="radio" name="model[is_show_map]" class="flat-blue" value="0" {if $model['is_show_map']==0} checked {/if}> 关闭
                                                </label>&nbsp;&nbsp;
                                                <label>
                                                    <input type="radio" name="model[is_show_map]" class="flat-blue" value="1" {if $model['is_show_map']==1} checked {/if}> 开启
                                                </label>&nbsp;&nbsp;
                                                <p class="help-block"><strong class="text-danger">提示：</strong>开启后活动界面中将展活动门店地址位置信息。</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="box" style="display: {if $config['sms_obj']!=1}none{/if};">
                                    <div class="box-header with-border">
                                        <h3 class="box-title"><i class="fa fa-circle-o"></i> 中奖通知设置{if $config['sms_obj']==1}<a name="6F" id="6F"></a>{/if}</h3>
                                        <div class="box-tools pull-right">
                                            <button class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
                                        </div>
                                    </div>
                                    <div class="box-body">
                                        <div class="form-group">
                                            <label class="col-sm-2 control-label"><span
                                                    class="text-red">(*)</span>中奖短信提醒</label>
                                            <div class="col-sm-10">
                                                <label>
                                                    <input type="radio" name="model[is_sms]" id="is_sms0" class="flat-blue obj_is_sms" value="0" {if $model['is_sms']==0} checked {/if}> 关闭
                                                </label>&nbsp;&nbsp;
                                                <label>
                                                    <input type="radio" name="model[is_sms]" id="is_sms1" class="flat-blue obj_is_sms" value="1" {if $model['is_sms']==1} checked {/if}> 开启
                                                </label>&nbsp;&nbsp;
                                                <p class="help-block"><strong class="text-danger">提示：</strong> 开启前请确保账户短信数量充足，短信不足将造成短信发送失败。</p>
                                            </div>
                                        </div>
                                        <div class="form-group" id="sms_tmp_id_box" style="display: {if $model['is_sms'] == 0} none{/if};">
                                            <label class="col-sm-2 control-label"><span class="text-red">(*)</span>中奖短信模板</label>
                                            <div class="col-sm-10">
                                                <input class="form-control" id="sms_tmp" maxlength="70"
                                                       name="model[sms_tmp]"  placeholder="请输入中奖短信模板！"
                                                       type="text" value="{$model['sms_tmp']}"/>
                                                <p class="help-block"><strong class="text-danger">提示：</strong>   请根据实际活动需求创建短信模板，最多70个字，系统提供标签将会在发送过程中自动替换。<code onclick="insertAtCursor('sms_tmp',this);">{{PRIZE}}</code>奖品名称 <code onclick="insertAtCursor('sms_tmp',this);">{{NICKNAME}}</code>微信昵称 <code onclick="insertAtCursor('sms_tmp',this);">{{OBJ}}</code>活动名称 <code onclick="insertAtCursor('sms_tmp',this);">{{WRITEOFFCODE}}</code>核销码</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="box">
                                    <div class="box-header with-border">
                                        <h3 class="box-title"><i class="fa fa-circle-o"></i> 活动样式设置<a name="7F" id="7F"></a></h3>
                                        <div class="box-tools pull-right">
                                            <button class="btn btn-box-tool" data-widget="collapse"><i
                                                    class="fa fa-minus"></i></button>
                                        </div>
                                    </div>
                                    <div class="box-body">
                                        <div class="form-group">
                                            <label class="col-sm-2 control-label"><span class="text-red">(*)</span>选择活动模板</label>
                                            <div class="col-sm-10">
                                                <select id="tmp_id" name="model[tmp_id]" class="form-control select2" style = "width: 100%;" datatype = "*" nullmsg = "请选择抽奖活动模板！">
                                                    {loop $objTmpList $tmp}
                                                    <option value="{$tmp['id']}" data-src="{$tmp['thumb_url']}" {if $tmp['id'] == $model['tmp_id']} selected="selected"{/if}>{$tmp['name']}</option>
                                                    {/loop}
                                                </select>
                                                <div class="input-group" style="margin-top:.5em;">
                                                    <img id="tmp_id_cover" src="./resource/images/nopic.jpg" class="img-responsive img-thumbnail" width="150">
                                                </div>
                                                <p class="help-block"><strong class="text-danger">提示：</strong> 请您根据活动场景和个人喜好选择活动模板，也可自定义上传模板项目。</p>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-2 control-label"><span class="text-red">(*)</span>页面头图模式</label>
                                            <div class="col-sm-10">
                                                <label>
                                                    <input type="radio" name="model[banner_types]" id="banner_types0" class="flat-blue banner_types" value="0" {if $model['banner_types']==0} checked {/if}> 多图轮播
                                                </label>&nbsp;&nbsp;
                                                <label>
                                                    <input type="radio" name="model[banner_types]" id="banner_types1" class="flat-blue banner_types" value="1" {if $model['banner_types']==1} checked {/if}> 单张头图
                                                </label>&nbsp;&nbsp;
                                                <p class="help-block"><strong class="text-danger">提示：</strong> 请根据实际需求选择头部图片模式，多图轮播：指定区域内多张图片轮播，{if strpos($tmpModel['resource'],'tmpc') === false }
                         {if ((int)str_replace("tmp","",$tmpModel['resource']))>91}
                            建议宽度750 高度不限
                         {else}
                            图片建议大小640*360；
                         {/if}
                        {else}
                            图片建议大小640*360；
                        {/if}；单张头图：可自定义整个头部，图片可自适应展示。</p>
                                            </div>
                                        </div>
                                        <div class="form-group" id="banner_types0_box" style="display: {if $model['banner_types'] == 1} none{/if};">
                                            <label class="col-sm-2 control-label"><span class="text-red">(*)</span>页面头图图片</label>
                                            <div class="col-sm-10">
                                                {php echo tpl_form_field_multi_image('model[multi_banner_url]',$model['multi_banner_url']);}
                                            </div>
                                        </div>
                                        <div class="form-group" id="banner_types1_box"  style="display: {if $model['banner_types'] == 0} none{/if};">
                                            <label class="col-sm-2 control-label"><span class="text-red">(*)</span>页面头图图片</label>
                                            <div class="col-sm-10">
                                                {php echo tpl_form_field_image('model[banner_url]',$model['banner_url']);}
                                            </div>
                                        </div>
                                        <div class="form-group" style="display: none;">
                                            <label class="col-sm-2 control-label"><span
                                                    class="text-red">(*)</span>活动背景颜色</label>
                                            <div class="col-sm-10">
                                                {php echo tpl_form_field_color('model[bg_color]',$model['bg_color']);}
                                                <br>
                                                <p><strong class="text-danger">提示：</strong> 活动自定义内容留空则此项无效，填写自定义内容后请选择背景颜色</p>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-2 control-label"><span class="text-red">(*)</span>活动门店地址</label>
                                            <div class="col-sm-10">
                                                <div class="box">
                                                    <div class="box-header">
                                                        <h3 class="box-title">创建门店所有信息都为必填信息，请按照要求认真填写。</h3>
                                                        <div class="box-tools pull-right">
                                                            <input type="button" id="addmapbtn"
                                                                   class="btn btn-sm btn-info" value="添加门店" style="margin-bottom: 10px;" />
                                                        </div>
                                                    </div>
                                                    <div class="box-body">
                                                        <table class="table table-striped" id="addmaptable">
                                                            <tr>
                                                                <th>门店名称</th>
                                                                <th>经纬度</th>
                                                                <th>详细地址</th>
                                                                <th>联系电话</th>
                                                                <th>操作</th>
                                                            </tr>
                                                            {if !empty($model['id'])}
                                                            {loop $model['store_map_list'] $index $item}
                                                            <tr class="addmap">
                                                                <td>
                                                                    <input class="form-control" name="model[store_map_list][{$index}][name]"  placeholder="请输入门店名称" value="{$item['name']}"  type="text" />
                                                                </td>
                                                                <td>
                                                                    <div class="row row-fix">
                                                                        <div class="col-xs-4 col-sm-4">
                                                                            <input type="text" name="model[store_map_list][{$index}][lng]" value="{$item['lng']}" placeholder="地理经度"  class="form-control" />
                                                                        </div>
                                                                        <div class="col-xs-4 col-sm-4">
                                                                            <input type="text" name="model[store_map_list][{$index}][lat]" value="{$item['lat']}" placeholder="地理纬度"  class="form-control" />
                                                                        </div>
                                                                        <div class="col-xs-4 col-sm-4">
                                                                            <button onclick="showCoordinate(this);" class="btn btn-default" type="button">选择坐标</button>
                                                                        </div>
                                                                    </div>
                                                                </td>
                                                                <td>
                                                                    <input class="form-control" name="model[store_map_list][{$index}][address]" value="{$item['address']}" placeholder="请输入门店位置" type="text" />
                                                                </td>
                                                                <td>
                                                                    <input class="form-control" name="model[store_map_list][{$index}][tel]" value="{$item['tel']}" placeholder="请输入联系电话" type="text" />
                                                                </td>
                                                                <td>
                                                                    <input type="button" class="btn btn-sm btn-danger pull-right delmapitem" value="删除门店" style="margin-right:10px" />
                                                                </td>
                                                            </tr>
                                                            {/loop}
                                                            {/if}
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-2 control-label"><span class="text-red">(*)</span>活动背景特效</label>
                                            <div class="col-sm-5">
                                                <select class="form-control select2" style="width: 100%;" id="effect_class" name="model[interim][effect_class]" >
                                                    <option value="0" selected="selected">无特效</option>
                                                </select>
                                            </div>
                                            <div class="col-sm-5">
                                                <select class="form-control select2" style="width: 100%;" id="effect_id" name="model[effect_id]">
                                                    <option value="0" selected="selected">无特效</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-2 control-label"><span class="text-red">(*)</span>背景音乐模板</label>
                                            <div class="col-sm-5">
                                                <select class="form-control select2" style="width: 100%;" id="audio_class" name="model[interim][audio_class]" >
                                                    <option value="0" selected="selected">请选择</option>
                                                </select>
                                                <p class="help-block"><strong class="text-danger">提示：</strong> 请您根据活动场景选择背景音乐模板，也可自定义上传背景音乐。</p>
                                            </div>
                                            <div class="col-sm-5">
                                                <select class="form-control select2" style="width: 100%;" id="audio_id" name="model[audio_id]">
                                                    <option value="0" selected="selected">请选择</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-2 control-label"><span class="text-red">(*)</span>活动背景音乐</label>
                                            <div class="col-sm-10">
                                                {php echo tpl_form_field_audio('model[audio_url]',$model['audio_url']);}
                                                    <span class="help-block">
                                                        <p><strong class="text-danger">提示：</strong> 请您根据活动场景和个人喜好上传背景音乐，关闭背景音乐请留空。</p>
                                                    </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="box">
                                    <div class="box-header with-border">
                                        <h3 class="box-title"><i class="fa fa-circle-o"></i> 活动广告设置<a name="8F" id="8F"></a></h3>
                                        <div class="box-tools pull-right">
                                            <button class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
                                        </div>
                                    </div>
                                    <div class="box-body">
                                        <div class="form-group">
                                            <label class="col-sm-2 control-label"><span class="text-red">(*)</span>开屏广告开关</label>
                                            <div class="col-sm-10">
                                                <label>
                                                    <input type="radio" value="0" name="model[is_show_ads]" id="is_show_ads0"
                                                           class="flat-blue is_show_ads" {if $model['is_show_ads']==0} checked
                                                    {/if}> 关闭
                                                </label>&nbsp;&nbsp;
                                                <label>
                                                    <input type="radio" value="1" name="model[is_show_ads]" id="is_show_ads1"
                                                           class="flat-blue is_show_ads" {if $model['is_show_ads']==1} checked
                                                    {/if}> 开启
                                                </label>&nbsp;&nbsp;
                                                <span class="help-block">
                                                        <p><strong class="text-danger">提示：</strong> 开启后用户首次进入首页会弹出开屏广告，为提升用户体验关闭后再次进入将不再展示。</p>
                                                    </span>
                                            </div>
                                        </div>
                                        <div id="ads_open_box" style="display: {if $model['is_show_ads'] != 1} none{/if};">
                                            <div class="form-group">
                                                <label class="col-sm-2 control-label"><span class="text-red">(*)</span>开屏广告图片</label>
                                                <div class="col-sm-10">
                                                    {php echo tpl_form_field_image('model[ads_url]',$model['ads_url']);}
                                                    <span class="help-block">
                                                        <p><strong class="text-danger">提示：</strong> 请按根据情况上传图片 建议尺寸518*740</p>
                                                    </span>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label for="ads_link" class="col-sm-2 control-label">广告链接地址</label>
                                                <div class="col-sm-10">
                                                    <input class="form-control" id="ads_link" maxlength="250"
                                                           name="model[ads_link]"  placeholder="请输入广告链接地址"
                                                           type="text" value="{$model['ads_link']}"/>
                                                    <p class="help-block"><strong class="text-danger">提示：</strong> 请输入完整链接地址，以http://或https://开头，例如：http://www.baidu.com/</p>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label for="show_ads_time" class="col-sm-2 control-label">
                                                    <span class="text-red">(*)</span>广告展示时间
                                                </label>
                                                <div class="col-sm-10">
                                                    <input class="form-control"  datatype="n" id="show_ads_time" name="model[show_ads_time]" onKeyUp="if(isNaN(this.value)) this.value='0';" placeholder="请输入广告展示时间" type="number" value="{$model['show_ads_time']}">
                                                    <p class="help-block"><strong class="text-danger">提示：</strong> 请输入开屏广告展示时间，开启后广告时间必填且大于零，单位：秒</p>
                                                </div>
                                            </div>
                                        </div>

                                        {if ($plug_appad && $plug_appad_act==1)}
                                        <div class="form-group">
                                            <label class="col-sm-2 control-label"><span class="text-red">(*)</span>劫流广告开关</label>
                                            <div class="col-sm-10">
                                                <label>
                                                    <input type="radio" value="0" name="model[is_open_appad]" id="is_open_appad0"
                                                           class="flat-blue is_open_appad" {if $model['is_open_appad']==0} checked
                                                    {/if}> 关闭
                                                </label>&nbsp;&nbsp;
                                                <label>
                                                    <input type="radio" value="1" name="model[is_open_appad]" id="is_open_appad1"
                                                           class="flat-blue is_open_appad" {if $model['is_open_appad']==1} checked
                                                    {/if}> 开启
                                                </label>&nbsp;&nbsp;
                                                <span class="help-block">
                                                        <p><strong class="text-danger">提示：</strong> 开启后用户访问活动点击页面任意位置，再访问第三方常用APP（抖音、快手、火山、淘宝等）后将弹出设定的口令广告。</p>
                                                </span>
                                            </div>
                                        </div>
                                        <div id="appad_open_box" style="display: {if $model['is_open_appad'] != 1} none{/if};">
                                            <div class="form-group">
                                                <label for="appad_password" class="col-sm-2 control-label"><span class="text-red">(*)</span>广告劫流口令</label>
                                                <div class="col-sm-10">
                                                    <textarea rows = "3" name="model[appad_password]" id="appad_password" class="form-control" placeholder = "请输入劫流口令,多个口令请用“*”分割...">{$model['appad_password']}</textarea>
                                                    <p class="help-block"><strong class="text-danger">提示：</strong> 支持多个平台口令同时存在，例如：抖音（找到您的广告视频 -> 点击右侧分享 -> 点击复制链接 -> 内容粘贴至此处）；淘宝（找到您的商家门店 -> 点击右上角分享 -> 点击复制链接 -> 内容粘贴至此处）；其他第三方平台以此类推；</p>
                                                </div>
                                            </div>
                                        </div>
                                        {/if}
                                    </div>
                                </div>

                                <div>
                                    <div class="box-body">
                                        <div class="form-group">
                                            <div class="col-sm-offset-2 col-sm-10">
                                                <a name="9F" id="9F"></a>
                                                <input type="hidden"  name="model[token]" value="{$model['token']}"/>
                                                <input id="id" name="id" type="hidden" value="{$model['id']}"/>
                                                <input type="hidden" name="token" value="{$_W['token']}"/>
                                                <input type="hidden" name="submit" value="submit"/>
                                                <input type="hidden"  name="model[check_status]" value="{$model['check_status']}"/>
                                                <button type="submit" class="btn btn-primary" id="SubmitBtn">
                                                    <i class="fa fa-pencil"></i> 提交
                                                </button>
                                                <button type="reset" class="btn btn-default"><i
                                                        class="fa fa-refresh"></i> 重置
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <div id="copyTarget" style="opacity: 0;"></div>
    </div>
    <!-- 底部版权 -->
    {template 'web/common/footer'}
</div>
<script id="regfieldtpl" type="text/html">
    <tr class="addfield">
        <td>
            <select name="model[register_field][<%=count%>][Type]" class="form-control select2" style = "width: 100%;">
                <option value="text" selected>文本字段</option>
                <option value="number">数字字段</option>
                <option value="radio">单选按钮</option>
                <option value="checkbox">复选按钮</option>
                <option value="select">下拉列表</option>
                <option value="textarea">文本域</option>
            </select>
        </td>
        <td>
            <input class="form-control"
                   name="model[register_field][<%=count%>][Explain]"  placeholder="请输入名称"
                   type="text"/>
        </td>
        <td>
            <input class="form-control"
                   name="model[register_field][<%=count%>][Name]"  placeholder="请输入字段(仅支持英文)" onkeyup="value=value.replace(/[^a-zA-Z]/g,'')"
                   type="text"/>
        </td>
        <td>
            <input class="form-control"
                   name="model[register_field][<%=count%>][Tips]"  placeholder="请输入提示信息"
                   type="text"/>
        </td>
        <td>
            <input type="button" class="btn btn-sm btn-danger pull-right delfielditem" value="删除字段" style="margin-right:10px" />
        </td>
    </tr>
</script>
<script id="maptpl" type="text/html">
    <tr class="addmap">
        <td>
            <input class="form-control" name="model[store_map_list][<%= count %>][name]"  placeholder="请输入门店名称" type="text" />
        </td>
        <td>
            <div class="row row-fix">
                <div class="col-xs-4 col-sm-4">
                    <input type="text" name="model[store_map_list][<%= count %>][lng]" value="" placeholder="地理经度"  class="form-control" />
                </div>
                <div class="col-xs-4 col-sm-4">
                    <input type="text" name="model[store_map_list][<%= count %>][lat]" value="" placeholder="地理纬度"  class="form-control" />
                </div>
                <div class="col-xs-4 col-sm-4">
                    <button onclick="showCoordinate(this);" class="btn btn-default" type="button">选择坐标</button>
                </div>
            </div>
        </td>
        <td>
            <input class="form-control" name="model[store_map_list][<%= count %>][address]"  placeholder="请输入门店位置" type="text" />
        </td>
        <td>
            <input class="form-control" name="model[store_map_list][<%= count %>][tel]"  placeholder="请输入联系电话" type="text" />
        </td>
        <td>
            <input type="button" class="btn btn-sm btn-danger pull-right delmapitem" value="删除门店" style="margin-right:10px" />
        </td>
    </tr>
</script>
<script>
    function randomString(len) {
        　　len = len || 16;
        　　var $chars = 'ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz';   
        　　var maxPos = $chars.length;
        　　var str = '';
        　　for (i = 0; i < len; i++) {
                str += $chars.charAt(Math.floor(Math.random() * maxPos));
        　　}
        　　return str;
        }
    $(function () {
        //设置选中导航
        SelectNav("大&nbsp;&nbsp;转&nbsp;&nbsp;盘");

        myrequire(['select2', 'bootstrap-switch', 'validform', 'icheck', 'bootstrap-slider'], function () {
            myrequire([ 'arttemplate'], function (template) {
                //添加登记字段选项
                $("#addregfieldbtn").click(function () {
                    var fieldcount	= $(".addfield").length;
                    var obj = {};
                    obj.count = fieldcount;
                    var html = template("regfieldtpl",obj);
                    $("#addregfieldtable").append(html);
                    $(".select2").select2();
                    $("input[name='model[register_field]["+fieldcount+"][Name]']").val(randomString(8));
                });

                //开启多门店添加门店信息
                $("#addmapbtn").click(function () {
                    var mapcount	= $(".addmap").length;
                    var obj = {};
                    obj.count = mapcount;
                    var html = template("maptpl",obj);
                    $("#addmaptable").append(html);
                });
            });

            //初始化select2控件
            $(".select2").select2();

            //初始化icheck控件radio
            $('input[type="checkbox"].flat-blue, input[type="radio"].flat-blue').iCheck({
                checkboxClass: 'icheckbox_flat-blue',
                radioClass: 'iradio_flat-blue'
            });

            //绑定更改状态操作
            $('#status').bootstrapSwitch({
                onSwitchChange: function (event, state) {
                    var status = state ? 1 : 0;
                    $("#status2").val(status);
                }
            });

            /*{if $model['models'] == 0}*/
            $("#get_types2").parent().parent().hide();
            /*{/if}*/

            //选择红包类型切换选项卡
            $('.obj_models').on('ifChecked', function (event) { //ifCreated 事件应该在插件初始化之前绑定
                var obj_types = $(this).val();
                if(obj_types==0)
                {
                    $("#obj_models_limit").show();
                    $("#obj_models_score").hide();
                    $("#get_types2").parent().parent().hide();
                    $("#friend_box").show();
                    var is_invite_friend = $('.invite_friend:checked').val();
                    if(is_invite_friend==1)
                    {
                        $("#invite_limit_box").show();
                    }
                    else
                    {
                        $("#invite_limit_box").hide();
                    }
                }
                if(obj_types==1)
                {
                    $("#obj_models_limit").hide();
                    $("#obj_models_score").show();
                    $("#friend_box").hide();
                    $("#invite_limit_box").hide();
                }
            });

            //选择开启邀请模式选项卡
            $('.invite_friend').on('ifChecked', function (event) { //ifCreated 事件应该在插件初始化之前绑定
                var is_invite_friend = $(this).val();
                if(is_invite_friend==1)
                {
                    $("#invite_limit_box").show();
                }
                else
                {
                    $("#invite_limit_box").hide();
                }
            });

            //选择领取红包方式选项卡
            $('.obj_get_types').on('ifChecked', function (event) { //ifCreated 事件应该在插件初始化之前绑定
                var obj_types = $(this).val();
                if(obj_types==2)
                {
                    $("#limit_num_box").hide();
                }
                else
                {
                    $("#limit_num_box").show();
                }
            });

            //选择是否短信提醒选项卡
            $('.obj_is_sms').on('ifChecked', function (event) { //ifCreated 事件应该在插件初始化之前绑定
                var obj_types = $(this).val();
                if(obj_types==0)
                {
                    $("#sms_tmp_id_box").hide();
                }
                else
                {
                    $("#sms_tmp_id_box").show();
                }
            });

            //选择是否轮播头图选项卡
            $('.banner_types').on('ifChecked', function (event) { //ifCreated 事件应该在插件初始化之前绑定
                var obj_types = $(this).val();
                if(obj_types==0)
                {
                    $("#banner_types0_box").show();
                    $("#banner_types1_box").hide();
                }
                else
                {
                    $("#banner_types0_box").hide();
                    $("#banner_types1_box").show();
                }
            });

            //选择是否信息登记选项卡
            $('.is_register').on('ifChecked', function (event) { //ifCreated 事件应该在插件初始化之前绑定
                var obj_types = $(this).val();
                if(obj_types==0)
                {
                    $("#register_field_box").hide();
                }
                else
                {
                    $("#register_field_box").show();
                }
            });

            //选择是否开启广告选项卡
            $('.is_show_ads').on('ifChecked', function (event) { //ifCreated 事件应该在插件初始化之前绑定
                var obj_types = $(this).val();
                if(obj_types==0)
                {
                    $("#ads_open_box").hide();
                }
                else
                {
                    $("#ads_open_box").show();
                }
            });

            //选择是否开启劫流广告
            $('.is_open_appad').on('ifChecked', function (event) { //ifCreated 事件应该在插件初始化之前绑定
                var obj_types = $(this).val();
                if(obj_types==0)
                {
                    $("#appad_open_box").hide();
                }
                else
                {
                    $("#appad_open_box").show();
                }
            });

            //选择红包模板
            $("#tmp_id").change(function () {
                $("#tmp_id_cover").attr("src", "{MODULE_URL}"+$(this).find("option:selected").data("src"));
            }).trigger("change");

            //删除信息登记字段
            $(document).delegate(".delfielditem", "click", function() {
                var list = $(this).parent().parent().parent();
                $(this).parent().parent().remove();
                list.children(".addfield").each(function (index) {
                    $(this).find(".form-control").each(function () {
                        var inputName = $(this).attr("name");
                        $(this).attr("name", inputName.replace(/\[([\d]+)\]/g, "[" + index + "]"));
                    });
                });
            });

            //删除多门店信息
            $(document).delegate(".delmapitem", "click", function() {
                var list = $(this).parent().parent().parent();
                $(this).parent().parent().remove();
                list.children(".addmap").each(function (index) {
                    $(this).find(".form-control").each(function () {
                        var inputName = $(this).attr("name");
                        $(this).attr("name", inputName.replace(/\[([\d]+)\]/g, "[" + index + "]"));
                    });
                });
            });

            //选择背景音乐模板
            $("#audio_id").change(function () {
                if($(this).val()!="0")
                {
                    var audioUrl = $(this).find("option:selected").data("src");
                    if(audioUrl.indexOf("resource/template/audio") != -1)
                    {
                        $('input[name="model[audio_url]"]').val("{MODULE_URL}"+$(this).find("option:selected").data("src"));
                    }
                    else
                    {
                        $('input[name="model[audio_url]"]').val($(this).find("option:selected").data("src"));
                    }
                }
            }).trigger("change");

            //为formContent 添加验证事件
            $("#form_content").Validform({
                tiptype: function (msg, o, cssctl) {
                    if (!o.obj.is("form")) {
                        if (o.type == 2) {
                            //loading带文字
                            layer.open({
                                type: 2
                                , content: '数据提交中'
                                , time: 999 //999秒后自动关闭
                            });
                        } else {
                            layer.closeAll();
                            layer.open({
                                content: msg
                                , skin: 'msg'
                                , time: 2 //2秒后自动关闭
                            });
                        }
                    }
                },
                ajaxPost: true,
                tipSweep: true,
                beforeSubmit: function (curform) {
                    $("#SubmitBtn").attr("disabled", true);
                },
                callback: function (data) {
                    layer.closeAll();
                    if (data.status == 1) {
                        Command: toastr["success"](data.msg, "成功提示");
                        if (data.type == 1) {
                            setTimeout(function () {
                                window.location.href = "{php echo $this->createWebUrl('obj_wheel', array('act' => 'index'));}";
                            }, 2000);
                        } else {
                            setTimeout(function () {
                                window.location.reload();
                            }, 2000);
                        }
                    }
                    else if (data.status == "2") {
                        Command: toastr["warning"](data.msg, "验证提示");
                        $("#SubmitBtn").attr("disabled", false);
                    }
                    else {
                        Command: toastr["error"](data.msg, "错误提示");
                        setTimeout(function () {
                            window.location.href = window.location.href;
                        }, 2000);
                    }
                }
            });

            //获取背景特效
            GetEffectClass();
            $('#effect_class').val({php echo empty($effect['class_id']) ? 0 : $effect['class_id']});
            $("#effect_class").select2("val", {php echo empty($effect['class_id']) ? 0 : $effect['class_id']});
            GetEffect();
            $('#effect_id').val({$model['effect_id']});
            $("#effect_id").select2("val", {$model['effect_id']});

            $("#effect_class").change(function () {GetEffect() });

            //获取背景音乐
            GetAudioClass();
            $('#audio_class').val({php echo empty($audio['class_id']) ? 0 : $audio['class_id']});
            $("#audio_class").select2("val", {php echo empty($audio['class_id']) ? 0 : $audio['class_id']});
            GetAudio();
            $('#audio_id').val({$model['audio_id']});
            $("#audio_id").select2("val", {$model['audio_id']});

            $("#audio_class").change(function () {GetAudio() });
            $("#audio_id").change(function () {setAudioPlayer() });
        });

    });

    $(window).scroll(function () {
        $(".edui-editor-toolbarbox").each(function () {
            var zIndex = parseInt($(this).css('z-index')) || -1;
            if(zIndex > 0){
                $(this).addClass('edui-editor-toolbarbox2');
            }else{
                $(this).removeClass('edui-editor-toolbarbox2');
            }
        })
    });
    //光标处插入指定文本内容
    function insertAtCursor(text, obj) {
        var myField = document.getElementById(text);
        var myValue = obj.innerHTML;
        if (document.selection) {
            //IE support
            myField.focus();
            sel = document.selection.createRange();
            sel.text = myValue;
            sel.select();
        } else if (myField.selectionStart || myField.selectionStart == '0') {
            //MOZILLA/NETSCAPE support
            var startPos = myField.selectionStart;
            var endPos = myField.selectionEnd;
            var beforeValue = myField.value.substring(0, startPos);
            var afterValue = myField.value.substring(endPos, myField.value.length);

            myField.value = beforeValue + myValue + afterValue;

            myField.selectionStart = startPos + myValue.length;
            myField.selectionEnd = startPos + myValue.length;
            myField.focus();
        } else {
            myField.value += myValue;
            myField.focus();
        }
    }

    $(function(){
        // @ 给窗口加滚动条事件
        $(window).scroll(function(){
            // 获得窗口滚动上去的距离
            var ling = $(document).scrollTop();
            // 在标题栏显示滚动的距离
            //document.title = $('#2F').offset().top;
            // 如果滚动距离大于1534的时候让滚动框出来
            if(ling>90){
                $('#rightbox').show();
            }
            if(90<ling && ling< ($('#2F').offset().top-100)){
                // 让第一层的数字隐藏，文字显示，让其他兄弟元素的li数字显示，文字隐藏
                $('#rightbox ul li').eq(0).find('.num').hide().siblings('.word').css({'display':'block','background':'#00c0ef','color':'white','width':'60px','right':'2px','position':'fixed'});
                $('#rightbox ul li').eq(0).siblings('li').find('.num').css('display','block').siblings('.word').hide();
            }else if(ling<($('#3F').offset().top-100)){
                $('#rightbox ul li').eq(1).find('.num').hide().siblings('.word').css({'display':'block','background':'#00c0ef','color':'white','width':'60px','right':'2px','position':'fixed'});
                $('#rightbox ul li').eq(1).siblings('li').find('.num').css('display','block').siblings('.word').hide();
            }else if(ling<($('#4F').offset().top-100)){
                $('#rightbox ul li').eq(2).find('.num').hide().siblings('.word').css({'display':'block','background':'#00c0ef','color':'white','width':'60px','right':'2px','position':'fixed'});
                $('#rightbox ul li').eq(2).siblings('li').find('.num').css('display','block').siblings('.word').hide();
            }else if(ling<($('#5F').offset().top-100)){
                $('#rightbox ul li').eq(3).find('.num').hide().siblings('.word').css({'display':'block','background':'#00c0ef','color':'white','width':'60px','right':'2px','position':'fixed'});
                $('#rightbox ul li').eq(3).siblings('li').find('.num').css('display','block').siblings('.word').hide();
            }
            /*{if $config['sms_obj']==1}*/
            else if(ling<($('#6F').offset().top-100)){
                $('#rightbox ul li').eq(4).find('.num').hide().siblings('.word').css({'display':'block','background':'#00c0ef','color':'white','width':'60px','right':'2px','position':'fixed'});
                $('#rightbox ul li').eq(4).siblings('li').find('.num').css('display','block').siblings('.word').hide();
            }
            else if(ling<($('#7F').offset().top-100)){
                $('#rightbox ul li').eq(5).find('.num').hide().siblings('.word').css({'display':'block','background':'#00c0ef','color':'white','width':'60px','right':'2px','position':'fixed'});
                $('#rightbox ul li').eq(5).siblings('li').find('.num').css('display','block').siblings('.word').hide();
            }
            /*{else}*/
            else if(ling<($('#7F').offset().top-100)){
                $('#rightbox ul li').eq(5).find('.num').hide().siblings('.word').css({'display':'block','background':'#00c0ef','color':'white','width':'60px','right':'2px','position':'fixed'});
                $('#rightbox ul li').eq(5).siblings('li').find('.num').css('display','block').siblings('.word').hide();
            }
            /*{/if}*/
            else if(ling<($('#8F').offset().top-100)){
                $('#rightbox ul li').eq(6).find('.num').hide().siblings('.word').css({'display':'block','background':'#00c0ef','color':'white','width':'60px','right':'2px','position':'fixed'});
                $('#rightbox ul li').eq(6).siblings('li').find('.num').css('display','block').siblings('.word').hide();
            }else if(ling<($('#9F').offset().top-100)){
                $('#rightbox ul li').eq(7).find('.num').hide().siblings('.word').css({'display':'block','background':'#00c0ef','color':'white','width':'60px','right':'2px','position':'fixed'});
                $('#rightbox ul li').eq(7).siblings('li').find('.num').css('display','block').siblings('.word').hide();
            }
            if(ling<90){
                $('#rightbox').hide();
            }
        })

    })

    $(function(){
        $('#rightbox ul li').hover(function(){
            $(this).find('.num').hide().siblings('.word').css({'display':'block','background':'#00c0ef','color':'white','width':'60px','right':'2px','position':'fixed'});
        },function(){
            $(this).find('.num').css({'display':'block','background':'white','color':'#666'}).siblings('.word').hide().css({'display':'none','background':'','color':''});
        })
    })

    function GetEffectClass() {
        $.ajaxSetup({ cache: false });
        $("#effect_class").empty(); //清空模板SELECT控件
        $.ajax({
            type: "GET",
            url: "{php echo $this->createWebUrl('sys_effect_class',array('act'=>'getSelect'));}",
            data: {  },
            async: false,
            dataType: "json",
            success: function (data) {
                $("<option></option>").val("0").text("无特效").appendTo($("#effect_class"));
                $.each(data, function (i, item) {
                    $("<option></option>").val(item["id"]).text(item["name"]).appendTo($("#effect_class"));
                });
                $("#effect_class").select2("val", "0");
                GetEffect();
            }
        });
    }

    function GetEffect() {
        $.ajaxSetup({ cache: false });
        $("#effect_id").empty(); //清空模板SELECT控件
        if( $("#effect_class").val() > 0)
        {
            $.ajax({
                type: "GET",
                url: "{php echo $this->createWebUrl('sys_effect',array('act'=>'getSelect'));}",
                data: { class_id: $("#effect_class").val() },
                async: false,
                dataType: "json",
                success: function (data) {
                    $.each(data, function (i, item) {
                        $("<option></option>").val(item["id"]).text(item["name"]).appendTo($("#effect_id"));
                    });
                }
            });
            $("#effect_id").select2("val", $("#effect_id").val());
        }else
        {
            $("<option></option>").val("0").text("无特效").appendTo($("#effect_id"));
            $("#effect_id").select2("val", "0");
        }
    }

    function GetAudioClass() {
        $.ajaxSetup({ cache: false });
        $("#audio_class").empty(); //清空模板SELECT控件
        $.ajax({
            type: "GET",
            url: "{php echo $this->createWebUrl('sys_audio_class',array('act'=>'getSelect'));}",
            data: {  },
            async: false,
            dataType: "json",
            success: function (data) {
                $("<option></option>").val("0").text("请选择").appendTo($("#audio_class"));
                $.each(data, function (i, item) {
                    $("<option></option>").val(item["id"]).text(item["name"]).appendTo($("#audio_class"));
                });
                $("#audio_class").select2("val", "0");
                GetAudio();
            }
        });
    }

    function GetAudio() {
        $.ajaxSetup({ cache: false });
        $("#audio_id").empty(); //清空模板SELECT控件
        if( $("#audio_class").val() > 0)
        {
            $.ajax({
                type: "GET",
                url: "{php echo $this->createWebUrl('sys_audio',array('act'=>'getSelect'));}",
                data: { class_id: $("#audio_class").val() },
                async: false,
                dataType: "json",
                success: function (data) {
                    $("<option></option>").val("0").text("请选择").appendTo($("#audio_id"));
                    $.each(data, function (i, item) {
                        $("<option></option>").val(item["id"]).data('src',item["audiourl"]).text(item["name"]).appendTo($("#audio_id"));
                    });
                }
            });
            $("#audio_id").select2("val", $("#audio_id").val());
        }else
        {
            $("<option></option>").val("0").text("请选择").appendTo($("#audio_id"));
            $("#audio_id").select2("val", "0");
        }
    }
</script>
<script type="text/javascript" src="https://api.map.baidu.com/api?v=2.0&ak=F51571495f717ff1194de02366bb8da9&s=1"></script>
<script type="text/javascript">
    function showCoordinate(elm) {
        require(["util"], function(util){
            require(["map"], function(){

                //百度地图API提供Geocoder类进行地址解析，您可以通过Geocoder.getPoint()方法来将一段地址描述转换为一个坐标。
                function addressToPoint(address) {
                    var LocalSearch = new BMap.LocalSearch(map, {
                        renderOptions: { map: map }
                    });
                    LocalSearch.search(address);
                    LocalSearch.setSearchCompleteCallback(function () {
                        var point = LocalSearch.getResults().getPoi(0).point;
                        LocalSearch.clearResults();
                        map.panTo(point); // 将地图的中心点更改为给定的点
                        marker.setPosition(point); // 设置标注的地理坐标
                        marker.setAnimation(BMAP_ANIMATION_BOUNCE); // 设置标注动画效果
                        setTimeout(function () {
                            marker.setAnimation(null);
                        }, 3600); // 动画持续时间
                    });
                }

                var defaultValue = {};
                defaultValue.lng = parseFloat($(elm).parent().prev().prev().find(":text").val());
                defaultValue.lat = parseFloat($(elm).parent().prev().find(":text").val());

                defaultValue || (defaultValue = {});
                defaultValue.lng || (defaultValue.lng = 116.403851);
                defaultValue.lat || (defaultValue.lat = 39.915177);
                var point = new BMap.Point(defaultValue.lng, defaultValue.lat) /*2、创建点坐标*/
                var geocoder = new BMap.Geocoder /*创建地址解析器实例*/
                var $mapDialog = $("#map-dialog");

                if (0 == $mapDialog.length) {
                    ($mapDialog = util.dialog("请选择地点", '<div class="form-group"><div class="input-group"><input type="text" class="form-control" placeholder="请输入地址来直接查找相关位置"><div class="input-group-btn"><button class="btn btn-default"><i class="icon-search"></i> 搜索</button></div></div></div><div id="map-container" style="height:400px;"></div>', '<button type="button" class="btn btn-default" data-dismiss="modal">取消</button><button type="button" class="btn btn-primary">确认</button>', {
                        containerName: "map-dialog"
                    })).find(".modal-dialog").css("width", "80%");
                    $mapDialog.modal({
                        keyboard: false
                    });
                    map = util.map.instance = new BMap.Map("map-container"); // 1、创建地图实例
                    map.centerAndZoom(point, 12); // 3、地图初始化，设置中心坐标点及地图级别
                    map.enableScrollWheelZoom(); // 4、其它，鼠标滚轮控制缩放
                    map.enableDragging(); // 启用地图拖拽，默认启用
                    map.enableContinuousZoom(); // 启用连续缩放效果，默认禁用
                    map.addControl(new BMap.NavigationControl); // 添加导航控件
                    map.addControl(new BMap.OverviewMapControl); // 添加缩略图控件
                    marker = util.map.marker = new BMap.Marker(point); // 创建一个图像标注实例。point参数指定了图像标注所在的地理位置
                    marker.setLabel(new BMap.Label("请您移动此标记，选择您的坐标！", {
                        offset: new BMap.Size(10, -20)
                    })); // //把label设置到maker上
                    map.addOverlay(marker); // 添加自定义覆盖物
                    marker.enableDragging(); //开启标注拖拽功能
                    // 添加拖拽事件监听函数
                    marker.addEventListener("dragend", function (e) {
                        var point = marker.getPosition(); // 返回标注的地理坐标
                        // 拖拽标签由坐标地址转换为文本地址
                        geocoder.getLocation(point, function (geocoderResult) {
                            $mapDialog.find(".input-group :text").val(geocoderResult.address)
                        })
                    });
                    // 回车由文本地址解析坐标
                    $mapDialog.find(".input-group :text").keydown(function (e) {
                        13 == e.keyCode && addressToPoint($(this).val())
                    });
                    // 点击按钮由文本地址解析坐标
                    $mapDialog.find(".input-group button").click(function () {
                        addressToPoint($(this).parent().prev().val())
                    });
                }

                // 在模态框完全展示出来做一些动作
                // http://www.runoob.com/bootstrap/bootstrap-modal-plugin.html
                $mapDialog.off("shown.bs.modal");
                $mapDialog.on("shown.bs.modal", function () {
                    marker.setPosition(point); // 设置标注的地理坐标
                    map.panTo(marker.getPosition()); // 将地图的中心点更改为给定的点
                });

                $mapDialog.find("button.btn-primary").off("click");
                $mapDialog.find("button.btn-primary").on("click", function () {
                    var e = util.map.marker.getPosition();
                    geocoder.getLocation(e, function (i) {
                        var result = {
                            lng: e.lng,
                            lat: e.lat,
                            label: i.address
                        };
                        $(elm).parent().prev().prev().find(":text").val(result.lng);
                        $(elm).parent().prev().find(":text").val(result.lat);
                    })
                    $mapDialog.modal("hide");
                });
                $mapDialog.modal("show");
            });
        });
    }
</script>
<!-- 重置日期选择器样式 -->
<link href="{__CSS__}/reset/daterange.css?v=1.0.0" rel="stylesheet">
</body>
</html>