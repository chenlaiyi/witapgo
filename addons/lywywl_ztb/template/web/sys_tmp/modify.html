<!DOCTYPE html>
<html lang="zh-cn">
{template 'web/common/header'}
<body class="skin-blue sidebar-mini fixed">
<div class="wrapper">
    <!-- 头部菜单 -->
    {template 'web/common/top'}
    <!-- 左侧导航 -->
    {template 'web/common/sidebar'}
    <!-- 页面内容 -->
    <div class="content-wrapper">
        <section class="content-header">
            <i></i>
            <h1>
                {$title}
            </h1>
            <ol class="breadcrumb">
                <li><a href="{php echo $this->createWebUrl('home');}"><i class="fa fa-dashboard"></i> 首页</a>
                </li>
                <li class="active">系统</li>
                <li class="active">{$title}</li>
            </ol>
        </section>
        <!-- 主体内容 -->
        <section class="content">
            <div class="row">
                <div class="col-xs-12">
                    <div class="nav-tabs-custom">
                        <ul class="nav nav-tabs">
                            <li><a href="{php echo $this->createWebUrl('sys_tmp', array('act' => 'index'));}">数据列表</a>
                            </li>
                            <li><a href="javascript:">可同步模板（{$total}）</a></li>
                            <li class="active"><a href="#">{if !empty($model['id'])}编辑{else}创建{/if}自定义模板</a></li>
                            <li class="pull-right"><a href="javascript:showMakeTmpDialog();" id="obj_create_btn" class="text-muted"><i class="fa fa-commenting"></i> 模板制作说明</a></li>
                        </ul>
                        <div class="tab-content">
                            <form class="form-horizontal" name="form_content" id="form_content" method="post">
                                <div class="box">
                                    <div class="box-header with-border">
                                        <h3 class="box-title"><i class="fa fa-circle-o"></i> {if !empty($model['id'])}编辑{else}创建{/if}自定义模板</h3>
                                        <div class="box-tools pull-right">
                                            <button class="btn btn-box-tool" data-widget="collapse"><i
                                                    class="fa fa-minus"></i></button>
                                        </div>
                                    </div>
                                    <div class="box-body">
                                        <div class="form-group">
                                            <label for="name" class="col-sm-2 control-label"><span
                                                    class="text-red">(*)</span>活动模板名称</label>
                                            <div class="col-sm-10">
                                                <input class="form-control" datatype="*" id="name" maxlength="20" name="model[name]" nullmsg="请输入活动模板名称！" placeholder="请输入活动模板名称" type="text" value="{$model['name']}"/>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="activity_types" class="col-sm-2 control-label"><span
                                                    class="text-red">(*)</span>模板活动类型</label>
                                            <div class="col-sm-10">
                                                <select class="form-control select2" id="activity_types" name="model[activity_types]" datatype="*"  nullmsg="请选择模板活动类型！">
                                                    <option value="" selected="selected">请选择</option>
                                                    {loop $activityTypes $index $item}
                                                    <option value="{$index}" {if $index == $model['activity_types']} selected="selected"{/if}>{$item}</option>
                                                    {/loop}
                                                </select>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-2 control-label"><span
                                                    class="text-red">(*)</span>活动模板分类</label>
                                            <div class="col-sm-10">
                                                {loop $objList $item}
                                                <label>
                                                    <input type="checkbox" class="flat-blue checkitem" name="model[obj_types][]"  value="{$item['id']}" {if in_array($item['id'],$model['obj_types'])}checked{/if}> {$item['name']}
                                                </label>
                                                {/loop}
                                                <p class="help-block"><strong class="text-danger">提示：</strong> 选择活动模板所属分类。</p>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-2 control-label"><span
                                                    class="text-red">(*)</span>模板适用节日</label>
                                            <div class="col-sm-10">
                                                {loop $festivalList $item}
                                                <label>
                                                    <input type="checkbox" class="flat-blue checkitem" name="model[festival][]"  value="{$item['id']}" {if in_array($item['id'],$model['festival'])}checked{/if}> {$item['name']}
                                                </label>
                                                {/loop}
                                                <p class="help-block"><strong class="text-danger">提示：</strong> 选择活动模板适用节日。</p>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-2 control-label"><span
                                                    class="text-red">(*)</span>模板适用行业</label>
                                            <div class="col-sm-10">
                                                {loop $industryList $item}
                                                <label>
                                                    <input type="checkbox" class="flat-blue checkitem" name="model[industry][]"  value="{$item['id']}" {if in_array($item['id'],$model['industry'])}checked{/if}> {$item['name']}
                                                </label>
                                                {/loop}
                                                <p class="help-block"><strong class="text-danger">提示：</strong> 选择活动模板适用行业。</p>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="baner_html" class="col-sm-2 control-label"><span
                                                    class="text-red">(*)</span>模板功能特点</label>
                                            <div class="col-sm-10">
                                                <textarea rows="6" datatype="*" name="model[intro1]" class="form-control" placeholder="请填写模板功能特点..." nullmsg="请填写模板功能特点！">{$model['intro1']}</textarea>
                                                <p class="help-block"><strong class="text-danger">提示：</strong> 模板功能特点将显示在商家创建活动模板列表页。</p>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="baner_html" class="col-sm-2 control-label"><span
                                                    class="text-red">(*)</span>模板功能说明</label>
                                            <div class="col-sm-10">
                                                <textarea rows="6" datatype="*" name="model[intro2]" class="form-control" placeholder="请填写模板功能说明..." nullmsg="请填写模板功能说明！">{$model['intro2']}</textarea>
                                                <p class="help-block"><strong class="text-danger">提示：</strong> 模板功能说明将显示在商家创建活动模板列表页。</p>
                                            </div>
                                        </div>
                                        {if $model['id'] > 0}
                                        <div class="form-group">
                                            <label for="resource" class="col-sm-2 control-label"><span
                                                    class="text-red"></span>模板目录名称</label>
                                            <div class="col-sm-10">
                                                <input class="form-control" type="text" id="resource" value="{$model['resource']}" disabled/>
                                                <p class="help-block"><strong class="text-danger">提示：</strong>
                                                    <code>该模板目录名称，模板文件目录名和模板资源目录名必须和这个保持一致。</code>
                                                    <a href="javascript:void(0);" onclick="showMakeTmpDialog();"> &gt;&gt;模板制作说明</a>
                                                </p>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="thumb_url" class="col-sm-2 control-label"><span
                                                    class="text-red"></span>模板封面路径</label>
                                            <div class="col-sm-10">
                                                <input class="form-control" type="text" id="thumb_url" value="{$model['thumb_url']}" disabled/>
                                                <p class="help-block"><strong class="text-danger">提示：</strong>请确保该路径下的模板封面图片存在 。</p>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="baner_html" class="col-sm-2 control-label"><span
                                                    class="text-red"></span>编辑Banner代码</label>
                                            <div class="col-sm-10">
                                                <textarea rows="6" datatype="*" name="model[baner_html]" id="baner_html" class="form-control" placeholder="请填写编辑Banner代码..." nullmsg="请填写编辑Banner代码！">{$model['baner_html']}</textarea>
                                                <p class="help-block"><strong class="text-danger">提示：</strong> 商家手机端发布编辑该模板活动页面的Banner Html代码。</p>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="body_style" class="col-sm-2 control-label"><span
                                                    class="text-red"></span>编辑背景样式</label>
                                            <div class="col-sm-10">
                                                <textarea rows="6" datatype="*" name="model[body_style]" id="body_style" class="form-control" placeholder="请填写编辑背景样式..." nullmsg="请填写编辑背景样式！">{$model['body_style']}</textarea>
                                                <p class="help-block"><strong class="text-danger">提示：</strong>商家手机端发布编辑该模板活动页面的body标签style属性里面的样式内容 。</p>
                                            </div>
                                        </div>
                                        {/if}
                                        <div class="form-group">
                                            <label for="sort" class="col-sm-2 control-label">
                                                <span class="text-red">(*)</span>活动模板排序
                                            </label>
                                            <div class="col-sm-10">
                                                <input class="form-control"  datatype="n" id="sort" name="model[sort]" nullmsg="信息排序必须填写！" onkeyup="if(isNaN(this.value)) this.value='0';" placeholder="请输入信息排序字段" type="text" value="{$model['sort']}">
                                                <p class="help-block">请输入数字 例如：1|6|10等数字，注意：此字段只能为数字 信息将按照排序字段正序排列</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <div class="box-body">
                                        <div class="form-group">
                                            <div class="col-sm-offset-2 col-sm-10">
                                                <input id="id" name="id" type="hidden" value="{$model['id']}"/>
                                                <input type="hidden" name="token" value="{$_W['token']}"/>
                                                <input type="hidden" name="submit" value="submit"/>
                                                <button type="submit" class="btn btn-primary" id="SubmitBtn">
                                                    <i class="fa fa-pencil"></i> 提交
                                                </button>
                                                <button type="reset" class="btn btn-default"><i
                                                        class="fa fa-refresh"></i> 重置
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>
    <!-- 底部版权 -->
    {template 'web/common/footer'}
</div>
<script>
    $(function () {
        SelectNav("模板列表");

        myrequire(['select2','icheck','bootstrap-switch', 'validform'], function () {
            //初始化select2控件
            $(".select2").select2();

            //初始化icheck控件radio
            $('input[type="checkbox"].flat-blue, input[type="radio"].flat-blue').iCheck({
                checkboxClass: 'icheckbox_flat-blue',
                radioClass: 'iradio_flat-blue'
            });

            //绑定更改状态操作
            $('#status').bootstrapSwitch({
                onSwitchChange: function (event, state) {
                    var status = state ? 1 : 0;
                    $("#status2").val(status);
                }
            });

            //为formContent 添加验证事件
            $("#form_content").Validform({
                tiptype: function (msg, o, cssctl) {
                    if (!o.obj.is("form")) {
                        if (o.type == 2) {
                            //loading带文字
                            layer.open({
                                type: 2
                                , content: '数据提交中'
                                , time: 999 //999秒后自动关闭
                            });
                        } else {
                            layer.closeAll();
                            layer.open({
                                content: msg
                                , skin: 'msg'
                                , time: 2 //2秒后自动关闭
                            });
                        }
                    }
                },
                ajaxPost: true,
                tipSweep: true,
                beforeSubmit: function (curform) {
                    $("#SubmitBtn").attr("disabled", true);
                },
                callback: function (data) {
                    layer.closeAll();
                    if (data.status == 1) {
                        Command: toastr["success"](data.msg, "成功提示");
                        if (data.type == 1) {
                            setTimeout(function () {
                                window.location.href = "{php echo $this->createWebUrl('sys_tmp', array('act' => 'index'));}";
                            }, 2000);
                        } else {
                            setTimeout(function () {
                                window.location.href = "{php echo $this->createWebUrl('sys_tmp', array('act' => 'modify'));}&id=" + data.tmp_id;
                            }, 2000);
                        }
                    }
                    else if (data.status == "2") {
                        Command: toastr["warning"](data.msg, "验证提示");
                        $("#SubmitBtn").attr("disabled", false);
                    }
                    else {
                        Command: toastr["error"](data.msg, "错误提示");
                        setTimeout(function () {
                            window.location.href = window.location.href;
                        }, 2000);
                    }
                }
            });

        });

    });
    //制作模板说明弹框
    function showMakeTmpDialog(){
        layer.open({
            content: '<div style="text-align:left;max-height: 600px;overflow-y: auto;">' +
                '<p>1、首先确定需要制作模板的活动类型，对应找到已有该类型的系统模板进行参考设计。比如“红包拓客”类型，模板所在目录<img align="absmiddle" src="{__TEMP__}/tmpdemo/1.png" width="100%"/>模板目录进入后结构：<img align="absmiddle" src="{__TEMP__}/tmpdemo/2.png" width="100%"/>资源所在目录：<img align="absmiddle" src="{__TEMP__}/tmpdemo/3.png" width="100%"/>资源目录进入后结构：<img align="absmiddle" src="{__TEMP__}/tmpdemo/4.png" width="100%"/></p>' +
                '<p>活动类型对应系统模板目录名称如下：<br>分享红包 tmp1 红包拓客 tmp2 联盟拓客 tmp3 集赞拓客 tmp4 锦鲤抽奖 tmp5 大转盘 tmp6 九宫格 tmp7 抢福袋 tmp8 砸金蛋 tmp9 翻卡牌 tmp10 幸运扑克 tmp11 刮刮卡 tmp12 摇一摇 tmp13 水果机 tmp14 助力砍价 tmp19 经典拼团 tmp20 阶梯拼团 tmp21</p>' +
                '<p>模板目录：您的域名/addons/lywywl_ztb/template/mobile/tmp/模板目录名称<br>资源目录：您的域名/addons/lywywl_ztb/resource/mobile/tmp/模板目录名称</p>' +
                '<p>2、自定义模板参照系统模板制作好后，应该也有两个目录一个是模板文件目录，一个是资源目录，这两个目录名要设置成编辑里面的模板目录名称，比如“tmpc1”，然后分别上传到“您的域名/addons/lywywl_ztb/template/mobile/tmp”，“您的域名/addons/lywywl_ztb/resource/mobile/tmp”这两个目录下，最后后台启用该模板，商家就可发布该模板的活动了。</p>' +
                '<p></p>' +
                '<p></p>' +
                '</div>'
            ,btn: ['知道了','取消']
            ,yes: function(index){
                layer.close(index);
            }
        });
    }
</script>
</body>
</html>