<!DOCTYPE html>
<html lang="zh-cn">
{template 'store/common/header'}
<link rel="stylesheet" href="{__PLUGIN__}/validform/5.3.2/Validform.css">
<link href="{MODULE_URL}resource/mobile/plugin/css/common.min.css?v=20170802" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="{__MOBILE_STORE_CSS__}/animate.min.css">
<style type="text/css">
    /*不滚动样式*/
    .scroll {position: fixed; width: 100%; height:100%; }
    body {position: static}
    /**定义编辑器冲突样式**/
    .Eleditor-area{min-height: 200px;}
    .Eleditor-controller{z-index:12;}
    .Eleditor-controller .webuploader-pick{color:#000;}
    .Eleditor-controller ul li{padding:0 0 0 10%;border-bottom: 1px solid #ddd !important;}
    .Eleditor-textEditor{z-index:13;}
    .buttonFloat{z-index: 10;}
    #contentEditor_miaoshu img,#contentEditor_shop img,#contentEditor_rule img,#contentEditor_goods img,#contentEditor5 img{  width: 100%;  }
    .Eleditor-controller{  z-index: 30;  }
    .Eleditor-textStyle .Eleditor-textStyle-item-upImg{  display: none;  }
    /**自定义海报**/
    .btn-poster {padding: 4px 10px;height: 30px;position: relative;cursor: pointer;color: #888;background: #fafafa;border: 1px solid #ddd;border-radius: 4px;}
    .bg-poster {width: 100%;}
    .drag {position: absolute;}
    .drag img {width:100%;}
    .drag .text {width:100%;}
    /*提示code颜色*/
    .publish code {color: #c7254e;}
</style>
<script src="{__MOBILE_STORE_JS__}/Eleditor.min.js"></script>
<script src="{__MOBILE_STORE_JS__}/webuploader.min.js"></script>
<script src="{__PLUGIN__}/artTemplate/template-native-debug.js"></script>
<link href="{__MOBILE_STORE_CSS__}/jquery.cxcolor.css" rel="stylesheet">
<script src="{__MOBILE_STORE_JS__}/jquery.cxcolor.js"></script>
<link href="{__MOBILE_STORE_CSS__}/LCalendar.css" rel="stylesheet">
<script src="{__MOBILE_STORE_JS__}/LCalendar.js"></script>
<script type="text/javascript" src="{MODULE_URL}resource/template/tmp/{$tmpModel['resource']}/init.js?v=20200815"></script>
<script type="text/javascript" src="{MODULE_URL}resource/mobile/plugin/js/app/util.js"></script>
<script type="text/javascript" src="{MODULE_URL}resource/mobile/plugin/js/require.js"></script>
<script type="text/javascript" src="{MODULE_URL}resource/mobile/plugin/js/lib/mui.min.js"></script>
<script type="text/javascript" src="{MODULE_URL}resource/mobile/plugin/js/app/common.js"></script>
<script type="text/javascript" src="https://api.map.baidu.com/api?v=2.0&ak=F51571495f717ff1194de02366bb8da9&s=1"></script>
<body class="bgf2" style="{$tmpModel['body_style']}">
<div class="moneybox" id="leafContainer"></div>
<form id="form_content" method="post">
    {$tmpModel['baner_html']}
    <section class="pt20">
        <div class="objbox bgfff">
            <div class="title">活动样式设置<span class="fr">-折叠</span></div>
            <ul class="publish">
                <li class="float">
                    <p>头图模式</p>
                    <section class="form_con clearfix">
                        <section class="input_item">
                            <input type="radio" value="0" name="model[banner_types]" id="banner_types0" class="banner_types" {if $model['banner_types']==0} checked {/if}>
                            <label for="banner_types0"></label>
                            <span>多图轮播</span>
                        </section>
                        <section class="input_item">
                            <input type="radio" value="1" name="model[banner_types]" id="banner_types1" class="banner_types" {if $model['banner_types']==1} checked {/if}>
                            <label for="banner_types1"></label>
                            <span>单张头图</span>
                        </section>
                    </section>
                    <section class="font26 c9 lh15">
                        <strong>提示：</strong>  请根据实际需求选择头部图片模式，多图轮播：指定区域内多张图片轮播，{if strpos($tmpModel['resource'],'tmpc') === false }
                         {if ((int)str_replace("tmp","",$tmpModel['resource']))>91}
                            建议宽度750 高度不限
                         {else}
                            图片建议大小640*360；
                         {/if}
                        {else}
                            图片建议大小640*360；
                        {/if}；单张头图：可自定义整个头部，图片可自适应展示。
                    </section>
                </li>
                <li id="banner_types0_box" style="display: {if $model['banner_types'] == 1} none{/if};">
                    <p>页面头图<span></span></p>
                    <section class="form_con clearfix">
                        <div class="mui-input-cell">
                            {php echo tpl_app_form_field_image('multi_banner_url',$model['multi_banner_url'],true);}
                        </div>
                    </section>
                    <section class="font26 c9 lh15">
                        <strong>提示：</strong> 请上传设置活动头部图片 {if strpos($tmpModel['resource'],'tmpc') === false }
                         {if ((int)str_replace("tmp","",$tmpModel['resource']))>91}
                            建议宽度750 高度不限
                         {else}
                            图片建议大小640*360；
                         {/if}
                        {else}
                            图片建议大小640*360；
                        {/if}
                    </section>
                </li>
                <li id="banner_types1_box" style="display: {if $model['banner_types'] == 0} none{/if};">
                    <p>页面头图<span></span></p>
                    <section class="form_con clearfix">
                        <div class="mui-input-cell">
                            {php echo tpl_app_form_field_image('single_banner_url',$model['banner_url'],false);}
                        </div>
                    </section>
                    <section class="font26 c9 lh15">
                        <strong>提示：</strong> 请上传设置活动头部图片
                    </section>
                </li>
                <li class="float" style="display: none;">
                    <p>背景颜色</p>
                    <section class="form_con selectBox">
                        <input id="bg_color" name="model[bg_color]" class="input_cxcolor"
                               type="text" readonly  value="{$model['bg_color']}">
                    </section>
                </li>
                <li id="StoreList">
                    <p class="mb24">商家门店<button class="but_store fr pt5 bgGreen" id="addmapbtn" type="button">添加门店</button></p>
                    {if !empty($model['store_map_list'])}
                    {loop $model['store_map_list'] $index $item}
                    <section class="form_con clearfix addmap" style="margin-top: 0.32rem;">
                        <section class="txt_item">
                            <input type="text"  name="model[store_map_list][{$index}][name]"  placeholder="请输入门店名称" value="{$item['name']}"  class="form_txt">
                        </section>
                        <section class="clearfix mb24">
                            <section class="coordinate_w33 txt_item">
                                <input type="text" name="model[store_map_list][{$index}][lng]" value="{$item['lng']}" placeholder="地理经度" class="form_txt">
                            </section>
                            <section class="coordinate_w33 txt_item">
                                <input type="text" name="model[store_map_list][{$index}][lat]" value="{$item['lat']}" placeholder="地理纬度" class="form_txt">
                            </section>
                            <section class="select_coordinate clickBtn">
                                <button class="but_store fr coordinate " type="button">选择坐标</button>
                            </section>
                        </section>
                        <section class="txt_item">
                            <input type="text" name="model[store_map_list][{$index}][address]" value="{$item['address']}" placeholder="请输入详情地址" class="form_txt">
                        </section>
                        <section class="clearfix">
                            <section class="txt_item add_w fl">
                                <input type="text" name="model[store_map_list][{$index}][tel]" value="{$item['tel']}" placeholder="请输入电话" class="form_txt">
                            </section>
                            <section class="select_coordinate ">
                                <button class="but_store fr bgRed delmapitem">删除门店</button>
                            </section>
                        </section>
                    </section>
                    {/loop}
                    {else}
                    <section class="form_con clearfix addmap" style="margin-top: 0.32rem;">
                        <section class="txt_item">
                            <input type="text"  name="model[store_map_list][0][name]"  placeholder="请输入门店名称" value=""  class="form_txt">
                        </section>
                        <section class="clearfix mb24">
                            <section class="coordinate_w33 txt_item">
                                <input type="text" name="model[store_map_list][0][lng]" value="" placeholder="地理经度" class="form_txt">
                            </section>
                            <section class="coordinate_w33 txt_item">
                                <input type="text" name="model[store_map_list][0][lat]" value="" placeholder="地理纬度" class="form_txt">
                            </section>
                            <section class="select_coordinate clickBtn">
                                <button class="but_store fr coordinate " type="button">选择坐标</button>
                            </section>
                        </section>
                        <section class="txt_item">
                            <input type="text" name="model[store_map_list][0][address]" value="" placeholder="请输入详情地址" class="form_txt">
                        </section>
                        <section class="clearfix">
                            <section class="txt_item add_w fl">
                                <input type="text" name="model[store_map_list][0][tel]" value="" placeholder="请输入电话" class="form_txt">
                            </section>
                            <section class="select_coordinate ">
                                <button class="but_store fr bgRed delmapitem">删除门店</button>
                            </section>
                        </section>
                    </section>
                    {/if}
                </li>
            </ul>
        </div>
        <div class="objbox bgfff">
            <div class="title">创建活动信息<span class="fr">-折叠</span></div>
            <ul class="publish">
                <li class="float">
                    <p>活动名称</p>
                    <section class="form_con selectBox">
                        <input class="form_float_txt" datatype="*" id="title" maxlength="200"
                               name="model[title]" nullmsg="请输入活动名称！" placeholder="请输入活动名称"
                               type="text" value="{$model['title']}"/>
                    </section>
                </li>
                <li>
                    <p>活动封面图片<span></span></p>
                    <section class="form_con clearfix">
                        <div class="mui-input-cell">
                            <input type="hidden" id="model[pic_url]" name="model[pic_url]" value=""/>
                            {php echo tpl_app_form_field_image('pic_url',$model['pic_url'],false);}
                        </div>
                    </section>
                    <section class="font26 c9 lh15">
                        <strong>提示：</strong> 请上传活动封面图片,将展示在活动列表和用户参与记录中;建议尺寸200*200px
                    </section>
                </li>
                <li>
                    <p>活动状态</p>
                    <section class="form_con rel">
                        <section class="font26 c9 form_tips">选择信息开启/关闭状态，关闭后该信息将被禁用</section>
                        <span class="switch {if $model['status']==1}switch_on{else}switch_off{/if}">
                    <i class="slider"></i>
                    <input type="hidden" name="model[status]" value="{$model['status']}"/>
                    </span>
                    </section>
                </li>
                <li>
                    <p>活动规则/活动内容<span></span></p>
                    <section class="form_con clearfix">
                        <section class="txt_item">
                            <textarea rows = "3" name="model[content]" id="content" class="form_area" style="display: none;" placeholder = "请输入活动内容..." >{$model['content']}</textarea>
                            <div id="contentEditor"></div>
                        </section>
                    </section>
                </li>
                <li class="float">
                    <p>咨询电话</p>
                    <section class="form_con selectBox">
                        <input class="form_float_txt" id="tel" maxlength="200"
                               name="model[tel]" placeholder="请输入咨询电话"
                               type="text" value="{$model['tel']}"/>
                    </section>
                    <section class="font26 c9 lh15">
                        <strong>提示：</strong>如不填写活动咨询电话，默认使用系统客服电话或商家联系电话。
                    </section>
                </li>
            </ul>
        </div>
        <div class="objbox bgfff">
            <div class="title">活动分享设置<span class="fr">-折叠</span></div>
            <ul class="publish">
                <li class="float">
                    <p>分享标题</p>
                    <section class="form_con selectBox">
                        <input class="form_float_txt" id="share_title" maxlength="200"
                               name="model[share_title]" placeholder="请输入活动分享标题"
                               type="text" value="{$model['share_title']}"/>
                    </section>
                    <section class="font26 c9 lh15">
                        <strong>提示：</strong> 填写<code onclick="insertAtCursor('share_title',this);">{##NICKNAME##}</code>系统会自动替换为分享用户的昵称。
                    </section>
                </li>
                <li>
                    <p>分享图标<span></span></p>
                    <section class="form_con clearfix">
                        <div class="mui-input-cell">
                            <input type="hidden" id="model[share_thumb]" name="model[share_thumb]" value=""/>
                            {php echo tpl_app_form_field_image('share_thumb',$model['share_thumb'],false);}
                        </div>
                    </section>
                    <section class="font26 c9 lh15">
                        <strong>提示：</strong> 分享图片可不设置 不设置将用分享者头像
                    </section>
                </li>
                <li>
                    <p>分享描述<span></span></p>
                    <section class="form_con clearfix">
                        <section class="txt_item">
                            <textarea rows = "3" name="model[share_desc]" id="share_desc" class="form_area" placeholder = "请输入活动分享描述..." >{$model['share_desc']}</textarea>
                        </section>
                    </section>
                    <section class="font26 c9 lh15">
                        <strong>提示：</strong> 填写<code onclick="insertAtCursor('share_desc',this);">{##NICKNAME##}</code>系统会自动替换为分享用户的昵称,活动分享描述请不要将内容换行，系统将自动过滤到换行符。
                    </section>
                </li>
            </ul>
        </div>
        <div class="objbox bgfff">
            <div class="title">活动数据伪造<span class="fr">-折叠</span></div>
            <ul class="publish">
                <li class="float">
                    <p>曝光人数</p>
                    <section class="form_con selectBox">
                        <input class="form_float_txt" datatype="n" id="bogus_click_num"
                               maxlength="10"
                               name="model[bogus_click_num]" nullmsg="请输入伪造曝光人数！"
                               placeholder="请输入伪造曝光人数"
                               type="number"
                               onkeyup="if(isNaN(this.value)){this.value='0';}"
                               value="{$model['bogus_click_num']}"/>
                    </section>
                    <section class="font26 c9 lh15">
                        <strong>提示：</strong> 请输入伪造曝光人数 0表示不伪造 展示人数=伪造人数+实际人数
                    </section>
                </li>
                <li class="float">
                    <p>转发人数</p>
                    <section class="form_con selectBox">
                        <input class="form_float_txt" datatype="n" id="bogus_repost_num"
                               maxlength="10"
                               name="model[bogus_repost_num]" nullmsg="请输入伪造转发人数！"
                               placeholder="请输入伪造转发人数"
                               type="number"
                               onkeyup="if(isNaN(this.value)){this.value='0';}"
                               value="{$model['bogus_repost_num']}"/>
                    </section>
                    <section class="font26 c9 lh15">
                        <strong>提示：</strong> 请输入伪造转发人数 0表示不伪造 展示转发人数=伪造人数+实际人数
                    </section>
                </li>
                <li class="float">
                    <p>中奖人数</p>
                    <section class="form_con selectBox">
                        <input class="form_float_txt" datatype="n" id="bogus_get_num"
                               maxlength="10"
                               name="model[bogus_get_num]" nullmsg="请输入伪造中奖人数！"
                               placeholder="请输入伪造中奖人数"
                               type="number"
                               onkeyup="if(isNaN(this.value)){this.value='0';}"
                               value="{$model['bogus_get_num']}"/>
                    </section>
                    <section class="font26 c9 lh15">
                        <strong>提示：</strong> 请输入伪造中奖人数 0表示不伪造 展示中奖人数=伪造人数+实际人数
                    </section>
                </li>
            </ul>
        </div>
        <div class="objbox bgfff">
            <div class="title">活动栏目设置<span class="fr">-折叠</span></div>
            <ul class="publish">
                <li class="float">
                    <p>展示中奖记录</p>
                    <section class="form_con clearfix">
                        <section class="input_item">
                            <input type="radio" value="0" name="model[is_show_winners]" id="is_show_winners0" class="is_show_winners" {if $model['is_show_winners']==0} checked {/if}>
                            <label for="is_show_winners0"></label>
                            <span>关闭</span>
                        </section>
                        <section class="input_item">
                            <input type="radio" value="1" name="model[is_show_winners]" id="is_show_winners1" class="is_show_winners" {if $model['is_show_winners']==1} checked {/if}>
                            <label for="is_show_winners1"></label>
                            <span>开启</span>
                        </section>
                    </section>
                    <section class="font26 c9 lh15">
                        <strong>提示：</strong>  开启后系统顶部会展示最新参与者名单，取前15名中奖者滚动展示。
                    </section>
                </li>
                <li class="float">
                    <p>展示门店位置</p>
                    <section class="form_con clearfix">
                        <section class="input_item">
                            <input type="radio" value="0" name="model[is_show_map]" id="is_show_map0" class="is_show_map" {if $model['is_show_map']==0} checked {/if}>
                            <label for="is_show_map0"></label>
                            <span>关闭</span>
                        </section>
                        <section class="input_item">
                            <input type="radio" value="1" name="model[is_show_map]" id="is_show_map1" class="is_show_map" {if $model['is_show_map']==1} checked {/if}>
                            <label for="is_show_map1"></label>
                            <span>开启</span>
                        </section>
                    </section>
                    <section class="font26 c9 lh15">
                        <strong>提示：</strong>  启后活动界面中将展活动门店地址位置信息。
                    </section>
                </li>
            </ul>
        </div>
        <div class="objbox bgfff">
            <div class="title">活动参与限制<span class="fr">-折叠</span></div>
            <ul class="publish">
                <li class="float">
                    <p>开始日期</p>
                    <section class="form_con selectBox">
                        <section>
                            <input class="form_float_txt" id="start_time" name="model[start_time]" placeholder="请选择日期" type="text" value="{$model['start_time']}" datatype="*" nullmsg="请选择活动开始日期！" readonly="true">
                        </section>
                    </section>
                    <section class="font26 c9 lh15">
                        <strong>提示：</strong> 请选择拓客活动的开始时间，活动只有在启动时间内有效。
                    </section>
                </li>
                <li class="float">
                    <p>结束日期</p>
                    <section class="form_con selectBox">
                        <section>
                            <input class="form_float_txt" id="end_time" name="model[end_time]" placeholder="请选择日期" type="text" value="{$model['end_time']}" datatype="*" nullmsg="请选择活动结束日期！" readonly="true">
                        </section>
                    </section>
                    <section class="font26 c9 lh15">
                        <strong>提示：</strong> 请选择拓客活动的结束时间，活动只有在启动时间内有效。
                    </section>
                </li>
                <li class="float">
                <p>抽奖模式</p>
                <section class="form_con clearfix">
                    <section class="input_item">
                        <input type="radio" value="0" name="model[models]" id="models0" class="models" {if $model['models']==0} checked {/if}>
                        <label for="models0"></label>
                        <span>普通模式</span>
                    </section>
                    <section class="input_item">
                        <input type="radio" value="1" name="model[models]" id="models1" class="models" {if $model['models']==1} checked {/if}>
                        <label for="models1"></label>
                        <span>积分模式</span>
                    </section>
                </section>
                <section class="font26 c9 lh15">
                    <strong>提示：</strong>
                    <code>普通模式：</code>用户访问即可参与抽奖，没有任何附加条件 ；<code>积分模式：</code>用户消耗指定账户积分后，参与一次抽奖活动。
                </section>
            </li>
                <li class="float obj_models_limit" style="display: {if $model['models'] != 0} none{/if};">
                    <p>领取方式</p>
                    <section class="form_con clearfix">
                        <section class="input_item">
                            <input type="radio" value="0" name="model[get_types]" id="get_types0" {if $model['get_types']==0} checked {/if}>
                            <label for="get_types0"></label>
                            <span>活动期间</span>
                        </section>
                        <section class="input_item">
                            <input type="radio" value="1" name="model[get_types]" id="get_types1" {if $model['get_types']==1} checked {/if}>
                            <label for="get_types1"></label>
                            <span>活动每天</span>
                        </section>
                        <section class="input_item" style="display: none">
                            <input type="radio" value="2" name="model[get_types]" id="get_types2" {if $model['get_types']==2} checked {/if}>
                            <label for="get_types2"></label>
                            <span>随意领取</span>
                        </section>
                    </section>
                    <section class="font26 c9 lh15">
                        <strong>提示：</strong>
                        请选择限制用户领取红包的方式，选择“活动期间”，“活动每天”后，请完善“默认领取次数”选项信息。
                    </section>
                </li>
                <li class="float obj_models_limit" style="display: {if $model['models'] != 0} none{/if};">
                    <p>默认领取次数</p>
                    <section class="form_con selectBox">
                        <input class="form_float_txt"  id="limit_num"
                               name="model[limit_num]" placeholder="请输入活动红包默认领取次数"
                               onKeyUp="if(isNaN(this.value)) this.value='0';"
                               type="number" value="{$model['limit_num']}">
                    </section>
                    <section class="font26 c9 lh15">
                        <strong>提示：</strong>  请输入活动红包默认领取次数，超过次数将无法参与活动，请和“领取红包方式”选项配合设置。
                    </section>
                </li>
                <li class="float obj_models_limit" style="display: {if $model['models'] != 0} none{/if};">
                    <p>邀请模式</p>
                    <section class="form_con clearfix">
                        <section class="input_item" >
                            <input type="radio" value="1" name="model[is_invite_friend]" class="invite_friend" id="is_invite_friend1" {if $model['is_invite_friend']==1} checked {/if}>
                            <label for="is_invite_friend1"></label>
                            <span>开启</span>
                        </section>
                        <section class="input_item">
                            <input type="radio" value="0" name="model[is_invite_friend]" class="invite_friend" id="is_invite_friend0" {if $model['is_invite_friend']==0} checked {/if}>
                            <label for="is_invite_friend0"></label>
                            <span>关闭</span>
                        </section>
                    </section>
                    <section class="font26 c9 lh15">
                        <strong>提示：</strong>
                        开启后每邀请一位好友参与抽奖活动 邀请用户可获得1次抽奖机会。
                    </section>
                </li>
                <li class="float invite_limit_box" style="display: {if $model['models'] != 0 || $model['is_invite_friend'] != 1} none{/if};">
                    <p>邀请次数</p>
                    <section class="form_con selectBox">
                        <input class="form_float_txt"  id="invite_limit_num"
                               name="model[invite_limit_num]" placeholder="请输入活动限制邀请次数"
                               onKeyUp="if(isNaN(this.value)) this.value='0';"
                               type="number" value="{$model['invite_limit_num']}">
                    </section>
                    <section class="font26 c9 lh15">
                        <strong>提示：</strong>  请输入活动邀请限制次数（0表示不限制），超过次数将无法参与活动，请和“领取红包方式”选项配合设置。
                    </section>
                </li>
                <li class="float obj_models_score" style="display: {if $model['models'] != 1} none{/if};">
                    <p>所需积分</p>
                    <section class="form_con selectBox">
                        <input class="form_float_txt"  id="cost_score"
                               name="model[cost_score]" placeholder="请输入所需积分"
                               onKeyUp="if(isNaN(this.value)) this.value='0';"
                               type="number" value="{$model['cost_score']}">
                    </section>
                </li>
                <li class="float">
                    <p>最大中奖数量</p>
                    <section class="form_con selectBox">
                        <input class="form_float_txt"  id="max_draw"
                               name="model[max_draw]" placeholder="请输入活动最大中奖数量"
                               onKeyUp="if(isNaN(this.value)) this.value='0';"
                               type="number" value="{$model['max_draw']}">
                    </section>
                    <section class="font26 c9 lh15">
                        <strong>提示：</strong> 请输入活动最大中奖数量，除谢谢参与外超过最大中奖数量后，将只会中“谢谢参与”奖项
                    </section>
                </li>
                <li class="float">
                    <p>信息登记</p>
                    <section class="form_con clearfix">
                        <section class="input_item">
                            <input type="radio" value="1" name="model[is_register]" class="is_register" id="is_register1" {if $model['is_register']==1} checked {/if}>
                            <label for="is_register1"></label>
                            <span>登记参与</span>
                        </section>
                        <section class="input_item">
                            <input type="radio" value="0" name="model[is_register]" class="is_register" id="is_register0" {if $model['is_register']==0} checked {/if}>
                            <label for="is_register0"></label>
                            <span>无需登记</span>
                        </section>
                    </section>
                    <section class="font26 c9 lh15">
                        <strong>提示：</strong>  请选择用户参与活动是否需要登记个人信息。
                    </section>
                </li>
                <li id="FieldList" style="display: {if $model['is_register'] == 0} none{/if};">
                    <p class="mb24">登记字段<button class="but_store fr pt5 bgGreen" id="addregfieldbtn" type="button">添加字段</button></p>
                    {if !empty($model['id'])}
                    {loop $model['register_field'] $index $item}
                    <section class="form_con clearfix addfield" style="margin-top: 0.32rem;">
                        {if $item['Name']=="Mobile"}
                        <section class="clearfix mb24">
                            <section class="selectBox txt_item fl" style="width: 48%;margin-right:4%">
                                <select name="model[register_field][{$index}][Type]" class="font28" style = "width: 100%;">
                                    <option value="text" {if $item['Type']=='text'} selected {/if}>文本字段</option>
                                    <option value="number" {php echo $index<2?"disabled":""} {if $item['Type']=='number'} selected {/if}>数字字段</option>
                                    <option value="radio" {php echo $index<2?"disabled":""} {if $item['Type']=='radio'} selected {/if}>单选按钮</option>
                                    <option value="checkbox" {php echo $index<2?"disabled":""} {if $item['Type']=='checkbox'} selected {/if}>复选按钮</option>
                                    <option value="select" {php echo $index<2?"disabled":""} {if $item['Type']=='select'} selected {/if}>下拉列表</option>
                                    <option value="textarea" {php echo $index<2?"disabled":""} {if $item['Type']=='textarea'} selected {/if}>文本域</option>
                                </select>
                            </section>
                            {if $config['sms_obj']==1}
                            <section class="input_item fr" style="width: 48%;margin-right:0%">
                                <input type="checkbox" name="model[register_field][{$index}][IsSmsCk]" id="model[register_field][{$index}][IsSmsCk]" {php echo $item['IsSmsCk']==1?"checked":""} value="1" />
                                <label for="model[register_field][{$index}][IsSmsCk]"></label>
                                <span>短信验证</span>
                            </section>
                            {/if}
                        </section>
                        {else}
                        <section class="clearfix selectBox txt_item mb24">
                            <select name="model[register_field][{$index}][Type]" class="font28" style = "width: 100%;">
                                <option value="text" {if $item['Type']=='text'} selected {/if}>文本字段</option>
                                <option value="number" {php echo $index<2?"disabled":""} {if $item['Type']=='number'} selected {/if}>数字字段</option>
                                <option value="radio" {php echo $index<2?"disabled":""} {if $item['Type']=='radio'} selected {/if}>单选按钮</option>
                                <option value="checkbox" {php echo $index<2?"disabled":""} {if $item['Type']=='checkbox'} selected {/if}>复选按钮</option>
                                <option value="select" {php echo $index<2?"disabled":""} {if $item['Type']=='select'} selected {/if}>下拉列表</option>
                                <option value="textarea" {php echo $index<2?"disabled":""} {if $item['Type']=='textarea'} selected {/if}>文本域</option>
                            </select>
                        </section>
                        {/if}
                        <section class="clearfix mb24">
                            <section class="coordinate_w33 txt_item"  style="width: 48%;margin-right:4%">
                                <input   type="text" name="model[register_field][{$index}][Explain]" value="{$item['Explain']}" placeholder="请输入名称" class="form_txt">
                            </section>
                            <section class="coordinate_w33 txt_item" style="width: 48%;margin-right:0%">
                                <input {php echo $index<2?"readonly":""} type="text" name="model[register_field][{$index}][Name]" value="{$item['Name']}" placeholder="请输入字段(仅支持英文)" onkeyup="value=value.replace(/[^a-zA-Z]/g,'')" class="form_txt">
                            </section>
                        </section>
                        <section class="clearfix">
                            <section class="txt_item add_w fl">
                                <input   type="text" name="model[register_field][{$index}][Tips]" value="{$item['Tips']}" placeholder="请输入提示信息/配置项" class="form_txt">
                            </section>
                            <section class="select_coordinate ">
                                <button class="but_store fr bgRed {php echo $index<2?"":"delfielditem"}" {php echo $index<2?"disabled":""}>删除字段</button>
                            </section>
                        </section>
                    </section>
                    {/loop}
                    {else}
                    <section class="form_con clearfix addfield" style="margin-top: 0.32rem;">
                        <section class="clearfix selectBox txt_item mb24">
                            <select name="model[register_field][0][Type]" class="font28">
                                <option value="text" selected>文本字段</option>
                                <option value="number" disabled>数字字段</option>
                                <option value="radio" disabled>单选按钮</option>
                                <option value="checkbox" disabled>复选按钮</option>
                                <option value="select" disabled>下拉列表</option>
                                <option value="textarea" disabled>文本域</option>
                            </select>
                        </section>
                        <section class="clearfix mb24">
                            <section class="coordinate_w33 txt_item" style="width: 48%;margin-right:4%">
                                <input type="text" name="model[register_field][0][Explain]" value="您的称呼" placeholder="请输入名称" class="form_txt">
                            </section>
                            <section class="coordinate_w33 txt_item" style="width: 48%;margin-right:0%">
                                <input readonly type="text" name="model[register_field][0][Name]" value="Name" placeholder="请输入字段(仅支持英文)" onkeyup="value=value.replace(/[^a-zA-Z]/g,'')" class="form_txt">
                            </section>
                        </section>
                        <section class="clearfix">
                            <section class="txt_item add_w fl">
                                <input type="text" name="model[register_field][0][Tips]" value="请输入您的称呼" placeholder="请输入提示信息/配置项" class="form_txt">
                            </section>
                            <section class="select_coordinate ">
                                <button class="but_store fr bgRed" type="button" disabled>删除字段</button>
                            </section>
                        </section>
                    </section>
                    <section class="form_con clearfix addfield" style="margin-top: 0.32rem;">
                        <section class="clearfix mb24">
                            <section class="selectBox txt_item fl" style="width: 48%;margin-right:4%">
                                <select name="model[register_field][1][Type]" class="font28">
                                    <option value="text" selected>文本字段</option>
                                    <option value="number" disabled>数字字段</option>
                                    <option value="radio" disabled>单选按钮</option>
                                    <option value="checkbox" disabled>复选按钮</option>
                                    <option value="select" disabled>下拉列表</option>
                                    <option value="textarea" disabled>文本域</option>
                                </select>
                            </section>
                            {if $config['sms_obj']==1}
                            <section class="input_item fr" style="width: 48%;margin-right:0%">
                                <input type="checkbox" name="model[register_field][1][IsSmsCk]" id="model[register_field][1][IsSmsCk]" value="1" />
                                <label for="model[register_field][1][IsSmsCk]"></label>
                                <span>短信验证</span>
                            </section>
                            {/if}
                        </section>
                        <section class="clearfix mb24">
                            <section class="coordinate_w33 txt_item" style="width: 48%;margin-right:4%">
                                <input type="text" name="model[register_field][1][Explain]" value="手机号码" placeholder="请输入名称" class="form_txt">
                            </section>
                            <section class="coordinate_w33 txt_item" style="width: 48%;margin-right:0%">
                                <input readonly type="text" name="model[register_field][1][Name]" value="Mobile" placeholder="请输入字段(仅支持英文)" onkeyup="value=value.replace(/[^a-zA-Z]/g,'')" class="form_txt">
                            </section>
                        </section>
                        <section class="clearfix">
                            <section class="txt_item add_w fl">
                                <input type="text" name="model[register_field][1][Tips]" value="请输入您的手机号码" placeholder="请输入提示信息/配置项" class="form_txt">
                            </section>
                            <section class="select_coordinate ">
                                <button class="but_store fr bgRed" type="button" disabled>删除字段</button>
                            </section>
                        </section>
                    </section>
                    {/if}
                </li>
                <li class="float" id="FieldExp" style="display: {if $model['is_register'] == 0} none{/if};">
                    <section class="font26 c9 lh15">
                        <strong>提示：</strong>  添加所有字段信息为必填字段，请按照要求填写，如不清楚请咨询在线客服。
                        <br>具体设置如下：
                        <br>文本字段：适用于用户填写文本内容信息，例如：名称，标题，电话，传真等信息
                        <br>数字字段：适用于用户填写数字内容信息，例如：年龄，数量等信息
                        <br>单选按钮：适用于用户单选内容信息，例如：性别 ，请填写至“提示信息/配置项”格式如下：男,女
                        <br>复选按钮：适用于用户多选内容信息，例如：爱好 ，请填写至“提示信息/配置项”格式如下：音乐,足球,画画
                        <br>下拉列表：适用于用户多选项单选内容信息，例如：行业 ，请填写至“提示信息/配置项”格式如下：教育行业,餐饮行业,医疗行业
                        <br>文本域：适用于用户较多用户信息填充，例如：备注，个人简介等信息
                    </section>
                </li>
                <li class="float">
                    <p>领取区域</p>
                    <section class="form_con selectBox">
                        <input class="form_float_txt" id="area_limit" maxlength="255"
                               name="model[area_limit]"  placeholder="请输入允许参与活动的区域名称！"
                               type="text" value="{$model['area_limit']}"/>
                    </section>
                    <section class="font26 c9 lh15">
                        <strong>提示：</strong> 请填写允许参与活动的区域名称，例如：北京,上海,湖南,海南,海口等等,不要加省，市，县。多个地区用","分割。
                    </section>
                </li>
            </ul>
        </div>
        <div class="objbox bgfff"  style="display: {if $config['sms_obj']!=1}none{/if};">
            <div class="title">中奖通知设置<span class="fr">-折叠</span></div>
            <ul class="publish">
                <li class="float">
                    <p>短信提醒</p>
                    <section class="form_con clearfix">
                        <section class="input_item">
                            <input type="radio" value="0" name="model[is_sms]" id="is_sms0" class="is_sms" {if $model['is_sms']==0} checked {/if}>
                            <label for="is_sms0"></label>
                            <span>关闭</span>
                        </section>
                        <section class="input_item">
                            <input type="radio" value="1" name="model[is_sms]" id="is_sms1" class="is_sms" {if $model['is_sms']==1} checked {/if}>
                            <label for="is_sms1"></label>
                            <span>开启</span>
                        </section>
                    </section>
                    <section class="font26 c9 lh15">
                        <strong>提示：</strong> 开启前请确保账户短信数量充足，短信不足将造成短信发送失败。
                    </section>
                </li>
                <li class="float" id="sms_tmp_box" style="display: {if $model['is_sms'] == 0} none{/if};">
                    <p>短信模板</p>
                    <section class="form_con selectBox">
                        <input class="form_float_txt" id="sms_tmp" maxlength="200"
                               name="model[sms_tmp]"  placeholder="请输入通知短信模板！"
                               type="text" value="{$model['sms_tmp']}"/>
                    </section>
                    <section class="font26 c9 lh15">
                        <strong>提示：</strong> 请根据实际活动需求创建短信模板，系统提供标签将会在发送过程中自动替换。<code onclick="insertAtCursor('sms_tmp',this);">{{PRIZE}}</code>奖品名称 <code onclick="insertAtCursor('sms_tmp',this);">{{NICKNAME}}</code>微信昵称 <code onclick="insertAtCursor('sms_tmp',this);">{{OBJ}}</code>活动名称 <code onclick="insertAtCursor('sms_tmp',this);">{{WRITEOFFCODE}}</code>核销码
                    </section>
                </li>
            </ul>
        </div>
        <div class="objbox bgfff">
            <div class="title">开屏广告设置<span class="fr">-折叠</span></div>
            <ul class="publish">
                <li class="float">
                    <p>广告开关</p>
                    <section class="form_con clearfix">
                        <section class="input_item">
                            <input type="radio" value="0" name="model[is_show_ads]" id="is_show_ads0" class="is_show_ads" {if $model['is_show_ads']==0} checked {/if}>
                            <label for="is_show_ads0"></label>
                            <span>关闭</span>
                        </section>
                        <section class="input_item">
                            <input type="radio" value="1" name="model[is_show_ads]" id="is_show_ads1" class="is_show_ads" {if $model['is_show_ads']==1} checked {/if}>
                            <label for="is_show_ads1"></label>
                            <span>开启</span>
                        </section>
                    </section>
                    <section class="font26 c9 lh15">
                        <strong>提示：</strong> 开启后用户首次进入首页会弹出开屏广告，为提升用户体验关闭后再次进入将不再展示。
                    </section>
                </li>
                <li class="ads_open_box" style="display: {if $model['is_show_ads'] != 1} none{/if};">
                    <p>广告图片<span></span></p>
                    <section class="form_con clearfix">
                        <div class="mui-input-cell">
                            <input type="hidden" id="model[ads_url]" name="model[ads_url]" value=""/>
                            {php echo tpl_app_form_field_image('ads_url',$model['ads_url'],false);}
                        </div>
                    </section>
                    <section class="font26 c9 lh15">
                        <strong>提示：</strong> 请按根据情况上传图片 建议尺寸518*740
                    </section>
                </li>
                <li class="float ads_open_box" style="display: {if $model['is_show_ads'] != 1} none{/if};">
                    <p>链接地址</p>
                    <section class="form_con selectBox">
                        <input class="form_float_txt" id="ads_link" maxlength="250"
                               name="model[ads_link]"  placeholder="请输入广告链接地址"
                               type="text" value="{$model['ads_link']}"/>
                    </section>
                    <section class="font26 c9 lh15">
                        <strong>提示：</strong> 请输入完整链接地址，以http://或https://开头，例如：http://www.baidu.com/
                    </section>
                </li>
                <li class="float ads_open_box" style="display: {if $model['is_show_ads'] != 1} none{/if};">
                    <p>展示时间</p>
                    <section class="form_con selectBox">
                        <input class="form_float_txt"  id="show_ads_time"
                               name="model[show_ads_time]" placeholder="请输入广告展示时间"
                               onKeyUp="if(isNaN(this.value)) this.value='0';"
                               type="number" value="{$model['show_ads_time']}">
                    </section>
                    <section class="font26 c9 lh15">
                        <strong>提示：</strong> 请输入开屏广告展示时间，开启后广告时间必填且大于零，单位：秒
                    </section>
                </li>
            </ul>
        </div>
        {if ($plug_appad && $plug_appad_act==1)}
        <div class="objbox bgfff">
            <div class="title">劫流广告设置<span class="fr">-折叠</span></div>
            <ul class="publish">
                <li class="float">
                    <p>广告开关</p>
                    <section class="form_con clearfix">
                        <section class="input_item">
                            <input type="radio" value="0" name="model[is_open_appad]" id="is_open_appad0" class="is_open_appad" {if $model['is_open_appad']==0} checked {/if}>
                            <label for="is_open_appad0"></label>
                            <span>关闭</span>
                        </section>
                        <section class="input_item">
                            <input type="radio" value="1" name="model[is_open_appad]" id="is_open_appad1" class="is_open_appad" {if $model['is_open_appad']==1} checked {/if}>
                            <label for="is_open_appad1"></label>
                            <span>开启</span>
                        </section>
                    </section>
                    <section class="font26 c9 lh15">
                        <strong>提示：</strong> 开启后用户访问活动点击页面任意位置，再访问第三方常用APP（抖音、快手、火山、淘宝等）后将弹出设定的口令广告。
                    </section>
                </li>
                <li class="float appad_open_box" style="display: {if $model['is_open_appad'] != 1} none{/if};">
                    <p>劫流口令<span></span></p>
                    <section class="form_con clearfix">
                        <section class="txt_item">
                            <textarea rows = "3" name="model[appad_password]" id="appad_password" class="form_area" placeholder = "请输入劫流口令,多个口令请用“*”分割..." >{$model['appad_password']}</textarea>
                        </section>
                    </section>
                    <section class="font26 c9 lh15">
                        <strong>提示：</strong> 支持多个平台口令同时存在，例如：抖音（找到您的广告视频 -> 点击右侧分享 -> 点击复制链接 -> 内容粘贴至此处）；淘宝（找到您的商家门店 -> 点击右上角分享 -> 点击复制链接 -> 内容粘贴至此处）；其他第三方平台以此类推；
                    </section>
                </li>
            </ul>
        </div>
        {/if}
    </section>
    <section class="h24"></section>
    <section class="buttonBox">
        <section class="buttonFloat">
            <input id="id" name="id" type="hidden" value="{$model['id']}"/>
            <input type="hidden" id="effect_id" name="model[effect_id]" value="{$model['effect_id']}"/>
            <input type="hidden" id="audio_id" name="model[audio_id]" value="{$model['audio_id']}" />
            <input type="hidden" id="audio_url" name="model[audio_url]" value="{$model['audio_url']}" />
            <input type="hidden" name="token" value="{$_W['token']}"/>
            <input id="iscopy" name="iscopy" type="hidden" value="{$iscopy}"/>
            <input type="hidden" name="submit" value="submit"/>
            {if empty($model['id'])}
            <a href="{php echo $this->createMobileUrl('store.sys_tmp',array('act'=>'index'))}" class="db font32" style="width: 50%;    float: left;   color: #fff;   border-radius: 0.6rem 0 0 0.6rem;    background: #f92f4a;">我再挑挑</a>
            {else}
            <a href="{php echo $this->createMobileUrl('store.obj_activity',array('act'=>'index'))}" class="db font32" style="width: 50%; float: left; color: #fff; border-radius: 0.6rem 0 0 0.6rem; background: #f92f4a;">活动列表</a>
            {/if}
            <button type="submit" style="width: 50%;   float: left;    background: #FFD112;    color: #0e0e0e;border-radius: 0 0.6rem 0.6rem 0;" id="SubmitBtn">确认提交</button>
        </section>
    </section>
</form>
<section class="leftTopIcons">
    <a href="javascript:;" class="speciaIcon" >特效</a>
    <a href="javascript:;" class="musicIcon">音乐</a>
    {if empty($model['id']) || !empty($iscopy)}
    <a href="javascript:;" class=" initIcon">一键初始化</a>
    {/if}
</section>
<div class="specia-win" >
    <div class="specia-sel-panel">
        <h1 class="specia-sel-h1">选择背景特效</h1>
        <span id="specia-button">关闭</span>
        <ul id="specia-sel-ul">
            <li class="effectli {if $model['effect_id']==0}act{/if}" data-id="0" data-pic="">
                <img src="{__MOBILE_STORE_IMG__}/checked.png" class="determine-icon" alt=""><h2>无特效</h2>
            </li>

            {loop $effectClassList $class}
            <li class="effectclass {if $class['id']==$editeffect['class_id']}on{/if}"><h2><em class="effectarrow"></em>{$class['name']}</h2>
                {loop $class['effectlist'] $item}
                <p data-id="{$item['id']}"  data-pic="{$item['pic_url']}"  class="effectli {if $item['id']==$editeffect['id']}on{/if}">
                    <img src="{__MOBILE_STORE_IMG__}/checked.png" class="determine-icon" style="margin-left: -0.7rem;">
                    {$item['name']}
                    <span class="fr">
                        <img class="specia-pic" src="{php echo explode(',',$item['pic_url'])[0]}" alt="">
                    </span>
                </p>
                {/loop}
            </li>
            {/loop}
        </ul>
    </div>
</div>
<div class="music-win" >
    <div class="music-sel-panel">
        <h1 class="music-sel-h1">选择背景音乐<input type="file" accept="audio/mpeg"  id="music_file" style="display: none"></h1>
        <span id="music-button">关闭</span>
        <ul id="music-sel-ul">
            <li data-id="0"  data-src="" data-url="" class="musicli {if empty($model['audio_url'])}act{/if}">
                <img src="{__MOBILE_STORE_IMG__}/checked.png" class="determine-icon" alt="">
                <h2>无背景音乐</h2></li>
            {if !empty($model['audio_url']) && $model['audio_id']==0}
            <li data-id="0"  data-src="{$model['audio_url']}" data-url="{php echo tomedia($model['audio_url'])}" class="musicli act">
                <img src="{__MOBILE_STORE_IMG__}/checked.png" class="determine-icon" alt="">
                <h2 >已上传音乐</h2>
                <img src="{__MOBILE_STORE_IMG__}/file_upload.png" class="upload-icon" alt="" id="music_upload">
            </li>
            {else}
            <li data-id="0"  data-src="" data-url="" class="musicli">
                <img src="{__MOBILE_STORE_IMG__}/checked.png" class="determine-icon" alt="">
                <h2>自定义音乐</h2>
                <img src="{__MOBILE_STORE_IMG__}/file_upload.png" class="upload-icon" alt="" id="music_upload">
            </li>
            {/if}

            {loop $audioClassList $class}
            <li class="musicclass {if $class['id']==$editaudio['class_id']}on{/if}"><h2><em class="musicarrow"></em>{$class['name']}</h2>
                {loop $class['audiolist'] $item}
                <p data-id="{$item['id']}"  data-src="{php echo strpos($item['audiourl'],'/template/audio')>0 ? MODULE_URL:''}{$item['audiourl']}" data-url="{php echo strpos($item['audiourl'],'/template/audio')>0 ? MODULE_URL.$item['audiourl']:tomedia($item['audiourl'])}" class="musicli {if $item['id']==$editaudio['id']}on{/if}">
                    <img src="{__MOBILE_STORE_IMG__}/checked.png" class="determine-icon" style="margin-left: -0.7rem;">
                    {$item['name']}
                    <span class="fr">
                        <img class="play-button" src="{__MOBILE_STORE_IMG__}/music_play.png" alt="">
                    </span>
                </p>
                {/loop}
            </li>
            {/loop}
        </ul>
    </div>
    <audio controls="" id="music" style="display: none;">
        <source src="" id="audio-play">
    </audio>
</div>
<script id="regfieldtpl" type="text/html">
    <section class="form_con clearfix addfield" style="margin-top: 0.32rem;">
        <section class="clearfix selectBox txt_item mb24">
            <select name="model[register_field][<%=count%>][Type]" class="font28">
                <option value="text" selected>文本字段</option>
                <option value="number">数字字段</option>
                <option value="radio">单选按钮</option>
                <option value="checkbox">复选按钮</option>
                <option value="select">下拉列表</option>
                <option value="textarea">文本域</option>
            </select>
        </section>
        <section class="clearfix mb24">
            <section class="coordinate_w33 txt_item" style="width: 48%;margin-right:4%">
                <input type="text" name="model[register_field][<%=count%>][Explain]" value="" placeholder="请输入名称" class="form_txt">
            </section>
            <section class="coordinate_w33 txt_item" style="width: 48%;margin-right:0%">
                <input type="text" name="model[register_field][<%=count%>][Name]" value="" placeholder="请输入字段(仅支持英文)" onkeyup="value=value.replace(/[^a-zA-Z]/g,'')" class="form_txt">
            </section>
        </section>
        <section class="clearfix">
            <section class="txt_item add_w fl">
                <input type="text" name="model[register_field][<%=count%>][Tips]" value="" placeholder="请输入提示信息/配置项" class="form_txt">
            </section>
            <section class="select_coordinate ">
                <button class="but_store fr bgRed delfielditem" type="button">删除字段</button>
            </section>
        </section>
    </section>
</script>
<script id="maptpl" type="text/html">
    <section class="form_con clearfix addmap" style="margin-top: 0.32rem;">
        <section class="txt_item">
            <input type="text"  name="model[store_map_list][<%= count %>][name]"  placeholder="请输入门店名称" value=""  class="form_txt">
        </section>
        <section class="clearfix mb24">
            <section class="coordinate_w33 txt_item">
                <input type="text" name="model[store_map_list][<%= count %>][lng]" value="" placeholder="地理经度" class="form_txt">
            </section>
            <section class="coordinate_w33 txt_item">
                <input type="text" name="model[store_map_list][<%= count %>][lat]" value="" placeholder="地理纬度" class="form_txt">
            </section>
            <section class="select_coordinate clickBtn">
                <button class="but_store fr coordinate " type="button">选择坐标</button>
            </section>
        </section>
        <section class="txt_item">
            <input type="text" name="model[store_map_list][<%= count %>][address]" value="" placeholder="请输入详情地址" class="form_txt">
        </section>
        <section class="clearfix">
            <section class="txt_item add_w fl">
                <input type="text" name="model[store_map_list][<%= count %>][tel]" value="" placeholder="请输入电话" class="form_txt">
            </section>
            <section class="select_coordinate ">
                <button class="but_store fr bgRed delmapitem">删除门店</button>
            </section>
        </section>
    </section>
</script>
<script id="bdmaptpl" type="text/html">
    <section class="bgfff">
        <section style=" height:1.6rem;">
            <section class="pd24 map_search clearfix">
                <section class="txt_item w80 fl"> <input  id="txtSearchMap" type="text" placeholder="请输入地址来直接查找相关位置" class="form_txt"></section>
                <section class="w20 fr"><button class="but_search"  id="btnSearchMap">搜索</button></section>
            </section>
        </section>
        <!--这里是地图-->
        <section class=" pd0_24 pd24" id="MapContact" style="width: 100%; box-sizing: border-box"></section>
    </section>
    <section class="buttonFloat"><a href="javascript:;" class="db font32" style="background-color: #fee002;border-radius: 0.6rem;" onclick="closeMap();">确定</a></section>
</script>
<script>
    //初始化日期控件
    var start_time = new LCalendar();
    start_time.init({
        'trigger': '#start_time',
        'type': 'datetime'
    });

    var end_time = new LCalendar();
    end_time.init({
        'trigger': '#end_time',
        'type': 'datetime'
    });

    // 实例化 编辑器
    var artEditor = new Eleditor({
        el: "#contentEditor",
        upload:{
            server: "{php echo $this->createMobileUrl('file',array('act'=>'upload','type'=>'image','thumb'=>0));}",
            formData: {
                'module':"umiacp_bargain",
            },
            accept: {
                title: 'Images',
                extensions: 'gif,jpg,jpeg,bmp,png,webp',
                mimeTypes: 'image/*'
            },
            compress: false,
            fileSizeLimit: 2
        },
    });
    // 初始化编辑器内容
    artEditor.append($("#content").val());
    // 初始化颜色选择器
    $('#bg_color').cxColor();
</script>
<script>
    var selectlng = '';
    var selectlat = '';
    var mapBtn = '';

    function randomString(len) {
    　　len = len || 16;
    　　var $chars = 'ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz';   
    　　var maxPos = $chars.length;
    　　var str = '';
    　　for (i = 0; i < len; i++) {
            str += $chars.charAt(Math.floor(Math.random() * maxPos));
    　　}
    　　return str;
    }
    //添加登记字段选项
    $("#addregfieldbtn").click(function () {
        var fieldcount	= $(".addfield").length;
        var obj = {};
        obj.count = fieldcount;
        var html = template("regfieldtpl",obj);
        $("#FieldList").append(html);
        $("input[name='model[register_field]["+fieldcount+"][Name]']").val(randomString(8));
    });

    //开启多门店添加门店信息
    $("#addmapbtn").click(function () {

        var mapcount	= $(".addmap").length;
        var obj = {};
        obj.count = mapcount;
        var html = template("maptpl",obj);
        $("#StoreList").append(html);
    });

    //删除信息登记字段
    $(document).delegate(".delfielditem", "click", function() {
        var list = $(this).parent().parent().parent().parent();
        $(this).parent().parent().parent().remove();
        list.children(".addfield").each(function (index) {
            $(this).find("[name^='model[']").each(function () {
                var inputName = $(this).attr("name");
                $(this).attr("name", inputName.replace(/\[([\d]+)\]/g, "[" + index + "]"));
            });
        });
    });

    //删除多门店信息
    $(document).delegate(".delmapitem", "click", function() {
        var list = $(this).parent().parent().parent().parent();
        $(this).parent().parent().parent().remove();
        list.children(".addmap").each(function (index) {
            $(this).find("[name^='model[']").each(function () {
                var inputName = $(this).attr("name");
                $(this).attr("name", inputName.replace(/\[([\d]+)\]/g, "[" + index + "]"));
            });
        });
    });

    $(function(){
        require(['{__PLUGIN__}/validform/5.3.2/Validform_v5.3.2_min.js'], function () {
            //为formContent 添加验证事件
            $("#form_content").Validform({
                tiptype: function (msg, o, cssctl) {
                    if (!o.obj.is("form")) {
                        if (o.type == 2) {
                            //loading带文字
                            layer.open({
                                type: 2
                                , content: '数据提交中'
                                , time: 999 //999秒后自动关闭
                            });
                        } else {
                            layer.closeAll();
                            layer.open({
                                content: msg
                                , skin: 'msg'
                                , time: 2 //2秒后自动关闭
                                , style: 'bottom:0;'
                            });
                        }
                    }
                },
                ajaxPost: true,
                tipSweep: true,
                beforeSubmit: function (curform) {
                    //赋值封面图片
                    $("input[name='model[pic_url]']").val($("#pic_url").val());
                    //赋值分享图标
                    $("input[name='model[share_thumb]']").val($("#share_thumb").val());
                    //赋值广告图片
                    $("input[name='model[ads_url]']").val($("#ads_url").val());
                    //赋值编辑器内容
                    $("#content").val(artEditor.getContent());
                    $("#SubmitBtn").attr("disabled", true);
                },
                callback: function (data) {
                    layer.closeAll();
                    if(data.status == 1){
                        layer.open({
                            content: data.msg
                            , skin: 'msg'
                            , time: 2 //2秒后自动关闭
                            , style: 'bottom:0;'
                        });

                        setTimeout(function () {
                            window.location.href = "{php echo $this->createMobileUrl('store.obj_activity',array('act'=>'index'));}";
                        }, 2000);

                    }else{
                        layer.open({
                            content: data.msg
                            , skin: 'msg'
                            , time: 2 //2秒后自动关闭
                            , style: 'bottom:0;'
                        });
                        $("#SubmitBtn").attr("disabled", false);
                    }
                }
            });
        });

        //背景特效弹框处理
        $('.speciaIcon').click(function(){
            $(".specia-win").show();
        });

        $("#specia-sel-ul .effectclass h2").click(function(e) {
            e.stopPropagation();
            $("#specia-sel-ul .effectclass").removeClass("on")
            $(this).parent().addClass("on");
        });

        $("#specia-sel-ul .effectli").click(function(e) {
            e.stopPropagation();
            $("#specia-sel-ul .effectli").removeClass("act")
            $(this).addClass("act");
            init();
        });
        $("#specia-button").click(function() {
            $("#effect_id").val($("#specia-sel-ul .act").data("id"));
            $(".specia-win").hide();
        });
        $("#specia-sel-panel").click(function (e) {
            e.stopPropagation();
        });

        //背景音乐弹框处理
        var audio = document.getElementById('music');
        $('.musicIcon').click(function(){
            $(".music-win").show();
            audio.src = $("#music-sel-ul .act").attr("data-url");
            let playPromise = audio.play()
            if (playPromise !== undefined) {
                playPromise.then(() => {
                    audio.play();
            }).catch(()=> {

                })
            }
        });

        $("#music-sel-ul .musicclass h2").click(function(e) {
            e.stopPropagation();
            $("#music-sel-ul .musicclass").removeClass("on")
            $(this).parent().addClass("on");
        });

        $("#music-sel-ul .musicli").click(function(e) {
            e.stopPropagation();
            $("#music-sel-ul .musicli").removeClass("act")
            $(this).addClass("act");
            audio.pause();
            audio.src = $(this).attr("data-url");
            audio.currentTime = 0;
            let playPromise = audio.play()
            if (playPromise !== undefined) {
                playPromise.then(() => {
                    audio.play();
            }).catch(()=> {

                })
            }
        });

        $("#music-button").click(function() {
            $("#audio_url").val($("#music-sel-ul .act").attr("data-src"));
            $("#audio_id").val($("#music-sel-ul .act").attr("data-id"));
            $(".music-win").hide();
            audio.pause();
        });
        $("#music-sel-panel").click(function (e) {
            e.stopPropagation();
        });

        $('#music_upload').click(function(e){
            e.stopPropagation();
            $('#music_file').click();
        });

        $('#music_file').click(function(e){
            e.stopPropagation();
        });
        $('#music_file').change(function(){
            var filePath=$(this).val();
            var myform = new FormData();
            myform.append('file', $(this)[0].files[0]);

            $.ajax({
                type: "post",
                dataType: "json",
                url: "{php echo $this->createMobileUrl('file',array('act'=>'upload','type'=>'audio'));}",
                data: myform,
                async: false,
                contentType: false,
                processData: false,
                success: function (jsonData, status) {
                    if (jsonData.status == 1) {
                        //赋值上传文件路径
                        $("#music_upload").parent().attr('data-url',jsonData.url);
                        $("#music_upload").parent().attr('data-src',jsonData.attachment);
                        $("#music_upload").prev().html('已上传音乐');
                        $("#music_upload").parent().click()
                        layer.open({
                            content: '上传成功！'
                            ,skin: 'msg'
                            ,time: 2 //2秒后自动关闭
                        });
                    }
                    else {
                        layer.open({
                            content: jsonData.msg
                            ,skin: 'msg'
                            ,time: 2 //2秒后自动关闭
                        });
                    }
                },
                error: function (e) {
                    layer.open({
                        content: '上传失败，请重试！'
                    });
                }
            });

        });

        //一键初始化
        $(".initIcon").click(function(){
            mobile_init();
        });

        $(".switch").click(function(e) {
            if($(this).hasClass("switch_on")){
                $(this).removeClass("switch_on");
                $(this).addClass("switch_off");
                $(this).find("input").val(0);
            }
            else{
                $(this).removeClass("switch_off");
                $(this).addClass("switch_on");
                $(this).find("input").val(1);
            }
        });

        //选择是否短信提醒选项卡
        $('.is_sms').on('click', function (event) {
            var is_sms = $(this).val();
            if(is_sms==0)
            {
                $("#sms_tmp_box").hide();
            }
            else
            {
                $("#sms_tmp_box").show();
            }
        });

        //选择是否开启广告选项卡
        $('.is_show_ads').on('click', function (event) {
            var obj_types = $(this).val();
            if(obj_types==0)
            {
                $(".ads_open_box").hide();
            }
            else
            {
                $(".ads_open_box").show();
            }
        });

        //选择是否开启劫流广告
        $('.is_open_appad').on('click', function (event) {
            var obj_types = $(this).val();
            if(obj_types==0)
            {
                $(".appad_open_box").hide();
            }
            else
            {
                $(".appad_open_box").show();
            }
        });

        //抽奖模式切换
        $('.models').on('click', function (event) {
            var models = $(this).val();
            if(models == 0)
            {
                $(".obj_models_score").hide();
                $(".obj_models_limit").show();
                var is_invite_friend = $('.invite_friend:checked').val();
                if(is_invite_friend==1)
                {
                    $(".invite_limit_box").show();
                }
                else
                {
                    $(".invite_limit_box").hide();
                }
            }
            else
            {
                $(".obj_models_limit").hide();
                $(".obj_models_score").show();
                $(".invite_limit_box").hide();
            }
        });

        //选择开启邀请模式选项卡
        $('.invite_friend').on('change', function (event) {
            var is_invite_friend = $('.invite_friend:checked').val();
            if(is_invite_friend==1)
            {
                $(".invite_limit_box").show();
            }
            else
            {
                $(".invite_limit_box").hide();
            }
        });

        //选择是否轮播头图选项卡
        $('.banner_types').on('click', function (event) {
            var banner_types = $(this).val();
            if(banner_types == 0)
            {
                $("#banner_types0_box").show();
                $("#banner_types1_box").hide();
                $("#single_banner").hide();
                $("#multi_banner").show();
                setMultiBanner();
                //$("body").attr("style","{$tmpModel['body_style']}");
            }
            else
            {
                $("#banner_types0_box").hide();
                $("#banner_types1_box").show();
                $("#single_banner").show();
                $("#multi_banner").hide();
                //$("body").css("background-image","");
            }
        });
        //选择是否信息登记选项卡
        $('.is_register').on('click', function (event) {
            var is_register = $(this).val();
            if(is_register==0)
            {
                $("#FieldList").hide();
                $("#FieldExp").hide();
            }
            else
            {
                $("#FieldList").show();
                $("#FieldExp").show();
            }
        });

        //点击折叠编辑选项
        //$(".objbox ul").hide();
        $(".objbox .title").click(function () {
            if($(this).next().is(':hidden')){
                $(this).find("span").text("-折叠");
                $(this).next().show();
            }else{
                $(this).find("span").text("+展开");
                $(this).next().hide();
            }
        })

        //地理位置拾取器
        $('#StoreList').on('click','.coordinate',function(){
            mapBtn = $(this);
            var lng = parseFloat(mapBtn.parent().prev().prev().find(":text").val());
            var lat = parseFloat(mapBtn.parent().prev().find(":text").val());

            selectlng = lng;
            selectlat = lat;

            var html = template("bdmaptpl", []);
            layer.open({
                type: 1
                ,content: html
                ,anim: 'up'
                ,style: 'position:fixed; left:0; top:0; width:100%; height:100%;overflow:auto;background-color: #F2F2F2; border: none; -webkit-animation-duration: .5s; animation-duration: .5s;'
            });

            var MapHeight = window.screen.height - $(".map_search").parent().height() - $(".buttonFloat").height();
            var map = new BMap.Map("MapContact");
            $("#MapContact").css('height', MapHeight+'px');
            var localpoint;
            if (isNaN(lng)) {
                localpoint = new BMap.Point(116.403119, 39.912943);
            } else {
                localpoint = new BMap.Point(lng, lat);
            }
            map.centerAndZoom(localpoint, 13);
            addMarker(localpoint);
            map.addControl(new BMap.ScaleControl());
            map.addControl(new BMap.OverviewMapControl());
            map.addControl(new BMap.MapTypeControl());
            map.enableScrollWheelZoom();
            var opts = { type: BMAP_NAVIGATION_CONTROL_SMALL }
            map.addControl(new BMap.NavigationControl(opts));

            var xArr = [];//存放横坐标
            var yArr = [];//存放纵坐标

            map.addEventListener("touchstart", function (e) {
                //手指触摸屏幕的时候清空两个数组
                xArr.length = 0;
                yArr.length = 0;
            });

            map.addEventListener("touchmove",function(e){
                //如果滑动了屏幕，xArr和yArr将各存入两个坐标值，即始末坐标值
                xArr.push(e.targetTouches[0].pageX);
                yArr.push(e.targetTouches[0].pageY);
            });

            map.addEventListener("touchend", function (e) {
                var far;
                var flag = true;
                //计算平移距离，区分滑动事件和点击事件
                if((xArr.length > 1) && (yArr.length > 1)){
                    far = (Math.abs(xArr[0]-xArr[1]))^2 + (Math.abs(yArr[0]-yArr[1]))^2;
                    if(far > 0){
                        flag = false;
                    }
                }
                if(flag){
                    var point = new BMap.Point(e.point.lng, e.point.lat);
                    selectlng = e.point.lng;
                    selectlat = e.point.lat;
                    addMarker(point);
                }
            });

            var loadCount = 1;
            map.addEventListener("tilesloaded",function(){
                if(loadCount == 1){
                    map.setCenter(new BMap.Point(selectlng, selectlat));
                }
                loadCount = loadCount + 1;
            });

            function addMarker(point) {
                var myIcon = new BMap.Icon("http://api.map.baidu.com/img/markers.png", new BMap.Size(23, 25), {
                    anchor: new BMap.Size(10, 30),
                    offset: new BMap.Size(10, 25),
                    imageOffset: new BMap.Size(0, 0)
                });
                var marker = new BMap.Marker(point);
                map.clearOverlays();
                map.addOverlay(marker);
            }

            $(document).on("click", "#btnSearchMap", function(){
                var LocalSearch = new BMap.LocalSearch(map, {
                    renderOptions: { map: map }
                });
                LocalSearch.search($("#txtSearchMap").val());
                LocalSearch.setSearchCompleteCallback(function () {
                    var item = LocalSearch.getResults();
                    selectlng = item.getPoi(0).point.lng;
                    selectlat = item.getPoi(0).point.lat;
                });
            });

            scroll.afterOpen();
            //清空浏览器历史记录
            window.history.pushState({title: "title",url:"#"}, "title", "#");
            //监听浏览器后退事件
            window.addEventListener("popstate",
                function(e) {
                    //后退关闭弹窗赋值
                    closeMap(mapBtn);
                }, false);
        });

        /*{if $model['banner_types']==0}*/
        $("#single_banner").hide();
        $("#multi_banner").show();
        //$("body").attr("style","{$tmpModel['body_style']}");
        /*{else}*/
        $("#single_banner").show();
        $("#multi_banner").hide();
        //$("body").css("background-image","");
        /*{/if}*/

        setMultiBanner();
        setSingleBanner();

        $('#banner_types0_box .mui-pull-left').on('DOMNodeInserted DOMNodeRemoved',function(){
            setMultiBanner();
        });

        $('#banner_types1_box .mui-pull-left').on('DOMNodeInserted DOMNodeRemoved',function(){
            setSingleBanner();
        });
    });

    function setMultiBanner()
    {
        require(['jquery.flexslider'], function () {
            $("#home_slider").before('<section id="home_slider_tmp" class="flexslider"><ul class="slides"></ul></section>');
            $("#home_slider").remove();
            $("#banner_types0_box img").each(function(){
                $("#home_slider_tmp ul").append('<li> <section class="slide"><img src="'+ $(this).attr('src') +'" alt=""/> </section> </li>')
            });
            $('#home_slider_tmp').flexslider({
                animation : 'slide',
                controlNav : true,
                directionNav : true,
                animationLoop : true,
                slideshow : true,
                slideshowSpeed : 3000,
                useCSS : false,
                autoPlay:true,
            });
            $('#home_slider_tmp').attr('id','home_slider');
        });
    }

    function setSingleBanner()
    {
        $("#single_banner").empty();
        $("#single_banner").html('<img src="'+ $("#banner_types1_box img").attr('src') +'" width="100%">');
    }

    //关闭关闭弹窗
    function closeMap(){
        layer.closeAll();
        scroll.beforeClose();
        mapBtn.parent().prev().prev().find(":text").val(selectlng);
        mapBtn.parent().prev().find(":text").val(selectlat);
    }

    //解决滚动弹窗滚动穿透
    // scroll.afterOpen 锁定
    // scroll.beforeClose 解锁
    var scroll = (function (className) {
        var scrollTop;
        return {
            afterOpen: function () {
                if(document.scrollingElement){
                    scrollTop = document.scrollingElement.scrollTop
                }
                else{
                    scrollTop = document.body.scrollTop;
                }
                document.body.classList.add(className);
                document.body.style.top = -scrollTop + 'px';
            },
            beforeClose: function () {
                document.body.classList.remove(className);
                if(document.scrollingElement){
                    document.scrollingElement.scrollTop = scrollTop;
                }
                document.body.scrollTop = scrollTop;
            }
        };
    })('scroll');
    //光标处插入指定文本内容
    function insertAtCursor(text, obj) {
        var myField = document.getElementById(text);
        var myValue = obj.innerHTML;
        if (document.selection) {
            //IE support
            myField.focus();
            sel = document.selection.createRange();
            sel.text = myValue;
            sel.select();
        } else if (myField.selectionStart || myField.selectionStart == '0') {
            //MOZILLA/NETSCAPE support
            var startPos = myField.selectionStart;
            var endPos = myField.selectionEnd;
            var beforeValue = myField.value.substring(0, startPos);
            var afterValue = myField.value.substring(endPos, myField.value.length);

            myField.value = beforeValue + myValue + afterValue;

            myField.selectionStart = startPos + myValue.length;
            myField.selectionEnd = startPos + myValue.length;
            myField.focus();
        } else {
            myField.value += myValue;
            myField.focus();
        }
    }

    const NUMBER_OF_LEAVES = 10;
    const width=window.screen.width;
    function init(){
        var picList = $("#specia-sel-ul .act").data("pic").split(',');
        var container = document.getElementById('leafContainer');
        $("#leafContainer").empty();
        for (var i = 0; i < NUMBER_OF_LEAVES; i++)
        {
            container.appendChild(createALeaf(picList));
        }
    }
    function randomInteger(low, high)
    {
        return low + Math.floor(Math.random() * (high - low));
    }
    function randomFloat(low, high)
    {
        return low + Math.random() * (high - low);
    }
    function pixelValue(value)
    {
        return value + 'px';
    }

    function durationValue(value)
    {
        return value + 's';
    }
    function createALeaf(effects_imgs)
    {
        var leafDiv = document.createElement('div');
        var image = document.createElement('img');
        image.src = effects_imgs[randomInteger(0, effects_imgs.length)];
        leafDiv.style.top = "-10px";
        leafDiv.style.left = pixelValue(randomInteger(0, width));
        var spinAnimationName = (Math.random() < 1.5) ? 'clockwiseSpin' : 'counterclockwiseSpinAndFlip';
        leafDiv.style.webkitAnimationName = 'fade, drop';
        image.style.webkitAnimationName = spinAnimationName;
        var fadeAndDropDuration = durationValue(randomFloat(6, 12));
        var spinDuration = durationValue(randomFloat(3, 7));
        leafDiv.style.webkitAnimationDuration = fadeAndDropDuration + ', ' + fadeAndDropDuration;
        var leafDelay = durationValue(randomFloat(0, 0));
        leafDiv.style.webkitAnimationDelay = leafDelay + ', ' + leafDelay;
        image.style.webkitAnimationDuration = spinDuration;
        leafDiv.appendChild(image);
        return leafDiv;

    }
</script>
</body>
</html>
