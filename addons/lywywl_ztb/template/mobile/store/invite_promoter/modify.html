<!doctype html>
<html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0">
<meta name = "format-detection" content ="telephone=no">
<meta http-equiv="Cache-Control" content="no-cache" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<title>{$title} - {$config['name']}</title>
<link rel="stylesheet" type="text/css" href="{__MOBILE_STORE_CSS__}/base.css">
<link rel="stylesheet" type="text/css" href="{__MOBILE_STORE_CSS__}/index.css?v=20191120">
<!-- 解决引用mui时ios输入框失去焦点页面跳到顶部问题 -->
<style type="text/css">
    body{overflow: scroll; -webkit-overflow-scrolling: touch;}
</style>
<!-- 移动端适配 -->
<script>
    var html = document.querySelector('html');
    changeRem();
    window.addEventListener('resize', changeRem);
    function changeRem() {
        var width = html.getBoundingClientRect().width;
        html.style.fontSize = width / 10 + 'px';
    }
</script>
<script src="{__MOBILE_STORE_JS__}/jquery-2.1.4.min.js"></script>
<script src="{__PLUGIN__}/layer/mobile/2.0/layer.js"></script>
<script src="https://res.wx.qq.com/open/js/jweixin-1.6.0.js"></script>
<script>
    // jssdk config 对象
    jssdkconfig = {php echo json_encode($_W['account']['jssdkconfig']);} || {};
    // 是否启用调试
    jssdkconfig.debug = false;
    jssdkconfig.jsApiList = [
        'checkJsApi',
        'updateAppMessageShareData',
        'updateTimelineShareData',
        'onMenuShareTimeline',
        'onMenuShareAppMessage',
        'onMenuShareQQ',
        'onMenuShareWeibo',
        'getLocation',
        'hideAllNonBaseMenuItem',
        'showAllNonBaseMenuItem',
        'hideMenuItems'
    ];
    wx.config(jssdkconfig);
    wx.error(function (res) {
        layer.open({ content: '对不起，微信JSSDK信息验证失败！', skin: 'msg', time: 2 });
    });
    wx.ready(function () {
        var title = "{$_share['title']}";
        var imgUrl = "{$_share['imgUrl']}";
        var link = "{$_share['link']}";
        var desc = "{$_share['desc']}";

        if (wx.onMenuShareTimeline) {
            //转发到朋友圈
            wx.onMenuShareTimeline({
                title: title,
                desc: desc,
                link: link,
                imgUrl: imgUrl,
                success: function () {

                },
                cancel: function () {
                    layer.open({ content: '对不起，转发失败请重试！', skin: 'msg', time: 2 });
                }
            });
            //转发给朋友
            wx.onMenuShareAppMessage({
                title: title,
                desc: desc,
                link: link,
                imgUrl: imgUrl,
                type: 'link',
                dataUrl: '',
                success: function () {

                },
                cancel: function () {
                    layer.open({ content: '对不起，转发失败请重试！', skin: 'msg', time: 2 });
                }
            });
            wx.onMenuShareQQ({
                title: title, // 分享标题
                desc: desc, // 分享描述
                link: link, // 分享链接
                imgUrl: imgUrl, // 分享图标
                success: function () {

                },
                cancel: function () {
                    layer.open({ content: '对不起，转发失败请重试！', skin: 'msg', time: 2 });
                }
            });
            wx.onMenuShareWeibo({
                title: title, // 分享标题
                desc: desc, // 分享描述
                link: link, // 分享链接
                imgUrl: imgUrl, // 分享图标
                success: function () {

                },
                cancel: function () {
                    layer.open({ content: '对不起，转发失败请重试！', skin: 'msg', time: 2 });
                }
            });
        }
        else{
            //新版发送朋友圈
            wx.updateTimelineShareData({
                title: title, // 分享标题
                link: link, // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致
                imgUrl: imgUrl, // 分享图标
            }, function(res) {

            });
            wx.updateAppMessageShareData({
                title: title, // 分享标题
                desc: desc, // 分享描述
                link: link, // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致
                imgUrl: imgUrl, // 分享图标
            }, function(res) {

            });
        }
    });
</script>
<link rel="stylesheet" href="{__PLUGIN__}/validform/5.3.2/Validform.css">
<link href="{MODULE_URL}resource/mobile/plugin/css/common.min.css?v=20170802" rel="stylesheet">
<script type="text/javascript" src="{MODULE_URL}resource/mobile/plugin/js/app/util.js"></script>
<script src="{MODULE_URL}resource/mobile/plugin/js/require.js"></script>
<script type="text/javascript" src="{MODULE_URL}resource/mobile/plugin/js//lib/mui.min.js"></script>
<script type="text/javascript" src="{MODULE_URL}resource/mobile/plugin/js/app/common.js"></script>
<body class="bgf2">
<form action="{php echo $this->createMobileUrl('store.invite_promoter',array('act'=>'modify'));}" id="store_form" method="post">
    <!--中心区域-->
    <section class="toux tc">
        {php echo tpl_app_form_field_avatar('avatar', $model['headurl']);}
        <p class="font28 black">OPENID：{$model['openid']}</p>
    </section>
    <ul class="edit">
        <li><span>成员名称</span><section><input class="editInput" type="text" datatype="*" id="name" name="model[name]" value="{$model['name']}" nullmsg="请输入团队成员名称！" placeholder="请输入团队成员名称"></section></li>
        <li><span>手机号码</span><section><input class="editInput"  type="tel" datatype="m" id="mobile" maxlength="11" name="model[mobile]" value="{$model['mobile']}" nullmsg="请输入成员手机号码！" placeholder="请输入成员手机号码"></section></li>
        <li><span>资金结算</span>
            <section>
                <input type="hidden" name="model[status]" id="status" value="{$model['status']}">
                <span class="switch switchstatus {php echo $model['status']==1?"switch_on":"switch_off"}" style="position:relative; vertical-align:middle; left:0"><i class="slider"></i></span>
            </section>
        </li>
        <li><span>分成比例</span><section><input class="editInput" type="text" datatype="n" id="royalty" name="model[royalty]" value="{$model['royalty']}" nullmsg="请输入分销员分成比例！" placeholder="请输入分销员分成比例" onkeyup="if(isNaN(this.value) || this.value==''){this.value='100';}else{this.value>100?this.value='100':this.value}"></section></li>

        <li><span>结算说明</span>
            <section class="font26 c9 lh15" style="padding-top: 5px;">
                选择开启结算后该业务员下线商家消费后，资金将直接结算至该业务员微信钱包。
            </section>
        </li>
    </ul>
    <section class="btn-de">
        <input id="id" name="id" type="hidden" value="{$model['id']}"/>
        <input name="token" value="{$_W['token']}" type="hidden" />
        <input type="hidden" name="submit" value="submit"/>
        <button type="submit" class="Button" id="SubmitBtn">保存</button>
    </section>
</form>
<script>
    $(function () {
        //ios开关
        $(".switchstatus").click(function(e) {
            if($(this).hasClass("switch_on")){
                $(this).removeClass("switch_on");
                $(this).addClass("switch_off");
                $("#status").val(0);
            }
            else{
                $(this).removeClass("switch_off");
                $(this).addClass("switch_on");
                $("#status").val(1);
            }
        });

        $(".switchmanager").click(function(e) {
            if($(this).hasClass("switch_on")){
                $(this).removeClass("switch_on");
                $(this).addClass("switch_off");
                $("#is_manager").val(0);
            }
            else{
                $(this).removeClass("switch_off");
                $(this).addClass("switch_on");
                $("#is_manager").val(1);
            }
        });

        require(['{__PLUGIN__}/validform/5.3.2/Validform_v5.3.2_min.js'], function () {
            //为formContent 添加验证事件
            $("#store_form").Validform({
                tiptype: function (msg, o, cssctl) {
                    if (!o.obj.is("form")) {
                        if (o.type == 2) {
                            //loading带文字
                            layer.open({
                                type: 2
                                , content: '数据提交中'
                                , time: 999 //999秒后自动关闭
                            });
                        } else {
                            layer.closeAll();
                            layer.open({
                                content: msg
                                , skin: 'msg'
                                , time: 2 //2秒后自动关闭
                                , style: 'bottom:0;'
                            });
                        }
                    }
                },
                ajaxPost: true,
                tipSweep: true,
                beforeSubmit: function (curform) {
                    $("#SubmitBtn").attr("disabled", true);
                },
                callback: function (data) {
                    layer.closeAll();
                    if(data.status == 1){
                        layer.open({
                            content: data.msg
                            , skin: 'msg'
                            , time: 2 //2秒后自动关闭
                            , style: 'bottom:0;'
                        });

                        if (data.type == 1) {
                            setTimeout(function () {
                                window.location.href = "{php echo $this->createMobileUrl('store.invite_promoter', array('act' => 'index'));}";
                            }, 2000);
                        } else {
                            setTimeout(function () {
                                window.location.reload();
                            }, 2000);
                        }

                    }else{
                        layer.open({
                            content: data.msg
                            , skin: 'msg'
                            , time: 2 //2秒后自动关闭
                            , style: 'bottom:0;'
                        });
                        $("#SubmitBtn").attr("disabled", false);
                    }
                }
            });
        });
    });
</script>
</body>
</html>