<?php
 goto Dmocl; mTpDp: $xcmodule = 'xc_beauty'; goto MSK7o; rvEvS: global $xcmodule, $xcconfig, $xcurl; goto mTpDp; jINYT: $xcconfig = array(); goto CNYkF; MSK7o: include_once IA_ROOT . '/addons/' . $xcmodule . '/common/function.php'; goto jINYT; Dmocl: defined('IN_IA') or exit('Access Denied'); goto rvEvS; CNYkF: class xc_beautyModuleSite extends WeModuleSite { protected function createWebUrl($do, $query = array()) { goto SKLcJ; lCCi1: return wurl('site/entry', $query); goto mYW8U; ufjTZ: $query['m'] = strtolower($this->modulename); goto sOi0A; sOi0A: $query['version_id'] = intval($_GPC['version_id']); goto lCCi1; w6S0z: $query['do'] = $do; goto ufjTZ; SKLcJ: global $_GPC; goto w6S0z; mYW8U: } public function doWebExport() { goto BYWER; PXg9V: S6KCD: goto e4qq2; MD2Rz: if (!$member) { goto Iv4UI; } goto qVp9v; mv1VE: uYGc5: goto Yr9PX; LpbaC: if (!$service) { goto O6zEd; } goto E4ct2; kmaTl: $condition['order_type'] = 1; goto lJS6T; l757A: HIu4d: goto u9aWX; dteW2: goto ExzbB; goto MX2Hz; Onc3c: $condition['out_trade_no LIKE'] = '%' . $_GPC['out_trade_no'] . '%'; goto KD3ar; Q6MgR: $user_list = array(); goto NMlIr; JKU3E: header('Content-Disposition: attachment; filename=order.xls'); goto vGrml; E4ct2: foreach ($service as $x2) { $datalist[$x2['id']] = $x2; uXJN8: } goto ag76Y; iuPgu: ccxrB: goto nVxre; AebRZ: $condition['createtime <='] = $times['end'] . ' 23:59:59'; goto PXg9V; aEzBF: if (!$store) { goto HIu4d; } goto upWWc; e4qq2: $order = pdo_getall('xc_beauty_order', $condition, array(), '', 'createtime DESC'); goto LO4N_; MX2Hz: CBopr: goto s5DcG; jLbsJ: $condition['store'] = $_GPC['store_id']; goto TeDPz; vGrml: $data = '<tr>'; goto VHjsZ; J1qVG: Iv4UI: goto q_xdv; T9f9W: EKvOZ: goto l757A; nVxre: if (empty($_GPC['content'])) { goto DUOMS; } goto h343S; bXo78: $data = '<table border=\'1\'>' . $data . '</table>'; goto dOOZV; D4_Uw: $datalist = array(); goto LpbaC; sSJnt: $condition['createtime >='] = $times['start'] . ' 00:00:00'; goto AebRZ; LO4N_: if ($order) { goto CBopr; } goto BKcfs; PUZ1h: $member_list = array(); goto MD2Rz; NMlIr: if (!$user) { goto IrMHa; } goto gYAMf; r8uMg: $times = $_GPC['times']; goto sSJnt; wRPYe: iHRLU: goto C2QCE; ag76Y: SxMCL: goto O3pGl; KORja: qkAPl: goto A9ZMS; fIC13: $member = pdo_getall('xc_beauty_store_member', array("uniacid" => $uniacid)); goto PUZ1h; gYAMf: foreach ($user as $u) { goto R1DLv; A3fY3: kvC_i: goto EiuK1; ZJV0C: $user_list[$u['openid']] = $u; goto A3fY3; R1DLv: $u['nick'] = base64_decode($u['nick']); goto ZJV0C; EiuK1: } goto hGw1f; KD3ar: o6j47: goto ks9pS; vSZmJ: $condition['openid LIKE'] = '%' . $_GPC['openid'] . '%'; goto KORja; Yr9PX: if (empty($_GPC['store_id'])) { goto IJiwS; } goto jLbsJ; q_xdv: $user = pdo_getall('xc_beauty_userinfo', array("uniacid" => $uniacid)); goto Q6MgR; TeDPz: IJiwS: goto vgDsz; Tj9ZJ: DUOMS: goto phq2q; rxzLR: $store_list = array(); goto aEzBF; phq2q: if (empty($_GPC['pay_type'])) { goto uYGc5; } goto GxG_Y; EOstu: F35zU: goto bXo78; ks9pS: if (empty($_GPC['openid'])) { goto qkAPl; } goto vSZmJ; A9ZMS: if (empty($_GPC['use'])) { goto ccxrB; } goto F57TH; JZIlj: $uniacid = $_W['uniacid']; goto KN0Za; F57TH: $condition['use'] = $_GPC['use']; goto iuPgu; O3pGl: O6zEd: goto fIC13; tkuek: $condition['status'] = 1; goto kmaTl; vgDsz: if (empty($_GPC['times'])) { goto S6KCD; } goto r8uMg; BYWER: global $_GPC, $_W; goto JZIlj; oe5El: $xc = json_decode($xc, true); goto tkuek; h343S: $condition['userinfo LIKE'] = '%' . $_GPC['content'] . '%'; goto Tj9ZJ; dsWzy: IrMHa: goto Y1A2n; Y1A2n: header('Content-type: application/vnd.ms-excel; charset=utf8'); goto JKU3E; GxG_Y: $condition['pay_type'] = $_GPC['pay_type']; goto mv1VE; C2QCE: $data .= '</tr>'; goto Bj2Xu; BKcfs: echo '无订单记录'; goto dteW2; KN0Za: $xc = htmlspecialchars_decode($_GPC['xc']); goto oe5El; VHjsZ: foreach ($xc as $x) { goto W3jqo; yB2gY: kNHy5: goto WJ7_Z; W3jqo: if (!($x['status'] == 1)) { goto wKFbv; } goto pv1NJ; dA4YC: wKFbv: goto yB2gY; pv1NJ: $data .= '<th>' . $x['name'] . '</th>'; goto dA4YC; WJ7_Z: } goto wRPYe; qVp9v: foreach ($member as $m) { $member_list[$m['id']] = $m; EgjQU: } goto JfOkf; u9aWX: $service = pdo_getall('xc_beauty_service', array("uniacid" => $uniacid)); goto D4_Uw; JfOkf: fuDVa: goto J1qVG; hGw1f: KVxd_: goto dsWzy; Bj2Xu: foreach ($order as &$v) { goto Zr5sl; fJAZk: if (empty($v['two_openid'])) { goto lf0Ar; } goto X7yGC; sdOWx: $v['store_name'] = $store_list[$v['store']]['name']; goto lKSDp; Loagi: goto oeUTM; goto SGaAl; x27SX: foreach ($xc as $x) { goto Y9Hu4; c0yf5: $data .= '<td style=\'vnd.ms-excel.numberformat:@\'>' . $v[$x['key']] . '</td>'; goto zjeAR; HW82l: Jvmcc: goto AgHwW; aFbq4: if ($x['key'] == 'name' || $x['key'] == 'mobile' || $x['key'] == 'address') { goto GbySD; } goto c0yf5; Bxfrv: $data .= '<td style=\'vnd.ms-excel.numberformat:@\'>' . $v['userinfo'][$x['key']] . '</td>'; goto HW82l; AgHwW: y0A4Q: goto XN7Ij; YmOLt: GbySD: goto Bxfrv; zjeAR: goto Jvmcc; goto YmOLt; Y9Hu4: if (!($x['status'] == 1)) { goto y0A4Q; } goto aFbq4; XN7Ij: F8KZY: goto MApxA; MApxA: } goto VmHEo; x2TiC: yWfGg: goto E4mXo; SZUrJ: if (!($v['status'] == -1)) { goto RJ8n0; } goto CsfP8; Yk3cE: $data = $data . '<tr>'; goto x27SX; XQN2N: $v['three_openid_nick'] = $user_list[$v['three_openid']]['nick']; goto Rt4DR; Np7t0: RJ8n0: goto IPAiD; cGQpd: Z5vMl: goto p4CUD; rcTvc: $v['status_name'] = '未退款'; goto Loagi; cFDsp: mqjLT: goto uQ5PG; Cc4OZ: LVv8_: goto VMd8z; VMd8z: goto gL5B_; goto I3GQ_; uQ5PG: if ($v['use'] == 1) { goto mjztT; } goto VUY1Z; XmCQl: L2vI1: goto lUaYQ; gZbfI: if ($v['status'] == 1) { goto mqjLT; } goto u8_Yb; Rt4DR: GEKyV: goto gZbfI; p4CUD: if ($v['refund_status'] == 1) { goto stCeZ; } goto rcTvc; pBKsq: EU2PT: goto Yk3cE; QJAHQ: $v['pay_name'] = '微信支付'; goto fTvcU; OC3AP: $v['one_openid_nick'] = $user_list[$v['one_openid']]['nick']; goto WEZDg; xpSgt: PjbBH: goto pBKsq; IPAiD: goto yWfGg; goto cGQpd; XULta: $v['service'] = $datalist[$v['pid']]['name']; goto fYHT7; CUypn: $v['status_name'] = '已使用'; goto xpSgt; xg8k3: $v['pay_name'] = '余额支付'; goto Cc4OZ; CsfP8: $v['status_name'] = '未支付'; goto Np7t0; fTvcU: gL5B_: goto XULta; I3GQ_: Z0nCy: goto QJAHQ; VUY1Z: $v['status_name'] = '未使用(' . $v['is_use'] . '/' . $v['can_use'] . ')'; goto lqUEx; IXnhG: mjztT: goto CUypn; VmHEo: SuVUF: goto vyby3; rBmHQ: lf0Ar: goto R7Uf_; R7Uf_: if (empty($v['three_openid'])) { goto GEKyV; } goto XQN2N; WEZDg: SKh9m: goto fJAZk; X7yGC: $v['two_openid_nick'] = $user_list[$v['two_openid']]['nick']; goto rBmHQ; u8_Yb: if ($v['status'] == 2) { goto Z5vMl; } goto SZUrJ; Zr5sl: if ($v['pay_type'] == 1) { goto Z0nCy; } goto vvCaM; vyby3: $data = $data . '</tr>'; goto XmCQl; fYHT7: $v['userinfo'] = json_decode($v['userinfo'], true); goto sdOWx; lnxlh: oeUTM: goto x2TiC; E4mXo: goto EU2PT; goto cFDsp; lKSDp: $v['member_name'] = $member_list[$v['member']]['name']; goto pGnbR; SGaAl: stCeZ: goto At8d3; At8d3: $v['status_name'] = '已退款'; goto lnxlh; lqUEx: goto PjbBH; goto IXnhG; pGnbR: if (empty($v['one_openid'])) { goto SKh9m; } goto OC3AP; vvCaM: if (!($v['pay_type'] == 2)) { goto LVv8_; } goto xg8k3; lUaYQ: } goto EOstu; c1tuo: if (empty($_GPC['out_trade_no'])) { goto o6j47; } goto Onc3c; dOOZV: echo iconv('UTF-8', 'GBK//TRANSLIT', $data . '	'); goto XjNzD; XjNzD: ExzbB: goto ADb0L; lJS6T: $condition['uniacid'] = $uniacid; goto c1tuo; s5DcG: $store = pdo_getall('xc_beauty_store', array("uniacid" => $uniacid), array(), '', 'sort DESC,createtime DESC'); goto rxzLR; upWWc: foreach ($store as $s) { $store_list[$s['id']] = $s; ilBUc: } goto T9f9W; ADb0L: } public function doWebExport2() { goto VKTev; lqvgd: J9KPH: goto WuWDo; WCM1P: goto Xx_ty; goto G0Y5V; k2D8C: echo '无订单记录'; goto WCM1P; MSJ9n: $uniacid = $_W['uniacid']; goto mVHlj; ZNKPd: ez6Xc: goto hD1Vb; tVvVL: foreach ($group as $g) { $group_id[] = $g['id']; OugU4: } goto xs3Qc; AlfdS: foreach ($order as $v) { goto sLpqI; Xx8JU: goto n0N3k; goto Y_6dZ; VtxzB: $data = $data . '<td>' . $v['o_amount'] . '</td>'; goto Af2HF; vCC8h: $data = $data . '<td style=\'vnd.ms-excel.numberformat:@\'>' . $v['pay_name'] . '</td>'; goto PX2HO; xnt1f: $data = $data . '<tr>'; goto pkfJA; NY6CJ: $data = $data . '<td>' . $v['coupon_price'] . '</td>'; goto d_FSQ; Enr62: $data = $data . '<td>' . $v['userinfo']['address'] . '</td>'; goto Lt1uI; xB4gz: $data = $data . '</tr>'; goto ubT4g; pkfJA: $data = $data . '<td style=\'vnd.ms-excel.numberformat:@\'>' . $v['out_trade_no'] . '</td>'; goto vCC8h; GWJXF: $v['pay_name'] = '微信支付'; goto M2OnP; Klvh8: if (!($v['pay_type'] == 2)) { goto MZEKE; } goto GWJXF; Af2HF: $data = $data . '<td>' . $v['total'] . '</td>'; goto ltNZU; PX2HO: $data = $data . '<td>' . $v['service'] . '</td>'; goto NY6CJ; ltNZU: $data = $data . '<td>' . $v['userinfo']['name'] . '</td>'; goto qJhG5; qJhG5: $data = $data . '<td>' . $v['userinfo']['mobile'] . '</td>'; goto Enr62; QEZ8J: n0N3k: goto xnt1f; sLpqI: if ($v['pay_type'] == 1) { goto Z3jrQ; } goto Klvh8; d_FSQ: $data = $data . '<td>' . $v['amount'] . '</td>'; goto VtxzB; Lt1uI: $data = $data . '<td>' . $v['plan_date'] . '</td>'; goto IkOMe; Y_6dZ: Z3jrQ: goto qx1UF; M2OnP: MZEKE: goto Xx8JU; IkOMe: $data = $data . '<td>' . $v['content'] . '</td>'; goto xB4gz; qx1UF: $v['pay_name'] = '余额支付'; goto QEZ8J; ubT4g: GdR0A: goto Aj2hV; Aj2hV: } goto ZNKPd; wT97T: $service = pdo_getall('xc_beauty_service', array("uniacid" => $uniacid)); goto had3I; c7HnE: $order = pdo_getall('xc_beauty_order', array("status" => 1, "uniacid" => $uniacid, "order_type" => 3, "group IN" => $group_id), array(), '', 'createtime DESC'); goto GJMMs; hD1Vb: $data = '<table border=\'1\'>' . $data . '</table>'; goto bojrU; o_SE1: foreach ($service as $x2) { $datalist[$x2['id']] = $x2; gwExJ: } goto hi8VZ; p_YBs: WPVYs: goto FVvVF; G0Y5V: WBMSg: goto wT97T; FVvVF: foreach ($order as &$x) { goto X4iyW; hAkk4: eiMid: goto Y_E4z; sWq_r: $x['userinfo'] = json_decode($x['userinfo'], true); goto hAkk4; X4iyW: $x['service'] = $datalist[$x['pid']]['name']; goto sWq_r; Y_E4z: } goto lqvgd; mVHlj: $group_id = array(); goto G95nI; VKTev: global $_GPC, $_W; goto MSJ9n; xs3Qc: Nn_ya: goto HqUln; WuWDo: header('Content-type: application/vnd.ms-excel; charset=utf8'); goto UrYMi; hi8VZ: G4ThM: goto p_YBs; had3I: $datalist = array(); goto Ml1qj; OWwh3: $data = '<tr><th>订单号</th><th>订单支付方式</th><th>服务项目</th><th>优惠（元）</th><th>应付款（元）</th><th>实付款（元）</th><th>总件数</th><th>姓名</th><th>手机号</th><th>地址</th><th>日期</th><th>备注</th></tr>'; goto AlfdS; Ml1qj: if (!$service) { goto WPVYs; } goto o_SE1; NSGlu: Xx_ty: goto B2YDW; d0QcL: if (!$group) { goto q_gPV; } goto tVvVL; G95nI: $group = pdo_getall('xc_beauty_group', array("status" => 1, "uniacid" => $uniacid)); goto d0QcL; HqUln: q_gPV: goto c7HnE; UrYMi: header('Content-Disposition: attachment; filename=order.xls'); goto OWwh3; bojrU: echo iconv('UTF-8', 'GBK//TRANSLIT', $data . '	'); goto NSGlu; GJMMs: if ($order) { goto WBMSg; } goto k2D8C; B2YDW: } public function doWebExport3() { goto ERalT; S_VtE: if (empty($_GPC['use'])) { goto sWo9h; } goto hACRf; gRJbR: NHpbu: goto wIdki; l9Ki_: $condition['pay_type'] = $_GPC['pay_type']; goto sjleI; efTxC: $order = pdo_getall('xc_beauty_order', $condition, array(), '', 'createtime DESC'); goto QH02y; FhUib: if (!$member) { goto YaQed; } goto mk3JY; ERalT: global $_GPC, $_W; goto N9jaQ; U3yBj: if (empty($_GPC['out_trade_no'])) { goto IxVfd; } goto bX5wQ; Z5lpc: x32l3: goto V88Ar; t9txM: $condition['userinfo LIKE'] = '%' . $_GPC['content'] . '%'; goto GQxJu; Q2lqm: f2RuW: goto Za9YX; McoQJ: BZ2Pe: goto KHCVp; kJcHv: $condition['uniacid'] = $uniacid; goto U3yBj; lgkq4: foreach ($service as $x2) { $datalist[$x2['id']] = $x2; b_38S: } goto E_IOV; Ljg7x: $datalist = array(); goto pdS3f; QoYbf: $data .= '</tr>'; goto JOiga; GQxJu: ow7ET: goto rNOfO; sjleI: jI3rJ: goto cjDUM; bkNXp: $condition['status'] = 1; goto veBLY; wxTPF: IrSCn: goto z34_o; wpR8X: foreach ($xc as $x) { goto lHIfe; lHIfe: if (!($x['status'] == 1)) { goto qKEZQ; } goto I2xHg; I2xHg: $data .= '<th>' . $x['name'] . '</th>'; goto sEUlH; O8PO4: qvKsq: goto HX83W; sEUlH: qKEZQ: goto O8PO4; HX83W: } goto Z2Ebp; hM1dd: IxVfd: goto fVp4A; JOiga: foreach ($order as $v) { goto NaQDK; mt30Z: g0n3M: goto Cy7uV; KuYjh: if ($v['status'] == 2) { goto XnJ0V; } goto HCHt5; MiagJ: mYZd6: goto kNtmQ; Ct039: goto ZwzGP; goto eN6X3; Saaou: $v['status_name'] = '已使用'; goto RE8k0; L_Qj8: $v['service'] = $datalist[$v['pid']]['name']; goto LDQiN; QUwk2: if (empty($v['two_openid'])) { goto tKGQS; } goto HLVo1; CaKBG: FTgFY: goto TBY3Z; TBY3Z: $data = $data . '</tr>'; goto t2C4n; sl7nN: $v['one_openid_nick'] = $user_list[$v['one_openid']]['nick']; goto Wc1Xi; qyEDl: if (empty($v['three_openid'])) { goto cmYX1; } goto hXPB_; bQPKF: tKGQS: goto qyEDl; eN6X3: XnJ0V: goto C8z1k; kNtmQ: $v['pay_name'] = '微信支付'; goto X33nB; K8LBE: if ($v['pay_type'] == 2) { goto WhBKg; } goto A8MxS; ND1Ul: $v['pay_name'] = '余额支付'; goto ypbe6; UdctG: WhBKg: goto ND1Ul; LDQiN: $v['userinfo'] = json_decode($v['userinfo'], true); goto EYTW8; hqkM3: iglwd: goto hRAgr; ypbe6: tYPYo: goto DHP1_; Cy7uV: ZwzGP: goto T2tIE; C8z1k: if ($v['refund_status'] == 1) { goto U5xlE; } goto z3OUX; T2tIE: goto c3CP1; goto fQ6Yo; wIOEm: goto GR3tj; goto HwepJ; xSw_j: cmYX1: goto rAh6h; DHP1_: goto n5CEq; goto MiagJ; pT7j8: goto g0n3M; goto GNdOF; t2C4n: D_1rt: goto HHBGK; g1Hxw: foreach ($xc as $x) { goto WzTKE; m89lu: vKNSx: goto JI661; IgEZ4: goto CODDY; goto m89lu; YrIvF: CODDY: goto r9A18; JI661: $data .= '<td style=\'vnd.ms-excel.numberformat:@\'>' . $v['userinfo'][$x['key']] . '</td>'; goto YrIvF; pjG0x: $data .= '<td style=\'vnd.ms-excel.numberformat:@\'>' . $v[$x['key']] . '</td>'; goto IgEZ4; WzTKE: if (!($x['status'] == 1)) { goto Mfjc_; } goto KK6Tp; KK6Tp: if ($x['key'] == 'name' || $x['key'] == 'mobile' || $x['key'] == 'address') { goto vKNSx; } goto pjG0x; r9A18: Mfjc_: goto P6e1o; P6e1o: A8O_d: goto W88Jz; W88Jz: } goto CaKBG; mXfau: $data = $data . '<tr>'; goto g1Hxw; VMUXI: if (empty($v['one_openid'])) { goto GfOOl; } goto sl7nN; HLVo1: $v['two_openid_nick'] = $user_list[$v['two_openid']]['nick']; goto bQPKF; HwepJ: N2I7d: goto Saaou; nnY0J: $v['status_name'] = '未使用(' . $v['is_use'] . '/' . $v['can_use'] . ')'; goto wIOEm; ZuWJy: $x['pay_name'] = '线下支付'; goto hqkM3; HCHt5: if (!($v['status'] == -1)) { goto XZN2c; } goto J2EpM; O3Z8L: XZN2c: goto Ct039; z3OUX: $v['status_name'] = '未退款'; goto pT7j8; rAh6h: if ($v['status'] == 1) { goto ti3ZQ; } goto KuYjh; EYTW8: $v['store_name'] = $store_list[$v['store']]['name']; goto SPUrV; X33nB: n5CEq: goto L_Qj8; hXPB_: $v['three_openid_nick'] = $user_list[$v['three_openid']]['nick']; goto xSw_j; lK0n3: if ($v['use'] == 1) { goto N2I7d; } goto nnY0J; NaQDK: if ($v['pay_type'] == 1) { goto mYZd6; } goto K8LBE; nZ4MO: $v['status_name'] = '已退款'; goto mt30Z; SPUrV: $v['member_name'] = $member_list[$v['member']]['name']; goto VMUXI; D_3KX: c3CP1: goto mXfau; GNdOF: U5xlE: goto nZ4MO; J2EpM: $v['status_name'] = '未支付'; goto O3Z8L; RE8k0: GR3tj: goto D_3KX; fQ6Yo: ti3ZQ: goto lK0n3; Wc1Xi: GfOOl: goto QUwk2; hRAgr: goto tYPYo; goto UdctG; A8MxS: if (!($v['pay_type'] == 3)) { goto iglwd; } goto ZuWJy; HHBGK: } goto Z5lpc; rNOfO: if (empty($_GPC['pay_type'])) { goto jI3rJ; } goto l9Ki_; pdS3f: if (!$service) { goto BZ2Pe; } goto lgkq4; E_IOV: ng4yj: goto McoQJ; Za9YX: $service = pdo_getall('xc_beauty_store_service', array("uniacid" => $uniacid)); goto Ljg7x; Bm9PE: if (!$store) { goto opOkP; } goto foNzb; ubG2D: sWo9h: goto yWW8t; z34_o: opOkP: goto uny8d; hACRf: $condition['use'] = $_GPC['use']; goto ubG2D; ylckM: VnVWp: goto dL1Ej; haULz: $condition['openid LIKE'] = '%' . $_GPC['openid'] . '%'; goto DAdAf; w5KXM: $condition['store'] = $_GPC['store_id']; goto gRJbR; bX5wQ: $condition['out_trade_no LIKE'] = '%' . $_GPC['out_trade_no'] . '%'; goto hM1dd; EPUZY: echo '无订单记录'; goto YJFL_; STuXO: $store_list = array(); goto Bm9PE; DAdAf: HwHmc: goto S_VtE; N9jaQ: $uniacid = $_W['uniacid']; goto x5oEU; lK4UD: $condition['createtime >='] = $times['start'] . ' 00:00:00'; goto NMrMy; G5IBE: Vb6jy: goto a82yo; o09bW: foreach ($user as $u) { goto FaE3q; FaE3q: $u['nick'] = base64_decode($u['nick']); goto hIx7R; hIx7R: $user_list[$u['openid']] = $u; goto l_Hp3; l_Hp3: uDGZw: goto xfzvc; xfzvc: } goto ylckM; wIdki: if (empty($_GPC['times'])) { goto CPrde; } goto qzoGe; ySt64: Oue56: goto BUAhe; LEBAr: $user_list = array(); goto MOi7U; dL1Ej: wwS7q: goto sD69r; fVp4A: if (empty($_GPC['openid'])) { goto HwHmc; } goto haULz; msXTG: header('Content-Disposition: attachment; filename=order.xls'); goto W4xsz; uny8d: $member = pdo_getall('xc_beauty_store_member', array("uniacid" => $uniacid)); goto QJ2wI; onMQg: echo iconv('UTF-8', 'GBK//TRANSLIT', $data . '	'); goto ySt64; cjDUM: if (empty($_GPC['store_id'])) { goto NHpbu; } goto w5KXM; SsBF6: $user = pdo_getall('xc_beauty_userinfo', array("uniacid" => $uniacid)); goto LEBAr; yWW8t: if (empty($_GPC['content'])) { goto ow7ET; } goto t9txM; NMrMy: $condition['createtime <='] = $times['end'] . ' 23:59:59'; goto y5tpD; foNzb: foreach ($store as $s) { $store_list[$s['id']] = $s; UQRaE: } goto wxTPF; x5oEU: $xc = htmlspecialchars_decode($_GPC['xc']); goto ft0w1; YJFL_: goto Oue56; goto Q2lqm; sD69r: header('Content-type: application/vnd.ms-excel; charset=utf8'); goto msXTG; QH02y: if ($order) { goto f2RuW; } goto EPUZY; MOi7U: if (!$user) { goto wwS7q; } goto o09bW; qzoGe: $times = $_GPC['times']; goto lK4UD; ft0w1: $xc = json_decode($xc, true); goto bkNXp; mk3JY: foreach ($member as $m) { $member_list[$m['id']] = $m; sGvH3: } goto G5IBE; veBLY: $condition['order_type'] = 4; goto kJcHv; KHCVp: $store = pdo_getall('xc_beauty_store', array("uniacid" => $uniacid)); goto STuXO; a82yo: YaQed: goto SsBF6; QJ2wI: $member_list = array(); goto FhUib; Z2Ebp: o33W3: goto QoYbf; W4xsz: $data = '<tr>'; goto wpR8X; y5tpD: CPrde: goto efTxC; V88Ar: $data = '<table border=\'1\'>' . $data . '</table>'; goto onMQg; BUAhe: } public function doWebPost() { goto Xuw05; lLm14: L1wTg: goto zgtUC; B07Zh: LlUBi: goto oF78F; AxW2p: $post = str_replace('{{trade}}', '1220171127101100000017', $post); goto YU1fD; MpR7T: $data = array(); goto MPKxy; kybWN: $post = str_replace('{{namex}}', '张三', $post); goto tJ389; oF78F: $request_get = ihttp_get($url); goto pNCz7; CErW0: $post = $sms['content']['post']; goto BTvEZ; ovMqu: if (!is_array($customize)) { goto lZvFr; } goto BI7we; pNCz7: echo $request_get['content']; goto xr4jq; STLEf: sIl3W: goto gYevh; o5mOU: QzZFv: goto KnQxo; YU1fD: $post = str_replace('{{amount}}', '199元', $post); goto kybWN; RUu_q: xe1pN: goto k2Qlw; fQBDd: $get = json_decode($get, true); goto mVv86; Cb9oq: $url = $_GPC['url']; goto j5xNU; WetJ2: $post = str_replace('{{addrx}}', '中国北京', $post); goto pSfzW; XsxnJ: $post = json_decode($post, true); goto MpR7T; SEikR: $get = str_replace('{{datex}}', date('Y-m-d H:i'), $get); goto fQBDd; mK9nQ: if (!is_array($customize)) { goto MME88; } goto K0yRV; X52cp: MME88: goto aVp09; pSfzW: $post = str_replace('{{datex}}', date('Y-m-d H:i'), $post); goto XsxnJ; BI7we: foreach ($customize as $x) { $get = str_replace('{{' . $x['attr'] . '}}', $x['value'], $get); Gah10: } goto lLm14; tJ389: $post = str_replace('{{phonex}}', '18888888888', $post); goto WetJ2; aVp09: $post = str_replace('{{webnamex}}', '美容', $post); goto AxW2p; PO9ir: if (!(strpos($header[0], '301') || strpos($header[0], '302'))) { goto xe1pN; } goto Wkh35; QNK_G: edATP: goto RUu_q; jn63_: $get = str_replace('{{webnamex}}', '美容', $get); goto QQn3E; QzF5z: cqtkP: goto oY6JR; zgtUC: lZvFr: goto jn63_; oY6JR: $url = $url . $url_data; goto B07Zh; EfjC6: load()->func('communication'); goto Cb9oq; xmmR5: $get = str_replace('{{amount}}', '199元', $get); goto HLxys; Xuw05: global $_GPC, $_W; goto EfjC6; JVDhE: foreach ($get as $x3) { goto PtplA; c3yW0: $url_data = $url_data . '&' . urlencode($x3['attr']) . '=' . urlencode($x3['value']); goto nEv_u; wiy0F: $url_data = urlencode($x3['attr']) . '=' . urlencode($x3['value']); goto Hd6iS; PtplA: if (empty($url_data)) { goto e5n4c; } goto c3yW0; Hd6iS: TzFs1: goto Y7__V; Y7__V: MduNg: goto wl_Wt; Wc94h: e5n4c: goto wiy0F; nEv_u: goto TzFs1; goto Wc94h; wl_Wt: } goto o5mOU; o34Dr: $url = $header['Location']; goto Ln22U; Ln22U: goto edATP; goto STLEf; wsY0Q: FHfqK: goto f5MZX; wCk4s: if (!$sms) { goto JeXmN; } goto VbtIS; zGMJS: $customize = $sms['content']['customize']; goto CErW0; jQSuJ: $get = json_encode($get); goto ovMqu; bpb0H: y94QQ: goto X52cp; gxq3q: $url = $url . '?' . $url_data; goto gW9xV; BeRkB: if (!(is_array($get) && !empty($get))) { goto kXfRX; } goto jQSuJ; SpDrO: $get = str_replace('{{phonex}}', '18888888888', $get); goto phQGB; f5MZX: $request_post = ihttp_post($url, $data); goto CdUHO; VbtIS: $sms['content'] = json_decode($sms['content'], true); goto zGMJS; VR_7V: $get = $sms['content']['get']; goto BeRkB; BTvEZ: $header = get_headers($url . '&_xcdebug=1', 1); goto PO9ir; K0yRV: foreach ($customize as $x) { $post = str_replace('{{' . $x['attr'] . '}}', $x['value'], $post); u13_i: } goto bpb0H; mVv86: $url_data = ''; goto JVDhE; QQn3E: $get = str_replace('{{trade}}', '1220171127101100000017', $get); goto xmmR5; HLxys: $get = str_replace('{{namex}}', '张三', $get); goto SpDrO; Wkh35: if (is_array($header['Location'])) { goto sIl3W; } goto o34Dr; gYevh: $url = $header['Location'][count($header['Location']) - 1]; goto QNK_G; phQGB: $get = str_replace('{{addrx}}', '中国北京', $get); goto SEikR; k2Qlw: if (!(is_array($post) && !empty($post))) { goto FkjMn; } goto wC3Ga; CdUHO: FkjMn: goto VR_7V; KnQxo: if (strpos($url, '?') !== false) { goto cqtkP; } goto gxq3q; gW9xV: goto LlUBi; goto QzF5z; wC3Ga: $post = json_encode($post); goto mK9nQ; MPKxy: foreach ($post as $x2) { $data[$x2['attr']] = $x2['value']; amit0: } goto wsY0Q; a7_pB: JeXmN: goto K7JOD; xr4jq: kXfRX: goto a7_pB; j5xNU: $sms = pdo_get('xc_beauty_config', array("xkey" => "sms")); goto wCk4s; K7JOD: } public function doWebOrderRefund() { goto pkMvj; A8rxU: pdo_update($xcmodule . '_package_log', array("status" => -1), array("uniacid" => $uniacid, "out_trade_no" => $order['out_trade_no'])); goto rHqXW; JKWeN: $result = json_decode($result, true); goto d8XlT; hZapv: $time_log = pdo_get('xc_beauty_times_log', array("uniacid" => $uniacid, "member" => $order['member'], "plan_date" => $order['plan_date'], "date_type" => 1, "createtime >=" => date('Y') . '-01-01')); goto FozTX; CzI0N: if ($data['return_code'] == 'SUCCESS') { goto AtmQj; } goto pvnro; v1JOm: goto L4Wvw; goto bLMPZ; gcb0v: goto JOPdM; goto b1CY7; jqxpw: zG7S6: goto hsOxb; wF5Y2: $total_fee = floatval($total_amount) * 100; goto Zd6fO; QI4gj: echo json_encode($json); goto x9XVh; A0Qqx: goto S272H; goto Gbtkz; zhzjM: ggrmn: goto PSFrw; SFuZK: $json = array("status" => -1, "msg" => "失败"); goto fChXB; SCGFW: WyB8g: goto xSK_1; BSdkT: exit; goto tX2nW; r1mGE: $data = array("charge_id" => $order['charge_id'], "amount" => $order['wxpay']); goto laMPg; TV1h9: echo json_encode($json); goto iEeYO; S9A9c: $result = vpost($url, $data); goto JKWeN; eVr0f: V4BU4: goto Z4PGt; Ifurr: goto WIbH9; goto HmE1Z; vNWqe: IsM_u: goto nB9I5; DbhCF: exit; goto xLtk6; F_RWu: $share_empty = round(floatval($userinfo['share_empty']) + floatval($share['amount'])); goto VXHle; R5fp8: $post_data['template_id'] = $moban['template_id']; goto BxObS; b1CY7: D_vhX: goto lJowv; Z4oNg: pdo_update('xc_beauty_times_log', array("total" => $time_log['total'] - intval($order['can_member'])), array("uniacid" => $uniacid, "member" => $order['member'], "plan_date" => $order['plan_date'], "createtime >=" => date('Y') . '-01-01')); goto pMbXd; fvXCr: gLh21: goto EjZRl; BxObS: $post_data['page'] = 'xc_beauty/pages/base/base'; goto Zkx2T; ws0Ff: mc_credit_update($fan['uid'], 'credit1', -$order['score'], $log = array(0, "退款", $_GPC['m'], 1, 0, 2)); goto qS2qj; HGAW9: $tong_bu = scoreCheck($uniacid); goto GdJxn; Zkx2T: $post_data['data'] = $postdata; goto ooz_h; kP1_6: $ch = curl_init(); goto BbIpc; GWMKA: echo json_encode($json); goto Xl6RU; RlIAF: $json = array("status" => 1, "msg" => "操作成功", "data" => array("refund_amount" => $refund_amount)); goto Qw9xB; D1TiJ: $json = array("status" => -1, "msg" => "操作失败4"); goto MLpiQ; nB9I5: $store = pdo_get('xc_beauty_store', array("uniacid" => $uniacid, "id" => $order['store'])); goto z1NYY; z1NYY: if (!(!empty($_GPC['yu_check_result']) && !empty($_GPC['content']))) { goto vd_28; } goto k7QbV; l2j2w: S272H: goto sl3GP; KpXUU: $tiangong = $config['content']['tiangong']; goto mcVmQ; CrUKN: $templateParam = array("out_trade_no" => $order['out_trade_no'], "store" => $store['name'], "service" => $order['title'], "amount" => $order['o_amount'], "name" => $order['userinfo']['name'], "mobile" => $order['userinfo']['mobile'], "createtime" => $order['createtime'], "check_result" => "拒绝", "check_content" => mb_substr($condition['yu_check_content'], 0, 20)); goto RurZ7; bF2Mk: ksort($refund); goto Ze3Tv; sLgvf: $AppKey = ''; goto ObvhZ; YFpaH: UhoFo: goto bZ4KS; WQILl: if (!(!empty($order['member']) && !empty($order['plan_date']))) { goto lx598; } goto qIBBt; ooz_h: $url = 'https://api.weixin.qq.com/cgi-bin/message/subscribe/send?access_token=' . $token; goto nUItY; sIvr6: $string = $string . "&key={$setting['payment']['wechat']['signkey']}"; goto WP4nj; spV_n: curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1); goto J2iuY; vi3tA: $json = array("status" => -1, "msg" => "失败"); goto TV1h9; laMPg: if (empty($_GPC['amount'])) { goto pc6VR; } goto uhM9U; RurZ7: $postdata = $moban['content']; goto zlp_s; kFwx7: Me3ge: goto hUjRR; x9XVh: exit; goto PASr5; qIBBt: if ($order['date_type'] == 1) { goto UDziy; } goto Vjqmx; flZcK: load()->func('communication'); goto O0zLo; t3K71: MqgGv: goto VaRYK; KQh3Y: $request = pdo_update('xc_beauty_order', $condition, array("id" => $_GPC['id'], "uniacid" => $uniacid)); goto jnXlJ; Ze3Tv: $string = array2url($refund); goto sIvr6; IYmhg: nZLq1: goto lrX3O; kW0A5: if (!($order['pay_type'] == 2)) { goto IO7JN; } goto bMK4_; OFkIW: pdo_update('xc_beauty_share', array("status" => 2), array("status" => 1, "uniacid" => $uniacid, "openid" => $order['openid'], "out_trade_no" => $order['out_trade_no'])); goto AR8Jm; DER0Y: $total_amount = $order['o_amount']; goto qeMf7; ilBeU: $score = $userinfo['score'] - $order['score']; goto d5Hs1; iD7Ij: $cert = authcode($refund_setting['cert'], 'DECODE'); goto w6WMn; GksRs: $userinfo = pdo_get('xc_beauty_userinfo', array("status" => 1, "openid" => $order['openid'], "uniacid" => $uniacid)); goto DER0Y; PASr5: R4Ng6: goto iD7Ij; Ptd2J: if ($order) { goto a0opk; } goto D1TiJ; Yyy9F: if (!($order['flash'] == 1)) { goto IsM_u; } goto evMC1; zaD8h: goto uKViD; goto fvXCr; pMbXd: mu2Ks: goto rxsLg; jnXlJ: if ($request) { goto nZLq1; } goto Ph9Er; TtOug: $json = array("status" => -1, "msg" => $result['emsg']); goto GWMKA; SZRrR: $condition['refund_amount'] = $refund_amount; goto KQh3Y; GgiId: echo json_encode($json); goto vkciY; vQDBT: pc6VR: goto S9A9c; tIl2c: WIbH9: goto zaD8h; hUjRR: $url = 'https://api.teegon.com/router?method=teegon.payment.charge.refund&app_key=' . $result['result']['key'] . '&client_secret=' . $result['result']['secret']; goto r1mGE; Ph9Er: $json = array("status" => -1, "msg" => "操作失败5"); goto HmLed; FysNo: exit; goto Yzlv8; io6wm: $moban = json_decode($template['content'], true); goto neMGb; q1tM0: if (empty($order['userinfo'])) { goto Pj3Zs; } goto jdMCg; neWIU: if ($order['pay_type'] == 1) { goto zG7S6; } goto kW0A5; XsAyM: $postdata = moban_limit($postdata); goto prl1f; pmoqL: goto bpfjH; goto jqxpw; mKgG2: $json = array("status" => -1, "msg" => "未开启微信退款功能"); goto HSkm5; nUItY: $post_data = json_encode($post_data); goto kP1_6; cUluw: if (!$share) { goto BLla9; } goto u0cmL; EjZRl: if (!empty($order['charge_id']) && !empty($AppKey) && !empty($AppSecret)) { goto eDyfn; } goto vi3tA; b2ddZ: if ($tiangong == 1) { goto gLh21; } goto Y20fA; WwX6b: YZYso: goto bJ5QU; YRXO5: IO7JN: goto pmoqL; d8XlT: if (!empty($result['result'])) { goto Q0Bny; } goto TtOug; GaX9T: $result = vpost($url, $data); goto My48L; rhvAw: $json = array("status" => -1, "msg" => "缺少微信证书"); goto QI4gj; PKLSi: unlink(ATTACHMENT_ROOT . $_W['uniacid'] . '_wechat_refund_all.pem'); goto XZq3b; sl3GP: uKViD: goto X4u4I; KQOiA: $config['content'] = json_decode($config['content'], true); goto rklTT; TZ53z: $post_data['touser'] = $order['openid']; goto R5fp8; Yzlv8: goto mD7SB; goto kFwx7; NnTLe: $fan = mc_fetch_one($userinfo['openid']); goto r5Lhm; N1SRM: file_put_contents(ATTACHMENT_ROOT . $_W['uniacid'] . '_wechat_refund_all.pem', $cert . $key); goto LldaQ; rmLtW: if ($data['result_code'] == 'SUCCESS') { goto D_vhX; } goto W4hmh; My48L: $result = json_decode($result, true); goto TD5FZ; jvEll: exit; goto excHR; qmnP5: echo json_encode($json); goto ne212; AR8Jm: BLla9: goto Abnvc; Y20fA: $setting = uni_setting_load('payment', $_W['uniacid']); goto DMoiV; idj9c: $output = curl_exec($ch); goto nkctx; PSFrw: tyBW3: goto iP7D3; neMGb: if (!($moban['status'] == 1)) { goto ggrmn; } goto q1tM0; excHR: goto oilDt; goto IYmhg; ixQC2: lx598: goto Yyy9F; t_uV7: goto tMpix; goto LG3_v; a00qA: N2fjM: goto NJeSd; Xl6RU: exit; goto aQ9Pp; bViR1: l8ZbR: goto NnTLe; lJowv: JOPdM: goto iNdX6; okPSR: Pj3Zs: goto B15IM; NCarx: $condition['yu_check_result'] = $_GPC['yu_check_result']; goto zxlF5; X6PBp: eDOrb: goto SZRrR; jvFwm: $token = $account_api->getAccessToken(); goto CrUKN; iEeYO: exit; goto A0Qqx; WP4nj: $string = md5($string); goto Pp9QX; ObvhZ: $AppSecret = ''; goto fd0lA; HMMT5: $refund = array("appid" => $_W['account']['key'], "mch_id" => $setting['payment']['wechat']['mchid'], "nonce_str" => random(8), "out_refund_no" => $transaction_id, "out_trade_no" => $transaction_id, "refund_fee" => $refund_fee, "total_fee" => $total_fee); goto bF2Mk; XZq3b: if ($response) { goto QaYLQ; } goto yoH7R; nkctx: curl_close($ch); goto zhzjM; W4hmh: $json = array("status" => -1, "msg" => $data['err_code_des']); goto qmnP5; Gbtkz: eDyfn: goto IBNJ5; iNdX6: tMpix: goto tIl2c; Zo75L: $refund_amount = floatval($_GPC['refund_amount']); goto t3K71; JUTEg: Oa32Z: goto XsAyM; zTgc4: exit; goto a00qA; J2iuY: curl_setopt($ch, CURLOPT_POST, 1); goto dzHTw; rHqXW: XXM5L: goto BWx82; cYRKS: $share = pdo_get('xc_beauty_share', array("status" => 1, "uniacid" => $uniacid, "openid" => $order['openid'], "out_trade_no" => $order['out_trade_no'])); goto cUluw; cRrFn: $order = pdo_get('xc_beauty_order', array("id" => $_GPC['id'], "uniacid" => $uniacid)); goto Ptd2J; XHFh1: exit; goto t_uV7; HmE1Z: QaYLQ: goto F3w4c; fChXB: echo json_encode($json); goto FysNo; TEC0a: $condition['refundtime'] = date('Y-m-d H:i:s'); goto Zvyp1; M5aGI: $agent_id = $config['content']['agent_id']; goto q1QQX; zlp_s: foreach ($postdata as &$ppp) { goto FtQXQ; AmSkV: ktyvx: goto SqQHU; FtQXQ: foreach ($templateParam as $key => $d) { $ppp['value'] = str_replace('{{' . $key . '}}', $d, $ppp['value']); hERpO: } goto gmtuM; gmtuM: cYLZu: goto AmSkV; SqQHU: } goto JUTEg; evMC1: pdo_query('UPDATE ' . tablename('xc_beauty_service') . ' SET flash_member=flash_member+:member WHERE uniacid=:uniacid AND id=:id', array(":member" => $order['total'], ":uniacid" => $uniacid, ":id" => $order['pid'])); goto vNWqe; ToFwh: akm_4: goto g0eXu; hsOxb: $tiangong = -1; goto sLgvf; B15IM: $account_api = WeAccount::create(); goto jvFwm; BbIpc: curl_setopt($ch, CURLOPT_URL, $url); goto spV_n; yoH7R: $json = array("status" => -1, "msg" => json_encode($response)); goto GgiId; FozTX: if (!$time_log) { goto mu2Ks; } goto Z4oNg; u0cmL: $share_o_amount = round(floatval($userinfo['share_o_amount']) - floatval($share['amount']), 2); goto F_RWu; Qw9xB: echo json_encode($json); goto DbhCF; Pp9QX: $refund['sign'] = strtoupper($string); goto flZcK; xSK_1: if (!(floatval($order['o_amount']) > 0)) { goto YZYso; } goto neWIU; bJ5QU: if (empty($order['score'])) { goto FQpl0; } goto HGAW9; Vjqmx: if (!($order['date_type'] == 2)) { goto k6biT; } goto Vk0ed; BWx82: pdo_update($xcmodule . '_share', array("status" => 2), array("uniacid" => $uniacid, "status" => -1, "out_trade_no" => $order['out_trade_no'])); goto WQILl; Vk0ed: pdo_delete('xc_beauty_times_log', array("uniacid" => $uniacid, "member" => $order['member'], "date_type" => 2, "schedule_date" => $order['schedule_date'], "schedule_start" => $order['schedule_start'], "schedule_end" => $order['schedule_end'])); goto L_HVo; w6WMn: $key = authcode($refund_setting['key'], 'DECODE'); goto N1SRM; gR3fD: $AppSecret = $config['content']['AppSecret']; goto M5aGI; MLpiQ: echo json_encode($json); goto BSdkT; d5Hs1: pdo_update('xc_beauty_userinfo', array("score" => $score), array("status" => 1, "openid" => $order['openid'], "uniacid" => $uniacid)); goto X4XSy; BD0Sr: echo json_encode($json); goto XHFh1; HmLed: echo json_encode($json); goto jvEll; qeMf7: $refund_amount = $order['o_amount']; goto X95GO; q1QQX: $user_id = $config['content']['user_id']; goto ToFwh; pkMvj: global $_GPC, $_W, $xcmodule; goto bWWAW; v5MA9: pdo_update($xcmodule . '_order_detail', array("is_member -=" => 1), array("uniacid" => $uniacid, "id" => $order['package'])); goto A8rxU; Zvyp1: if (empty($_GPC['yu_check_result'])) { goto h1Ydp; } goto NCarx; bMK4_: $money = round(floatval($userinfo['money']) + floatval($refund_amount), 2); goto CXA7a; bWWAW: $uniacid = $_W['uniacid']; goto cRrFn; TD5FZ: if (!empty($result['result'])) { goto Me3ge; } goto SFuZK; mcVmQ: $AppKey = $config['content']['AppKey']; goto gR3fD; UWFwS: if (!$config) { goto TjQwR; } goto KQOiA; hXaMv: if (empty($_GPC['content'])) { goto eDOrb; } goto fc2Vo; cRSUu: if (!($refund_setting['switch'] != 1)) { goto N2fjM; } goto mKgG2; DMoiV: $refund_setting = $setting['payment']['wechat_refund']; goto cRSUu; giMbv: $response = ihttp_request($url, $xml, array(CURLOPT_SSLCERT => ATTACHMENT_ROOT . $_W['uniacid'] . '_wechat_refund_all.pem')); goto PKLSi; jdMCg: $order['userinfo'] = json_decode($order['userinfo'], true); goto okPSR; yT80A: a0opk: goto GksRs; fd0lA: $agent_id = ''; goto Q03Iu; Q03Iu: $user_id = ''; goto zOGOW; pvnro: $json = array("status" => -1, "msg" => $data['return_msg']); goto BD0Sr; rxsLg: L4Wvw: goto ixQC2; F3w4c: $data = xml2array($response['content']); goto CzI0N; ghVAs: $data = array("agent_id" => $agent_id, "user_id" => $user_id, "secret_type" => 1); goto GaX9T; VaRYK: if (!(floatval($refund_amount) > floatval($total_amount))) { goto WyB8g; } goto jgpJK; NJeSd: if (!(empty($refund_setting['key']) || empty($refund_setting['cert']))) { goto R4Ng6; } goto rhvAw; aQ9Pp: Q0Bny: goto TOd2V; Abnvc: $condition['refund_status'] = 1; goto d7IgG; Zd6fO: $refund_fee = floatval($refund_amount) * 100; goto c_Sdn; iP7D3: vd_28: goto RlIAF; xLtk6: oilDt: goto eVr0f; c_Sdn: $url = 'https://api.mch.weixin.qq.com/secapi/pay/refund'; goto HMMT5; IBNJ5: $url = 'https://api.teegon.com/router?method=teegon.agent.mfuser.get.pay.secret&app_key=' . $AppKey . '&client_secret=' . $AppSecret; goto ghVAs; bLMPZ: UDziy: goto hZapv; lrX3O: if (!($order['order_type'] == 4 && !empty($order['package']))) { goto XXM5L; } goto v5MA9; k7QbV: $template = pdo_get($xcmodule . '_config', array("xkey" => "moban_check", "uniacid" => $uniacid)); goto gor4x; dzHTw: curl_setopt($ch, CURLOPT_POSTFIELDS, $post_data); goto idj9c; X4XSy: goto UhoFo; goto bViR1; bZ4KS: FQpl0: goto cYRKS; L_HVo: k6biT: goto v1JOm; nfR9r: exit; goto SCGFW; VXHle: pdo_update('xc_beauty_userinfo', array("share_o_amount" => $share_o_amount, "share_empty" => $share_empty), array("status" => 1, "openid" => $order['openid'], "uniacid" => $uniacid)); goto OFkIW; zxlF5: h1Ydp: goto hXaMv; jgpJK: $json = array("status" => 0, "msg" => "退款金额不能大于订单金额"); goto clGIV; rklTT: if (!(!empty($config['content']['tiangong']) && !empty($config['content']['AppKey']) && !empty($config['content']['AppSecret']))) { goto akm_4; } goto KpXUU; GdJxn: if ($tong_bu == 1) { goto l8ZbR; } goto ilBeU; fc2Vo: $condition['yu_check_content'] = $_GPC['content']; goto X6PBp; LldaQ: $transaction_id = $order['wx_out_trade_no']; goto wF5Y2; X95GO: if (empty($_GPC['refund_amount'])) { goto MqgGv; } goto Zo75L; d7IgG: $condition['status'] = 2; goto TEC0a; uhM9U: $data['amount'] = $_GPC['amount']; goto vQDBT; zOGOW: $config = pdo_get('xc_beauty_config', array("xkey" => "web", "uniacid" => $uniacid)); goto UWFwS; CXA7a: $request = pdo_update('xc_beauty_userinfo', array("money" => $money), array("status" => 1, "openid" => $order['openid'], "uniacid" => $uniacid)); goto YRXO5; qS2qj: MGyZg: goto YFpaH; LG3_v: AtmQj: goto rmLtW; TOd2V: mD7SB: goto l2j2w; ne212: exit; goto gcb0v; O0zLo: $xml = array2xml($refund); goto giMbv; gor4x: if (!$template) { goto tyBW3; } goto io6wm; g0eXu: TjQwR: goto b2ddZ; HSkm5: echo json_encode($json); goto zTgc4; vkciY: exit; goto Ifurr; tX2nW: goto V4BU4; goto yT80A; prl1f: $post_data = array(); goto TZ53z; r5Lhm: if (!$fan) { goto MGyZg; } goto ws0Ff; X4u4I: bpfjH: goto WwX6b; clGIV: echo json_encode($json); goto nfR9r; Z4PGt: } function doMobileTGong() { goto yYdBP; Q25tA: $group_data['team_total'] = $group['team_total'] + 1; goto fo0XS; xBYYm: $content .= '订单号：' . $order['out_trade_no'] . '\\r\\n'; goto FwsVS; kaEwS: $group_data = array(); goto gsmPN; sDmSy: xoH2r: goto J5ooP; Kel7N: goto mE017; goto Dkbwj; TmkMy: $request = pdo_update('xc_beauty_order', array("status" => 1, "wx_out_trade_no" => $data['out_trade_no']), array("id" => $order['id'], "uniacid" => $uniacid)); goto ugXno; KFygQ: $share_condition['wx_out_trade_no'] = $order['out_trade_no']; goto ZPMw4; vDY4T: $request = pdo_update('xc_beauty_group', $group_data, array("id" => $order['group'], "uniacid" => $uniacid)); goto K2M3l; FMwzw: if ($order['order_type'] == 4) { goto rxNXn; } goto HKV1y; xkxpt: $money = round(floatval($money) + floatval($order['gift']), 2); goto dONzA; phrIV: if (!($share_config['type'] == 2)) { goto niS05; } goto J73rB; cgTBi: LElYA: goto lh3Cu; rYShO: X1_Pf: goto B3nZL; WZU4E: goto dSM1W; goto K0VJX; qRv_a: ARpuU: goto Qq_yL; f6ebT: logging_run('666:' . $data['order_no']); goto vLk1D; zn5Ju: $share_condition['two_openid'] = null; goto xQOto; onEI8: $print = pdo_get('xc_beauty_config', array("xkey" => "print", "uniacid" => $uniacid)); goto lhFNh; M7NTM: $level_data['card_amount'] = round(floatval($userinfo['card_amount']) + floatval($order['o_amount']), 2); goto JjMXI; hYJ5b: if (!empty($order['userinfo']['address'])) { goto zVk07; } goto fs9Mz; SjpHG: goto wAcg4; goto imgVj; n3VnF: if (!($sms['content']['status'] == 1)) { goto airPG; } goto YjYDX; f1Jpz: if (!empty($order['userinfo']['address'])) { goto ds3aN; } goto A3Mt5; XMbJ6: $group_data['status'] = -1; goto Q25tA; cf2fU: $times_log = pdo_get('xc_beauty_times_log', array("uniacid" => $uniacid, "plan_date" => $order['plan_date'], "member" => $order['member'], "date_type" => 1, "createtime >=" => date('Y') . '-01-01 00:00:00')); goto URunp; jnz7y: l7wPl: goto LH4zz; WiE5z: dKAWu: goto Z76Rv; DLKhI: SxeDo: goto IngX8; F1jv1: IR2Jg: goto uIHqA; WxQmp: SNWzz: goto MED8q; WkzJU: pdo_update('xc_beauty_userinfo', $level_data, array("openid" => $order['openid'], "uniacid" => $uniacid)); goto iHKcm; ayki1: VH9tz: goto Kel7N; Yo1k8: goto MBtSh; goto MPUYH; Qsbih: $templateParam['addrx'] = $order['userinfo']['address']; goto tucRE; sFzaO: pdo_update('xc_beauty_user_coupon', array("status" => 1), array("id" => $use_coupon['id'], "uniacid" => $uniacid)); goto gW8yP; euok9: $list = pdo_getall('xc_beauty_order', array("status" => 1, "order_type" => 3, "group" => $order['group'])); goto ez0J7; jeJGq: FxWzU: goto W45LH; HlpDw: NvtY5: goto EVXxw; XnDq7: $data = array(); goto OUiGr; eQZeo: mRqHH: goto aswl1; ZdWhQ: $use_coupon = pdo_get('xc_beauty_user_coupon', array("status" => -1, "openid" => $order['openid'], "uniacid" => $uniacid, "cid" => $order['coupon_id'])); goto DxMvD; Lv31T: PBJNw: goto HKNob; IqnAP: $share_config['two'] = $share['content']['level_two']; goto I0OAx; jVyXl: if (!$content) { goto Jbzj7; } goto GOW31; QTglb: pdo_update('xc_beauty_service', array("group_total" => $service['group_total'] + $order['total']), array("id" => $order['pid'], "uniacid" => $uniacid)); goto WzTZK; tucRE: su1Oj: goto GP8Yg; YeW79: if (empty($share['content']['status'])) { goto tSTWf; } goto Z45Uo; Gvqlc: $sms = pdo_get('xc_beauty_config', array("uniacid" => $uniacid, "xkey" => "sms")); goto gwVA6; zk6OL: if (!($share_config['level'] >= 1 && !empty($share_config['one']) && !empty($userinfo['share']))) { goto A2zZa; } goto KY8zK; L1DEx: foreach ($customize as $x) { $post = str_replace('{{' . $x['attr'] . '}}', $x['value'], $post); dzUXY: } goto bSMvo; japS3: $share_condition['one_amount'] = round(floatval($order['o_amount']) * floatval($share_config['one']) * 0.01, 2); goto OIyh9; fKKDl: $orderInfo .= '地址：无<BR>'; goto mGCab; sWsX_: $group_data['team'] = json_decode($group['team'], true); goto F1hhs; Tnu1i: if (!(!empty($share_config['type']) && $share_status == 1)) { goto UhdWq; } goto zk6OL; Bzr8q: curl_setopt($ch, CURLOPT_POSTFIELDS, $data); goto QDCzV; qNfQM: $moeny = round(floatval($userinfo['money']) - floatval($order['canpay']), 2); goto G4d8p; Z76Rv: goto F_WEB; goto Lv31T; Kv2BP: if (empty($order['gift'])) { goto LiYTg; } goto xkxpt; nM1vj: MBtSh: goto qdekr; EYxNW: $orderInfo .= '应付款：' . $order['amount'] . '<BR>'; goto j1aj4; g51a3: $content = ''; goto xBYYm; vLk1D: $order = pdo_get('xc_beauty_order', array("out_trade_no" => $data['order_no'], "status" => -1)); goto AncGH; PBpAm: if (!$group) { goto hj2sM; } goto kaEwS; N0evS: $post = str_replace('{{datex}}', $order['plan_date'], $post); goto Xwc9N; Y2WWp: $group_data['team'] = json_encode($group_data['team']); goto XMbJ6; MPzr2: Ab1J9: goto EL_6f; cm6XP: wVLrN: goto TkmhO; uRWCl: if (!(is_array($post) && !empty($post))) { goto IUijq; } goto Fit5T; rGR0t: if (!(!empty($result['result']) && $result['result']['paid'])) { goto An9ZA; } goto jKzpR; MmBwm: $share_config = array("level" => 3, "type" => "", "one" => "", "two" => "", "three" => ""); goto RpL5K; NkmuB: $orderInfo .= '小程序名：' . $config['content']['title'] . '<BR>'; goto KfQrE; Iak2G: if (!(is_array($get) && !empty($get))) { goto yoCip; } goto J1DIG; zx6Wl: $content .= '地址：无\\r\\n'; goto LH7L1; VEb3l: $service = pdo_get('xc_beauty_store_service', array("uniacid" => $uniacid, "id" => $order['pid'])); goto kjaTF; tIKme: $tpl_value = '#webnamex#=' . $config['content']['title'] . '&#trade#=' . $order['out_trade_no'] . '&#amount#=' . $order['o_amount'] . '&#namex#=' . $order['userinfo']['name'] . '&#phonex#=' . $order['userinfo']['mobile'] . '&#datex#=' . $order['plan_date']; goto Lk1aj; GHPor: if ($order['order_type'] == 1 || $order['order_type'] == 3 || $order['order_type'] == 4) { goto IGNq3; } goto NQ82W; bZeuC: $orderInfo .= '服务项目：' . $service['name'] . '<BR>'; goto eUhVo; oL2CG: foreach ($customize as $x) { $get = str_replace('{{' . $x['attr'] . '}}', $x['value'], $get); TOJ7r: } goto R4MaF; r0txA: pdo_insert('xc_beauty_share', array("uniacid" => $uniacid, "openid" => $share_condition['three_openid'], "title" => "三级订单结算奖励", "out_trade_no" => $order['out_trade_no'], "amount" => $share_condition['three_amount'], "level" => 3, "status" => -1, "createtime" => date('Y-m-d H:i:s'))); goto kWdZ9; Eu8El: $userinfo = pdo_get('xc_beauty_userinfo', array("status" => 1, "openid" => $order['openid'])); goto lhfO4; diBlX: $level_data['card_amount'] = round(floatval($userinfo['card_amount']) + floatval($order['o_amount']), 2); goto zISVX; J1DIG: $get = json_encode($get); goto wYF2d; F9rg8: curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1); goto T6FDv; JDeOA: $content .= '应付款：' . $order['amount'] . '\\r\\n'; goto eg6o2; CsH2D: puByv: goto uOP33; h7FUR: $orderInfo .= '总件数：' . $order['total'] . '<BR>'; goto EYxNW; kVMky: eCymL: goto Y5AXt; Lk1aj: if (!empty($order['userinfo']['address'])) { goto MJEaR; } goto qfvdt; KN3R4: OF4ON: goto n5iJQ; Rx1Dx: y8FZX: goto fveRR; jg4_F: goto su1Oj; goto i0PZ3; Pw9j2: k7CZy: goto XjePw; Vn70W: $post = str_replace('{{namex}}', $order['userinfo']['name'], $post); goto Jr3Gx; u4PPP: $request = pdo_update('xc_beauty_order', $share_condition, array("id" => $order['id'], "uniacid" => $uniacid)); goto I8TZM; kSse7: $orderInfo .= '手机：' . $order['userinfo']['mobile'] . '<BR>'; goto DwKET; qI1PI: if (!($card && $card['content']['level_status'] == 1 && $userinfo['card'] == 1)) { goto k7CZy; } goto zZ3F0; egH32: F_WEB: goto Yo1k8; leKQO: if (!(floatval($order['canpay']) != 0)) { goto rv6w_; } goto qNfQM; xnh4V: $share_condition['three_openid'] = $two['share']; goto o5guC; YZMCM: $config = pdo_get('xc_beauty_config', array("xkey" => "web", "uniacid" => $uniacid)); goto NbQCX; oKf8F: r3bE9: goto JTKAL; MH0uF: pdo_update('xc_beauty_service', array("group_total" => $service['group_total'] + $order['total']), array("id" => $order['pid'], "uniacid" => $uniacid)); goto l_4Li; Qk8IT: goto G_4ei; goto rYShO; dobJJ: MJEaR: goto d39RF; tijrj: if (!($share_config['level'] >= 2 && !empty($share_config['two']) && !empty($one['share']))) { goto wVLrN; } goto NNuhL; Igm0V: tLbse: goto Y2WWp; EzTFa: $share_condition['score'] = $score; goto KFygQ; ZOtDa: set_time_limit(0); goto VLG3C; RI2d3: $share_condition['three_amount'] = round(floatval($order['o_amount']) * floatval($share_config['three']) * 0.01, 2); goto F2KM3; ZY604: if (empty($order['content'])) { goto xoH2r; } goto wjvGF; Mdp1g: $content .= '姓名：' . $order['userinfo']['name'] . '\\r\\n'; goto VajFx; dr7nj: $order['userinfo'] = json_decode($order['userinfo'], true); goto YZMCM; HKV1y: $service = pdo_get('xc_beauty_service', array("uniacid" => $uniacid, "id" => $order['pid'])); goto SjpHG; u_uRG: B3SP3: goto KN3R4; LzHx2: pb3n7: goto Gvqlc; q0_Un: $share_condition['two_amount'] = round(floatval($order['o_amount']) * floatval($share_config['two']) * 0.01, 2); goto vJVOR; KfQrE: $orderInfo .= '--------------------------------<BR>'; goto bZeuC; FyZAG: if (!(!empty($card['content']['level']) && is_array($card['content']['level']))) { goto KcXPz; } goto PUozg; l9q1a: $content .= '总件数：' . $order['total'] . '\\r\\n'; goto VJxoH; oSd7I: $content = juhecurl($sendUrl, $smsConf, 1); goto jVyXl; vYxmP: define('SN', $print['content']['sn']); goto JZSC1; F1hhs: $group_data['team'][] = $order['openid']; goto Igm0V; JZSC1: define('IP', 'api.feieyun.cn'); goto tYPyM; NAFl5: $get = str_replace('{{trade}}', $order['out_trade_no'], $get); goto PSc1C; dbvqZ: w6YB8: goto DWKIK; tYPyM: define('PORT', 80); goto bp6N4; dWmEI: if (!$fan) { goto m3rMA; } goto VMbJg; Gtjjb: $share = pdo_get('xc_beauty_config', array("xkey" => "share", "uniacid" => $uniacid)); goto vO9Nh; fNHsO: if (empty($share_condition['two_openid'])) { goto BHBv4; } goto oC94l; VMg5q: OYhha: goto UAALG; jS9Zo: bsei1: goto ssdFZ; c6k8J: $post = str_replace('{{addrx}}', '无', $post); goto CWSfi; eUhVo: $orderInfo .= '--------------------------------<BR>'; goto h7FUR; EmuO0: An9ZA: goto UNJLs; Wbxrm: if (!$service_list) { goto l7wPl; } goto YYOuW; khQa9: vHJGT: goto TmkMy; f1pEN: VJ4wK: goto XaFKE; lhfO4: if (!(floatval($order['canpay']) != 0)) { goto VJ4wK; } goto U46Hn; T6FDv: curl_setopt($ch, CURLOPT_HEADER, 0); goto j6A4I; yYdBP: global $_GPC, $_W; goto sRqtg; WXGxy: if (!($print['content']['status'] == 1)) { goto CtQE_; } goto c7mpI; qR9fM: $fan = mc_fetch_one($userinfo['openid']); goto aTDwo; DWKIK: require_once '../addons/xc_beauty/resource/sms/sendSms.php'; goto ZOtDa; jOIqn: JyNz3: goto PYpbb; s5DC0: ErWem: goto vDY4T; gsmPN: if (!empty($group['team'])) { goto iSKpD; } goto BE2It; wooeT: dasKk: goto TLxAV; lYjSi: gvSFm: goto xnual; Ya4Za: rv6w_: goto OpI9K; D6pys: curl_close($ch); goto Km0Oh; elahG: niS05: goto WZU4E; cl5N2: if (!$request) { goto XdjM2; } goto R2blJ; FwsVS: $content .= '小程序名：' . $config['content']['title'] . '\\r\\n'; goto l9q1a; NNuhL: $share_condition['two_openid'] = $one['share']; goto CRwUY; MKT1M: bSld7: goto egx_r; n1ezv: $share_config['type'] = $share['content']['type']; goto MVzOA; agLl8: D081u: goto qI1PI; YjYDX: if ($sms['content']['type'] == 1) { goto w6YB8; } goto hNkK8; qkcPz: if ($tong_bu == 1) { goto P9jzT; } goto t0knn; WTM73: x2hF3: goto b6tqX; fMzIf: if (!($order['order_type'] == 3)) { goto OF4ON; } goto UJEQU; XaFKE: if (empty($order['coupon_id'])) { goto vHJGT; } goto ZdWhQ; fvaMX: pdo_insert('xc_beauty_times_log', array("uniacid" => $uniacid, "member" => $order['member'], "plan_date" => $order['plan_date'], "total" => 1, "createtime" => date('Y-m-d H:i:s'), "date_type" => 2, "schedule_date" => $order['schedule_date'], "schedule_start" => $order['schedule_start'], "schedule_end" => $order['schedule_start'])); goto VMg5q; lhFNh: if (!$print) { goto M8t22; } goto ZRFZd; j1aj4: $orderInfo .= '实付款：' . $order['o_amount'] . '<BR>'; goto BqeuU; gUYGq: $data_dd = explode('&', $input); goto KTMA2; ugXno: if (!$request) { goto Jruhr; } goto onlf9; rXtA4: $level_data = array(); goto M7NTM; SWPzM: $get = $sms['content']['get']; goto Iak2G; xnual: if (empty($score)) { goto z_A6B; } goto iWkSC; fo0XS: if (!($group_data['team_total'] == $group['total'])) { goto ErWem; } goto cguyJ; HGf7a: define('USER', $print['content']['user']); goto HARFj; kLTVu: z_A6B: goto dr7nj; ZfpTv: ds3aN: goto Lp7y7; ErI3A: if ($order['order_type'] == 1 || $order['order_type'] == 4) { goto D081u; } goto fMzIf; ahiPs: Jg9NY: goto st7PG; HARFj: define('UKEY', $print['content']['ukey']); goto vYxmP; th4ju: BHBv4: goto KVQRj; imgVj: rxNXn: goto VEb3l; zZ3F0: $level_data = array(); goto diBlX; KTMA2: $data = array(); goto yNNbq; idFba: o2h49: goto jnz7y; zgpBq: Jbzj7: goto oKf8F; Qq_yL: goto dasKk; goto DLKhI; wjvGF: $orderInfo .= '备注：' . $order['content'] . '<BR>'; goto sDmSy; OCxaV: if (!($card['content']['score_status'] == 1 && !empty($card['content']['score_attr']) && !empty($card['content']['score_value']) && $userinfo['card'] == 1)) { goto yCqzg; } goto taT7s; NbQCX: if (!$config) { goto pb3n7; } goto CNRra; LtLM0: tSTWf: goto PApNL; kWdZ9: T7vYf: goto lYjSi; hNkK8: if ($sms['content']['type'] == 2) { goto v1Mt7; } goto B8vwL; YQtcx: pNfc6: goto nNj4n; fvd0q: P9jzT: goto qR9fM; CWSfi: goto vPmyL; goto Zaxyj; H_Skl: b8WA4: goto onEI8; xQOto: $share_condition['two_amount'] = null; goto RRFtx; K2M3l: if (!$request) { goto Pya8Y; } goto MH0uF; Vlz9g: $money = floatval($userinfo['money']) + floatval($order['amount']); goto Kv2BP; XN601: $result = $send->sendSms($sms['content']['AccessKeyId'], $sms['content']['AccessKeySecret'], $sms['content']['sign'], $sms['content']['code'], $sms['content']['mobile'], $templateParam); goto yGmqu; gwVA6: if (!$sms) { goto b8WA4; } goto FSykx; gW8yP: KMWG0: goto ySSap; ptcPu: $fan = mc_fetch_one($userinfo['openid']); goto dWmEI; kBcu0: if (!($share_config['level'] >= 3 && !empty($share_config['three']) && !empty($two['share']))) { goto o1vnT; } goto xnh4V; EL_6f: $orderInfo .= '地址：' . $order['userinfo']['address'] . '<BR>'; goto qiGMR; KPad2: $share_condition['status'] = 1; goto EzTFa; A0ZPD: define('STIME', time()); goto sWZCD; CRwUY: if ($share_config['type'] == 1) { goto RsSEk; } goto phrIV; phgpg: airPG: goto H_Skl; toV_n: curl_setopt($ch, CURLOPT_URL, $sms['content']['url']); goto Fsl9u; smqdO: goto RKEzp; goto cgTBi; JmStV: goto tLbse; goto tzMiS; rwCoq: $sign = strtoupper(md5($print['content']['apikey'] . 'machine_code' . $print['content']['machine_code'] . 'partner' . $print['content']['partner'] . 'time' . $time . $print['content']['msign'])); goto DkJpJ; k7k9X: if (!(strpos($header[0], '301') || strpos($header[0], '302'))) { goto bsei1; } goto BoQi0; h5vWC: $request = push($requestInfo, $requestUrl); goto F1jv1; oC94l: pdo_insert('xc_beauty_share', array("uniacid" => $uniacid, "openid" => $share_condition['two_openid'], "title" => "二级订单结算奖励", "out_trade_no" => $order['out_trade_no'], "amount" => $share_condition['two_amount'], "level" => 2, "status" => -1, "createtime" => date('Y-m-d H:i:s'))); goto th4ju; KLNV_: pdo_update('xc_beauty_userinfo', array("money" => $moeny), array("status" => 1, "openid" => $order['openid'])); goto f1pEN; HKL0u: yoCip: goto vigWz; tzMiS: iSKpD: goto sWsX_; VMbJg: $userinfo['score'] = $fan['credit1']; goto aXUlr; aEf74: $get = str_replace('{{datex}}', $order['plan_date'], $get); goto Xn0o2; PUozg: foreach ($card['content']['level'] as $card_l) { goto ponK3; jLQLI: bhC6j: goto hVVtK; SJiY1: $level_data['card_name'] = $card_l['name']; goto APqqK; hVVtK: waz2z: goto CDvBL; APqqK: $level_data['card_price'] = $card_l['price']; goto jLQLI; ponK3: if (!(floatval($card_amount) >= floatval($card_l['amount']))) { goto bhC6j; } goto SJiY1; CDvBL: } goto YQtcx; K0VJX: RsSEk: goto q0_Un; URunp: if ($times_log) { goto LElYA; } goto KTTJL; fDNxS: goto hiKiH; goto WTM73; MED8q: $get = str_replace('{{webnamex}}', $config['content']['title'], $get); goto NAFl5; IngX8: $group = pdo_get('xc_beauty_group', array("id" => $order['group'], "uniacid" => $uniacid)); goto PBpAm; DxMvD: pdo_update('xc_beauty_user_coupon', array("status" => 1), array("id" => $use_coupon['id'], "uniacid" => $uniacid)); goto khQa9; XaaGH: $post = $sms['content']['post']; goto uRWCl; axz31: $share_config['two'] = $service['level_two']; goto fpsvM; Ohh0k: header('content-type:text/html;charset=utf-8'); goto Sj9nP; c20U5: if (!$request) { goto ARpuU; } goto QTglb; GOW31: $result = json_decode($content, true); goto VcSNu; LoSsf: $post = str_replace('{{trade}}', $order['out_trade_no'], $post); goto hFpPY; vs3g0: $one = pdo_get('xc_beauty_userinfo', array("status" => 1, "openid" => $userinfo['share'], "uniacid" => $uniacid)); goto tijrj; MOopZ: pdo_update('xc_beauty_userinfo', $level_data, array("openid" => $order['openid'], "uniacid" => $uniacid)); goto Pw9j2; eD0Nz: pdo_insert('xc_beauty_score', array("uniacid" => $uniacid, "openid" => $order['openid'], "status" => 1, "score" => $score, "over" => $user_score, "title" => "消费", "createtime" => date('Y-m-d H:i:s'))); goto kLTVu; Lp7y7: $get = str_replace('{{addrx}}', $order['userinfo']['address'], $get); goto CacAK; XGVTG: $ttt = array("charge_id" => $data['charge_id']); goto xpwkM; B8vwL: if (!($sms['content']['type'] == 3)) { goto puByv; } goto KaR4q; q1Ai3: G_4ei: goto FH3Kc; cEJv3: pdo_update('xc_beauty_order', array("group" => $group[0]['id']), array("id" => $order['id'], "uniacid" => $uniacid)); goto qRv_a; TLxAV: if (empty($order['member'])) { goto B3SP3; } goto XbbBU; u1KZ_: cIlhB: goto MKT1M; kKt_j: if (!is_array($customize)) { goto xXLel; } goto L1DEx; JjMXI: $card_amount = round(floatval($level_data['card_amount']) + floatval($userinfo['order_fee']), 2); goto hp_FJ; OYBOg: $user_score = $userinfo['score'] + $score; goto qkcPz; KY8zK: $share_condition['one_openid'] = $userinfo['share']; goto CRN7T; qiGMR: kPfzk: goto dD9Y5; BoQi0: if (is_array($header['Location'])) { goto x2hF3; } goto dfX2d; VcSNu: $error_code = $result['error_code']; goto zgpBq; bp6N4: define('PATH', '/Api/Open/'); goto A0ZPD; st7PG: goto IR2Jg; goto XCUZQ; Xwc9N: $post = json_decode($post, true); goto XnDq7; XCUZQ: Lg90d: goto QBSTO; hFpPY: $post = str_replace('{{amount}}', $order['o_amount'] . '元', $post); goto Vn70W; O51Ol: pdo_update('xc_beauty_times_log', array("total" => $times_log_total), array("uniacid" => $uniacid, "id" => $times_log['id'])); goto i0242; I8TZM: if (!$request) { goto wurR0; } goto ErI3A; J5ooP: $request = wp_print(SN, $orderInfo, 1); goto ahiPs; qdekr: echo 'SUCCESS'; goto EmuO0; ZRFZd: $print['content'] = json_decode($print['content'], true); goto WXGxy; qQSIp: GXNzE: goto KPad2; YCtup: $service_data = array(); goto Wbxrm; qfvdt: $tpl_value = $tpl_value . '&#addrx#=无'; goto suH_z; RRFtx: $share_condition['three_openid'] = null; goto QhT1n; VHnFa: $share_config['one'] = $service['level_one']; goto axz31; W1lo1: if (!($share_config['type'] == 2)) { goto eCymL; } goto KovUS; owO8M: $sms['content']['url'] = $sms['content']['url'] . '?' . $url_data; goto Qk8IT; fENFw: $userinfo = pdo_get('xc_beauty_userinfo', array("status" => 1, "openid" => $order['openid'])); goto leKQO; Xn0o2: $get = json_decode($get, true); goto yfFlA; FSykx: $sms['content'] = json_decode($sms['content'], true); goto n3VnF; xpwkM: $result = vpost($url, $ttt); goto uPUoh; QhT1n: $share_condition['three_amount'] = null; goto Tnu1i; Xfbjg: $request = pdo_update('xc_beauty_order', array("status" => 1, "money" => $money, "wx_out_trade_no" => $data['out_trade_no']), array("id" => $order['id'], "uniacid" => $uniacid)); goto cl5N2; ZN2L3: o1vnT: goto cm6XP; BlDeq: $requestInfo = http_build_query($requestAll); goto h5vWC; NQ82W: if ($order['order_type'] == 2) { goto PBJNw; } goto n4jQF; OcV9y: $use_coupon = pdo_get('xc_beauty_user_coupon', array("status" => -1, "openid" => $order['openid'], "uniacid" => $uniacid, "cid" => $order['coupon_id'])); goto sFzaO; rFX8S: $share_config['type'] = $service['type']; goto VHnFa; vznyf: DVIQk: goto fNHsO; i0PZ3: zVk07: goto Qsbih; cWB49: sNgjY: goto CWRLg; Ikh1b: ukvLa: goto WkzJU; HHYmx: gdRwF: goto u_uRG; EIOPi: $requestAll = ["partner" => $print['content']['partner'], "machine_code" => $print['content']['machine_code'], "time" => $time, "content" => $content, "sign" => $sign]; goto BlDeq; o32Lw: $card['content'] = json_decode($card['content'], true); goto OCxaV; MPUYH: IGNq3: goto FMwzw; dONzA: LiYTg: goto Xfbjg; Ui6jF: goto miV2r; goto ZfpTv; iHKcm: E_GYT: goto p6Q6I; QDCzV: $output = curl_exec($ch); goto D6pys; KaR4q: if (empty($sms['content']['url'])) { goto C7mrm; } goto tzg_7; wJ56M: WD3O1: goto MmBwm; BqeuU: $orderInfo .= '姓名：' . $order['userinfo']['name'] . '<BR>'; goto kSse7; zISVX: $card_amount = round(floatval($level_data['card_amount']) + floatval($userinfo['order_fee']), 2); goto FyZAG; kjaTF: wAcg4: goto fENFw; t58xC: if (!$card) { goto WD3O1; } goto o32Lw; oiwrn: if (!($card && $card['content']['level_status'] == 1 && $userinfo['card'] == 1)) { goto E_GYT; } goto rXtA4; ZPMw4: $share_condition['one_openid'] = null; goto YviEm; J73rB: $share_condition['two_amount'] = $share_config['two']; goto elahG; FzpPl: if (!$order) { goto h93Gn; } goto Dzot1; KuIxG: $request = pdo_insert('xc_beauty_group', array("uniacid" => $uniacid, "openid" => $order['openid'], "pid" => $order['pid'], "failtime" => $service['group_limit'], "total" => $service['group_number'], "team_total" => 1, "createtime" => date('Y-m-d H:i:s'))); goto c20U5; b6tqX: $sms['content']['url'] = $header['Location'][count($header['Location']) - 1]; goto dTWAh; MWClU: UEdSG: goto xoWzu; FpTgJ: $get = str_replace('{{phonex}}', $order['userinfo']['mobile'], $get); goto f1Jpz; tD7L2: wIEJS: goto cf2fU; Y5AXt: goto erZZD; goto WeH8b; fs9Mz: $templateParam['addrx'] = '无'; goto jg4_F; Seyza: $ch = curl_init(); goto toV_n; DWKkh: goto uuT5m; goto fvd0q; ieBGl: foreach ($card['content']['level'] as $card_l) { goto as7zN; as7zN: if (!(floatval($card_amount) >= floatval($card_l['amount']))) { goto spV8W; } goto t27pU; n_pp9: $level_data['card_price'] = $card_l['price']; goto yjW6o; iNl35: Gs_la: goto htrQK; t27pU: $level_data['card_name'] = $card_l['name']; goto n_pp9; yjW6o: spV8W: goto iNl35; htrQK: } goto Ex7gM; VLG3C: header('Content-Type: text/plain; charset=utf-8'); goto mhJH1; p6Q6I: Jruhr: goto WiE5z; MVzOA: $share_config['one'] = $share['content']['level_one']; goto IqnAP; OpaeX: $share['content'] = json_decode($share['content'], true); goto YeW79; suH_z: goto sNgjY; goto dobJJ; Fsl9u: curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1); goto MNyzP; O4QKT: $share_condition['three_amount'] = $share_config['three']; goto ayki1; GP8Yg: $send = new sms(); goto XN601; yfFlA: $url_data = ''; goto iozvZ; KovUS: $share_condition['one_amount'] = $share_config['one']; goto kVMky; Vpz6N: Pya8Y: goto m5i0c; rqirc: if (!($tong_bu == 1)) { goto Kux2N; } goto ptcPu; Ex7gM: P7HEc: goto Ikh1b; xVuPG: $share_config['level'] = $share['content']['level']; goto jeJGq; taT7s: $score = intval(floatval($order['o_amount']) / floatval($card['content']['score_attr'])) * $card['content']['score_value']; goto KMpws; j6A4I: $output = curl_exec($ch); goto w1wfg; MNyzP: curl_setopt($ch, CURLOPT_POST, 1); goto Bzr8q; l1Akj: $result = json_decode($result, true); goto rGR0t; p0V27: VUAKU: goto jOIqn; chisM: v1Mt7: goto Ohh0k; sWZCD: define('SIG', sha1(USER . UKEY . STIME)); goto dX7OG; iozvZ: foreach ($get as $x3) { goto Jnlrc; Zy6Ue: ZsGpg: goto Ahjg4; Ahjg4: JuQkT: goto SVk8v; Jnlrc: if (empty($url_data)) { goto xBlQM; } goto AbSKc; oJGW5: $url_data = urlencode($x3['attr']) . '=' . urlencode($x3['value']); goto Zy6Ue; r7y1T: goto ZsGpg; goto g4tbU; g4tbU: xBlQM: goto oJGW5; AbSKc: $url_data = $url_data . '&' . urlencode($x3['attr']) . '=' . urlencode($x3['value']); goto r7y1T; SVk8v: } goto qaBnE; aTDwo: if (!$fan) { goto y8FZX; } goto rlDt1; jwbaw: xXLel: goto QLoug; lh3Cu: $times_log_total = intval($times_log['total']) + 1; goto O51Ol; OIyh9: erZZD: goto vs3g0; BE2It: $group_data['team'] = array($order['openid']); goto JmStV; w1wfg: curl_close($ch); goto HKL0u; onlf9: $card = pdo_get('xc_beauty_config', array("xkey" => "card", "uniacid" => $uniacid)); goto oiwrn; fveRR: uuT5m: goto eD0Nz; c2BDZ: xRROr: goto Seyza; KMpws: yCqzg: goto wJ56M; hp_FJ: if (!(!empty($card['content']['level']) && is_array($card['content']['level']))) { goto ukvLa; } goto ieBGl; QBSTO: $service_name = $service['name']; goto oPGdI; G4d8p: pdo_update('xc_beauty_userinfo', array("money" => $moeny), array("status" => 1, "openid" => $order['openid'])); goto Ya4Za; ed_sN: UhdWq: goto u4PPP; bA1Un: pdo_insert('xc_beauty_share', array("uniacid" => $uniacid, "openid" => $share_condition['one_openid'], "title" => "一级订单结算奖励", "out_trade_no" => $order['out_trade_no'], "amount" => $share_condition['one_amount'], "level" => 1, "status" => -1, "createtime" => date('Y-m-d H:i:s'))); goto vznyf; XbbBU: if ($order['date_type'] == 1) { goto wIEJS; } goto K3Azp; Km0Oh: IUijq: goto SWPzM; VzeuL: wurR0: goto nM1vj; wYF2d: if (!is_array($customize)) { goto SNWzz; } goto oL2CG; UAALG: goto gdRwF; goto tD7L2; pM_8Q: $post = str_replace('{{addrx}}', $order['userinfo']['address'], $post); goto IeXBw; sRqtg: $input = file_get_contents('php://input'); goto oPER2; PSc1C: $get = str_replace('{{amount}}', $order['o_amount'] . '元', $get); goto hrp9B; OUiGr: foreach ($post as $x2) { $data[$x2['attr']] = $x2['value']; rsDYb: } goto c2BDZ; UNJLs: h93Gn: goto U67sp; c7mpI: if ($print['content']['type'] == 1) { goto Lg90d; } goto GYqAy; CWRLg: $smsConf = array("key" => $sms['content']['key'], "mobile" => $sms['content']['mobile'], "tpl_id" => $sms['content']['tpl_id'], "tpl_value" => $tpl_value); goto oSd7I; W45LH: if (empty($share['content']['type'])) { goto VUAKU; } goto n1ezv; QLoug: $post = str_replace('{{webnamex}}', $config['content']['title'], $post); goto LoSsf; o5guC: if ($share_config['type'] == 1) { goto Z2D_1; } goto Te5uW; uPUoh: logging_run('result:' . $result); goto l1Akj; VJxoH: $content .= '商品：' . $service_name . '\\r\\n'; goto JDeOA; x9c8w: $get = ''; goto y43KG; dTWAh: hiKiH: goto jS9Zo; l_4Li: if (!($group_data['status'] == 1)) { goto MeY_9; } goto euok9; ulJhp: $orderInfo .= '订单号：' . $order['out_trade_no'] . '<BR>'; goto NkmuB; nNj4n: KcXPz: goto MOopZ; U7h8L: logging_run('天工'); goto cd4vj; ySSap: $score = null; goto eIche; oPGdI: $time = time(); goto g51a3; CacAK: miV2r: goto aEf74; LLPrc: if (!empty($order['userinfo']['address'])) { goto mRqHH; } goto zx6Wl; R2blJ: pdo_update('xc_beauty_userinfo', array("money" => $money), array("status" => 1, "uniacid" => $uniacid, "openid" => $order['openid'])); goto tz92N; U67sp: echo 'SUCCESS'; goto nfqH5; I0OAx: $share_config['three'] = $share['content']['level_three']; goto p0V27; WzTZK: $group = pdo_getall('xc_beauty_group', array("uniacid" => $uniacid, "openid" => $order['openid']), array(), '', 'id DESC'); goto cEJv3; y43KG: load()->func('logging'); goto U7h8L; Dkbwj: Z2D_1: goto RI2d3; CRN7T: if ($share_config['type'] == 1) { goto wqC2q; } goto W1lo1; eSR1F: Kux2N: goto OYBOg; oPER2: $isxml = true; goto x9c8w; DkJpJ: $requestUrl = 'http://open.10ss.net:8888'; goto EIOPi; uOP33: goto r3bE9; goto chisM; ez0J7: if (!$list) { goto bSld7; } goto muios; UJEQU: if (!empty($order['group'])) { goto SxeDo; } goto KuIxG; mGCab: goto kPfzk; goto MPzr2; cguyJ: $group_data['status'] = 1; goto s5DC0; dQH3f: M8t22: goto FY4t0; B3nZL: $sms['content']['url'] = $sms['content']['url'] . $url_data; goto q1Ai3; Sj9nP: $sendUrl = 'http://v.juhe.cn/sms/send'; goto tIKme; jKzpR: $uniacid = $order['uniacid']; goto GHPor; R4MaF: YPvqE: goto WxQmp; dX7OG: $service_list = pdo_getall('xc_cake_service', array("uniacid" => $uniacid)); goto YCtup; DwKET: if (!empty($order['userinfo']['address'])) { goto Ab1J9; } goto fKKDl; dfX2d: $sms['content']['url'] = $header['Location']; goto fDNxS; m5i0c: hj2sM: goto wooeT; t0knn: pdo_update('xc_beauty_userinfo', array("score" => $user_score), array("status" => 1, "openid" => $order['openid'], "uniacid" => $uniacid)); goto DWKkh; aswl1: $content .= '地址：' . $order['userinfo']['address'] . '\\r\\n'; goto HlpDw; seGcV: curl_setopt($ch, CURLOPT_URL, $sms['content']['url']); goto F9rg8; egx_r: MeY_9: goto Vpz6N; LH4zz: $orderInfo = '<CB>订单</CB><BR>'; goto ulJhp; PYpbb: if (empty($service['type'])) { goto GXNzE; } goto rFX8S; yNNbq: foreach ($data_dd as &$dddd) { goto Au_RT; WrXya: $data[$dddd[0]] = $dddd[1]; goto QaHHC; Au_RT: $dddd = explode('=', $dddd); goto WrXya; QaHHC: NLWnO: goto nLWfw; nLWfw: } goto MWClU; Fit5T: $post = json_encode($post); goto kKt_j; muios: foreach ($list as $l) { goto tKLgF; AbBko: pdo_insert('xc_beauty_score', array("uniacid" => $uniacid, "openid" => $l['openid'], "status" => 1, "score" => $l['score'], "over" => $user_score, "title" => "消费", "createtime" => date('Y-m-d H:i:s'))); goto cMInQ; S2muq: goto xJ84p; goto Znnir; N879v: YP6JC: goto H1UmI; ZaHDx: if (!($card && $card['content']['level_status'] == 1 && $userinfo['card'] == 1)) { goto SsMAA; } goto McFQS; hSRF9: jbkpU: goto YB1_5; YB1_5: xJ84p: goto AbBko; Cz9GY: $tong_bu = scoreCheck($uniacid); goto XTiH1; SdcL8: $userinfo = pdo_get('xc_beauty_userinfo', array("status" => 1, "openid" => $l['openid'])); goto Cz9GY; AWHDN: w7P32: goto eDpmT; t3qaf: if (empty($l['two_openid'])) { goto VVJCk; } goto Mb2TQ; cMInQ: nI6xb: goto ZaHDx; r3UGd: $fan = mc_fetch_one($userinfo['openid']); goto oHvyY; XTiH1: if (!($tong_bu == 1)) { goto xy8Pp; } goto mcYlR; AFubW: pdo_insert('xc_beauty_share', array("uniacid" => $uniacid, "openid" => $l['three_openid'], "title" => "三级订单结算奖励", "out_trade_no" => $l['out_trade_no'], "amount" => $l['three_amount'], "level" => 3, "status" => -1, "createtime" => date('Y-m-d H:i:s'))); goto AWHDN; xUY9g: $card_amount = round(floatval($level_data['card_amount']) + floatval($userinfo['order_fee']), 2); goto m_HYt; nL8Km: foreach ($card['content']['level'] as $card_l) { goto UQh_F; thmLW: UB6gI: goto l6UY7; u4vLl: $level_data['card_name'] = $card_l['name']; goto yS0Wh; UQh_F: if (!(floatval($card_amount) >= floatval($card_l['amount']))) { goto qbqab; } goto u4vLl; yS0Wh: $level_data['card_price'] = $card_l['price']; goto IBPAF; IBPAF: qbqab: goto thmLW; l6UY7: } goto d0U9q; T6Cmt: TzQu5: goto t3qaf; eDpmT: wDxnV: goto yW3_V; WMMZY: if (!$fan) { goto tV9tp; } goto vfPez; M50ol: mc_credit_update($fan['uid'], 'credit1', $l['score'], $log = array(0, "消费", $_GPC['m'], 1, 0, 2)); goto hSRF9; M1FIa: pdo_insert('xc_beauty_share', array("uniacid" => $uniacid, "openid" => $l['one_openid'], "title" => "一级订单结算奖励", "out_trade_no" => $l['out_trade_no'], "amount" => $l['one_amount'], "level" => 1, "status" => -1, "createtime" => date('Y-m-d H:i:s'))); goto T6Cmt; McFQS: $level_data = array(); goto I05pu; I05pu: $level_data['card_amount'] = round(floatval($userinfo['card_amount']) + floatval($l['o_amount']), 2); goto xUY9g; d0U9q: iEdvD: goto N879v; pkbBC: pdo_update('xc_beauty_userinfo', array("score" => $user_score), array("status" => 1, "openid" => $l['openid'], "uniacid" => $uniacid)); goto S2muq; Znnir: HUaaa: goto r3UGd; H1UmI: pdo_update('xc_beauty_userinfo', $level_data, array("openid" => $l['openid'], "uniacid" => $uniacid)); goto Rt3Pm; vfPez: $userinfo['score'] = $fan['credit1']; goto WhwFR; tKLgF: if (empty($l['score'])) { goto nI6xb; } goto SdcL8; Rt3Pm: SsMAA: goto p083k; p083k: if (empty($l['one_openid'])) { goto TzQu5; } goto M1FIa; r6CXg: $user_score = $userinfo['score'] + $l['score']; goto xKaoV; Mb2TQ: pdo_insert('xc_beauty_share', array("uniacid" => $uniacid, "openid" => $l['two_openid'], "title" => "二级订单结算奖励", "out_trade_no" => $l['out_trade_no'], "amount" => $l['two_amount'], "level" => 2, "status" => -1, "createtime" => date('Y-m-d H:i:s'))); goto xSVAm; mcYlR: $fan = mc_fetch_one($userinfo['openid']); goto WMMZY; oHvyY: if (!$fan) { goto jbkpU; } goto M50ol; vpxb6: if (empty($l['three_openid'])) { goto w7P32; } goto AFubW; xKaoV: if ($tong_bu == 1) { goto HUaaa; } goto pkbBC; GWoTa: xy8Pp: goto r6CXg; WhwFR: tV9tp: goto GWoTa; m_HYt: if (!(!empty($card['content']['level']) && is_array($card['content']['level']))) { goto YP6JC; } goto nL8Km; xSVAm: VVJCk: goto vpxb6; yW3_V: } goto u1KZ_; LH7L1: goto NvtY5; goto eQZeo; tz92N: XdjM2: goto egH32; ssdFZ: $customize = $sms['content']['customize']; goto XaaGH; TkmhO: A2zZa: goto ed_sN; iWkSC: $tong_bu = scoreCheck($uniacid); goto rqirc; U46Hn: $moeny = round(floatval($userinfo['money']) - floatval($order['canpay']), 2); goto KLNV_; RpL5K: $share_status = 1; goto Gtjjb; n5iJQ: goto Z9R2U; goto agLl8; vO9Nh: if (!$share) { goto JyNz3; } goto OpaeX; PApNL: if (empty($share['content']['level'])) { goto FxWzU; } goto xVuPG; JTKAL: goto r2bZY; goto dbvqZ; AncGH: logging_run('order:' . json_encode($order)); goto FzpPl; k3M8d: if (!empty($order['userinfo']['address'])) { goto cUuNM; } goto c6k8J; fpsvM: $share_config['three'] = $service['level_three']; goto qQSIp; Dzot1: $url = 'https://api.teegon.com/router?method=teegon.payment.charge.info&app_key=MRpZFBi&client_secret=6A8mDpirh2bhyjwG7GSC'; goto XGVTG; d39RF: $tpl_value = $tpl_value . '&#addrx#=' . $order['userinfo']['address']; goto cWB49; IeXBw: vPmyL: goto N0evS; eg6o2: $content .= '实付款：' . $order['o_amount'] . '\\r\\n'; goto Mdp1g; F2KM3: mE017: goto ZN2L3; A3Mt5: $get = str_replace('{{addrx}}', '无', $get); goto Ui6jF; VajFx: $content .= '手机：' . $order['userinfo']['mobile'] . '\\r\\n'; goto LLPrc; mhJH1: $templateParam = array("webnamex" => $config['content']['title'], "trade" => $order['out_trade_no'], "amount" => $order['o_amount'], "namex" => $order['userinfo']['name'], "phonex" => $order['userinfo']['mobile'], "datex" => $order['plan_date']); goto hYJ5b; YYOuW: foreach ($service_list as $sl) { $service_data[$sl['id']] = $sl; By3IR: } goto idFba; Jr3Gx: $post = str_replace('{{phonex}}', $order['userinfo']['mobile'], $post); goto k3M8d; Te5uW: if (!($share_config['type'] == 2)) { goto VH9tz; } goto O4QKT; hrp9B: $get = str_replace('{{namex}}', $order['userinfo']['name'], $get); goto FpTgJ; qaBnE: bb29y: goto I3bBN; FH3Kc: $ch = curl_init(); goto seGcV; K3Azp: if (!($order['date_type'] == 2)) { goto OYhha; } goto fvaMX; cd4vj: if (empty($input)) { goto Kyfqp; } goto gUYGq; XjePw: if (!($share_status == 1)) { goto gvSFm; } goto Ad1m0; Z45Uo: $share_status = $share['content']['status']; goto LtLM0; Mwdv3: include dirname(__FILE__) . '/resource/HttpClient.class.php'; goto HGf7a; yGmqu: r2bZY: goto phgpg; eIche: $card = pdo_get('xc_beauty_config', array("xkey" => "card", "uniacid" => $uniacid)); goto t58xC; OpI9K: if (empty($order['coupon_id'])) { goto KMWG0; } goto OcV9y; nfqH5: Kyfqp: goto p60LN; CNRra: $config['content'] = json_decode($config['content'], true); goto LzHx2; tzg_7: $header = get_headers($sms['content']['url'] . '&xcdubuge=1', 1); goto k7k9X; KTTJL: pdo_insert('xc_beauty_times_log', array("uniacid" => $uniacid, "member" => $order['member'], "plan_date" => $order['plan_date'], "total" => 1, "createtime" => date('Y-m-d H:i:s'))); goto smqdO; uIHqA: CtQE_: goto dQH3f; bSMvo: bc7V2: goto jwbaw; i0242: RKEzp: goto HHYmx; YviEm: $share_condition['one_amount'] = null; goto zn5Ju; n4jQF: if (!($order['order_type'] == 5)) { goto dKAWu; } goto Eu8El; aXUlr: m3rMA: goto eSR1F; vigWz: C7mrm: goto CsH2D; Ad1m0: if (empty($share_condition['one_openid'])) { goto DVIQk; } goto bA1Un; Zaxyj: cUuNM: goto pM_8Q; vJVOR: dSM1W: goto OgL7n; I3bBN: if (strpos($sms['content']['url'], '?') !== false) { goto X1_Pf; } goto owO8M; xoWzu: logging_run('input:' . json_encode($data)); goto f6ebT; dD9Y5: $orderInfo .= '日期：' . $order['plan_date'] . '<BR>'; goto ZY604; KVQRj: if (empty($share_condition['three_openid'])) { goto T7vYf; } goto r0txA; GYqAy: if (!($print['content']['type'] == 2)) { goto Jg9NY; } goto Mwdv3; rlDt1: mc_credit_update($fan['uid'], 'credit1', $score, $log = array(0, "消费", $_GPC['m'], 1, 0, 2)); goto Rx1Dx; HKNob: $userinfo = pdo_get('xc_beauty_userinfo', array("status" => 1, "uniacid" => $uniacid, "openid" => $order['openid'])); goto Vlz9g; EVXxw: $content .= '日期：' . $order['plan_date'] . '\\r\\n'; goto rwCoq; OgL7n: $two = pdo_get('xc_beauty_userinfo', array("status" => 1, "openid" => $one['share'], "uniacid" => $uniacid)); goto kBcu0; WeH8b: wqC2q: goto japS3; FY4t0: Z9R2U: goto VzeuL; p60LN: } public function doWebWxPay() { goto UTNt3; ZodkK: $order = pdo_get('xc_beauty_withdraw', array("id" => $_GPC['id'], "uniacid" => $uniacid)); goto hzK1c; YCtYg: iJDKO: goto ZA71h; Sp1s3: $xml = array2xml($arr); goto dbhoY; C4QK6: $arr = array(); goto IJonW; qIu2N: goto aKm0j; goto HyU5g; M7_S4: aKm0j: goto WI3Aj; BwLAv: echo json_encode($json); goto QpLCX; DXaDP: exit; goto cxCQQ; iryQx: unlink(ATTACHMENT_ROOT . $_W['uniacid'] . '_wechat_refund_all.pem'); goto HN2jz; d3H7V: echo json_encode($json); goto Qv8r_; hzK1c: if ($order) { goto iJDKO; } goto DzeqT; b87J9: $arr['sign'] = md5($str); goto h8eGA; HP3bi: ksort($arr); goto Ua1M0; mycIa: ALAjr: goto liuGX; eNKpp: echo json_encode($json); goto DXaDP; wuRXH: e0iXO: goto L6581; tYT94: S5cep: goto GXza8; dbhoY: $response = ihttp_request($url, $xml, array(CURLOPT_SSLCERT => ATTACHMENT_ROOT . $_W['uniacid'] . '_wechat_refund_all.pem')); goto iryQx; QpLCX: exit; goto eLKGr; cxCQQ: goto qQ6Bn; goto YCtYg; EMgvk: $json = array("status" => -1, "msg" => $data['err_code'] . '：' . $data['err_code_des']); goto OctV0; Quwz1: $json = array("status" => -1, "msg" => "缺少微信证书"); goto IgkfA; liuGX: $request = pdo_update('xc_beauty_withdraw', array("status" => 1, "wx_out_trade_no" => $data['payment_no']), array("id" => $_GPC['id'], "uniacid" => $uniacid)); goto SoMFo; UTNt3: global $_GPC, $_W; goto J71pC; IJonW: $arr['mch_appid'] = $_W['account']['key']; goto TyDQY; HN2jz: if ($response) { goto bTPu_; } goto NVEWC; Ua1M0: $str = ''; goto rl6Vb; AMkpV: $arr['partner_trade_no'] = $order['out_trade_no']; goto Eh6Og; S02pW: $url = 'https://api.mch.weixin.qq.com/mmpaymkttransfers/promotion/transfers'; goto HP3bi; hl679: exit; goto VjCaM; dYIsz: $user_IP = $_SERVER['HTTP_VIA'] ? $_SERVER['HTTP_X_FORWARDED_FOR'] : $_SERVER['REMOTE_ADDR']; goto Fn_Uh; ZA71h: $setting = uni_setting_load('payment', $_W['uniacid']); goto XgJ1J; glrhY: goto RcmW0; goto raZCx; ihkQW: $arr['check_name'] = 'NO_CHECK'; goto rb3R6; SoMFo: if ($request) { goto e0iXO; } goto rGP5q; raZCx: bTPu_: goto Cq2IJ; K_wLz: if ($data['return_code'] == 'SUCCESS') { goto aQlkN; } goto Z8jJL; Fn_Uh: $user_IP = $user_IP ? $user_IP : $_SERVER['REMOTE_ADDR']; goto DBAa9; AKHs5: $key = authcode($refund_setting['key'], 'DECODE'); goto E1_TU; YmV85: $desc = '提现'; goto t6Ou9; NVEWC: $json = array("status" => -1, "msg" => $response['message']); goto sAB94; J71pC: $uniacid = $_W['uniacid']; goto ZodkK; tF37f: qQ6Bn: goto TR8wF; NZhlX: $cert = authcode($refund_setting['cert'], 'DECODE'); goto AKHs5; VjCaM: goto dSVqn; goto mycIa; TyDQY: $arr['mchid'] = $setting['payment']['wechat']['mchid']; goto tM9CN; IgkfA: echo json_encode($json); goto LwK6Z; DBAa9: $arr['spbill_create_ip'] = $user_IP; goto S02pW; Z8jJL: $json = array("status" => -1, "msg" => $data['return_msg']); goto d3H7V; XgJ1J: $refund_setting = $setting['payment']['wechat_refund']; goto XL3nX; tM9CN: $arr['nonce_str'] = random(8); goto AMkpV; E1_TU: file_put_contents(ATTACHMENT_ROOT . $_W['uniacid'] . '_wechat_refund_all.pem', $cert . $key); goto C4QK6; sAB94: echo json_encode($json); goto bRfc2; h8eGA: load()->func('communication'); goto Sp1s3; t6Ou9: $arr['desc'] = $desc; goto dYIsz; GXza8: dSVqn: goto M7_S4; VLpDG: exit; goto tYT94; SmoQO: oQw0U: goto XzcZo; LdsS3: echo json_encode($json); goto VLpDG; XL3nX: if (!(empty($refund_setting['key']) || empty($refund_setting['cert']))) { goto BFUJe; } goto Quwz1; XzcZo: $str .= 'key=' . $setting['payment']['wechat']['signkey']; goto b87J9; NfpUe: BFUJe: goto NZhlX; WI3Aj: RcmW0: goto tF37f; bRfc2: exit; goto glrhY; rl6Vb: foreach ($arr as $k => $v) { $str .= $k . '=' . $v . '&'; eo7_g: } goto SmoQO; LwK6Z: exit; goto NfpUe; Eh6Og: $arr['openid'] = $order['openid']; goto ihkQW; rb3R6: $arr['amount'] = floatval($order['amount']) * 100; goto YmV85; DzeqT: $json = array("status" => -1, "msg" => "查询不到订单"); goto eNKpp; rGP5q: $json = array("status" => -1, "msg" => "提现成功，数据写入失败"); goto BwLAv; iV1Vp: if ($data['result_code'] == 'SUCCESS') { goto ALAjr; } goto EMgvk; Qv8r_: exit; goto qIu2N; OctV0: echo json_encode($json); goto hl679; eLKGr: goto S5cep; goto wuRXH; HyU5g: aQlkN: goto iV1Vp; Cq2IJ: $data = xml2array($response['content']); goto K_wLz; L6581: $json = array("status" => 1, "msg" => "提现成功"); goto LdsS3; TR8wF: } public function doWebStoreWxPay() { goto AwGv7; D4lba: $url = 'https://api.mch.weixin.qq.com/mmpaymkttransfers/promotion/transfers'; goto lrrjO; Vk1V7: F1LKW: goto i_z7N; c1AQQ: $json = array("status" => 1, "msg" => "提现成功"); goto YoBcu; iQmKf: $arr['mchid'] = $setting['payment']['wechat']['mchid']; goto l5ACr; tbfVe: $json = array("status" => -1, "msg" => json_encode($response)); goto eLVfd; Pa_Bq: $response = ihttp_request($url, $xml, array(CURLOPT_SSLCERT => ATTACHMENT_ROOT . $_W['uniacid'] . '_wechat_refund_all.pem')); goto wsiBS; lrrjO: ksort($arr); goto sjLRb; mXAlW: exit; goto HTJSg; l5ACr: $arr['nonce_str'] = random(8); goto rfRsQ; OXHg6: PhS2S: goto JXKxz; uE3Re: if ($data['result_code'] == 'SUCCESS') { goto cabq2; } goto DDQci; e9ohw: $arr = array(); goto ylFg_; EH0wk: $uniacid = $_W['uniacid']; goto tw43j; wJW0Y: GE3Go: goto kBnRL; zQWPp: $cert = authcode($refund_setting['cert'], 'DECODE'); goto EY3Vj; lU8oH: k7JZy: goto ELo6k; i1P3B: $json = array("status" => -1, "msg" => $data['return_msg']); goto jMugS; wsiBS: unlink(ATTACHMENT_ROOT . $_W['uniacid'] . '_wechat_refund_all.pem'); goto Ozju3; lE1qb: load()->func('communication'); goto qfsFh; kVDYq: exit; goto xKxUO; lLeA4: $arr['openid'] = $order['openid']; goto HsGbK; Jc51p: goto yGYG_; goto oIspe; eLVfd: echo json_encode($json); goto iTAmm; HTJSg: goto qsAPg; goto OXHg6; nwRyS: $user_IP = $_SERVER['HTTP_VIA'] ? $_SERVER['HTTP_X_FORWARDED_FOR'] : $_SERVER['REMOTE_ADDR']; goto KhRbd; i_z7N: $str .= 'key=' . $setting['payment']['wechat']['signkey']; goto W_K6W; xwcwi: foreach ($arr as $k => $v) { $str .= $k . '=' . $v . '&'; dhfk0: } goto Vk1V7; YoBcu: echo json_encode($json); goto lKUlU; ccj6r: $data = xml2array($response['content']); goto zJqId; ymSTl: if ($request) { goto OmyqJ; } goto YsSHA; Ozju3: if ($response) { goto NcAyU; } goto tbfVe; AB_o_: $arr['desc'] = $desc; goto nwRyS; AGn7f: $request = pdo_update('xc_beauty_store_fee', array("status" => 1, "wx_out_trade_no" => $data['payment_no']), array("id" => $_GPC['id'], "uniacid" => $uniacid)); goto ymSTl; zJqId: if ($data['return_code'] == 'SUCCESS') { goto KsFRe; } goto i1P3B; tw43j: $order = pdo_get('xc_beauty_store_fee', array("id" => $_GPC['id'], "uniacid" => $uniacid)); goto kT4Yz; JXKxz: $setting = uni_setting_load('payment', $_W['uniacid']); goto WX_0g; KhRbd: $user_IP = $user_IP ? $user_IP : $_SERVER['REMOTE_ADDR']; goto Ij8Za; LINa6: file_put_contents(ATTACHMENT_ROOT . $_W['uniacid'] . '_wechat_refund_all.pem', $cert . $key); goto e9ohw; iuNfy: echo json_encode($json); goto rrouc; P1iQw: cabq2: goto AGn7f; WX_0g: $refund_setting = $setting['payment']['wechat_refund']; goto dUuJG; lKUlU: exit; goto z02zh; eJTWb: echo json_encode($json); goto kVDYq; RHzhK: $json = array("status" => -1, "msg" => "查询不到订单"); goto wg90B; x_Psu: $json = array("status" => -1, "msg" => "缺少微信证书"); goto pu2tL; Cu1ds: $desc = '提现'; goto AB_o_; sjLRb: $str = ''; goto xwcwi; MOrUX: OmyqJ: goto c1AQQ; dUuJG: if (!(empty($refund_setting['key']) || empty($refund_setting['cert']))) { goto vMGj2; } goto x_Psu; W4Q4f: exit; goto Jc51p; Ij8Za: $arr['spbill_create_ip'] = $user_IP; goto D4lba; jMugS: echo json_encode($json); goto W4Q4f; iTAmm: exit; goto n12Mz; wg90B: echo json_encode($json); goto mXAlW; B0DI7: exit; goto zOnWK; pu2tL: echo json_encode($json); goto B0DI7; YsSHA: $json = array("status" => -1, "msg" => "提现成功，数据写入失败"); goto iuNfy; xKxUO: goto k7JZy; goto P1iQw; kBnRL: qsAPg: goto KomV3; zOnWK: vMGj2: goto zQWPp; W_K6W: $arr['sign'] = md5($str); goto lE1qb; n12Mz: goto GE3Go; goto cVJf0; ELo6k: yGYG_: goto wJW0Y; oPCS4: goto Y2zyD; goto MOrUX; z02zh: Y2zyD: goto lU8oH; ylFg_: $arr['mch_appid'] = $_W['account']['key']; goto iQmKf; rfRsQ: $arr['partner_trade_no'] = $order['pid']; goto lLeA4; qfsFh: $xml = array2xml($arr); goto Pa_Bq; AwGv7: global $_GPC, $_W; goto EH0wk; oIspe: KsFRe: goto uE3Re; gnjGZ: $arr['amount'] = floatval($order['amount']) * 100; goto Cu1ds; kT4Yz: if ($order) { goto PhS2S; } goto RHzhK; EY3Vj: $key = authcode($refund_setting['key'], 'DECODE'); goto LINa6; HsGbK: $arr['check_name'] = 'NO_CHECK'; goto gnjGZ; cVJf0: NcAyU: goto ccj6r; rrouc: exit; goto oPCS4; DDQci: $json = array("status" => -1, "msg" => $data['err_code'] . '：' . $data['err_code_des']); goto eJTWb; KomV3: } public function doWebUpSql() { include_once IA_ROOT . '/addons/xc_beauty/upsql.php'; upsql(); } public function doMobileGroupRefund() { goto EGpa2; IjB0w: if (!$group_config) { goto N1mV8; } goto n5M_C; CYgBZ: N1mV8: goto y_S6V; OURb2: pdgEg: goto Xvu7e; i7qeN: if (!$group) { goto pdgEg; } goto HVcXo; AvYBM: set_time_limit(0); goto cqX0A; tkQqO: $uniacid = $_W['uniacid']; goto AvYBM; n5M_C: $group_config['content'] = json_decode($group_config['content'], true); goto gFvbG; y_S6V: foreach ($group as &$g) { goto BN63J; ir_He: sIfzR: goto QaEgL; Ag32H: $tiangong = $config['content']['tiangong']; goto f9joO; CR8yo: exit; goto X8zdH; Y3lp7: $config = pdo_get('xc_beauty_config', array("xkey" => "web", "uniacid" => $uniacid)); goto cranY; cranY: if (!$config) { goto C8EvC; } goto u_EmI; CUyub: $can_list = 1; goto rlqhl; lSUEP: $transaction_id = $order['wx_out_trade_no']; goto MYyKc; HVDF8: if (!($data['result_code'] == 'SUCCESS')) { goto lvp53; } goto CUyub; sF1iG: mG8TS: goto IBfwt; QNRYM: goto mG8TS; goto YDMhg; VoGdx: goto DD1Tu; goto yPsuR; ceyah: $refund_fee = floatval($_GPC['amount']) * 100; goto pKp_Y; REl71: Ni2oK: goto XjhD1; z5RDl: Hbnfv: goto sYghM; YE0Bu: $config['content'] = json_decode($config['content'], true); goto UTLWr; kcp0Y: $xml = array2xml($refund); goto Qqh9Q; mvql5: pdo_update('xc_beauty_order', array("refund_status" => -1, "status" => 2), array("id" => $order['id'], "uniacid" => $uniacid)); goto QNRYM; Mq63V: echo json_encode($json); goto ZEIY5; pKp_Y: oW6Gc: goto hJMMu; s6qb_: $result = vpost($url, $data); goto HiRoG; iRoU7: $user_id = ''; goto Y3lp7; qhFRr: if ($group_refund == 1) { goto Dp9c5; } goto zEWRE; ZJpJu: $agent_id = $config['content']['agent_id']; goto viUgR; d7wAE: v03Cu: goto E2w9d; ky53R: if (!(floatval($order['canpay']) != 0)) { goto V5L2U; } goto PbolS; ZEgzU: $refund['sign'] = $ref; goto zfppD; bCRfw: $result = json_decode($result, true); goto Yl5cW; HgkM1: $data = array("agent_id" => $agent_id, "user_id" => $user_id, "secret_type" => 1); goto s6qb_; WhB_Z: if ($tiangong == 1 && !empty($AppKey) && !empty($AppSecret)) { goto c8EyP; } goto SPHqH; ubXIX: goto Hbnfv; goto ir_He; jFv85: if (!empty($result['result'])) { goto sIfzR; } goto ubXIX; FXDSw: i7rC5: goto FEYfY; GwFQj: $data = array("charge_id" => $order['charge_id'], "amount" => $order['wxpay']); goto qoLBQ; ZEIY5: exit; goto YDUJB; QMJ_s: $data = xml2array($response['content']); goto cm0o9; UyfGr: RCu4a: goto HSTYK; UZRGb: $order = pdo_get('xc_beauty_order', array("status" => 1, "uniacid" => $uniacid, "group" => $g['id'], "openid" => $g['openid'])); goto jj3mX; blddY: $agent_id = ''; goto iRoU7; Yl5cW: if (!empty($result['result'])) { goto NL8BN; } goto jfifI; E7qWH: pdo_update('xc_beauty_order', array("refund_status" => 1, "status" => 2, "refundtime" => date('Y-m-d H:i:s')), array("id" => $order['id'], "uniacid" => $uniacid)); goto sF1iG; ccRJi: $g['team'] = json_decode($g['team'], true); goto pW8Cb; sYghM: aWbS8: goto UGV7h; p0jMW: $ref = strtoupper(md5('appid=' . $refund['appid'] . '&mch_id=' . $refund['mch_id'] . '&nonce_str=' . $refund['nonce_str'] . '&out_refund_no=' . $refund['out_refund_no'] . '&out_trade_no=' . $refund['out_trade_no'] . '&refund_fee=' . $refund['refund_fee'] . '&total_fee=' . $refund['total_fee'] . '&key=' . $setting['payment']['wechat']['signkey'])); goto ZEgzU; B8D6V: $refund_setting = $setting['payment']['wechat_refund']; goto wzUpH; qoLBQ: $result = vpost($url, $data); goto bCRfw; j7JeC: if (floatval($order['wxpay']) != 0) { goto VMA7t; } goto hW5st; zEWRE: if (!($group_refund == 2)) { goto U9fF0; } goto rFl1N; tiSne: $key = authcode($refund_setting['key'], 'DECODE'); goto V02Km; HSTYK: goto t1dos; goto gA9ys; gKeD1: pdo_query($sql, array(":group_stock" => $order['total'], ":uniacid" => $uniacid, ":id" => $order['pid'])); goto REl71; YDMhg: PZI6C: goto ky53R; UTLWr: o9lGw: goto oVVEa; H039R: pdo_update('xc_beauty_order', array("refund_status" => -1, "status" => 2), array("id" => $order['id'], "uniacid" => $uniacid)); goto d7wAE; b1EU5: Wq2QZ: goto UJpY4; FGLo6: if (!empty($order['charge_id'])) { goto xHHFz; } goto ib3nA; rsywu: goto v03Cu; goto PB60B; SPHqH: $setting = uni_setting_load('payment', $_W['uniacid']); goto B8D6V; aRVX2: $cert = authcode($refund_setting['cert'], 'DECODE'); goto tiSne; lXEoW: o_FlF: goto FXDSw; pW8Cb: foreach ($g['team'] as $gg) { goto TZTTh; omnjZ: $agent_id = ''; goto XIzDY; K1Uuq: $result = json_decode($result, true); goto fqqfP; ZW2FG: $AppKey = $config['content']['AppKey']; goto zHBxs; s3rUQ: if (!($data['return_code'] == 'SUCCESS')) { goto zO4CP; } goto s2nLA; Iw4gz: boHgD: goto RZMno; RMP6Z: $data = array("agent_id" => $agent_id, "user_id" => $user_id, "secret_type" => 1); goto PTmK7; IXmgL: $total_fee = floatval($order['wxpay']) * 100; goto ne3Bn; zHBxs: $AppSecret = $config['content']['AppSecret']; goto snidz; v78md: exit; goto GU_CW; gZwjS: if (empty($_GPC['amount'])) { goto boHgD; } goto cWsZ1; AzeNK: yd8ga: goto UDOoZ; gM7we: fRFsz: goto zsz7O; WKbja: $cert = authcode($refund_setting['cert'], 'DECODE'); goto RKO6B; zsz7O: oQaTx: goto Af6yR; EdWrq: VGUKd: goto V33po; DHS0v: if (!($refund_setting['switch'] != 1)) { goto CLX2k; } goto euxC1; SSfex: if (!$order) { goto saOcf; } goto qYCWO; uJ9xS: exit; goto LpD5R; mhC0S: $can_list = 1; goto CHOqb; io7Lg: qfC2M: goto dCHNx; cOYsH: pdo_update('xc_beauty_order', array("refund_status" => -1, "status" => 2), array("id" => $order['id'], "uniacid" => $uniacid)); goto v78md; TZTTh: $order = pdo_get('xc_beauty_order', array("status" => 1, "uniacid" => $uniacid, "group" => $g['id'], "openid" => $gg)); goto SSfex; QRjS4: bmSnc: goto PA31N; B4i2j: $setting = uni_setting_load('payment', $_W['uniacid']); goto PF9Xl; Om9Bx: $money = round(floatval($userinfo['money']) + floatval($order['canpay']), 2); goto Aa51c; HJ1Hs: saOcf: goto foC48; PA31N: if (empty($order['charge_id'])) { goto qfC2M; } goto TpWgO; s2nLA: if (!($data['result_code'] == 'SUCCESS')) { goto eFyeB; } goto cq_46; foC48: P1eGS: goto B4pOr; TpWgO: $url = 'https://api.teegon.com/router?method=teegon.agent.mfuser.get.pay.secret&app_key=' . $AppKey . '&client_secret=' . $AppSecret; goto RMP6Z; I32ff: unlink(ATTACHMENT_ROOT . $_W['uniacid'] . '_wechat_refund_all.pem'); goto gGRX4; YProa: if (floatval($order['wxpay']) != 0) { goto bYQMe; } goto mhC0S; T3JAk: eFyeB: goto S7fCz; YsZA1: if (!(!empty($config['content']['tiangong']) && !empty($config['content']['AppKey']) && !empty($config['content']['AppSecret']))) { goto fRFsz; } goto oXfpa; QiIzR: $string = md5($string); goto xn9_j; DI2zG: r5Due: goto A57VG; IQVRD: pdo_update('xc_beauty_order', array("refund_status" => -1, "status" => 2), array("id" => $order['id'], "uniacid" => $uniacid)); goto KH29j; j9574: FP4Fp: goto fVsaX; oXfpa: $tiangong = $config['content']['tiangong']; goto ZW2FG; Yv8bq: iOat3: goto jUhdd; xn9_j: $refund['sign'] = strtoupper($string); goto wrPDB; JhWWF: if (!(floatval($order['canpay']) != 0)) { goto m0xAS; } goto OkNTP; r7kKS: bYQMe: goto n5zaq; jUhdd: pdo_update('xc_beauty_order', array("refund_status" => 1, "status" => 2, "refundtime" => date('Y-m-d H:i:s')), array("id" => $order['id'], "uniacid" => $uniacid)); goto EdWrq; A57VG: $sql = 'UPDATE ' . tablename('xc_beauty_service') . ' SET group_stock=group_stock+:group_stock WHERE uniacid=:uniacid AND id=:id AND group_stock>=0'; goto bhWx0; n5zaq: $tiangong = -1; goto EGMqU; bUCSl: JA8S5: goto CSU6x; St8CF: $config['content'] = json_decode($config['content'], true); goto YsZA1; RIIl1: $response = ihttp_request($url, $xml, array(CURLOPT_SSLCERT => ATTACHMENT_ROOT . $_W['uniacid'] . '_wechat_refund_all.pem')); goto I32ff; XIzDY: $user_id = ''; goto OpuFG; o7quB: xl1Du: goto io7Lg; PTmK7: $result = vpost($url, $data); goto K1Uuq; A5AIJ: $user_id = $config['content']['user_id']; goto gM7we; RZMno: $url = 'https://api.mch.weixin.qq.com/secapi/pay/refund'; goto yKAtw; ne3Bn: $refund_fee = floatval($order['wxpay']) * 100; goto gZwjS; KYu0f: file_put_contents(ATTACHMENT_ROOT . $_W['uniacid'] . '_wechat_refund_all.pem', $cert . $key); goto v80Z5; S7fCz: zO4CP: goto AzeNK; GU_CW: goto xl1Du; goto bUCSl; UDOoZ: goto QcHHf; goto QRjS4; L6yES: echo json_encode($json); goto uJ9xS; snidz: $agent_id = $config['content']['agent_id']; goto A5AIJ; CHOqb: goto FP4Fp; goto r7kKS; pNour: $result = json_decode($result, true); goto xazJN; SbKzl: $can_list = -1; goto YProa; OkNTP: $userinfo = pdo_get('xc_beauty_userinfo', array("status" => 1, "openid" => $order['openid'], "uniacid" => $uniacid)); goto Om9Bx; OpuFG: $config = pdo_get('xc_beauty_config', array("xkey" => "web", "uniacid" => $uniacid)); goto GXnRj; v80Z5: $transaction_id = $order['wx_out_trade_no']; goto IXmgL; cq_46: $can_list = 1; goto T3JAk; HQ0Bd: $data = array("charge_id" => $order['charge_id'], "amount" => $order['wxpay']); goto QF3Du; cWsZ1: $refund_fee = floatval($_GPC['amount']) * 100; goto Iw4gz; rp1VB: echo json_encode($json); goto edEw9; RG3Z2: $string = array2url($refund); goto Ti8pd; CSU6x: $url = 'https://api.teegon.com/router?method=teegon.payment.charge.refund&app_key=' . $result['result']['key'] . '&client_secret=' . $result['result']['secret']; goto HQ0Bd; Aa51c: $request = pdo_update('xc_beauty_userinfo', array("money" => $money), array("status" => 1, "openid" => $order['openid'], "uniacid" => $uniacid)); goto dbwvu; yKAtw: $refund = array("appid" => $_W['account']['key'], "mch_id" => $setting['payment']['wechat']['mchid'], "nonce_str" => random(8), "out_refund_no" => $transaction_id, "out_trade_no" => $transaction_id, "refund_fee" => $refund_fee, "total_fee" => $total_fee); goto YJ5YY; dbwvu: m0xAS: goto Yv8bq; gycAz: $data = xml2array($response['content']); goto s3rUQ; fVsaX: if (!($can_list == 1)) { goto iOat3; } goto JhWWF; QF3Du: $result = vpost($url, $data); goto pNour; LpD5R: CLX2k: goto fkb51; wrPDB: load()->func('communication'); goto S6E7n; xXu0g: $json = array("status" => -1, "msg" => "缺少微信证书"); goto rp1VB; cadGr: if (!($group_refund == 2)) { goto VGUKd; } goto SbKzl; bhWx0: pdo_query($sql, array(":group_stock" => $order['total'], ":uniacid" => $uniacid, ":id" => $order['pid'])); goto HJ1Hs; Yviq0: pdo_update('xc_beauty_order', array("refund_status" => -1, "status" => 2), array("id" => $order['id'], "uniacid" => $uniacid)); goto DI2zG; Uggyh: $AppSecret = ''; goto omnjZ; JrmZa: eJ5QG: goto Yviq0; R6SxF: eGe9S: goto o7quB; edEw9: exit; goto jzv_7; RKO6B: $key = authcode($refund_setting['key'], 'DECODE'); goto KYu0f; fqqfP: if (!empty($result['result'])) { goto JA8S5; } goto cOYsH; EGMqU: $AppKey = ''; goto Uggyh; dCHNx: QcHHf: goto j9574; fkb51: if (!(empty($refund_setting['key']) || empty($refund_setting['cert']))) { goto f5Zg8; } goto xXu0g; jzv_7: f5Zg8: goto WKbja; PF9Xl: $refund_setting = $setting['payment']['wechat_refund']; goto DHS0v; GXnRj: if (!$config) { goto oQaTx; } goto St8CF; YJ5YY: ksort($refund); goto RG3Z2; Af6yR: if ($tiangong == 1 && !empty($AppKey) && !empty($AppSecret)) { goto bmSnc; } goto B4i2j; euxC1: $json = array("status" => -1, "msg" => "未开启微信退款功能"); goto L6yES; qYCWO: if ($group_refund == 1) { goto eJ5QG; } goto cadGr; Ti8pd: $string = $string . "&key={$setting['payment']['wechat']['signkey']}"; goto QiIzR; V33po: goto r5Due; goto JrmZa; KH29j: exit; goto R6SxF; S6E7n: $xml = array2xml($refund); goto RIIl1; xazJN: if (!empty($result['result'])) { goto eGe9S; } goto IQVRD; gGRX4: if (!$response) { goto yd8ga; } goto gycAz; B4pOr: } goto lXEoW; f9joO: $AppKey = $config['content']['AppKey']; goto QTEmp; yPsuR: VMA7t: goto jy3ZZ; gA9ys: c8EyP: goto FGLo6; X8zdH: VGAXX: goto aRVX2; QTEmp: $AppSecret = $config['content']['AppSecret']; goto ZJpJu; YDUJB: h8mbG: goto xM_Kx; V02Km: file_put_contents(ATTACHMENT_ROOT . $_W['uniacid'] . '_wechat_refund_all.pem', $cert . $key); goto lSUEP; PbolS: $userinfo = pdo_get('xc_beauty_userinfo', array("status" => 1, "openid" => $order['openid'], "uniacid" => $uniacid)); goto bfUzZ; MYyKc: $total_fee = floatval($order['wxpay']) * 100; goto SpCin; lcxcj: echo json_encode($json); goto CR8yo; SpCin: $refund_fee = floatval($order['wxpay']) * 100; goto USPfx; LF9U9: jgv97: goto b1EU5; jy3ZZ: $tiangong = -1; goto lrvbA; Siasl: if (!(!empty($config['content']['tiangong']) && !empty($config['content']['AppKey']) && !empty($config['content']['AppSecret']))) { goto OebPk; } goto Ag32H; u_EmI: $config['content'] = json_decode($config['content'], true); goto Siasl; L26Id: if (!$response) { goto RCu4a; } goto QMJ_s; fAsZd: $url = 'https://api.teegon.com/router?method=teegon.agent.mfuser.get.pay.secret&app_key=' . $AppKey . '&client_secret=' . $AppSecret; goto HgkM1; xM_Kx: if (!(empty($refund_setting['key']) || empty($refund_setting['cert']))) { goto VGAXX; } goto NFQs1; sdVr_: $refund = array("appid" => $_W['account']['key'], "mch_id" => $setting['payment']['wechat']['mchid'], "nonce_str" => random(8), "out_refund_no" => $transaction_id, "out_trade_no" => $transaction_id, "refund_fee" => $refund_fee, "total_fee" => $total_fee); goto p0jMW; bfUzZ: $money = round(floatval($userinfo['money']) + floatval($order['canpay']), 2); goto i5Qqz; rlqhl: lvp53: goto Bl74V; XjhD1: if (empty($g['team'])) { goto i7rC5; } goto ccRJi; w6jfI: $json = array("status" => -1, "msg" => "未开启微信退款功能"); goto Mq63V; jj3mX: if (!$order) { goto Ni2oK; } goto qhFRr; Qqh9Q: $response = ihttp_request($url, $xml, array(CURLOPT_SSLCERT => ATTACHMENT_ROOT . $_W['uniacid'] . '_wechat_refund_all.pem')); goto iv4Ld; AXMuR: if ($can_list == 1) { goto PZI6C; } goto mvql5; ib3nA: goto aWbS8; goto a3qq4; R7_kx: C8EvC: goto WhB_Z; IBfwt: U9fF0: goto rsywu; KfQMD: DD1Tu: goto AXMuR; lrvbA: $AppKey = ''; goto LOvs_; NFQs1: $json = array("status" => -1, "msg" => "缺少微信证书"); goto lcxcj; QaEgL: $url = 'https://api.teegon.com/router?method=teegon.payment.charge.refund&app_key=' . $result['result']['key'] . '&client_secret=' . $result['result']['secret']; goto GwFQj; iv4Ld: unlink(ATTACHMENT_ROOT . $_W['uniacid'] . '_wechat_refund_all.pem'); goto L26Id; PB60B: Dp9c5: goto H039R; LOvs_: $AppSecret = ''; goto blddY; USPfx: if (empty($_GPC['amount'])) { goto oW6Gc; } goto ceyah; BN63J: if (!(strtotime($g['createtime']) + intval($g['failtime']) * 60 * 60 < time())) { goto jgv97; } goto UZRGb; q7629: V5L2U: goto E7qWH; i5Qqz: $request = pdo_update('xc_beauty_userinfo', array("money" => $money), array("status" => 1, "openid" => $order['openid'], "uniacid" => $uniacid)); goto q7629; GHctn: NL8BN: goto z5RDl; oVVEa: $sql = 'UPDATE ' . tablename('xc_beauty_service') . ' SET group_stock=group_stock+:group_stock WHERE uniacid=:uniacid AND id=:id AND group_stock>=0'; goto gKeD1; FEYfY: $request = pdo_update('xc_beauty_group', array("status" => 2), array("status" => -1, "uniacid" => $uniacid, "id" => $g['id'])); goto LF9U9; zfppD: load()->func('communication'); goto kcp0Y; E2w9d: $config = pdo_get('xc_beauty_config', array("xkey" => "web", "uniacid" => $uniacid)); goto j3O2N; viUgR: $user_id = $config['content']['user_id']; goto dRIQV; jfifI: $can_list = 1; goto GHctn; a3qq4: xHHFz: goto fAsZd; UGV7h: t1dos: goto KfQMD; hW5st: $can_list = 1; goto VoGdx; dRIQV: OebPk: goto R7_kx; Bl74V: Hbdkq: goto UyfGr; HiRoG: $result = json_decode($result, true); goto jFv85; cm0o9: if (!($data['return_code'] == 'SUCCESS')) { goto Hbdkq; } goto HVDF8; j3O2N: if (!$config) { goto o9lGw; } goto YE0Bu; rFl1N: $can_list = -1; goto j7JeC; hJMMu: $url = 'https://api.mch.weixin.qq.com/secapi/pay/refund'; goto sdVr_; wzUpH: if (!($refund_setting['switch'] != 1)) { goto h8mbG; } goto w6jfI; UJpY4: } goto ixvs0; lauO4: $group_refund = $group_config['content']['group_refund']; goto yLfzL; EGpa2: global $_GPC, $_W; goto tkQqO; yLfzL: I6gBS: goto CYgBZ; cAT_x: $group_config = pdo_get('xc_beauty_config', array("xkey" => "web", "uniacid" => $uniacid)); goto IjB0w; HVcXo: $group_refund = 1; goto cAT_x; h4YPO: $group = pdo_getall('xc_beauty_group', array("status" => -1, "uniacid" => $uniacid)); goto i7qeN; cqX0A: ignore_user_abort(true); goto h4YPO; Xvu7e: echo '退款完成'; goto YCxNH; gFvbG: if (empty($group_config['content']['group_refund'])) { goto I6gBS; } goto lauO4; ixvs0: s2Q3n: goto OURb2; YCxNH: } } ?>