<?php
 class SignatureHelper { public function request($accessKeyId, $accessKeySecret, $domain, $params, $security = false) { goto Rbrbn; BY_87: foreach ($apiParams as $key => $value) { $sortedQueryStringTmp .= "\x26" . $this->encode($key) . "\75" . $this->encode($value); DYPq0: } goto snBNq; kTQUZ: $sortedQueryStringTmp = ''; goto BY_87; bLCf_: $stringToSign = "\x47\105\x54\46\45\x32\x46\46" . $this->encode(substr($sortedQueryStringTmp, 1)); goto VsbHV; Crocg: $signature = $this->encode($sign); goto UBVAk; VsbHV: $sign = base64_encode(hash_hmac("\163\150\141\x31", $stringToSign, $accessKeySecret . "\x26", true)); goto Crocg; Rbrbn: $apiParams = array_merge(array("\x53\151\147\x6e\x61\x74\x75\x72\145\x4d\x65\x74\150\x6f\x64" => "\110\x4d\x41\103\55\x53\x48\101\x31", "\123\x69\x67\156\141\164\x75\x72\145\116\x6f\156\x63\145" => uniqid(mt_rand(0, 0xffff), true), "\123\x69\x67\156\141\x74\x75\162\145\126\145\x72\x73\x69\157\156" => "\x31\x2e\60", "\x41\x63\x63\x65\163\163\113\145\x79\x49\144" => $accessKeyId, "\124\151\x6d\x65\163\164\x61\155\x70" => gmdate("\x59\x2d\x6d\55\144\x5c\x54\110\72\151\72\163\x5c\132"), "\106\157\x72\x6d\141\164" => "\x4a\123\117\116"), $params); goto RXK8Y; REhPa: try { $content = $this->fetchContent($url); return json_decode($content); } catch (\Exception $e) { return false; } goto k7n5r; RXK8Y: ksort($apiParams); goto kTQUZ; snBNq: BAtOz: goto bLCf_; UBVAk: $url = ($security ? "\x68\164\x74\160\163" : "\150\x74\x74\160") . "\72\x2f\x2f{$domain}\x2f\77\123\151\x67\156\141\x74\165\x72\145\x3d{$signature}{$sortedQueryStringTmp}"; goto REhPa; k7n5r: } private function encode($str) { goto ZNRYc; Mi9hN: $res = preg_replace("\x2f\x5c\x2b\57", "\45\x32\60", $res); goto mtJTV; mtJTV: $res = preg_replace("\57\134\52\x2f", "\x25\62\x41", $res); goto o4auO; ZNRYc: $res = urlencode($str); goto Mi9hN; zRgIL: return $res; goto Zg9t7; o4auO: $res = preg_replace("\x2f\x25\67\105\57", "\176", $res); goto zRgIL; Zg9t7: } private function fetchContent($url) { goto tva7d; e8E6H: curl_close($ch); goto M5MwS; M5MwS: return $rtn; goto oDx0s; bY3f8: $rtn = curl_exec($ch); goto yKOGM; NcOVH: curl_setopt($ch, CURLOPT_URL, $url); goto PKTDr; EIhzr: curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, false); goto MRLFk; tva7d: $ch = curl_init(); goto NcOVH; PKTDr: curl_setopt($ch, CURLOPT_TIMEOUT, 5); goto OaBot; OaBot: curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1); goto s7X0m; BUq1B: I6RR6: goto e8E6H; AqNeX: if (!(substr($url, 0, 5) == "\150\164\x74\160\163")) { goto Miegh; } goto rRtNE; s7X0m: curl_setopt($ch, CURLOPT_HTTPHEADER, array("\x78\55\163\x64\x6b\x2d\143\154\x69\145\x6e\x74" => "\x70\150\160\x2f\x32\x2e\60\x2e\60")); goto AqNeX; yKOGM: if (!($rtn === false)) { goto I6RR6; } goto T9NAJ; T9NAJ: trigger_error("\x5b\x43\125\122\114\137" . curl_errno($ch) . "\135\x3a\40" . curl_error($ch), E_USER_ERROR); goto BUq1B; MRLFk: Miegh: goto bY3f8; rRtNE: curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false); goto EIhzr; oDx0s: } }