<?php
 goto IGl_J; TDRba: global $xcmodule, $xcconfig, $xcurl; goto uFaq7; xQ53S: $xcconfig = array(); goto CDGiv; uFaq7: $xcmodule = 'xc_beauty'; goto crAt3; IGl_J: defined('IN_IA') or exit('Access Denied'); goto TDRba; crAt3: include_once IA_ROOT . '/addons/' . $xcmodule . '/common/function.php'; goto xQ53S; CDGiv: class xc_beautyModuleSite extends WeModuleSite { protected function createWebUrl($do, $query = array()) { goto ruZ0l; Mmf4L: $query['version_id'] = intval($_GPC['version_id']); goto z6ik0; ruZ0l: global $_GPC; goto RhPgV; z6ik0: return wurl('site/entry', $query); goto ctK3K; RhPgV: $query['do'] = $do; goto pHALa; pHALa: $query['m'] = strtolower($this->modulename); goto Mmf4L; ctK3K: } public function doWebExport() { goto pmdGR; VaKlw: $service = pdo_getall('xc_beauty_service', array("uniacid" => $uniacid)); goto kdxQg; ANEFn: goto mVyap; goto qLXEu; AB8m2: if (empty($_GPC['pay_type'])) { goto N5EnK; } goto F12Jt; As2HD: LSkba: goto Pa_hm; osT4e: if (empty($_GPC['content'])) { goto VHN7K; } goto yOtoW; TUIWx: if (!$user) { goto LSkba; } goto cuC_S; qLXEu: HzEf2: goto rnSlh; Q07jF: N5EnK: goto mlY0Q; g1Ou1: $user_list = array(); goto TUIWx; hLqA9: if (empty($_GPC['out_trade_no'])) { goto h6Rk7; } goto ImtQz; zQp6o: foreach ($member as $m) { $member_list[$m['id']] = $m; iI24K: } goto Jeo2a; KYWq0: $condition['createtime <='] = $times['end'] . ' 23:59:59'; goto jGh2k; vka5w: D0KV1: goto eO5Yb; LqwaC: if ($order) { goto HzEf2; } goto ipLO3; pmdGR: global $_GPC, $_W; goto SrTFd; OJof0: echo iconv('UTF-8', 'GBK//TRANSLIT', $data . '	'); goto x36ls; ksxm_: hwO60: goto F4XL5; rnSlh: $store = pdo_getall('xc_beauty_store', array("uniacid" => $uniacid), array(), '', 'sort DESC,createtime DESC'); goto n6caG; n9yaN: $condition['use'] = $_GPC['use']; goto K21qo; EPO13: $condition['order_type'] = 1; goto rUmol; kdxQg: $datalist = array(); goto Fc_ik; kJX5L: $condition['openid LIKE'] = '%' . $_GPC['openid'] . '%'; goto vka5w; vbu98: foreach ($order as &$v) { goto re691; iSspb: if (!($v['pay_type'] == 2)) { goto FnNQG; } goto MxWe9; Yy9db: nJBx1: goto go48d; SLf3n: goto nJBx1; goto GG0bt; DtvJN: goto zVwig; goto yRqN8; kltPw: $data = $data . '</tr>'; goto IfssL; QwjZD: $v['status_name'] = '已使用'; goto jNz8d; jNz8d: v4xtS: goto vRU2c; PTHav: jbYnK: goto mWfsd; psCKa: zqdgh: goto UGuoi; MDln9: $v['member_name'] = $member_list[$v['member']]['name']; goto NVfpO; re691: if ($v['pay_type'] == 1) { goto l3v5h; } goto iSspb; IfssL: szy0s: goto isv2Y; pOs6q: $v['status_name'] = '已退款'; goto PTHav; MyMxw: iS81p: goto kltPw; GG0bt: l3v5h: goto pKK_a; vRU2c: zVwig: goto V9G51; LpxHK: if ($v['use'] == 1) { goto UBXx9; } goto RWIJ9; BXlyw: goto v4xtS; goto ICYUe; TMwhu: goto jbYnK; goto J36Os; Hipiw: $v['three_openid_nick'] = $user_list[$v['three_openid']]['nick']; goto yT2Cl; yRqN8: rXGbE: goto LpxHK; ICYUe: UBXx9: goto QwjZD; go48d: $v['service'] = $datalist[$v['pid']]['name']; goto XtDiS; L3U6N: x2j1G: goto lNeeJ; Ubhkf: if (!($v['status'] == -1)) { goto fNLT8; } goto PvLwQ; C4Obm: goto mM7m_; goto psCKa; RWIJ9: $v['status_name'] = '未使用(' . $v['is_use'] . '/' . $v['can_use'] . ')'; goto BXlyw; e6pB1: FnNQG: goto SLf3n; ACl9L: if (empty($v['two_openid'])) { goto x2j1G; } goto LrAfj; NVfpO: if (empty($v['one_openid'])) { goto AEDGd; } goto mhIxR; lNeeJ: if (empty($v['three_openid'])) { goto bZkE3; } goto Hipiw; pKK_a: $v['pay_name'] = '微信支付'; goto Yy9db; yT2Cl: bZkE3: goto aJ77R; V9G51: $data = $data . '<tr>'; goto A77_4; XtDiS: $v['userinfo'] = json_decode($v['userinfo'], true); goto nvhlG; bRUuV: AEDGd: goto ACl9L; nvhlG: $v['store_name'] = $store_list[$v['store']]['name']; goto MDln9; J36Os: gX7oy: goto pOs6q; A77_4: foreach ($xc as $x) { goto q0r5C; q0r5C: if (!($x['status'] == 1)) { goto dL0VT; } goto P1_cg; YKRYl: dZiXg: goto EFirk; EFirk: dL0VT: goto w_aFt; P1_cg: if ($x['key'] == 'name' || $x['key'] == 'mobile' || $x['key'] == 'address') { goto MbZSL; } goto LdYhi; w_aFt: bL4Zt: goto bX4iC; W079B: goto dZiXg; goto q4E3y; P1Bev: $data .= '<td style=\'vnd.ms-excel.numberformat:@\'>' . $v['userinfo'][$x['key']] . '</td>'; goto YKRYl; q4E3y: MbZSL: goto P1Bev; LdYhi: $data .= '<td style=\'vnd.ms-excel.numberformat:@\'>' . $v[$x['key']] . '</td>'; goto W079B; bX4iC: } goto MyMxw; mhIxR: $v['one_openid_nick'] = $user_list[$v['one_openid']]['nick']; goto bRUuV; MxWe9: $v['pay_name'] = '余额支付'; goto e6pB1; lpRXe: fNLT8: goto C4Obm; qPx01: $v['status_name'] = '未退款'; goto TMwhu; aJ77R: if ($v['status'] == 1) { goto rXGbE; } goto XbUcg; mWfsd: mM7m_: goto DtvJN; XbUcg: if ($v['status'] == 2) { goto zqdgh; } goto Ubhkf; UGuoi: if ($v['refund_status'] == 1) { goto gX7oy; } goto qPx01; PvLwQ: $v['status_name'] = '未支付'; goto lpRXe; LrAfj: $v['two_openid_nick'] = $user_list[$v['two_openid']]['nick']; goto L3U6N; isv2Y: } goto ksxm_; HZhbl: $member_list = array(); goto H9_96; f3cT2: $order = pdo_getall('xc_beauty_order', $condition, array(), '', 'createtime DESC'); goto LqwaC; Pa_hm: header('Content-type: application/vnd.ms-excel; charset=utf8'); goto gpIDZ; F4XL5: $data = '<table border=\'1\'>' . $data . '</table>'; goto OJof0; rPDFk: foreach ($service as $x2) { $datalist[$x2['id']] = $x2; I_tVV: } goto Gbhdu; b5KYh: $condition['store'] = $_GPC['store_id']; goto ilU9t; GOEfh: h6Rk7: goto cqtFF; DedSj: Li1dG: goto L3o8y; ERgUw: $xc = json_decode($xc, true); goto yTjq4; L3o8y: VDpa1: goto VaKlw; H9_96: if (!$member) { goto iVJqz; } goto zQp6o; Gbhdu: GxnfM: goto mkE40; SrTFd: $uniacid = $_W['uniacid']; goto TH67k; cuC_S: foreach ($user as $u) { goto lL9CV; k3zX4: $user_list[$u['openid']] = $u; goto Nfsbb; lL9CV: $u['nick'] = base64_decode($u['nick']); goto k3zX4; Nfsbb: E7TXZ: goto RyS6S; RyS6S: } goto M_rkN; S3HNj: if (empty($_GPC['times'])) { goto Ph4M8; } goto dbife; PLfXz: foreach ($xc as $x) { goto HFO3N; K7cJ0: IBBTT: goto wmay1; WOuGJ: $data .= '<th>' . $x['name'] . '</th>'; goto K7cJ0; wmay1: nR3rT: goto Oegye; HFO3N: if (!($x['status'] == 1)) { goto IBBTT; } goto WOuGJ; Oegye: } goto s4ix9; Jkf5g: if (!$store) { goto VDpa1; } goto POrOC; TArpu: iVJqz: goto RE0le; dbife: $times = $_GPC['times']; goto EoX8c; ImtQz: $condition['out_trade_no LIKE'] = '%' . $_GPC['out_trade_no'] . '%'; goto GOEfh; eO5Yb: if (empty($_GPC['use'])) { goto qnXOj; } goto n9yaN; imcZY: VHN7K: goto AB8m2; iECZo: $member = pdo_getall('xc_beauty_store_member', array("uniacid" => $uniacid)); goto HZhbl; s4ix9: nX_wx: goto TPweO; ilU9t: ogtY5: goto S3HNj; rUmol: $condition['uniacid'] = $uniacid; goto hLqA9; TH67k: $xc = htmlspecialchars_decode($_GPC['xc']); goto ERgUw; yTjq4: $condition['status'] = 1; goto EPO13; M_rkN: t1DXP: goto As2HD; K21qo: qnXOj: goto osT4e; gDwtq: $data = '<tr>'; goto PLfXz; RE0le: $user = pdo_getall('xc_beauty_userinfo', array("uniacid" => $uniacid)); goto g1Ou1; cqtFF: if (empty($_GPC['openid'])) { goto D0KV1; } goto kJX5L; F12Jt: $condition['pay_type'] = $_GPC['pay_type']; goto Q07jF; Jeo2a: DZpfA: goto TArpu; EoX8c: $condition['createtime >='] = $times['start'] . ' 00:00:00'; goto KYWq0; mlY0Q: if (empty($_GPC['store_id'])) { goto ogtY5; } goto b5KYh; ipLO3: echo '无订单记录'; goto ANEFn; Fc_ik: if (!$service) { goto r8C7z; } goto rPDFk; yOtoW: $condition['userinfo LIKE'] = '%' . $_GPC['content'] . '%'; goto imcZY; jGh2k: Ph4M8: goto f3cT2; mkE40: r8C7z: goto iECZo; POrOC: foreach ($store as $s) { $store_list[$s['id']] = $s; XWNwX: } goto DedSj; x36ls: mVyap: goto oXsBO; TPweO: $data .= '</tr>'; goto vbu98; gpIDZ: header('Content-Disposition: attachment; filename=order.xls'); goto gDwtq; n6caG: $store_list = array(); goto Jkf5g; oXsBO: } public function doWebExport2() { goto udUU1; ibone: header('Content-Disposition: attachment; filename=order.xls'); goto NYe9U; BH0qN: fCFUY: goto ilYAW; udUU1: global $_GPC, $_W; goto ifJSZ; DiN2T: $order = pdo_getall('xc_beauty_order', array("status" => 1, "uniacid" => $uniacid, "order_type" => 3, "group IN" => $group_id), array(), '', 'createtime DESC'); goto mm9ol; uaWvc: header('Content-type: application/vnd.ms-excel; charset=utf8'); goto ibone; oH9hk: $group = pdo_getall('xc_beauty_group', array("status" => 1, "uniacid" => $uniacid)); goto yMqXo; c6ag1: qwl9q: goto tqT3z; F3l_M: $group_id = array(); goto oH9hk; MOm4H: p53WR: goto g4A7O; sreMD: foreach ($group as $g) { $group_id[] = $g['id']; bgFfD: } goto MOm4H; GYHqF: foreach ($service as $x2) { $datalist[$x2['id']] = $x2; qE_pg: } goto BH0qN; g4A7O: bcFl4: goto DiN2T; ilYAW: zw60k: goto t5F8P; yMqXo: if (!$group) { goto bcFl4; } goto sreMD; Hmpnk: echo iconv('UTF-8', 'GBK//TRANSLIT', $data . '	'); goto ZFJbV; NYe9U: $data = '<tr><th>订单号</th><th>订单支付方式</th><th>服务项目</th><th>优惠（元）</th><th>应付款（元）</th><th>实付款（元）</th><th>总件数</th><th>姓名</th><th>手机号</th><th>地址</th><th>日期</th><th>备注</th></tr>'; goto Q9Ssy; bhrAB: if (!$service) { goto zw60k; } goto GYHqF; Y1EkO: LLaGV: goto MX_Um; mm9ol: if ($order) { goto qwl9q; } goto QUKFf; Q9Ssy: foreach ($order as $v) { goto t4jSN; ig5Ml: $v['pay_name'] = '余额支付'; goto u7TMr; NIdTF: $data = $data . '<td>' . $v['content'] . '</td>'; goto keHHb; qPWBo: HZzjs: goto Ej3lZ; t4jSN: if ($v['pay_type'] == 1) { goto oH4Xh; } goto amH9g; gI2v3: ljbbU: goto kSLu1; TzIZ2: $data = $data . '<td>' . $v['userinfo']['address'] . '</td>'; goto oa9Yd; kSLu1: goto Hc5bF; goto oE1sK; MDhfD: $data = $data . '<td>' . $v['coupon_price'] . '</td>'; goto E83rK; bci5J: $data = $data . '<td>' . $v['userinfo']['name'] . '</td>'; goto Lc0jX; oE1sK: oH4Xh: goto ig5Ml; oa9Yd: $data = $data . '<td>' . $v['plan_date'] . '</td>'; goto NIdTF; u7TMr: Hc5bF: goto vX9LA; N8tJB: $data = $data . '<td style=\'vnd.ms-excel.numberformat:@\'>' . $v['out_trade_no'] . '</td>'; goto DAMyk; E83rK: $data = $data . '<td>' . $v['amount'] . '</td>'; goto WCPVz; vX9LA: $data = $data . '<tr>'; goto N8tJB; WCPVz: $data = $data . '<td>' . $v['o_amount'] . '</td>'; goto zGGJo; RfEVE: $v['pay_name'] = '微信支付'; goto gI2v3; DAMyk: $data = $data . '<td style=\'vnd.ms-excel.numberformat:@\'>' . $v['pay_name'] . '</td>'; goto Snpdi; amH9g: if (!($v['pay_type'] == 2)) { goto ljbbU; } goto RfEVE; keHHb: $data = $data . '</tr>'; goto qPWBo; zGGJo: $data = $data . '<td>' . $v['total'] . '</td>'; goto bci5J; Snpdi: $data = $data . '<td>' . $v['service'] . '</td>'; goto MDhfD; Lc0jX: $data = $data . '<td>' . $v['userinfo']['mobile'] . '</td>'; goto TzIZ2; Ej3lZ: } goto Y1EkO; ifJSZ: $uniacid = $_W['uniacid']; goto F3l_M; J7j_7: goto Ac4w1; goto c6ag1; t5F8P: foreach ($order as &$x) { goto fnOC9; E7U_z: $x['userinfo'] = json_decode($x['userinfo'], true); goto l97iV; fnOC9: $x['service'] = $datalist[$x['pid']]['name']; goto E7U_z; l97iV: d0tf9: goto e_S4J; e_S4J: } goto MkzB_; sjMzA: $datalist = array(); goto bhrAB; ZFJbV: Ac4w1: goto FhZPM; tqT3z: $service = pdo_getall('xc_beauty_service', array("uniacid" => $uniacid)); goto sjMzA; MX_Um: $data = '<table border=\'1\'>' . $data . '</table>'; goto Hmpnk; MkzB_: fRdhr: goto uaWvc; QUKFf: echo '无订单记录'; goto J7j_7; FhZPM: } public function doWebExport3() { goto N0AU2; PyWKm: $uniacid = $_W['uniacid']; goto OJGLT; Kg8GP: foreach ($store as $s) { $store_list[$s['id']] = $s; pqYzV: } goto X7KJ1; wOYlH: $member = pdo_getall('xc_beauty_store_member', array("uniacid" => $uniacid)); goto rj6u3; NnAkW: if (!$store) { goto x5AKR; } goto Kg8GP; dF7JK: o80TF: goto ovzkO; veCv5: $condition['status'] = 1; goto TTNMv; ovzkO: if (empty($_GPC['use'])) { goto MxO2P; } goto b1OL9; blYu9: if (empty($_GPC['store_id'])) { goto vZrW7; } goto giEEi; R3vyI: foreach ($user as $u) { goto jEIqS; twQl4: Ay1EC: goto zho6C; jEIqS: $u['nick'] = base64_decode($u['nick']); goto Pzvw1; Pzvw1: $user_list[$u['openid']] = $u; goto twQl4; zho6C: } goto ifc91; usLl_: xcsBf: goto d898R; jpSPU: Tz4G2: goto Cyanf; GjvsO: v505x: goto J897l; Uhe1A: $data = '<table border=\'1\'>' . $data . '</table>'; goto LNPgm; LNPgm: echo iconv('UTF-8', 'GBK//TRANSLIT', $data . '	'); goto jpSPU; RD82T: if (empty($_GPC['times'])) { goto xcsBf; } goto t9fMd; Ofbmc: $condition['userinfo LIKE'] = '%' . $_GPC['content'] . '%'; goto Np3wD; V3LR_: $condition['openid LIKE'] = '%' . $_GPC['openid'] . '%'; goto dF7JK; N0AU2: global $_GPC, $_W; goto PyWKm; giEEi: $condition['store'] = $_GPC['store_id']; goto AnR25; aJpnH: MxO2P: goto yDuyR; tRevb: if ($order) { goto jHOb3; } goto F3VSp; VTfit: V7pJC: goto CgpEw; b1OL9: $condition['use'] = $_GPC['use']; goto aJpnH; OwmFK: $datalist = array(); goto Xya9D; Xya9D: if (!$service) { goto KGKSs; } goto G8byb; bjAGs: $store = pdo_getall('xc_beauty_store', array("uniacid" => $uniacid)); goto iE6Cc; t9fMd: $times = $_GPC['times']; goto C0Lot; Bl0WJ: $condition['pay_type'] = $_GPC['pay_type']; goto KmH3L; Fe5p2: if (!$user) { goto bfvGe; } goto R3vyI; CgpEw: $user = pdo_getall('xc_beauty_userinfo', array("uniacid" => $uniacid)); goto W2wJJ; gJwPL: foreach ($xc as $x) { goto jAskv; VS1vc: ydBLn: goto gUjKc; jAskv: if (!($x['status'] == 1)) { goto ydBLn; } goto nd8zU; gUjKc: LVNga: goto Rvmnu; nd8zU: $data .= '<th>' . $x['name'] . '</th>'; goto VS1vc; Rvmnu: } goto GjvsO; C0Lot: $condition['createtime >='] = $times['start'] . ' 00:00:00'; goto uK7i6; TTNMv: $condition['order_type'] = 4; goto pxglz; d898R: $order = pdo_getall('xc_beauty_order', $condition, array(), '', 'createtime DESC'); goto tRevb; KOK0N: foreach ($order as $v) { goto MV6_r; p8VQ7: goto HUcUX; goto hR7AS; IQELC: p8z_k: goto RdqDq; jzwzi: $data = $data . '</tr>'; goto DKebY; U7BCX: glyIT: goto SL5oV; W50Xg: if ($v['status'] == 2) { goto Phcnp; } goto qt3dn; ZYI6v: $v['userinfo'] = json_decode($v['userinfo'], true); goto Oea3L; AIs2u: KOXk4: goto YRwFJ; d2Mus: $data = $data . '<tr>'; goto D4ZpM; Oea3L: $v['store_name'] = $store_list[$v['store']]['name']; goto YJ7Om; WoCVt: uMfWu: goto xm66v; mIrBT: goto JEEnd; goto BnqfF; faY1M: $v['service'] = $datalist[$v['pid']]['name']; goto ZYI6v; D4ZpM: foreach ($xc as $x) { goto VaiZ6; tMjjo: if ($x['key'] == 'name' || $x['key'] == 'mobile' || $x['key'] == 'address') { goto dmbBM; } goto gSE70; G5cU9: dmbBM: goto gNl17; LYEHx: goto t_F3V; goto G5cU9; gSE70: $data .= '<td style=\'vnd.ms-excel.numberformat:@\'>' . $v[$x['key']] . '</td>'; goto LYEHx; gNl17: $data .= '<td style=\'vnd.ms-excel.numberformat:@\'>' . $v['userinfo'][$x['key']] . '</td>'; goto qtgF4; jPmoK: RjceQ: goto AByKn; qtgF4: t_F3V: goto BZnWd; VaiZ6: if (!($x['status'] == 1)) { goto G9nWz; } goto tMjjo; BZnWd: G9nWz: goto jPmoK; AByKn: } goto AphAX; DKebY: LfYAS: goto BBK9j; hIQNw: $v['status_name'] = '未支付'; goto gnR86; hR7AS: EOHmb: goto YBLBg; C53YH: HUcUX: goto d2Mus; XJWiE: L24n_: goto gcBZf; SL5oV: JEEnd: goto p8VQ7; MV6_r: if ($v['pay_type'] == 1) { goto p8z_k; } goto LaNtF; wMk8j: goto BRHXI; goto WoCVt; FoHfu: $v['status_name'] = '已退款'; goto U7BCX; OeTXk: I1Vew: goto wMk8j; g21gJ: if (!($v['pay_type'] == 3)) { goto I1Vew; } goto mi69a; qxeP4: $v['status_name'] = '未使用(' . $v['is_use'] . '/' . $v['can_use'] . ')'; goto DvT7g; x6KmF: BRHXI: goto gBfve; JrbNR: goto glyIT; goto EZXOU; WCFpz: $v['status_name'] = '已使用'; goto Pnl6k; AphAX: QI5E1: goto jzwzi; hEVjZ: if ($v['refund_status'] == 1) { goto cC1sK; } goto Kwt2V; gBfve: goto xqept; goto IQELC; c_6nk: if (empty($v['three_openid'])) { goto KOXk4; } goto ScvVc; qt3dn: if (!($v['status'] == -1)) { goto bMxZc; } goto hIQNw; gcBZf: if (empty($v['two_openid'])) { goto ylEtg; } goto tJuHg; RdqDq: $v['pay_name'] = '微信支付'; goto GTW18; YRwFJ: if ($v['status'] == 1) { goto EOHmb; } goto W50Xg; ScvVc: $v['three_openid_nick'] = $user_list[$v['three_openid']]['nick']; goto AIs2u; GTW18: xqept: goto faY1M; tJuHg: $v['two_openid_nick'] = $user_list[$v['two_openid']]['nick']; goto fLcXw; xm66v: $v['pay_name'] = '余额支付'; goto x6KmF; LaNtF: if ($v['pay_type'] == 2) { goto uMfWu; } goto g21gJ; Kwt2V: $v['status_name'] = '未退款'; goto JrbNR; BnqfF: Phcnp: goto hEVjZ; EZXOU: cC1sK: goto FoHfu; Pnl6k: IzZep: goto C53YH; YBLBg: if ($v['use'] == 1) { goto JydWs; } goto qxeP4; mi69a: $x['pay_name'] = '线下支付'; goto OeTXk; L8otz: if (empty($v['one_openid'])) { goto L24n_; } goto s2bIt; gnR86: bMxZc: goto mIrBT; UJ7CF: JydWs: goto WCFpz; fLcXw: ylEtg: goto c_6nk; YJ7Om: $v['member_name'] = $member_list[$v['member']]['name']; goto L8otz; s2bIt: $v['one_openid_nick'] = $user_list[$v['one_openid']]['nick']; goto XJWiE; DvT7g: goto IzZep; goto UJ7CF; BBK9j: } goto V00Vv; Voa3v: KGKSs: goto bjAGs; pt8I7: $data = '<tr>'; goto gJwPL; mdpIW: g2chD: goto wWSrd; XbSHT: if (!$member) { goto V7pJC; } goto PRVsZ; OJGLT: $xc = htmlspecialchars_decode($_GPC['xc']); goto VOCD5; AnR25: vZrW7: goto RD82T; rj6u3: $member_list = array(); goto XbSHT; b6Aj3: jHOb3: goto N1pt5; VOCD5: $xc = json_decode($xc, true); goto veCv5; G8byb: foreach ($service as $x2) { $datalist[$x2['id']] = $x2; PgoxG: } goto uAHmW; mJP5C: hPAK3: goto VTfit; V00Vv: mlTcp: goto Uhe1A; F3VSp: echo '无订单记录'; goto yZI16; yDuyR: if (empty($_GPC['content'])) { goto bjhV6; } goto Ofbmc; VQbDr: if (empty($_GPC['out_trade_no'])) { goto g2chD; } goto awiUY; ifc91: mx6iF: goto RPXg2; KmH3L: PdhcR: goto blYu9; RPXg2: bfvGe: goto QQZZe; UaKYW: if (empty($_GPC['pay_type'])) { goto PdhcR; } goto Bl0WJ; uK7i6: $condition['createtime <='] = $times['end'] . ' 23:59:59'; goto usLl_; awiUY: $condition['out_trade_no LIKE'] = '%' . $_GPC['out_trade_no'] . '%'; goto mdpIW; J897l: $data .= '</tr>'; goto KOK0N; Np3wD: bjhV6: goto UaKYW; iE6Cc: $store_list = array(); goto NnAkW; jrG6o: x5AKR: goto wOYlH; N1pt5: $service = pdo_getall('xc_beauty_store_service', array("uniacid" => $uniacid)); goto OwmFK; GzkYe: header('Content-Disposition: attachment; filename=order.xls'); goto pt8I7; QQZZe: header('Content-type: application/vnd.ms-excel; charset=utf8'); goto GzkYe; pxglz: $condition['uniacid'] = $uniacid; goto VQbDr; yZI16: goto Tz4G2; goto b6Aj3; W2wJJ: $user_list = array(); goto Fe5p2; X7KJ1: oHnIU: goto jrG6o; PRVsZ: foreach ($member as $m) { $member_list[$m['id']] = $m; NLQRd: } goto mJP5C; uAHmW: aE4Aj: goto Voa3v; wWSrd: if (empty($_GPC['openid'])) { goto o80TF; } goto V3LR_; Cyanf: } public function doWebPost() { goto M7nc6; UUEYI: $post = str_replace('{{trade}}', '1220171127101100000017', $post); goto KG6qD; svlVm: $get = str_replace('{{amount}}', '199元', $get); goto Pz3UW; M8hEm: $post = str_replace('{{webnamex}}', '美容', $post); goto UUEYI; YZD8A: $url = $header['Location'][count($header['Location']) - 1]; goto yZIaj; hTfFW: $url = $url . $url_data; goto bAzuY; KG6qD: $post = str_replace('{{amount}}', '199元', $post); goto dnjCJ; uIC3f: FhOo9: goto r7ckE; YAFkO: $get = str_replace('{{datex}}', date('Y-m-d H:i'), $get); goto s0SXe; LzNtf: $customize = $sms['content']['customize']; goto sGOFT; dnjCJ: $post = str_replace('{{namex}}', '张三', $post); goto JrLP2; zSoTz: $sms['content'] = json_decode($sms['content'], true); goto LzNtf; aM2n9: qkUBv: goto hTfFW; yZIaj: HPbhd: goto uIC3f; x0sPu: $header = get_headers($url . '&_xcdebug=1', 1); goto ln4w4; KmIA8: $request_get = ihttp_get($url); goto a37Qz; tw30x: $url_data = ''; goto CrDKr; GnWnq: $post = json_encode($post); goto WetEM; s1Nz2: $post = json_decode($post, true); goto KR6YB; Ha37_: foreach ($post as $x2) { $data[$x2['attr']] = $x2['value']; mKpvt: } goto rVZgg; zugzx: if (is_array($header['Location'])) { goto fNhXo; } goto Z4Mw3; W91Mk: foreach ($customize as $x) { $post = str_replace('{{' . $x['attr'] . '}}', $x['value'], $post); sekM7: } goto JvMri; GVQiD: $get = $sms['content']['get']; goto wCkQn; KR6YB: $data = array(); goto Ha37_; VlvIe: hr9xH: goto Ea2si; IiwdQ: $get = str_replace('{{phonex}}', '18888888888', $get); goto wZ0eA; naiSB: JA1dj: goto VlvIe; Z4Mw3: $url = $header['Location']; goto oe1j4; iwxnm: fNhXo: goto YZD8A; r7ckE: if (!(is_array($post) && !empty($post))) { goto jgKQI; } goto GnWnq; TcP2J: mk6It: goto M8hEm; oe1j4: goto HPbhd; goto iwxnm; rVZgg: EE6YW: goto g_5Wo; Pz3UW: $get = str_replace('{{namex}}', '张三', $get); goto IiwdQ; LgDJs: $post = str_replace('{{datex}}', date('Y-m-d H:i'), $post); goto s1Nz2; wZ0eA: $get = str_replace('{{addrx}}', '中国北京', $get); goto YAFkO; IR53L: $post = str_replace('{{addrx}}', '中国北京', $post); goto LgDJs; cEwxr: $get = str_replace('{{trade}}', '1220171127101100000017', $get); goto svlVm; fySKM: load()->func('communication'); goto BGtHD; JrLP2: $post = str_replace('{{phonex}}', '18888888888', $post); goto IR53L; ke9zS: YVrhV: goto DUDCF; vcswT: jgKQI: goto GVQiD; JvMri: gC5FU: goto TcP2J; g_5Wo: $request_post = ihttp_post($url, $data); goto vcswT; M7nc6: global $_GPC, $_W; goto fySKM; s0SXe: $get = json_decode($get, true); goto tw30x; CrDKr: foreach ($get as $x3) { goto mRhGo; TpIP5: NP7Pc: goto QXNMK; QXNMK: qs2qE: goto MDqbl; mRhGo: if (empty($url_data)) { goto EH0BH; } goto Dgs48; XNbiz: goto NP7Pc; goto bUkPI; Dgs48: $url_data = $url_data . '&' . urlencode($x3['attr']) . '=' . urlencode($x3['value']); goto XNbiz; fRsMD: $url_data = urlencode($x3['attr']) . '=' . urlencode($x3['value']); goto TpIP5; bUkPI: EH0BH: goto fRsMD; MDqbl: } goto ke9zS; WetEM: if (!is_array($customize)) { goto mk6It; } goto W91Mk; ln4w4: if (!(strpos($header[0], '301') || strpos($header[0], '302'))) { goto FhOo9; } goto zugzx; zv9Vr: if (!$sms) { goto hr9xH; } goto zSoTz; bAzuY: uyg9k: goto KmIA8; dn9Sf: if (!is_array($customize)) { goto Jkh3t; } goto Ju5D7; JSgI4: $url = $url . '?' . $url_data; goto ClKnz; wCkQn: if (!(is_array($get) && !empty($get))) { goto JA1dj; } goto Ao2Gu; cPRQ5: ETiM9: goto WyjYm; BGtHD: $url = $_GPC['url']; goto jGQj1; VpRP_: $get = str_replace('{{webnamex}}', '美容', $get); goto cEwxr; sGOFT: $post = $sms['content']['post']; goto x0sPu; Ju5D7: foreach ($customize as $x) { $get = str_replace('{{' . $x['attr'] . '}}', $x['value'], $get); Q2bZ3: } goto cPRQ5; a37Qz: echo $request_get['content']; goto naiSB; DUDCF: if (strpos($url, '?') !== false) { goto qkUBv; } goto JSgI4; jGQj1: $sms = pdo_get('xc_beauty_config', array("xkey" => "sms")); goto zv9Vr; WyjYm: Jkh3t: goto VpRP_; Ao2Gu: $get = json_encode($get); goto dn9Sf; ClKnz: goto uyg9k; goto aM2n9; Ea2si: } public function doWebOrderRefund() { goto UboiM; jmyut: $order = pdo_get('xc_beauty_order', array("id" => $_GPC['id'], "uniacid" => $uniacid)); goto SmGpx; Vx7t3: $AppKey = ''; goto rPqE1; YRqIg: $xml = array2xml($refund); goto dIYRT; pJFSG: $money = round(floatval($userinfo['money']) + floatval($order['canpay']), 2); goto lNm32; c6f3k: if ($data['return_code'] == 'SUCCESS') { goto Joqg2; } goto DL_vd; uC18_: apJSf: goto wxCEU; reIWv: echo json_encode($json); goto s110R; I31sQ: $uniacid = $_W['uniacid']; goto jmyut; tjU7e: goto tr8rb; goto nfZH5; dRBU9: file_put_contents(ATTACHMENT_ROOT . $_W['uniacid'] . '_wechat_refund_all.pem', $cert . $key); goto yxGME; t6YNE: exit; goto jCzRM; gL1Gh: fkUZd: goto jigzd; Syltb: if (!empty($result['result'])) { goto y4IEy; } goto bN4PD; ITxXr: goto jip0q; goto xlt8m; PD6Ww: $data['amount'] = $_GPC['amount']; goto uC18_; s110R: exit; goto Im17d; rPqE1: $AppSecret = ''; goto dNZfM; BXeXi: JOOh6: goto NjHVH; R3Bu7: $output = curl_exec($ch); goto dfJAy; On3F9: $url = 'https://api.weixin.qq.com/cgi-bin/message/wxopen/template/send?access_token=' . $token; goto KOfaG; mS1YU: $share_o_amount = round(floatval($userinfo['share_o_amount']) - floatval($share['amount']), 2); goto X_vii; EbKNS: $store = pdo_get('xc_beauty_store', array("uniacid" => $uniacid, "id" => $order['store'])); goto EJrvT; mCDxc: Z6SUc: goto TUCUB; KEQyM: if (!$fan) { goto MtK4P; } goto WYJEi; eIJgT: $postdata = $moban['content']['content']; goto fV71Y; OA2bd: $post_data['form_id'] = $order['form_id2']; goto H4FiD; H4FiD: $post_data['data'] = $postdata; goto On3F9; Ag2vY: curl_setopt($ch, CURLOPT_POSTFIELDS, $post_data); goto R3Bu7; Zh5cj: $refund_fee = floatval($order['wxpay']) * 100; goto Q0FLF; rOW4h: gVJ8p: goto tmqjg; WYJEi: mc_credit_update($fan['uid'], 'credit1', -$order['score'], $log = array(0, "退款", $_GPC['m'], 1, 0, 2)); goto QjjRT; yVvqm: $condition['refund_status'] = 1; goto WrO7t; TUCUB: $json = array("status" => 1, "msg" => "操作成功"); goto rlhc5; YHS4T: $data = array("charge_id" => $order['charge_id'], "amount" => $order['wxpay']); goto TxQwU; Im17d: goto NNgq9; goto p4IB7; TxQwU: if (empty($_GPC['amount'])) { goto apJSf; } goto PD6Ww; TZJkz: $key = authcode($refund_setting['key'], 'DECODE'); goto dRBU9; rSdij: echo json_encode($json); goto oA4Q4; tmqjg: $url = 'https://api.teegon.com/router?method=teegon.agent.mfuser.get.pay.secret&app_key=' . $AppKey . '&client_secret=' . $AppSecret; goto K651J; TVcfa: tr8rb: goto kxiHR; EJrvT: $moban = pdo_get('xc_beauty_config', array("uniacid" => $uniacid, "xkey" => "check")); goto OtmfB; HTfC2: $json = array("status" => -1, "msg" => json_encode($response)); goto DKInx; WrO7t: $condition['status'] = 2; goto HwZos; Idck4: if (!($refund_setting['switch'] != 1)) { goto JOOh6; } goto L5dVm; OtmfB: if (!($order && !empty($order['form_id2']) && $moban && !empty($_GPC['yu_check_result']) && !empty($_GPC['content']))) { goto Z6SUc; } goto Z743D; xMKU9: hxJbZ: goto M5qFk; cmkbj: exMcC: goto fcmLE; Q0FLF: if (empty($_GPC['amount'])) { goto fkUZd; } goto ftpQw; HekJw: goto CL2Hz; goto amq7B; Bi9Ew: upN6t: goto EbKNS; TPoY6: if (!(!empty($config['content']['tiangong']) && !empty($config['content']['AppKey']) && !empty($config['content']['AppSecret']))) { goto hxJbZ; } goto JMvBY; vW2YD: $moban_data = array("out_trade_no" => $order['out_trade_no'], "store" => $store['name'], "service" => $order['title'], "check_result" => "通过", "check_content" => $order['yu_check_content']); goto eIJgT; wPIo0: if (empty($_GPC['yu_check_result'])) { goto Cc_pa; } goto WuCi6; AfalT: if (!(floatval($order['wxpay']) != 0)) { goto PkaYN; } goto YDLy5; rlhc5: echo json_encode($json); goto S0ivn; XFvN6: xmAnO: goto IjPNC; xlt8m: Jxy15: goto KOVlX; UDD8F: $json = array("status" => -1, "msg" => "失败"); goto reIWv; L4D1O: if ($response) { goto CIQmH; } goto HTfC2; rCJ6Z: J2cNT: goto mCDxc; fV71Y: foreach ($postdata as &$ppp) { goto TVH8b; Vrgu8: eUOMr: goto w9A3V; DCVAm: M5Juz: goto Vrgu8; TVH8b: foreach ($moban_data as $key => $mo) { $ppp['value'] = str_replace('{{' . $key . '}}', $mo, $ppp['value']); BQJIM: } goto DCVAm; w9A3V: } goto EPzLd; OKtBr: $total_fee = floatval($order['wxpay']) * 100; goto Zh5cj; L1lUy: $result = vpost($url, $data); goto kkrsn; X_vii: $share_empty = round(floatval($userinfo['share_empty']) + floatval($share['amount'])); goto IbFwt; UH7zQ: ksort($refund); goto rN2zE; IbFwt: pdo_update('xc_beauty_userinfo', array("share_o_amount" => $share_o_amount, "share_empty" => $share_empty), array("status" => 1, "openid" => $order['openid'], "uniacid" => $uniacid)); goto lfhEy; amq7B: Joqg2: goto cSZuS; SmGpx: if ($order) { goto VMZLb; } goto Aft0n; u_2pa: $condition['yu_check_content'] = $_GPC['content']; goto ovMvW; DWTkD: $config = pdo_get('xc_beauty_config', array("xkey" => "web", "uniacid" => $uniacid)); goto ja9tI; R2S5k: $json = array("status" => -1, "msg" => "缺少微信证书"); goto SSUAy; feSYL: $post_data['touser'] = $order['openid']; goto mcKex; CyhMI: CL2Hz: goto TVcfa; DoHBC: unlink(ATTACHMENT_ROOT . $_W['uniacid'] . '_wechat_refund_all.pem'); goto L4D1O; p4IB7: Jzvy6: goto E2cnk; DKInx: echo json_encode($json); goto GiZqC; G2XhP: OOc70: goto n4PQW; pfqRV: if ($tong_bu == 1) { goto Jxy15; } goto cfhKE; M8PA1: $cert = authcode($refund_setting['cert'], 'DECODE'); goto TZJkz; dNZfM: $agent_id = ''; goto fpizI; lNm32: $request = pdo_update('xc_beauty_userinfo', array("money" => $money), array("status" => 1, "openid" => $order['openid'], "uniacid" => $uniacid)); goto cmkbj; IjPNC: if (!empty($order['charge_id']) && !empty($AppKey) && !empty($AppSecret)) { goto gVJ8p; } goto tOniO; NjHVH: if (!(empty($refund_setting['key']) || empty($refund_setting['cert']))) { goto TfSGR; } goto R2S5k; Z743D: $moban['content'] = json_decode($moban['content'], true); goto Qq9te; WuCi6: $condition['yu_check_result'] = $_GPC['yu_check_result']; goto TE9ku; dIYRT: $response = ihttp_request($url, $xml, array(CURLOPT_SSLCERT => ATTACHMENT_ROOT . $_W['uniacid'] . '_wechat_refund_all.pem')); goto DoHBC; teKol: $result = json_decode($result, true); goto Syltb; sjDgQ: echo json_encode($json); goto t6YNE; dfJAy: curl_close($ch); goto rCJ6Z; ZZaGO: $ch = curl_init(); goto OptTh; kt1dc: $refund_setting = $setting['payment']['wechat_refund']; goto Idck4; DL_vd: $json = array("status" => -1, "msg" => $data['return_msg']); goto DCJBR; K651J: $data = array("agent_id" => $agent_id, "user_id" => $user_id, "secret_type" => 1); goto L1lUy; rUvni: curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1); goto vRlZZ; S5gRK: echo json_encode($json); goto fjw45; mcKex: $post_data['template_id'] = $moban['content']['template_id']; goto GWvd5; Qq9te: if (!($moban['content']['status'] == 1)) { goto J2cNT; } goto Z7yuC; jigzd: $url = 'https://api.mch.weixin.qq.com/secapi/pay/refund'; goto hS4TL; PCYeR: exit; goto BXeXi; VJm8l: NNgq9: goto Npm7m; M5qFk: aSsqZ: goto wliB2; TE9ku: Cc_pa: goto sqn4k; ATV_P: $request = pdo_update('xc_beauty_order', $condition, array("id" => $_GPC['id'], "uniacid" => $uniacid)); goto kw0qR; wxCEU: $result = vpost($url, $data); goto teKol; nfZH5: CIQmH: goto MbqYJ; fpizI: $user_id = ''; goto DWTkD; E2cnk: $url = 'https://api.teegon.com/router?method=teegon.payment.charge.refund&app_key=' . $result['result']['key'] . '&client_secret=' . $result['result']['secret']; goto YHS4T; ufTYl: $setting = uni_setting_load('payment', $_W['uniacid']); goto kt1dc; sqn4k: if (empty($_GPC['content'])) { goto ks771; } goto u_2pa; ShiSh: PkaYN: goto f3yBM; S0ivn: exit; goto Mv1A4; l805z: $user_id = $config['content']['user_id']; goto xMKU9; kxiHR: goto NdJeG; goto XFvN6; wliB2: if ($tiangong == 1) { goto xmAnO; } goto ufTYl; YDLy5: $tiangong = -1; goto Vx7t3; HwZos: $condition['refundtime'] = date('Y-m-d H:i:s'); goto wPIo0; KOVlX: $fan = mc_fetch_one($userinfo['openid']); goto KEQyM; ItOLa: ZzK2i: goto Cq0dK; yBRLq: $string = md5($string); goto atCof; qszJ8: TfSGR: goto M8PA1; kw0qR: if ($request) { goto upN6t; } goto LnMvD; eQrrj: VMZLb: goto ydjtQ; E7x54: pdo_update('xc_beauty_userinfo', array("score" => $score), array("status" => 1, "openid" => $order['openid'], "uniacid" => $uniacid)); goto ITxXr; NX8tY: exit; goto CLa_U; EPzLd: hegDS: goto H9hGn; UboiM: global $_GPC, $_W; goto I31sQ; ja9tI: if (!$config) { goto aSsqZ; } goto xLW2D; lfhEy: pdo_update('xc_beauty_share', array("status" => 2), array("status" => 1, "uniacid" => $uniacid, "openid" => $order['openid'], "out_trade_no" => $order['out_trade_no'])); goto Yirex; JMvBY: $tiangong = $config['content']['tiangong']; goto S9Xul; xLW2D: $config['content'] = json_decode($config['content'], true); goto TPoY6; H9hGn: $post_data = array(); goto feSYL; fjw45: exit; goto ry0pI; MbqYJ: $data = xml2array($response['content']); goto c6f3k; L5dVm: $json = array("status" => -1, "msg" => "未开启微信退款功能"); goto PSSKL; Wf7XZ: HVvvM: goto CyhMI; jCzRM: y4IEy: goto VJm8l; GiZqC: exit; goto tjU7e; QjjRT: MtK4P: goto X8lxn; ovMvW: ks771: goto ATV_P; OptTh: curl_setopt($ch, CURLOPT_URL, $url); goto rUvni; t16u7: $token = $account_api->getAccessToken(); goto vW2YD; PSSKL: echo json_encode($json); goto PCYeR; fcmLE: $share = pdo_get('xc_beauty_share', array("status" => 1, "uniacid" => $uniacid, "openid" => $order['openid'], "out_trade_no" => $order['out_trade_no'])); goto S7dte; S7dte: if (!$share) { goto NXrYm; } goto mS1YU; X8lxn: jip0q: goto ItOLa; cfhKE: $score = $userinfo['score'] - $order['score']; goto E7x54; kkrsn: $result = json_decode($result, true); goto yipn6; tOniO: $json = array("status" => -1, "msg" => "失败"); goto ZgvBS; Aft0n: $json = array("status" => -1, "msg" => "操作失败4"); goto WnSsV; Yirex: NXrYm: goto yVvqm; rN2zE: $string = array2url($refund); goto P4iEa; oA4Q4: exit; goto uDZ8x; vRlZZ: curl_setopt($ch, CURLOPT_POST, 1); goto Ag2vY; yipn6: if (!empty($result['result'])) { goto Jzvy6; } goto UDD8F; Npm7m: vVTvW: goto HL3XE; HGqOP: exit; goto HekJw; yxGME: $transaction_id = $order['wx_out_trade_no']; goto OKtBr; Z7yuC: $account_api = WeAccount::create(); goto t16u7; uDZ8x: goto HVvvM; goto MLugV; atCof: $refund['sign'] = strtoupper($string); goto l86_Q; HL3XE: NdJeG: goto ShiSh; MLugV: yLgHx: goto Wf7XZ; DQwg6: goto OOc70; goto eQrrj; f3yBM: if (empty($order['score'])) { goto ZzK2i; } goto IJ63V; bN4PD: $json = array("status" => -1, "msg" => $result['emsg']); goto sjDgQ; ydjtQ: $userinfo = pdo_get('xc_beauty_userinfo', array("status" => 1, "openid" => $order['openid'], "uniacid" => $uniacid)); goto AfalT; Mv1A4: wHdsu: goto G2XhP; TWn8S: $agent_id = $config['content']['agent_id']; goto l805z; S9Xul: $AppKey = $config['content']['AppKey']; goto rRtiv; l86_Q: load()->func('communication'); goto YRqIg; SSUAy: echo json_encode($json); goto bqGqx; rRtiv: $AppSecret = $config['content']['AppSecret']; goto TWn8S; GWvd5: $post_data['page'] = 'xc_beauty/pages/base/base'; goto OA2bd; ftpQw: $refund_fee = floatval($_GPC['amount']) * 100; goto gL1Gh; ry0pI: goto wHdsu; goto Bi9Ew; Cq0dK: if (!(floatval($order['canpay']) != 0)) { goto exMcC; } goto pJFSG; CLa_U: goto vVTvW; goto rOW4h; LnMvD: $json = array("status" => -1, "msg" => "操作失败5"); goto S5gRK; cSZuS: if ($data['result_code'] == 'SUCCESS') { goto yLgHx; } goto ef7NA; hS4TL: $refund = array("appid" => $_W['account']['key'], "mch_id" => $setting['payment']['wechat']['mchid'], "nonce_str" => random(8), "out_refund_no" => $transaction_id, "out_trade_no" => $transaction_id, "refund_fee" => $refund_fee, "total_fee" => $total_fee); goto UH7zQ; IJ63V: $tong_bu = scoreCheck($uniacid); goto pfqRV; ef7NA: $json = array("status" => -1, "msg" => $data['err_code_des']); goto rSdij; P4iEa: $string = $string . "&key={$setting['payment']['wechat']['signkey']}"; goto yBRLq; WnSsV: echo json_encode($json); goto s2oEr; s2oEr: exit; goto DQwg6; bqGqx: exit; goto qszJ8; DCJBR: echo json_encode($json); goto HGqOP; KOfaG: $post_data = json_encode($post_data); goto ZZaGO; ZgvBS: echo json_encode($json); goto NX8tY; n4PQW: } function doMobileTGong() { goto IYJe3; apeBs: curl_setopt($ch, CURLOPT_URL, $sms['content']['url']); goto KXOjV; gOek9: if ($print['content']['type'] == 1) { goto iYbpy; } goto hMrCw; vOQYo: pdo_update('xc_beauty_service', array("group_total" => $service['group_total'] + $order['total']), array("id" => $order['pid'], "uniacid" => $uniacid)); goto sgF6u; x3IY3: bql9r: goto Fj0i8; KdjaF: $orderInfo .= '备注：' . $order['content'] . '<BR>'; goto SrwEP; XE6oI: $url_data = ''; goto yA6Cl; gqxyp: if ($order['order_type'] == 1 || $order['order_type'] == 3 || $order['order_type'] == 4) { goto YTXyA; } goto gDaoe; Mli8d: $get = str_replace('{{addrx}}', '无', $get); goto I5xOM; i59dd: vLvBw: goto MNhLH; hMrCw: if (!($print['content']['type'] == 2)) { goto Bj3HH; } goto M_PHw; mLk1f: $request = pdo_insert('xc_beauty_group', array("uniacid" => $uniacid, "openid" => $order['openid'], "pid" => $order['pid'], "failtime" => $service['group_limit'], "total" => $service['group_number'], "team_total" => 1, "createtime" => date('Y-m-d H:i:s'))); goto E9v_3; ODGNS: goto o0npL; goto WMW1Q; xMTI1: lWdCt: goto Y_W4v; cPnd8: $card_amount = round(floatval($level_data['card_amount']) + floatval($userinfo['order_fee']), 2); goto nz1BA; rKiE4: $one = pdo_get('xc_beauty_userinfo', array("status" => 1, "openid" => $userinfo['share'], "uniacid" => $uniacid)); goto B3ZJp; uUO6H: if (!($card && $card['content']['level_status'] == 1 && $userinfo['card'] == 1)) { goto u2dcu; } goto z4HBf; FLA2K: cSOVF: goto ZX5oJ; Qoi3K: pdo_update('xc_beauty_order', array("group" => $group[0]['id']), array("id" => $order['id'], "uniacid" => $uniacid)); goto qElgp; IvZej: f22jQ: goto dXPKe; WlxAK: $userinfo['score'] = $fan['credit1']; goto E6lZq; tpnI3: ObSqw: goto Z6up5; yA6Cl: foreach ($get as $x3) { goto XcHjs; Rwdtb: GQos6: goto oJi2D; Gyilv: $url_data = $url_data . '&' . urlencode($x3['attr']) . '=' . urlencode($x3['value']); goto VzgEw; XcHjs: if (empty($url_data)) { goto zqQVj; } goto Gyilv; oJi2D: AOb7c: goto b4yCv; uRE6N: zqQVj: goto CKaIM; CKaIM: $url_data = urlencode($x3['attr']) . '=' . urlencode($x3['value']); goto Rwdtb; VzgEw: goto GQos6; goto uRE6N; b4yCv: } goto hT_no; sGrdQ: pdo_update('xc_beauty_times_log', array("total" => $times_log_total), array("uniacid" => $uniacid, "id" => $times_log['id'])); goto tpnI3; h0HPK: $orderInfo .= '姓名：' . $order['userinfo']['name'] . '<BR>'; goto Mbb0t; atQzC: $share_condition['one_amount'] = $share_config['one']; goto xIj0t; nMOWp: iYbpy: goto qsihg; ck5h3: sDvrJ: goto j7bYb; OIWzR: $input = file_get_contents('php://input'); goto LsTwo; ope0I: $get = str_replace('{{webnamex}}', $config['content']['title'], $get); goto JA6_I; p7Wwy: NOc4v: goto CofYk; NOMZp: $orderInfo .= '总件数：' . $order['total'] . '<BR>'; goto yXgfW; zAC5O: $sms['content']['url'] = $header['Location']; goto Ar8Dx; fQxde: $score = intval(floatval($order['o_amount']) / floatval($card['content']['score_attr'])) * $card['content']['score_value']; goto FLA2K; WvNUO: $orderInfo .= '小程序名：' . $config['content']['title'] . '<BR>'; goto zNrfA; BnwyY: $post_data['page'] = 'xc_beauty/pages/base/base'; goto ReZFZ; mD445: $tpl_value = $tpl_value . '&#addrx#=无'; goto nP393; wbYVk: if (!empty($group['team'])) { goto Woy7H; } goto o5pWQ; jO7eV: $requestUrl = 'http://open.10ss.net:8888'; goto oH50e; tk67v: $sms['content']['url'] = $header['Location'][count($header['Location']) - 1]; goto GOwpt; H0cHv: IUFP8: goto ZTTch; G_qCd: pFpGF: goto wdEuB; yXgfW: $orderInfo .= '应付款：' . $order['amount'] . '<BR>'; goto HpLFN; Dk6Ev: $ch = curl_init(); goto apeBs; MBKqX: $level_data['card_amount'] = round(floatval($userinfo['card_amount']) + floatval($order['o_amount']), 2); goto cPnd8; wc_R_: if (!($card && $card['content']['level_status'] == 1 && $userinfo['card'] == 1)) { goto AuxzN; } goto j7R8x; vGrJ4: $sendUrl = 'http://v.juhe.cn/sms/send'; goto Jw1l7; AhjmY: $request = pdo_update('xc_beauty_order', $share_condition, array("id" => $order['id'], "uniacid" => $uniacid)); goto dRZUA; GmGt0: $url = 'https://api.teegon.com/router?method=teegon.payment.charge.info&app_key=MRpZFBi&client_secret=6A8mDpirh2bhyjwG7GSC'; goto ROfBb; MNhLH: $score = null; goto uhZgZ; i2dHR: Rxe2q: goto Wmw2X; puFdU: goto rqZXC; goto wrF2R; kZClt: B5EXU: goto BiA0Q; smQie: Pw4El: goto hv3uu; oH50e: $requestAll = ["partner" => $print['content']['partner'], "machine_code" => $print['content']['machine_code'], "time" => $time, "content" => $content, "sign" => $sign]; goto pJmKE; ZC9xw: X321d: goto FzOng; UDLdN: qI4fy: goto GSDvn; zyeJk: $data_dd = explode('&', $input); goto qLj9t; nQduL: c0Iid: goto so2tE; Y_W4v: goto uu4bm; goto smQie; AdpIs: $order = pdo_get('xc_beauty_order', array("out_trade_no" => $data['order_no'], "status" => -1)); goto cf_rz; T6s5p: $content .= '姓名：' . $order['userinfo']['name'] . '\\r\\n'; goto EEjn3; hT_no: wChTh: goto HHr0E; ABGUb: $error_code = $result['error_code']; goto LMyRz; Wo9kZ: aGHF6: goto fA_j7; mcu8W: $order['userinfo'] = json_decode($order['userinfo'], true); goto BkMqh; PoU9I: $times_log_total = intval($times_log['total']) + 1; goto sGrdQ; BiA0Q: $share_condition['status'] = 1; goto Ss08y; U9sl8: set_time_limit(0); goto Ket1q; dqaZ2: $orderInfo .= '订单号：' . $order['out_trade_no'] . '<BR>'; goto WvNUO; GEV5z: oTQCu: goto K6Ep_; MKIil: $money = round(floatval($money) + floatval($order['gift']), 2); goto nQduL; QToys: $content .= '总件数：' . $order['total'] . '\\r\\n'; goto LA0C9; DSCck: OIQWL: goto PZ1oF; V4riB: if (is_array($header['Location'])) { goto tYaRD; } goto zAC5O; tb8DZ: define('UKEY', $print['content']['ukey']); goto quUEm; Z2a77: $service = pdo_get('xc_beauty_service', array("uniacid" => $uniacid, "id" => $order['pid'])); goto SrWyY; k2Nhd: $request = push($requestInfo, $requestUrl); goto S_Urg; E9v_3: if (!$request) { goto u0fer; } goto vOQYo; qLj9t: $data = array(); goto iwR2y; jBXlg: $userinfo = pdo_get('xc_beauty_userinfo', array("status" => 1, "openid" => $order['openid'])); goto kxdZf; axk3p: pqYWy: goto UMiVo; C2XQO: foreach ($post as $x2) { $data[$x2['attr']] = $x2['value']; UZBQh: } goto JicTn; FUGwI: $post_data['touser'] = $order['openid']; goto d_1UC; SyBn2: Nn0E8: goto ZJ4z6; BH0EC: $content .= '实付款：' . $order['o_amount'] . '\\r\\n'; goto T6s5p; Z6up5: YMHsA: goto GQV9_; JCDMf: V5TN_: goto guOwP; kjIzZ: $userinfo = pdo_get('xc_beauty_userinfo', array("status" => 1, "uniacid" => $uniacid, "openid" => $order['openid'])); goto ZOdmx; uElJT: echo 'SUCCESS'; goto xVpyT; zNrfA: $orderInfo .= '--------------------------------<BR>'; goto jOPQ3; zmdLS: $orderInfo .= '--------------------------------<BR>'; goto NOMZp; mfMTs: $sms['content']['url'] = $sms['content']['url'] . $url_data; goto HqOTw; mpGNv: $share_condition['two_amount'] = null; goto aqJ41; h8wZr: if (!$request) { goto eDXic; } goto xIoNR; jOPQ3: $orderInfo .= '服务项目：' . $service['name'] . '<BR>'; goto zmdLS; Yo9ry: $post = json_encode($post); goto J_gBl; hG0aw: load()->func('logging'); goto PXMYn; Akjal: if (!$sms) { goto zyz6Q; } goto T45He; d_1UC: $post_data['template_id'] = $config['content']['template_id']; goto BnwyY; CCoCc: $result = vpost($url, $ttt); goto goVH1; iX5yQ: $card_amount = round(floatval($level_data['card_amount']) + floatval($userinfo['order_fee']), 2); goto v83Fj; v8tzf: $orderInfo .= '地址：' . $order['userinfo']['address'] . '<BR>'; goto Badon; BJkum: $tong_bu = scoreCheck($uniacid); goto OKwTY; M5nRQ: if (!(!empty($result['result']) && $result['result']['paid'])) { goto vWfwR; } goto QmtA9; GQV9_: QvMpZ: goto dadpl; HTP45: dGjoH: goto PoU9I; PxrFb: Winct: goto KXPs5; Zaw4a: $get = str_replace('{{phonex}}', $order['userinfo']['mobile'], $get); goto aQLGa; nz1BA: if (!(!empty($card['content']['level']) && is_array($card['content']['level']))) { goto qI4fy; } goto mFZN8; Xg_vj: if (!$fan) { goto Krx8G; } goto Y9ymv; UKDgJ: $share_condition['one_amount'] = round(floatval($order['o_amount']) * floatval($share_config['one']) * 0.01, 2); goto zxd04; j2DLd: $postdata = array("keyword1" => array("value" => $order['userinfo']['name']), "keyword2" => array("value" => $order['userinfo']['mobile']), "keyword3" => array("value" => $service['name']), "keyword4" => array("value" => date('Y-m-d'))); goto FUGwI; gFmRC: $request = wp_print(SN, $orderInfo, 1); goto GPDsx; BdAQj: $content .= '地址：' . $order['userinfo']['address'] . '\\r\\n'; goto AaejM; fX8QO: if (empty($order['coupon_id'])) { goto IlEpG; } goto UAVq5; GJ_XU: foreach ($card['content']['level'] as $card_l) { goto COu16; COu16: if (!(floatval($card_amount) >= floatval($card_l['amount']))) { goto N4MSI; } goto abVnd; abVnd: $level_data['card_name'] = $card_l['name']; goto S4T15; DQNfa: N4MSI: goto BweM4; BweM4: Hc07q: goto Ow3uj; S4T15: $level_data['card_price'] = $card_l['price']; goto DQNfa; Ow3uj: } goto PnYn9; SFWuT: if (!is_array($customize)) { goto ECcUS; } goto DSZLL; fxmNQ: $share_config = array("level" => 3, "type" => "", "one" => "", "two" => "", "three" => ""); goto Y21Fg; yUK6G: OzWDD: goto kEy2j; M_PHw: include dirname(__FILE__) . '/resource/HttpClient.class.php'; goto wWq1l; naLBp: $result = json_decode($result, true); goto M5nRQ; WzWu9: o5jo1: goto cNxuQ; so2tE: $request = pdo_update('xc_beauty_order', array("status" => 1, "money" => $money, "wx_out_trade_no" => $data['out_trade_no']), array("id" => $order['id'], "uniacid" => $uniacid)); goto h8wZr; e1xDE: $content .= '小程序名：' . $config['content']['title'] . '\\r\\n'; goto QToys; LRaK2: $sms = pdo_get('xc_beauty_config', array("uniacid" => $uniacid, "xkey" => "sms")); goto Akjal; guOwP: LDe6L: goto iU1k2; UJkNs: $output = curl_exec($ch); goto XoN9K; liss9: pdo_update('xc_beauty_userinfo', array("money" => $moeny), array("status" => 1, "openid" => $order['openid'])); goto H0cHv; JCkbN: if ($sms['content']['type'] == 1) { goto Pw4El; } goto ojSVF; UMiVo: if (empty($share['content']['type'])) { goto Xa1Rq; } goto x7PTJ; g_b0P: uiZCr: goto Fy2jN; dadpl: goto xIc1y; goto BgDnu; yrzzJ: $orderInfo = '<CB>订单</CB><BR>'; goto dqaZ2; EI3yl: if (!$config) { goto lTm6K; } goto PMH43; Ket1q: header('Content-Type: text/plain; charset=utf-8'); goto VcCUN; yBawx: $output = curl_exec($ch); goto hVug6; qwBdd: qLCbl: goto arYCC; V3rGc: if (!$card) { goto yTe3Q; } goto aPseQ; gWpWF: $group_data['team'] = json_encode($group_data['team']); goto J7aey; fVAoX: pdo_insert('xc_beauty_share', array("uniacid" => $uniacid, "openid" => $share_condition['three_openid'], "title" => "三级订单结算奖励", "out_trade_no" => $order['out_trade_no'], "amount" => $share_condition['three_amount'], "level" => 3, "status" => -1, "createtime" => date('Y-m-d H:i:s'))); goto tW1Nj; BkMqh: $config = pdo_get('xc_beauty_config', array("xkey" => "web", "uniacid" => $uniacid)); goto EI3yl; caQ4L: if (!($card['content']['score_status'] == 1 && !empty($card['content']['score_attr']) && !empty($card['content']['score_value']) && $userinfo['card'] == 1)) { goto cSOVF; } goto fQxde; f11Nw: goto Ug0zn; goto kMBpf; dAJyP: $send = new sms(); goto AS6YP; rDK32: if (empty($share_condition['one_openid'])) { goto OzWDD; } goto r4ep0; ce3ub: ebney: goto BdAQj; RGM14: define('PORT', 80); goto DYfR1; EEjn3: $content .= '手机：' . $order['userinfo']['mobile'] . '\\r\\n'; goto k05Sz; sgF6u: $group = pdo_getall('xc_beauty_group', array("uniacid" => $uniacid, "openid" => $order['openid']), array(), '', 'id DESC'); goto Qoi3K; CofYk: header('content-type:text/html;charset=utf-8'); goto vGrJ4; qsihg: $service_name = $service['name']; goto NhXEN; jKL2Y: S6Jsi: goto dAJyP; JicTn: A95nz: goto keF_T; yNGTD: if (!(is_array($post) && !empty($post))) { goto Oi_p7; } goto Yo9ry; JCHi3: pdo_insert('xc_beauty_score', array("uniacid" => $uniacid, "openid" => $order['openid'], "status" => 1, "score" => $score, "over" => $user_score, "title" => "消费", "createtime" => date('Y-m-d H:i:s'))); goto gXYUt; PDDlP: $orderInfo .= '地址：无<BR>'; goto pgULd; xIoNR: pdo_update('xc_beauty_userinfo', array("money" => $money), array("status" => 1, "uniacid" => $uniacid, "openid" => $order['openid'])); goto DdDlK; HqOTw: d4Jxw: goto Dk6Ev; moPL1: Fe2l0: goto Al29C; xJYfj: foreach ($list as $l) { goto fTxzC; fTxzC: if (empty($l['score'])) { goto Kk9lB; } goto VO7W_; C6UHt: $level_data['card_amount'] = round(floatval($userinfo['card_amount']) + floatval($l['o_amount']), 2); goto Uw1yr; fs0Rh: Il5ni: goto m0dxr; jiQH4: $userinfo['score'] = $fan['credit1']; goto Jwufg; krUxF: S3cWs: goto OeqSj; VO7W_: $userinfo = pdo_get('xc_beauty_userinfo', array("status" => 1, "openid" => $l['openid'])); goto sqObM; Ywq36: $fan = mc_fetch_one($userinfo['openid']); goto xYNj1; tCbZ2: Kk9lB: goto AJ7_m; Jwufg: G7DSl: goto im8x6; rAZvE: pdo_update('xc_beauty_userinfo', $level_data, array("openid" => $l['openid'], "uniacid" => $uniacid)); goto fs0Rh; El7Ju: VLgpK: goto I93qH; NGwhU: mc_credit_update($fan['uid'], 'credit1', $l['score'], $log = array(0, "消费", $_GPC['m'], 1, 0, 2)); goto oKxH0; JrLzh: $level_data = array(); goto C6UHt; jLPrX: pdo_insert('xc_beauty_share', array("uniacid" => $uniacid, "openid" => $l['three_openid'], "title" => "三级订单结算奖励", "out_trade_no" => $l['out_trade_no'], "amount" => $l['three_amount'], "level" => 3, "status" => -1, "createtime" => date('Y-m-d H:i:s'))); goto HpA7I; E0peB: if (empty($l['two_openid'])) { goto S3cWs; } goto CwHVL; f1hnh: if (!(!empty($card['content']['level']) && is_array($card['content']['level']))) { goto wt9Ee; } goto g_MSj; xYNj1: if (!$fan) { goto QwhuK; } goto NGwhU; AJ7_m: if (!($card && $card['content']['level_status'] == 1 && $userinfo['card'] == 1)) { goto Il5ni; } goto JrLzh; IUBbu: aHQbA: goto E0peB; cXIWQ: pdo_insert('xc_beauty_score', array("uniacid" => $uniacid, "openid" => $l['openid'], "status" => 1, "score" => $l['score'], "over" => $user_score, "title" => "消费", "createtime" => date('Y-m-d H:i:s'))); goto tCbZ2; TliZd: pdo_insert('xc_beauty_share', array("uniacid" => $uniacid, "openid" => $l['one_openid'], "title" => "一级订单结算奖励", "out_trade_no" => $l['out_trade_no'], "amount" => $l['one_amount'], "level" => 1, "status" => -1, "createtime" => date('Y-m-d H:i:s'))); goto IUBbu; im8x6: JRmfi: goto SdexC; HpA7I: gy3fb: goto El7Ju; kTNAz: VNt0o: goto cXIWQ; sqObM: $tong_bu = scoreCheck($uniacid); goto I4F0m; oKxH0: QwhuK: goto kTNAz; d1lz6: goto VNt0o; goto QDDtO; I4F0m: if (!($tong_bu == 1)) { goto JRmfi; } goto JzgxY; SdexC: $user_score = $userinfo['score'] + $l['score']; goto NKLSP; QDDtO: V1Ll1: goto Ywq36; gRVOZ: pdo_update('xc_beauty_userinfo', array("score" => $user_score), array("status" => 1, "openid" => $l['openid'], "uniacid" => $uniacid)); goto d1lz6; OeqSj: if (empty($l['three_openid'])) { goto gy3fb; } goto jLPrX; vPX2w: wt9Ee: goto rAZvE; NNIGJ: rDvH3: goto vPX2w; CwHVL: pdo_insert('xc_beauty_share', array("uniacid" => $uniacid, "openid" => $l['two_openid'], "title" => "二级订单结算奖励", "out_trade_no" => $l['out_trade_no'], "amount" => $l['two_amount'], "level" => 2, "status" => -1, "createtime" => date('Y-m-d H:i:s'))); goto krUxF; RCQU2: if (!$fan) { goto G7DSl; } goto jiQH4; g_MSj: foreach ($card['content']['level'] as $card_l) { goto Al10G; PvrmO: $level_data['card_price'] = $card_l['price']; goto uw7m9; IVqvm: GttC1: goto PsZz6; uw7m9: UpviG: goto IVqvm; Al10G: if (!(floatval($card_amount) >= floatval($card_l['amount']))) { goto UpviG; } goto N31Rn; N31Rn: $level_data['card_name'] = $card_l['name']; goto PvrmO; PsZz6: } goto NNIGJ; JzgxY: $fan = mc_fetch_one($userinfo['openid']); goto RCQU2; m0dxr: if (empty($l['one_openid'])) { goto aHQbA; } goto TliZd; NKLSP: if ($tong_bu == 1) { goto V1Ll1; } goto gRVOZ; Uw1yr: $card_amount = round(floatval($level_data['card_amount']) + floatval($userinfo['order_fee']), 2); goto f1hnh; I93qH: } goto sL9j0; S_Urg: PPvOl: goto qa2_p; rsKnP: Krx8G: goto a3POC; BxuA5: $content .= '日期：' . $order['plan_date'] . '\\r\\n'; goto ri8eo; lbCMY: curl_setopt($ch, CURLOPT_URL, $url); goto okOUb; a5jFY: pdo_update('xc_beauty_userinfo', array("score" => $user_score), array("status" => 1, "openid" => $order['openid'], "uniacid" => $uniacid)); goto ALFZz; PDxYV: uu4bm: goto uzi6G; PMH43: $config['content'] = json_decode($config['content'], true); goto MXUxi; u3evS: foreach ($customize as $x) { $post = str_replace('{{' . $x['attr'] . '}}', $x['value'], $post); Yfc2j: } goto JCDMf; Tevup: if (empty($order['gift'])) { goto c0Iid; } goto MKIil; xIj0t: UNTPu: goto ODGNS; gDaoe: if ($order['order_type'] == 2) { goto DzGcY; } goto zTRYI; k5cIU: uY9LM: goto dlVkh; GUyeo: $share_condition['three_amount'] = null; goto pRpId; WNLge: Oi_p7: goto hpVS8; zwEXr: $get = str_replace('{{amount}}', $order['o_amount'] . '元', $get); goto Ztd9w; qsJ6V: goto PPvOl; goto nMOWp; SrWyY: goto pFpGF; goto Yb30e; v6XUR: if (!($order['order_type'] == 3)) { goto QvMpZ; } goto cgBa1; vUdN9: u2dcu: goto H3Z15; AaejM: kGmLK: goto BxuA5; QSdGz: goto ObSqw; goto HTP45; BgDnu: zBF9H: goto uUO6H; cf_rz: logging_run('order:' . json_encode($order)); goto QJL5a; HP9X6: if (empty($sms['content']['url'])) { goto KXOrL; } goto lEE4M; hVug6: curl_close($ch); goto WNLge; Y21Fg: $share_status = 1; goto wYH5z; RYUPo: lA0Nb: goto UDLdN; Uf9RR: $share_condition['three_openid'] = $two['share']; goto U2ViX; HpLFN: $orderInfo .= '实付款：' . $order['o_amount'] . '<BR>'; goto h0HPK; LMyRz: s8JfB: goto xMTI1; I0CX1: mzIsK: goto AhjmY; ZDkMn: eEYGP: goto I6oMd; Zp7Dw: if (!($sms['content']['status'] == 1)) { goto ja8Po; } goto JCkbN; kEy2j: if (empty($share_condition['two_openid'])) { goto sDvrJ; } goto b3uJr; ommSZ: $post = str_replace('{{namex}}', $order['userinfo']['name'], $post); goto buxZv; q9ERU: $post = str_replace('{{addrx}}', '无', $post); goto PwhXR; BmiGg: Pkb4B: goto PnmMc; zxd04: o0npL: goto rKiE4; zTRYI: if (!($order['order_type'] == 5)) { goto y8uJw; } goto jBXlg; tybko: $customize = $sms['content']['customize']; goto Ygdb6; GOwpt: Yqgy7: goto JQWmH; iwR2y: foreach ($data_dd as &$dddd) { goto EmuuQ; jW35p: $data[$dddd[0]] = $dddd[1]; goto TX1iR; EmuuQ: $dddd = explode('=', $dddd); goto jW35p; TX1iR: rgqGO: goto SxTJJ; SxTJJ: } goto SyBn2; v83Fj: if (!(!empty($card['content']['level']) && is_array($card['content']['level']))) { goto aGHF6; } goto GJ_XU; MKgdx: goto X321d; goto MMHiP; HgwXw: $templateParam['addrx'] = '无'; goto zu6G9; pJmKE: $requestInfo = http_build_query($requestAll); goto k2Nhd; GSDvn: pdo_update('xc_beauty_userinfo', $level_data, array("openid" => $order['openid'], "uniacid" => $uniacid)); goto vUdN9; HHr0E: if (strpos($sms['content']['url'], '?') !== false) { goto p0VW1; } goto sfSWW; T45He: $sms['content'] = json_decode($sms['content'], true); goto Zp7Dw; HkW4A: define('SIG', sha1(USER . UKEY . STIME)); goto jJ4E3; Y9ymv: mc_credit_update($fan['uid'], 'credit1', $score, $log = array(0, "消费", $_GPC['m'], 1, 0, 2)); goto rsKnP; r4ObH: $share_config['two'] = $share['content']['level_two']; goto pnl2s; nPAkt: $tpl_value = $tpl_value . '&#addrx#=' . $order['userinfo']['address']; goto dhhcP; HDc0i: $group_data['team'] = json_decode($group['team'], true); goto pGEXU; ZaXzV: $post = json_decode($post, true); goto ZdDGL; T_5fY: $share_condition['two_openid'] = null; goto mpGNv; iyL9S: $card = pdo_get('xc_beauty_config', array("xkey" => "card", "uniacid" => $uniacid)); goto wc_R_; pRpId: if (!(!empty($share_config['type']) && $share_status == 1)) { goto mzIsK; } goto HbE_F; uhZgZ: $card = pdo_get('xc_beauty_config', array("xkey" => "card", "uniacid" => $uniacid)); goto V3rGc; Zn76C: if ($order['order_type'] == 1 || $order['order_type'] == 4) { goto zBF9H; } goto v6XUR; ZCJ93: YTXyA: goto kLntd; e6AXU: $get = json_encode($get); goto SFWuT; l1hSA: curl_setopt($ch, CURLOPT_HEADER, 0); goto cMuvj; vpr1p: curl_setopt($ch, CURLOPT_POST, 1); goto AHm0z; vTKuf: $list = pdo_getall('xc_beauty_order', array("status" => 1, "order_type" => 3, "group" => $order['group'])); goto pCFCZ; PGwuO: $share_condition['two_openid'] = $one['share']; goto nrlgq; k05Sz: if (!empty($order['userinfo']['address'])) { goto ebney; } goto gmwaD; qElgp: u0fer: goto tBHm_; yjCJl: $account_api = WeAccount::create(); goto qp4g0; VcCUN: $templateParam = array("webnamex" => $config['content']['title'], "trade" => $order['out_trade_no'], "amount" => $order['o_amount'], "namex" => $order['userinfo']['name'], "phonex" => $order['userinfo']['mobile'], "datex" => $order['plan_date']); goto DvmfA; kRUh1: $share_config['one'] = $service['level_one']; goto tx2zt; k6UMp: $content = ''; goto BIrkl; tW1Nj: SDwNS: goto g_b0P; S5Ex4: $user_score = $userinfo['score'] + $score; goto Dx1XC; kY5sS: $orderInfo .= '日期：' . $order['plan_date'] . '<BR>'; goto ub4JR; zu6G9: goto S6Jsi; goto q5bdv; DdDlK: eDXic: goto HdrdN; yiM8P: $get = json_decode($get, true); goto XE6oI; Mzi9C: $content .= '应付款：' . $order['amount'] . '\\r\\n'; goto BH0EC; z382x: goto kGmLK; goto ce3ub; hpVS8: $get = $sms['content']['get']; goto xDa4y; ZTTch: if (empty($order['coupon_id'])) { goto vLvBw; } goto KcGkK; zAa8d: Rrx27: goto PQn8m; mRX1X: $post_data = json_encode($post_data); goto uYyvo; eB64X: $service_data = array(); goto dmDvP; btElv: logging_run('666:' . $data['order_no']); goto AdpIs; dmDvP: if (!$service_list) { goto u3wyv; } goto TOMmP; sADc0: pdo_update('xc_beauty_userinfo', array("money" => $moeny), array("status" => 1, "openid" => $order['openid'])); goto mMQ3Q; y33r0: $post = str_replace('{{amount}}', $order['o_amount'] . '元', $post); goto ommSZ; AS6YP: $result = $send->sendSms($sms['content']['AccessKeyId'], $sms['content']['AccessKeySecret'], $sms['content']['sign'], $sms['content']['code'], $sms['content']['mobile'], $templateParam); goto PDxYV; Jw1l7: $tpl_value = '#webnamex#=' . $config['content']['title'] . '&#trade#=' . $order['out_trade_no'] . '&#amount#=' . $order['o_amount'] . '&#namex#=' . $order['userinfo']['name'] . '&#phonex#=' . $order['userinfo']['mobile'] . '&#datex#=' . $order['plan_date']; goto UVJ43; OKwTY: if (!($tong_bu == 1)) { goto h0JMc; } goto K72VA; wWq1l: define('USER', $print['content']['user']); goto tb8DZ; ofkh1: if ($share_config['type'] == 1) { goto hd6Jx; } goto Hgz__; ZX5oJ: yTe3Q: goto fxmNQ; xVpyT: vWfwR: goto dA1i0; nP393: goto s2EOW; goto zRWFP; s4g2S: if (!$group) { goto eEYGP; } goto Rva8H; sfSWW: $sms['content']['url'] = $sms['content']['url'] . '?' . $url_data; goto L8YCf; RN_vM: AuxzN: goto wb1Fg; V7Ezt: pdo_update('xc_beauty_user_coupon', array("status" => 1), array("id" => $use_coupon['id'], "uniacid" => $uniacid)); goto i59dd; F_lys: Gc3bM: goto MKgdx; tx2zt: $share_config['two'] = $service['level_two']; goto I7LLR; dXPKe: $group = pdo_get('xc_beauty_group', array("id" => $order['group'], "uniacid" => $uniacid)); goto s4g2S; cv_kQ: UcWFk: goto leD_G; Badon: DyUa0: goto kY5sS; MXUxi: if (empty($config['content']['template_id'])) { goto oTQCu; } goto yjCJl; KVNHp: define('STIME', time()); goto HkW4A; QRevD: if ($times_log) { goto dGjoH; } goto RzjQR; Dx1XC: if ($tong_bu == 1) { goto WWC73; } goto a5jFY; aqJ41: $share_condition['three_openid'] = null; goto GUyeo; qa2_p: Vlucu: goto PxrFb; SyoOM: WWC73: goto tA7pE; BEtSv: $moeny = round(floatval($userinfo['money']) - floatval($order['canpay']), 2); goto sADc0; IwdzC: $share_status = $share['content']['status']; goto xIdL8; O3W89: $group_data['team_total'] = $group['team_total'] + 1; goto XM7Ds; Kb5s1: goto lWdCt; goto p7Wwy; LsTwo: $isxml = true; goto Zh57I; VZQom: $url = 'https://api.weixin.qq.com/cgi-bin/message/wxopen/template/send?access_token=' . $token; goto mRX1X; mN1YL: if (!(floatval($order['canpay']) != 0)) { goto IUFP8; } goto wW63I; kMBpf: DzGcY: goto kjIzZ; Ss08y: $share_condition['score'] = $score; goto RnVeU; TdjRn: XBUtY: goto v8tzf; DYfR1: define('PATH', '/Api/Open/'); goto KVNHp; EI2d2: curl_setopt($ch, CURLOPT_POST, 1); goto yjenK; Ixx2_: $get = str_replace('{{addrx}}', $order['userinfo']['address'], $get); goto BmiGg; mFfRO: SZabw: goto ZDkMn; s_LxC: if (!($share_config['type'] == 2)) { goto Gc3bM; } goto nxAt6; H3Z15: if (!($share_status == 1)) { goto uiZCr; } goto rDK32; UAVq5: $use_coupon = pdo_get('xc_beauty_user_coupon', array("status" => -1, "openid" => $order['openid'], "uniacid" => $uniacid, "cid" => $order['coupon_id'])); goto MUfB1; K6Ep_: lTm6K: goto LRaK2; goVH1: logging_run('result:' . $result); goto naLBp; qVc0w: if (!($share_config['type'] == 2)) { goto Fe2l0; } goto MsBcQ; tA7pE: $fan = mc_fetch_one($userinfo['openid']); goto Xg_vj; YuLsM: curl_close($ch); goto cv_kQ; KrO67: u3wyv: goto yrzzJ; leD_G: KXOrL: goto vFJVJ; PZ1oF: $share_condition['three_amount'] = round(floatval($order['o_amount']) * floatval($share_config['three']) * 0.01, 2); goto JfY63; Zh57I: $get = ''; goto hG0aw; eVHuG: if (!$content) { goto s8JfB; } goto N_2El; lEE4M: $header = get_headers($sms['content']['url'] . '&xcdubuge=1', 1); goto Edsk1; ysaxW: $share_condition['one_openid'] = null; goto EUQXU; xDa4y: if (!(is_array($get) && !empty($get))) { goto UcWFk; } goto e6AXU; nuXU4: if (empty($order['member'])) { goto YMHsA; } goto oU97K; jYnTn: $templateParam['addrx'] = $order['userinfo']['address']; goto jKL2Y; szFu9: u3Rdx: goto WUgov; ojSVF: if ($sms['content']['type'] == 2) { goto NOc4v; } goto Ihft9; fzcY3: $share_config['type'] = $service['type']; goto kRUh1; iU1k2: $post = str_replace('{{webnamex}}', $config['content']['title'], $post); goto O4RDM; PnmMc: $get = str_replace('{{datex}}', $order['plan_date'], $get); goto yiM8P; j7bYb: if (empty($share_condition['three_openid'])) { goto SDwNS; } goto fVAoX; JA6_I: $get = str_replace('{{trade}}', $order['out_trade_no'], $get); goto zwEXr; KcGkK: $use_coupon = pdo_get('xc_beauty_user_coupon', array("status" => -1, "openid" => $order['openid'], "uniacid" => $uniacid, "cid" => $order['coupon_id'])); goto V7Ezt; buxZv: $post = str_replace('{{phonex}}', $order['userinfo']['mobile'], $post); goto np6Yf; skKkh: rqZXC: goto gWpWF; Fj0i8: $post = str_replace('{{addrx}}', $order['userinfo']['address'], $post); goto szFu9; IMNtK: if (!$request) { goto GAhoS; } goto iyL9S; gXYUt: SttAj: goto mcu8W; RnVeU: $share_condition['wx_out_trade_no'] = $order['out_trade_no']; goto ysaxW; qFdRF: if (!$print) { goto Winct; } goto tlZrf; zRWFP: K1ssc: goto nPAkt; yjenK: curl_setopt($ch, CURLOPT_POSTFIELDS, $post_data); goto UJkNs; b3uJr: pdo_insert('xc_beauty_share', array("uniacid" => $uniacid, "openid" => $share_condition['two_openid'], "title" => "二级订单结算奖励", "out_trade_no" => $order['out_trade_no'], "amount" => $share_condition['two_amount'], "level" => 2, "status" => -1, "createtime" => date('Y-m-d H:i:s'))); goto ck5h3; keF_T: $ch = curl_init(); goto PcEhA; hkbMR: $group_data['status'] = 1; goto qwBdd; HdrdN: Ug0zn: goto VUdEc; KXPs5: xIc1y: goto i2dHR; MsBcQ: $share_condition['three_amount'] = $share_config['three']; goto moPL1; wb1Fg: GAhoS: goto RzmWz; PQn8m: c12VI: goto I0CX1; ZJ4z6: logging_run('input:' . json_encode($data)); goto btElv; np6Yf: if (!empty($order['userinfo']['address'])) { goto bql9r; } goto q9ERU; Ar8Dx: goto Yqgy7; goto g2U65; GIxb0: define('IP', 'api.feieyun.cn'); goto RGM14; arYCC: $request = pdo_update('xc_beauty_group', $group_data, array("id" => $order['group'], "uniacid" => $uniacid)); goto St8tK; Yb30e: g_jX_: goto cSUYA; ub4JR: if (empty($order['content'])) { goto A9UIp; } goto KdjaF; x7PTJ: $share_config['type'] = $share['content']['type']; goto nvMpS; nrlgq: if ($share_config['type'] == 1) { goto DxlCB; } goto s_LxC; MUfB1: pdo_update('xc_beauty_user_coupon', array("status" => 1), array("id" => $use_coupon['id'], "uniacid" => $uniacid)); goto Q825w; q5bdv: Z2RHQ: goto jYnTn; oU97K: $times_log = pdo_get('xc_beauty_times_log', array("uniacid" => $uniacid, "plan_date" => $order['plan_date'], "member" => $order['member'], "createtime >=" => date('Y') . '-01-01 00:00:00')); goto QRevD; pnl2s: $share_config['three'] = $share['content']['level_three']; goto Frelu; RzmWz: y8uJw: goto f11Nw; kxdZf: if (!(floatval($order['canpay']) != 0)) { goto acyjl; } goto BEtSv; XM7Ds: if (!($group_data['team_total'] == $group['total'])) { goto qLCbl; } goto hkbMR; tlZrf: $print['content'] = json_decode($print['content'], true); goto jRe1r; J_gBl: if (!is_array($customize)) { goto LDe6L; } goto u3evS; uYyvo: $ch = curl_init(); goto lbCMY; bBx__: echo 'SUCCESS'; goto k5cIU; g2U65: tYaRD: goto tk67v; PXMYn: logging_run('天工'); goto G_btf; I7LLR: $share_config['three'] = $service['level_three']; goto kZClt; hv3uu: require_once '../addons/xc_beauty/resource/sms/sendSms.php'; goto U9sl8; MMHiP: DxlCB: goto hHnDK; EqpSI: if (empty($share['content']['status'])) { goto CwPgb; } goto IwdzC; ZOdmx: $money = floatval($userinfo['money']) + floatval($order['amount']); goto Tevup; L8YCf: goto d4Jxw; goto hp51B; I5xOM: goto Pkb4B; goto iXxRM; AHm0z: curl_setopt($ch, CURLOPT_POSTFIELDS, $data); goto yBawx; okOUb: curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1); goto EI2d2; U2ViX: if ($share_config['type'] == 1) { goto OIQWL; } goto qVc0w; z4HBf: $level_data = array(); goto MBKqX; pGEXU: $group_data['team'][] = $order['openid']; goto skKkh; nvMpS: $share_config['one'] = $share['content']['level_one']; goto r4ObH; Hgz__: if (!($share_config['type'] == 2)) { goto UNTPu; } goto atQzC; B3ZJp: if (!($share_config['level'] >= 2 && !empty($share_config['two']) && !empty($one['share']))) { goto Rrx27; } goto PGwuO; G_btf: if (empty($input)) { goto uY9LM; } goto zyeJk; WUgov: $post = str_replace('{{datex}}', $order['plan_date'], $post); goto ZaXzV; MXW6Z: if (empty($share['content']['level'])) { goto pqYWy; } goto wRMOH; jJ4E3: $service_list = pdo_getall('xc_cake_service', array("uniacid" => $uniacid)); goto eB64X; QJL5a: if (!$order) { goto LrbXw; } goto GmGt0; xIdL8: CwPgb: goto MXW6Z; wlYEU: $level_data['card_amount'] = round(floatval($userinfo['card_amount']) + floatval($order['o_amount']), 2); goto iX5yQ; QmtA9: $uniacid = $order['uniacid']; goto gqxyp; o5pWQ: $group_data['team'] = array($order['openid']); goto puFdU; mFZN8: foreach ($card['content']['level'] as $card_l) { goto ecKZa; Ie2WI: $level_data['card_name'] = $card_l['name']; goto orABw; LYDd7: SHrmK: goto O3AdK; ecKZa: if (!(floatval($card_amount) >= floatval($card_l['amount']))) { goto SHrmK; } goto Ie2WI; O3AdK: xd7a9: goto EHMwQ; orABw: $level_data['card_price'] = $card_l['price']; goto LYDd7; EHMwQ: } goto RYUPo; ZdDGL: $data = array(); goto C2XQO; JQWmH: wo6Aq: goto tybko; wW63I: $moeny = round(floatval($userinfo['money']) - floatval($order['canpay']), 2); goto liss9; nxAt6: $share_condition['two_amount'] = $share_config['two']; goto F_lys; HbE_F: if (!($share_config['level'] >= 1 && !empty($share_config['one']) && !empty($userinfo['share']))) { goto c12VI; } goto TAP6y; zR6o2: if (!($group_data['status'] == 1)) { goto EMdcj; } goto vTKuf; vc6KG: $content = juhecurl($sendUrl, $smsConf, 1); goto eVHuG; aPseQ: $card['content'] = json_decode($card['content'], true); goto caQ4L; dRZUA: if (!$request) { goto Rxe2q; } goto Zn76C; iXxRM: vCSjp: goto Ixx2_; PnYn9: Ejl4Z: goto Wo9kZ; UVJ43: if (!empty($order['userinfo']['address'])) { goto K1ssc; } goto mD445; Mbb0t: $orderInfo .= '手机：' . $order['userinfo']['mobile'] . '<BR>'; goto rKBDo; TAP6y: $share_condition['one_openid'] = $userinfo['share']; goto ofkh1; N4Hd7: if (!($share_config['level'] >= 3 && !empty($share_config['three']) && !empty($two['share']))) { goto SbIDB; } goto Uf9RR; aQLGa: if (!empty($order['userinfo']['address'])) { goto vCSjp; } goto Mli8d; EUQXU: $share_condition['one_amount'] = null; goto T_5fY; cgBa1: if (!empty($order['group'])) { goto f22jQ; } goto mLk1f; ROfBb: $ttt = array("charge_id" => $data['charge_id']); goto CCoCc; Ygdb6: $post = $sms['content']['post']; goto yNGTD; quUEm: define('SN', $print['content']['sn']); goto GIxb0; LA0C9: $content .= '商品：' . $service_name . '\\r\\n'; goto Mzi9C; wRMOH: $share_config['level'] = $share['content']['level']; goto axk3p; DSZLL: foreach ($customize as $x) { $get = str_replace('{{' . $x['attr'] . '}}', $x['value'], $get); XJEnU: } goto zy5vv; VUdEc: goto BBNzS; goto ZCJ93; iQsWC: h0JMc: goto S5Ex4; Mr7pW: $post_data['data'] = $postdata; goto VZQom; dhhcP: s2EOW: goto BM8Du; hp51B: p0VW1: goto mfMTs; pCFCZ: if (!$list) { goto o5jo1; } goto xJYfj; A40xD: ECcUS: goto ope0I; FzOng: $two = pdo_get('xc_beauty_userinfo', array("status" => 1, "openid" => $one['share'], "uniacid" => $uniacid)); goto N4Hd7; JfY63: J8TI0: goto qjff1; ri8eo: $sign = strtoupper(md5($print['content']['apikey'] . 'machine_code' . $print['content']['machine_code'] . 'partner' . $print['content']['partner'] . 'time' . $time . $print['content']['msign'])); goto jO7eV; j7R8x: $level_data = array(); goto wlYEU; vFJVJ: dmI3X: goto Kb5s1; kLntd: if ($order['order_type'] == 4) { goto g_jX_; } goto Z2a77; MYVyR: $share['content'] = json_decode($share['content'], true); goto EqpSI; gmwaD: $content .= '地址：无\\r\\n'; goto z382x; Z391a: pdo_update('xc_beauty_service', array("group_total" => $service['group_total'] + $order['total']), array("id" => $order['pid'], "uniacid" => $uniacid)); goto zR6o2; NhXEN: $time = time(); goto k6UMp; f1YSo: if (empty($service['type'])) { goto B5EXU; } goto fzcY3; RzjQR: pdo_insert('xc_beauty_times_log', array("uniacid" => $uniacid, "member" => $order['member'], "plan_date" => $order['plan_date'], "total" => 1, "createtime" => date('Y-m-d H:i:s'))); goto QSdGz; Rva8H: $group_data = array(); goto wbYVk; DvmfA: if (!empty($order['userinfo']['address'])) { goto Z2RHQ; } goto HgwXw; cMuvj: $output = curl_exec($ch); goto YuLsM; Ihft9: if (!($sms['content']['type'] == 3)) { goto dmI3X; } goto HP9X6; Fy2jN: if (empty($score)) { goto SttAj; } goto BJkum; xjrMg: if (!$fan) { goto xc24s; } goto WlxAK; voh1r: O959L: goto f1YSo; a3POC: N8y2_: goto JCHi3; Al29C: goto J8TI0; goto DSCck; qp4g0: $token = $account_api->getAccessToken(); goto j2DLd; dA1i0: LrbXw: goto bBx__; rKBDo: if (!empty($order['userinfo']['address'])) { goto XBUtY; } goto PDDlP; XoN9K: curl_close($ch); goto GEV5z; MIeXf: zyz6Q: goto sG108; J7aey: $group_data['status'] = -1; goto O3W89; mPwI2: $request = pdo_update('xc_beauty_order', array("status" => 1, "wx_out_trade_no" => $data['out_trade_no']), array("id" => $order['id'], "uniacid" => $uniacid)); goto IMNtK; Wmw2X: BBNzS: goto uElJT; PcEhA: curl_setopt($ch, CURLOPT_URL, $sms['content']['url']); goto gkzjF; cNxuQ: EMdcj: goto mFfRO; wdEuB: $userinfo = pdo_get('xc_beauty_userinfo', array("status" => 1, "openid" => $order['openid'])); goto mN1YL; St8tK: if (!$request) { goto SZabw; } goto Z391a; sL9j0: U5tIK: goto WzWu9; fA_j7: pdo_update('xc_beauty_userinfo', $level_data, array("openid" => $order['openid'], "uniacid" => $uniacid)); goto RN_vM; hHnDK: $share_condition['two_amount'] = round(floatval($order['o_amount']) * floatval($share_config['two']) * 0.01, 2); goto ZC9xw; K72VA: $fan = mc_fetch_one($userinfo['openid']); goto xjrMg; BM8Du: $smsConf = array("key" => $sms['content']['key'], "mobile" => $sms['content']['mobile'], "tpl_id" => $sms['content']['tpl_id'], "tpl_value" => $tpl_value); goto vc6KG; wYH5z: $share = pdo_get('xc_beauty_config', array("xkey" => "share", "uniacid" => $uniacid)); goto OX2GV; Q825w: IlEpG: goto mPwI2; IYJe3: global $_GPC, $_W; goto OIWzR; TOMmP: foreach ($service_list as $sl) { $service_data[$sl['id']] = $sl; SkzEU: } goto YtELF; r4ep0: pdo_insert('xc_beauty_share', array("uniacid" => $uniacid, "openid" => $share_condition['one_openid'], "title" => "一级订单结算奖励", "out_trade_no" => $order['out_trade_no'], "amount" => $share_condition['one_amount'], "level" => 1, "status" => -1, "createtime" => date('Y-m-d H:i:s'))); goto yUK6G; OX2GV: if (!$share) { goto O959L; } goto MYVyR; tBHm_: goto Gf6eC; goto IvZej; Frelu: Xa1Rq: goto voh1r; pgULd: goto DyUa0; goto TdjRn; Ztd9w: $get = str_replace('{{namex}}', $order['userinfo']['name'], $get); goto Zaw4a; mMQ3Q: acyjl: goto fX8QO; I6oMd: Gf6eC: goto nuXU4; E6lZq: xc24s: goto iQsWC; cSUYA: $service = pdo_get('xc_beauty_store_service', array("uniacid" => $uniacid, "id" => $order['pid'])); goto G_qCd; N_2El: $result = json_decode($content, true); goto ABGUb; WMW1Q: hd6Jx: goto UKDgJ; uzi6G: ja8Po: goto MIeXf; YtELF: Svavy: goto KrO67; ALFZz: goto N8y2_; goto SyoOM; BIrkl: $content .= '订单号：' . $order['out_trade_no'] . '\\r\\n'; goto e1xDE; O4RDM: $post = str_replace('{{trade}}', $order['out_trade_no'], $post); goto y33r0; sG108: $print = pdo_get('xc_beauty_config', array("xkey" => "print", "uniacid" => $uniacid)); goto qFdRF; KXOjV: curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1); goto l1hSA; Edsk1: if (!(strpos($header[0], '301') || strpos($header[0], '302'))) { goto wo6Aq; } goto V4riB; SrwEP: A9UIp: goto gFmRC; GPDsx: Bj3HH: goto qsJ6V; PwhXR: goto u3Rdx; goto x3IY3; qjff1: SbIDB: goto zAa8d; ReZFZ: $post_data['form_id'] = $order['form_id']; goto Mr7pW; zy5vv: NVon9: goto A40xD; wrF2R: Woy7H: goto HDc0i; gkzjF: curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1); goto vpr1p; jRe1r: if (!($print['content']['status'] == 1)) { goto Vlucu; } goto gOek9; dlVkh: } public function doWebWxPay() { goto m138d; QpdT5: S9Fpv: goto TbbSY; uP0Rv: exit; goto T2lkA; Q1qxf: $url = 'https://api.mch.weixin.qq.com/mmpaymkttransfers/promotion/transfers'; goto nMmHL; Al_Wx: iaoi1: goto kYzPM; TbbSY: $json = array("status" => 1, "msg" => "提现成功"); goto u4acb; kYzPM: a5Fja: goto C_FAs; kSieP: $json = array("status" => -1, "msg" => $data['return_msg']); goto biEVE; FLudL: $setting = uni_setting_load('payment', $_W['uniacid']); goto SxOYX; cZP0f: $arr['mch_appid'] = $_W['account']['key']; goto xDrub; eGCgF: $response = ihttp_request($url, $xml, array(CURLOPT_SSLCERT => ATTACHMENT_ROOT . $_W['uniacid'] . '_wechat_refund_all.pem')); goto D0WIB; T2lkA: goto OJUfl; goto KdooV; X4wog: $arr['spbill_create_ip'] = $user_IP; goto Q1qxf; TIZhs: $arr['amount'] = floatval($order['amount']) * 100; goto JLsID; YLLzz: if ($response) { goto nmXEw; } goto Y_Pz_; c8Iv_: $arr['nonce_str'] = random(8); goto Zvmhy; Dk9dE: goto iaoi1; goto SNOk9; biEVE: echo json_encode($json); goto SZYUx; nX1o8: $uniacid = $_W['uniacid']; goto czE7J; QWDH6: echo json_encode($json); goto k2MjB; xDrub: $arr['mchid'] = $setting['payment']['wechat']['mchid']; goto c8Iv_; cIS5a: if ($request) { goto S9Fpv; } goto N1d3I; FAj8y: exit; goto K_iHd; K_iHd: goto boxHd; goto a93Ib; U8fxa: $cert = authcode($refund_setting['cert'], 'DECODE'); goto z2g5a; SZYUx: exit; goto e0Zd9; o7yck: echo json_encode($json); goto FAj8y; hCu46: $arr['openid'] = $order['openid']; goto L1f9x; H7D5q: $user_IP = $_SERVER['HTTP_VIA'] ? $_SERVER['HTTP_X_FORWARDED_FOR'] : $_SERVER['REMOTE_ADDR']; goto KwbZq; aZb2f: load()->func('communication'); goto jsGex; pORe4: foreach ($arr as $k => $v) { $str .= $k . '=' . $v . '&'; bM8Tv: } goto ZI302; L1f9x: $arr['check_name'] = 'NO_CHECK'; goto TIZhs; IaTgs: boxHd: goto IPK11; SxOYX: $refund_setting = $setting['payment']['wechat_refund']; goto PVDjW; ZI302: AtQdD: goto q2PYq; D0WIB: unlink(ATTACHMENT_ROOT . $_W['uniacid'] . '_wechat_refund_all.pem'); goto YLLzz; EuIH6: echo json_encode($json); goto rsIvt; u4acb: echo json_encode($json); goto qwdZ_; czE7J: $order = pdo_get('xc_beauty_withdraw', array("id" => $_GPC['id'], "uniacid" => $uniacid)); goto jomQZ; z2g5a: $key = authcode($refund_setting['key'], 'DECODE'); goto IVFCY; nMmHL: ksort($arr); goto NaOdE; m138d: global $_GPC, $_W; goto nX1o8; qwdZ_: exit; goto AbjMf; nduAr: $arr['desc'] = $desc; goto H7D5q; Zvmhy: $arr['partner_trade_no'] = $order['out_trade_no']; goto hCu46; i9FTB: $json = array("status" => -1, "msg" => "缺少微信证书"); goto CatkG; k2MjB: exit; goto T_iXS; q2PYq: $str .= 'key=' . $setting['payment']['wechat']['signkey']; goto z5fDN; z5fDN: $arr['sign'] = md5($str); goto aZb2f; Y_Pz_: $json = array("status" => -1, "msg" => json_encode($response)); goto SdVEl; NaOdE: $str = ''; goto pORe4; cSEYc: exit; goto jTCMu; CatkG: echo json_encode($json); goto cSEYc; KdooV: nmXEw: goto jZueA; PVDjW: if (!(empty($refund_setting['key']) || empty($refund_setting['cert']))) { goto WPrm5; } goto i9FTB; e0Zd9: goto a5Fja; goto RPqDZ; IVFCY: file_put_contents(ATTACHMENT_ROOT . $_W['uniacid'] . '_wechat_refund_all.pem', $cert . $key); goto daqlb; jTCMu: WPrm5: goto U8fxa; qoVVP: $request = pdo_update('xc_beauty_withdraw', array("status" => 1, "wx_out_trade_no" => $data['payment_no']), array("id" => $_GPC['id'], "uniacid" => $uniacid)); goto cIS5a; rsIvt: exit; goto Dk9dE; jsGex: $xml = array2xml($arr); goto eGCgF; C_FAs: OJUfl: goto IaTgs; SNOk9: YRR9G: goto qoVVP; RPqDZ: jQLcU: goto b1rxu; jomQZ: if ($order) { goto Yw8lP; } goto gYM8p; b1rxu: if ($data['result_code'] == 'SUCCESS') { goto YRR9G; } goto kckMS; gYM8p: $json = array("status" => -1, "msg" => "查询不到订单"); goto o7yck; so973: if ($data['return_code'] == 'SUCCESS') { goto jQLcU; } goto kSieP; daqlb: $arr = array(); goto cZP0f; N1d3I: $json = array("status" => -1, "msg" => "提现成功，数据写入失败"); goto QWDH6; AbjMf: PnyMl: goto Al_Wx; KwbZq: $user_IP = $user_IP ? $user_IP : $_SERVER['REMOTE_ADDR']; goto X4wog; a93Ib: Yw8lP: goto FLudL; SdVEl: echo json_encode($json); goto uP0Rv; jZueA: $data = xml2array($response['content']); goto so973; T_iXS: goto PnyMl; goto QpdT5; JLsID: $desc = '提现'; goto nduAr; kckMS: $json = array("status" => -1, "msg" => $data['err_code'] . '：' . $data['err_code_des']); goto EuIH6; IPK11: } public function doWebStoreWxPay() { goto Czs1_; dKhwB: file_put_contents(ATTACHMENT_ROOT . $_W['uniacid'] . '_wechat_refund_all.pem', $cert . $key); goto TauMC; lyfhW: njgGv: goto G7czl; YTRaN: $json = array("status" => 1, "msg" => "提现成功"); goto VVgOp; jXUmd: $json = array("status" => -1, "msg" => $data['err_code'] . '：' . $data['err_code_des']); goto f6UI7; gtvN5: if ($response) { goto qG1jy; } goto eyVPF; sHP4P: echo json_encode($json); goto f4BuV; IvON2: ksort($arr); goto Jhh0_; NJszF: goto U5XR4; goto q_JyS; FSt5G: DA6vl: goto C4ART; h_csH: if ($data['return_code'] == 'SUCCESS') { goto hMBPX; } goto kwLR9; A2e0w: foreach ($arr as $k => $v) { $str .= $k . '=' . $v . '&'; xwFVv: } goto cAykW; t21g2: $setting = uni_setting_load('payment', $_W['uniacid']); goto BVw9b; BD73j: if ($request) { goto lixfC; } goto rOyTp; lm6aQ: $url = 'https://api.mch.weixin.qq.com/mmpaymkttransfers/promotion/transfers'; goto IvON2; oHCho: echo json_encode($json); goto EnK8q; f6UI7: echo json_encode($json); goto incrz; LHi9F: goto D7eFM; goto FSt5G; Rn75G: $response = ihttp_request($url, $xml, array(CURLOPT_SSLCERT => ATTACHMENT_ROOT . $_W['uniacid'] . '_wechat_refund_all.pem')); goto ZtFLM; adU3Z: lixfC: goto YTRaN; lpm9V: exit; goto jeOQQ; sSfir: $cert = authcode($refund_setting['cert'], 'DECODE'); goto zeil4; KuD2V: $arr['nonce_str'] = random(8); goto ouFYq; XNJLs: yXgkQ: goto qSJjx; kgYOz: exit; goto MxLAh; vSBos: $desc = '提现'; goto MON8e; daHUe: load()->func('communication'); goto D7XoO; rOyTp: $json = array("status" => -1, "msg" => "提现成功，数据写入失败"); goto TpU1O; eyVPF: $json = array("status" => -1, "msg" => json_encode($response)); goto oHCho; D_BYr: $data = xml2array($response['content']); goto h_csH; VVgOp: echo json_encode($json); goto qcjst; EnK8q: exit; goto NJszF; f4BuV: exit; goto jjroO; crv2S: goto db2I4; goto mwehJ; JWgvc: $str .= 'key=' . $setting['payment']['wechat']['signkey']; goto GlUGI; cAykW: LrDp9: goto JWgvc; mwehJ: fG2Sz: goto t21g2; MON8e: $arr['desc'] = $desc; goto Uqihi; mI7bw: echo json_encode($json); goto zMLQs; jeOQQ: goto njgGv; goto adU3Z; Jhh0_: $str = ''; goto A2e0w; QDT00: $uniacid = $_W['uniacid']; goto eJ0h0; q_JyS: qG1jy: goto D_BYr; PU38d: $arr['check_name'] = 'NO_CHECK'; goto o6q1r; LQOG5: $json = array("status" => -1, "msg" => "查询不到订单"); goto mI7bw; kwLR9: $json = array("status" => -1, "msg" => $data['return_msg']); goto sHP4P; qcjst: exit; goto lyfhW; TpU1O: echo json_encode($json); goto lpm9V; LQhSt: $arr['mch_appid'] = $_W['account']['key']; goto N564F; GlUGI: $arr['sign'] = md5($str); goto daHUe; zMLQs: exit; goto crv2S; qSJjx: U5XR4: goto nO_Uf; Uqihi: $user_IP = $_SERVER['HTTP_VIA'] ? $_SERVER['HTTP_X_FORWARDED_FOR'] : $_SERVER['REMOTE_ADDR']; goto Mh7hB; G7czl: D7eFM: goto XNJLs; eJ0h0: $order = pdo_get('xc_beauty_store_fee', array("id" => $_GPC['id'], "uniacid" => $uniacid)); goto Xk43S; N564F: $arr['mchid'] = $setting['payment']['wechat']['mchid']; goto KuD2V; Xk43S: if ($order) { goto fG2Sz; } goto LQOG5; D7XoO: $xml = array2xml($arr); goto Rn75G; s800f: $arr['openid'] = $order['openid']; goto PU38d; BMddp: if ($data['result_code'] == 'SUCCESS') { goto DA6vl; } goto jXUmd; MxLAh: v_mGF: goto sSfir; zeil4: $key = authcode($refund_setting['key'], 'DECODE'); goto dKhwB; Mh7hB: $user_IP = $user_IP ? $user_IP : $_SERVER['REMOTE_ADDR']; goto JBXvi; z0Lot: if (!(empty($refund_setting['key']) || empty($refund_setting['cert']))) { goto v_mGF; } goto JHYQN; JBXvi: $arr['spbill_create_ip'] = $user_IP; goto lm6aQ; JHYQN: $json = array("status" => -1, "msg" => "缺少微信证书"); goto wQrJl; BVw9b: $refund_setting = $setting['payment']['wechat_refund']; goto z0Lot; z8gWm: hMBPX: goto BMddp; o6q1r: $arr['amount'] = floatval($order['amount']) * 100; goto vSBos; ouFYq: $arr['partner_trade_no'] = $order['pid']; goto s800f; wQrJl: echo json_encode($json); goto kgYOz; incrz: exit; goto LHi9F; TauMC: $arr = array(); goto LQhSt; C4ART: $request = pdo_update('xc_beauty_store_fee', array("status" => 1, "wx_out_trade_no" => $data['payment_no']), array("id" => $_GPC['id'], "uniacid" => $uniacid)); goto BD73j; nO_Uf: db2I4: goto Ac5D2; jjroO: goto yXgkQ; goto z8gWm; ZtFLM: unlink(ATTACHMENT_ROOT . $_W['uniacid'] . '_wechat_refund_all.pem'); goto gtvN5; Czs1_: global $_GPC, $_W; goto QDT00; Ac5D2: } public function doWebUpSql() { include_once IA_ROOT . '/addons/xc_beauty/upsql.php'; upsql(); } public function doMobileGroupRefund() { goto THbVa; SNgj4: ZgC5k: goto FvxBE; o1iA7: $group_refund = $group_config['content']['group_refund']; goto LxGJH; tCMVF: $group_refund = 1; goto KFX7H; LS_ZT: $group_config['content'] = json_decode($group_config['content'], true); goto WTbHK; WTbHK: if (empty($group_config['content']['group_refund'])) { goto hG4UG; } goto o1iA7; eplmr: MW_vb: goto SNgj4; CEfGy: if (!$group) { goto ZgC5k; } goto tCMVF; HWhBC: if (!$group_config) { goto pzcvL; } goto LS_ZT; PL5JV: ignore_user_abort(true); goto WyBOw; cL4yK: $uniacid = $_W['uniacid']; goto mg7Uq; THbVa: global $_GPC, $_W; goto cL4yK; FvxBE: echo '退款完成'; goto y0464; qLMrf: foreach ($group as &$g) { goto at_14; cDNhB: if (!($data['result_code'] == 'SUCCESS')) { goto E6IbS; } goto V_tg2; w1ME6: XpV0y: goto e_9tB; VF1AG: bgBZj: goto Sg4zf; i2eFv: I8Xo6: goto QH1qp; uVXPs: $response = ihttp_request($url, $xml, array(CURLOPT_SSLCERT => ATTACHMENT_ROOT . $_W['uniacid'] . '_wechat_refund_all.pem')); goto EnVys; i5uRR: goto V4QRB; goto d_RSJ; zy2Bu: if (!(!empty($config['content']['tiangong']) && !empty($config['content']['AppKey']) && !empty($config['content']['AppSecret']))) { goto sgWnp; } goto do6z8; XqMaN: $refund_setting = $setting['payment']['wechat_refund']; goto nKYmc; CHyUP: $userinfo = pdo_get('xc_beauty_userinfo', array("status" => 1, "openid" => $order['openid'], "uniacid" => $uniacid)); goto TD7JV; gw_kg: oqJzb: goto pAk9x; r2sKG: $post_data['touser'] = $order['openid']; goto awP2b; rNtsL: pdo_update('xc_beauty_order', array("refund_status" => -1, "status" => 2), array("id" => $order['id'], "uniacid" => $uniacid)); goto PqPMB; iGH41: $total_fee = floatval($order['wxpay']) * 100; goto c8HQe; lFAD7: $order = pdo_get('xc_beauty_order', array("status" => 1, "uniacid" => $uniacid, "group" => $g['id'], "openid" => $g['openid'])); goto HzJSR; do6z8: $tiangong = $config['content']['tiangong']; goto n_7B2; TCpCj: $xml = array2xml($refund); goto uVXPs; xaQ9y: goto nudG7; goto HPGQl; uCZ9H: $user_id = ''; goto zyTsO; n_7B2: $AppKey = $config['content']['AppKey']; goto D55lv; HPGQl: t1Sxn: goto wqxcl; tFuib: curl_setopt($ch, CURLOPT_URL, $url); goto HNzP7; kAhBb: $refund = array("appid" => $_W['account']['key'], "mch_id" => $setting['payment']['wechat']['mchid'], "nonce_str" => random(8), "out_refund_no" => $transaction_id, "out_trade_no" => $transaction_id, "refund_fee" => $refund_fee, "total_fee" => $total_fee); goto xXTKU; Efp5Z: $agent_id = ''; goto uCZ9H; vtISw: curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1); goto AIfgq; ZU11B: $key = authcode($refund_setting['key'], 'DECODE'); goto sjMsn; AIfgq: curl_setopt($ch, CURLOPT_POST, 1); goto VDYmY; FXh3s: UNTxd: goto oIND5; Sm4cS: $service = pdo_get('xc_beauty_service', array("id" => $order['pid'])); goto L9sWO; dFKKt: $g['team'] = json_decode($g['team'], true); goto uj3YA; Urdd8: if (!(empty($refund_setting['key']) || empty($refund_setting['cert']))) { goto hIM0R; } goto mGYgF; c8HQe: $refund_fee = floatval($order['wxpay']) * 100; goto T4umj; sjMsn: file_put_contents(ATTACHMENT_ROOT . $_W['uniacid'] . '_wechat_refund_all.pem', $cert . $key); goto r1GF0; nyA_Z: $data = array("charge_id" => $order['charge_id'], "amount" => $order['wxpay']); goto FzVZ6; zP6dq: $request = pdo_update('xc_beauty_userinfo', array("money" => $money), array("status" => 1, "openid" => $order['openid'], "uniacid" => $uniacid)); goto lrhmw; HNzP7: curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false); goto H7GSG; oxjhD: $AppKey = ''; goto xoEph; JMDxp: JQdqK: goto rNtsL; I7Xnw: $post_data['page'] = 'xc_beauty/pages/base/base'; goto Hb3oG; d_RSJ: EZyk5: goto MUaX0; xoEph: $AppSecret = ''; goto Efp5Z; e_9tB: $sql = 'UPDATE ' . tablename('xc_beauty_service') . ' SET group_stock=group_stock+:group_stock WHERE uniacid=:uniacid AND id=:id AND group_stock>=0'; goto Azrx5; zGkRu: CilZj: goto nUs3r; bNLVU: echo json_encode($json); goto cETdf; a6o5n: $cert = authcode($refund_setting['cert'], 'DECODE'); goto ZU11B; ZL23V: syAG1: goto tMImQ; V_tg2: $can_list = 1; goto QjAFa; PqPMB: HEcJR: goto rIe06; XSnp8: nHqHm: goto EbInl; ED4nb: if (empty($g['team'])) { goto eiLop; } goto dFKKt; k5jp1: $result = json_decode($result, true); goto RYtzr; bOnSL: if (!empty($result['result'])) { goto Rs3ii; } goto qqDC4; WGGhB: $data = array("agent_id" => $agent_id, "user_id" => $user_id, "secret_type" => 1); goto M0N0O; MH8RS: $config['content'] = json_decode($config['content'], true); goto zy2Bu; CQb91: $url = 'https://api.teegon.com/router?method=teegon.payment.charge.refund&app_key=' . $result['result']['key'] . '&client_secret=' . $result['result']['secret']; goto nyA_Z; uj3YA: foreach ($g['team'] as $gg) { goto lzn0J; SyIY0: $account_api = WeAccount::create(); goto c_yTu; VrqQp: $cert = authcode($refund_setting['cert'], 'DECODE'); goto kJokR; FlTZP: if (!empty($result['result'])) { goto OAiWh; } goto l3FI_; U5Qwv: qTOY_: goto ihsn0; j54Al: $string = md5($string); goto gLn9f; kAvrA: if (!$config) { goto BX79j; } goto llBmu; Qm6Hl: E1vhi: goto bppVI; c_yTu: $token = $account_api->getAccessToken(); goto ATy1z; YKF4H: $can_list = 1; goto jK26h; PGTlG: if (!empty($result['result'])) { goto aSYTp; } goto t7Yap; SiZwi: if (!($group_refund == 2)) { goto B6cGH; } goto W2rtO; YmOul: curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1); goto LVKJq; gsLAu: $response = ihttp_request($url, $xml, array(CURLOPT_SSLCERT => ATTACHMENT_ROOT . $_W['uniacid'] . '_wechat_refund_all.pem')); goto of8FG; gBJBi: $refund = array("appid" => $_W['account']['key'], "mch_id" => $setting['payment']['wechat']['mchid'], "nonce_str" => random(8), "out_refund_no" => $transaction_id, "out_trade_no" => $transaction_id, "refund_fee" => $refund_fee, "total_fee" => $total_fee); goto Mrbjd; gLn9f: $refund['sign'] = strtoupper($string); goto GVluS; dRg4T: $setting = uni_setting_load('payment', $_W['uniacid']); goto HAO99; FkAER: $post_data['data'] = $postdata; goto pjACX; AmyVL: curl_setopt($ch, CURLOPT_POSTFIELDS, $post_data); goto nw6QD; jL8gP: $data = array("agent_id" => $agent_id, "user_id" => $user_id, "secret_type" => 1); goto osyve; iqgVa: $result = vpost($url, $data); goto pl5r_; hbbNz: AUw_V: goto I0UNm; lzn0J: $order = pdo_get('xc_beauty_order', array("status" => 1, "uniacid" => $uniacid, "group" => $g['id'], "openid" => $gg)); goto pe1JS; osyve: $result = vpost($url, $data); goto PbkwG; PB8cM: $data = array("charge_id" => $order['charge_id'], "amount" => $order['wxpay']); goto iqgVa; HTY_H: $sql = 'UPDATE ' . tablename('xc_beauty_service') . ' SET group_stock=group_stock+:group_stock WHERE uniacid=:uniacid AND id=:id AND group_stock>=0'; goto hCGkh; pNjRF: $transaction_id = $order['wx_out_trade_no']; goto ogPC0; uSNM5: xP5E5: goto h33ue; Ckp5s: $agent_id = $config['content']['agent_id']; goto CDeeP; yAsv6: $userinfo = pdo_get('xc_beauty_userinfo', array("status" => 1, "openid" => $order['openid'], "uniacid" => $uniacid)); goto WtK2v; PC7TS: if ($group_refund == 1) { goto MfcwU; } goto SiZwi; h0e7L: $xml = array2xml($refund); goto gsLAu; nw6QD: $output = curl_exec($ch); goto VXUAC; QULi0: pS7gs: goto EEfao; jES8e: goto lEXVF; goto rbcfM; pl5r_: $result = json_decode($result, true); goto PGTlG; T2FY_: $AppKey = $config['content']['AppKey']; goto xIXYx; Yr2E1: if (empty($_GPC['amount'])) { goto GSAOJ; } goto CbMg9; g_CDF: $request = pdo_update('xc_beauty_userinfo', array("money" => $money), array("status" => 1, "openid" => $order['openid'], "uniacid" => $uniacid)); goto uSNM5; mvQCF: r1Aec: goto Jmokp; pDdso: Kzrrb: goto KmGbs; yizln: pmJLy: goto vIlba; WtK2v: $money = round(floatval($userinfo['money']) + floatval($order['canpay']), 2); goto g_CDF; etCOd: $config = pdo_get('xc_beauty_config', array("xkey" => "web", "uniacid" => $uniacid)); goto dQ0rT; ogPC0: $total_fee = floatval($order['wxpay']) * 100; goto YzYWj; ilotD: if (!($data['return_code'] == 'SUCCESS')) { goto mZDg5; } goto Ipfee; EEfao: if (!(empty($refund_setting['key']) || empty($refund_setting['cert']))) { goto WoBzc; } goto smAV7; hntRc: $url = 'https://api.teegon.com/router?method=teegon.payment.charge.refund&app_key=' . $result['result']['key'] . '&client_secret=' . $result['result']['secret']; goto PB8cM; I0UNm: if (!($can_list == 1)) { goto A7vkY; } goto CajoZ; GVluS: load()->func('communication'); goto h0e7L; gdz5Q: $ch = curl_init(); goto Z3jiB; dQ0rT: if (!$config) { goto E1vhi; } goto HTq1b; ADR6E: pdo_update('xc_beauty_order', array("refund_status" => 1, "status" => 2, "refundtime" => date('Y-m-d H:i:s')), array("id" => $order['id'], "uniacid" => $uniacid)); goto BOq47; Xo3Hv: $AppKey = ''; goto mONtT; unb1v: $user_id = ''; goto etCOd; P90FK: if (!$response) { goto r1Aec; } goto ETScQ; qAEtc: $post_data['template_id'] = $config['content']['group_fail']; goto u9h22; ihsn0: SW7vR: goto Tkxtm; vgkCt: $post_data['touser'] = $order['openid']; goto qAEtc; CbMg9: $refund_fee = floatval($_GPC['amount']) * 100; goto gRk1U; t7Yap: pdo_update('xc_beauty_order', array("refund_status" => -1, "status" => 2), array("id" => $order['id'], "uniacid" => $uniacid)); goto CMcLU; S_mli: echo json_encode($json); goto rt4HA; ca6fk: BX79j: goto HTY_H; WIfp4: $json = array("status" => -1, "msg" => "未开启微信退款功能"); goto S_mli; YzYWj: $refund_fee = floatval($order['wxpay']) * 100; goto Yr2E1; OQgEn: exit; goto jES8e; BOq47: B6cGH: goto gS2_m; jK26h: CLFX1: goto ctWJg; C6KpN: if (empty($config['content']['group_fail'])) { goto m2BGH; } goto SyIY0; IDE3r: file_put_contents(ATTACHMENT_ROOT . $_W['uniacid'] . '_wechat_refund_all.pem', $cert . $key); goto pNjRF; H6lGj: WoBzc: goto VrqQp; L8gx2: lEXVF: goto O3LMz; llBmu: $config['content'] = json_decode($config['content'], true); goto C6KpN; FjcVQ: echo json_encode($json); goto RrO2x; CajoZ: if (!(floatval($order['canpay']) != 0)) { goto xP5E5; } goto yAsv6; zrdEn: l3FHC: goto Qm6Hl; ETScQ: $data = xml2array($response['content']); goto ilotD; rt4HA: exit; goto QULi0; ATy1z: $service = pdo_get('xc_beauty_service', array("id" => $order['pid'])); goto H6P9D; HAO99: $refund_setting = $setting['payment']['wechat_refund']; goto G2cvB; rbcfM: OAiWh: goto hntRc; HTq1b: $config['content'] = json_decode($config['content'], true); goto ngZvq; LpuZi: curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, false); goto YmOul; AwN8a: PC15e: goto hbbNz; gRk1U: GSAOJ: goto B9kGx; poqhe: $can_list = 1; goto Dngfj; DL3uZ: pdo_update('xc_beauty_order', array("refund_status" => -1, "status" => 2), array("id" => $order['id'], "uniacid" => $uniacid)); goto pDdso; kJokR: $key = authcode($refund_setting['key'], 'DECODE'); goto IDE3r; gS2_m: goto Kzrrb; goto flhwK; ctWJg: mZDg5: goto mvQCF; KuMUA: yT_7l: goto YPeSA; xIXYx: $AppSecret = $config['content']['AppSecret']; goto Ckp5s; pD2Nm: $url = 'https://api.teegon.com/router?method=teegon.agent.mfuser.get.pay.secret&app_key=' . $AppKey . '&client_secret=' . $AppSecret; goto jL8gP; vIlba: if (empty($order['charge_id'])) { goto TaQa2; } goto pD2Nm; hCGkh: pdo_query($sql, array(":group_stock" => $order['total'], ":uniacid" => $uniacid, ":id" => $order['pid'])); goto U5Qwv; pjACX: $url = 'https://api.weixin.qq.com/cgi-bin/message/wxopen/template/send?access_token=' . $token; goto lChK2; PbkwG: $result = json_decode($result, true); goto FlTZP; mONtT: $AppSecret = ''; goto YLal6; h33ue: A7vkY: goto ADR6E; lChK2: $post_data = json_encode($post_data); goto gdz5Q; ngZvq: if (!(!empty($config['content']['tiangong']) && !empty($config['content']['AppKey']) && !empty($config['content']['AppSecret']))) { goto l3FHC; } goto Vz80z; KmGbs: $config = pdo_get('xc_beauty_config', array("xkey" => "web", "uniacid" => $uniacid)); goto kAvrA; CMcLU: exit; goto NHwK4; RrO2x: exit; goto H6lGj; VXUAC: curl_close($ch); goto OB_HN; Z3jiB: curl_setopt($ch, CURLOPT_URL, $url); goto iGl1S; Jmokp: goto PC15e; goto yizln; flhwK: MfcwU: goto DL3uZ; bppVI: if ($tiangong == 1 && !empty($AppKey) && !empty($AppSecret)) { goto pmJLy; } goto dRg4T; YLal6: $agent_id = ''; goto unb1v; H6P9D: $postdata = array("keyword1" => array("value" => $order['out_trade_no']), "keyword2" => array("value" => $order['amount']), "keyword3" => array("value" => $service['name']), "keyword4" => array("value" => "人数不足")); goto vgkCt; CDeeP: $user_id = $config['content']['user_id']; goto zrdEn; Vz80z: $tiangong = $config['content']['tiangong']; goto T2FY_; NHwK4: aSYTp: goto L8gx2; TW4QZ: $post_data['form_id'] = $order['form_id']; goto FkAER; YPeSA: $tiangong = -1; goto Xo3Hv; Mrbjd: ksort($refund); goto PzLmp; O3LMz: TaQa2: goto AwN8a; W2rtO: $can_list = -1; goto plngv; u9h22: $post_data['page'] = 'xc_beauty/pages/base/base'; goto TW4QZ; iGl1S: curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false); goto LpuZi; G2cvB: if (!($refund_setting['switch'] != 1)) { goto pS7gs; } goto WIfp4; Dngfj: goto AUw_V; goto KuMUA; B9kGx: $url = 'https://api.mch.weixin.qq.com/secapi/pay/refund'; goto gBJBi; of8FG: unlink(ATTACHMENT_ROOT . $_W['uniacid'] . '_wechat_refund_all.pem'); goto P90FK; smAV7: $json = array("status" => -1, "msg" => "缺少微信证书"); goto FjcVQ; pe1JS: if (!$order) { goto qTOY_; } goto PC7TS; Ipfee: if (!($data['result_code'] == 'SUCCESS')) { goto CLFX1; } goto YKF4H; plngv: if (floatval($order['wxpay']) != 0) { goto yT_7l; } goto poqhe; Vpwad: $string = $string . "&key={$setting['payment']['wechat']['signkey']}"; goto j54Al; OB_HN: m2BGH: goto ca6fk; LVKJq: curl_setopt($ch, CURLOPT_POST, 1); goto AmyVL; l3FI_: pdo_update('xc_beauty_order', array("refund_status" => -1, "status" => 2), array("id" => $order['id'], "uniacid" => $uniacid)); goto OQgEn; PzLmp: $string = array2url($refund); goto Vpwad; Tkxtm: } goto im8Hz; LXBtE: hIM0R: goto a6o5n; cfy03: pdo_update('xc_beauty_order', array("refund_status" => 1, "status" => 2, "refundtime" => date('Y-m-d H:i:s')), array("id" => $order['id'], "uniacid" => $uniacid)); goto rq9EL; mGYgF: $json = array("status" => -1, "msg" => "缺少微信证书"); goto iLuUU; ofD5p: if (!$response) { goto oqJzb; } goto q3h0e; VjCur: Rs3ii: goto XSnp8; H1rnc: if (floatval($order['wxpay']) != 0) { goto UNTxd; } goto CDPWl; G9fQo: $json = array("status" => -1, "msg" => "未开启微信退款功能"); goto bNLVU; HHtBg: $account_api = WeAccount::create(); goto g5GbK; iLuUU: echo json_encode($json); goto L2rJM; pAk9x: goto bgBZj; goto zGkRu; EnVys: unlink(ATTACHMENT_ROOT . $_W['uniacid'] . '_wechat_refund_all.pem'); goto ofD5p; MLAgY: iAKsW: goto w1ME6; tMImQ: $url = 'https://api.mch.weixin.qq.com/secapi/pay/refund'; goto kAhBb; ZQbdX: if (empty($config['content']['group_fail'])) { goto iAKsW; } goto HHtBg; wgjBi: xE1Bj: goto CQb91; CDPWl: $can_list = 1; goto PBk4E; rIe06: $config = pdo_get('xc_beauty_config', array("xkey" => "web", "uniacid" => $uniacid)); goto VeQ7t; hRUcs: $refund_fee = floatval($_GPC['amount']) * 100; goto ZL23V; cCfRU: U2eRQ: goto i2eFv; wJv_K: $request = pdo_update('xc_beauty_group', array("status" => 2), array("status" => -1, "uniacid" => $uniacid, "id" => $g['id'])); goto cCfRU; hroFl: $refund['sign'] = $ref; goto ZlgDy; VeQ7t: if (!$config) { goto XpV0y; } goto v4LRN; VDYmY: curl_setopt($ch, CURLOPT_POSTFIELDS, $post_data); goto TqG_j; M0N0O: $result = vpost($url, $data); goto k5jp1; H7GSG: curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, false); goto vtISw; FzVZ6: $result = vpost($url, $data); goto kWa6Q; d7S0x: p6Q1W: goto hLixh; LpMIZ: $setting = uni_setting_load('payment', $_W['uniacid']); goto XqMaN; w0MTZ: $can_list = -1; goto H1rnc; cETdf: exit; goto lyYry; EbInl: nudG7: goto VF1AG; Sg4zf: RKC0q: goto Deo1X; qqDC4: $can_list = 1; goto VjCur; L9sWO: $postdata = array("keyword1" => array("value" => $order['out_trade_no']), "keyword2" => array("value" => $order['amount']), "keyword3" => array("value" => $service['name']), "keyword4" => array("value" => "人数不足")); goto r2sKG; KVcwr: $ch = curl_init(); goto tFuib; QLoB6: $post_data = json_encode($post_data); goto KVcwr; mSD7t: goto nHqHm; goto wgjBi; TqG_j: $output = curl_exec($ch); goto fN8vw; x93hl: $agent_id = $config['content']['agent_id']; goto kKS9C; q3h0e: $data = xml2array($response['content']); goto eBA_k; lyYry: nODsy: goto Urdd8; Deo1X: if ($can_list == 1) { goto EZyk5; } goto vqI3H; QjAFa: E6IbS: goto Qu9Fs; rIV63: if (!$config) { goto RZxbS; } goto MH8RS; hLixh: goto HEcJR; goto JMDxp; TD7JV: $money = round(floatval($userinfo['money']) + floatval($order['canpay']), 2); goto zP6dq; g5GbK: $token = $account_api->getAccessToken(); goto Sm4cS; Azrx5: pdo_query($sql, array(":group_stock" => $order['total'], ":uniacid" => $uniacid, ":id" => $order['pid'])); goto KXWUn; eBA_k: if (!($data['return_code'] == 'SUCCESS')) { goto yfJqi; } goto cDNhB; RYtzr: if (!empty($result['result'])) { goto xE1Bj; } goto mSD7t; HzJSR: if (!$order) { goto o8HKo; } goto ldIxo; ZlgDy: load()->func('communication'); goto TCpCj; r1GF0: $transaction_id = $order['wx_out_trade_no']; goto iGH41; DCNwf: $url = 'https://api.weixin.qq.com/cgi-bin/message/wxopen/template/send?access_token=' . $token; goto QLoB6; dwxGE: if ($tiangong == 1 && !empty($AppKey) && !empty($AppSecret)) { goto CilZj; } goto LpMIZ; fN8vw: curl_close($ch); goto MLAgY; ldIxo: if ($group_refund == 1) { goto JQdqK; } goto vf31c; nUs3r: if (!empty($order['charge_id'])) { goto t1Sxn; } goto xaQ9y; wqxcl: $url = 'https://api.teegon.com/router?method=teegon.agent.mfuser.get.pay.secret&app_key=' . $AppKey . '&client_secret=' . $AppSecret; goto WGGhB; awP2b: $post_data['template_id'] = $config['content']['group_fail']; goto I7Xnw; vFhiz: eiLop: goto wJv_K; kWa6Q: $result = json_decode($result, true); goto bOnSL; v4LRN: $config['content'] = json_decode($config['content'], true); goto ZQbdX; L2rJM: exit; goto LXBtE; PBk4E: goto RKC0q; goto FXh3s; im8Hz: MQvgN: goto vFhiz; rq9EL: V4QRB: goto d7S0x; KXWUn: o8HKo: goto ED4nb; Hb3oG: $post_data['form_id'] = $order['form_id']; goto M9KWA; vf31c: if (!($group_refund == 2)) { goto p6Q1W; } goto w0MTZ; MUaX0: if (!(floatval($order['canpay']) != 0)) { goto eREs_; } goto CHyUP; M9KWA: $post_data['data'] = $postdata; goto DCNwf; D55lv: $AppSecret = $config['content']['AppSecret']; goto x93hl; at_14: if (!(strtotime($g['createtime']) + intval($g['failtime']) * 60 * 60 < time())) { goto U2eRQ; } goto lFAD7; vqI3H: pdo_update('xc_beauty_order', array("refund_status" => -1, "status" => 2), array("id" => $order['id'], "uniacid" => $uniacid)); goto i5uRR; piseQ: RZxbS: goto dwxGE; zyTsO: $config = pdo_get('xc_beauty_config', array("xkey" => "web", "uniacid" => $uniacid)); goto rIV63; lrhmw: eREs_: goto cfy03; oIND5: $tiangong = -1; goto oxjhD; xXTKU: $ref = strtoupper(md5('appid=' . $refund['appid'] . '&mch_id=' . $refund['mch_id'] . '&nonce_str=' . $refund['nonce_str'] . '&out_refund_no=' . $refund['out_refund_no'] . '&out_trade_no=' . $refund['out_trade_no'] . '&refund_fee=' . $refund['refund_fee'] . '&total_fee=' . $refund['total_fee'] . '&key=' . $setting['payment']['wechat']['signkey'])); goto hroFl; kKS9C: $user_id = $config['content']['user_id']; goto Nq2Mp; Nq2Mp: sgWnp: goto piseQ; nKYmc: if (!($refund_setting['switch'] != 1)) { goto nODsy; } goto G9fQo; T4umj: if (empty($_GPC['amount'])) { goto syAG1; } goto hRUcs; Qu9Fs: yfJqi: goto gw_kg; QH1qp: } goto eplmr; mg7Uq: set_time_limit(0); goto PL5JV; KFX7H: $group_config = pdo_get('xc_beauty_config', array("xkey" => "web", "uniacid" => $uniacid)); goto HWhBC; iyUgJ: pzcvL: goto qLMrf; LxGJH: hG4UG: goto iyUgJ; WyBOw: $group = pdo_getall('xc_beauty_group', array("status" => -1, "uniacid" => $uniacid)); goto CEfGy; y0464: } } ?>