<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="referrer" content="origin">
    <meta name="viewport"
        content="width=device-width, viewport-fit=cover, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <title>支付完成</title>
    <link href="style/paySuccess.css" rel="stylesheet">  
    <script type="text/javascript" charset="UTF-8" src="https://wx.gtimg.com/pay_h5/goldplan/js/jgoldplan-1.0.0.js">
    </script>
    <script type="text/javascript" src="https://cdn.bootcss.com/vConsole/3.3.0/vconsole.min.js"></script>
    <script type="text/javascript" src="https://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>

</head>

<body>
    <div class="order_box">
        <div class="bussiness_avt">
            <img id="b_avt" src="https://wx.qlogo.cn/mmhead/Q3auHgzwzM4TRSZU7DITckrgsIib7QHkyW271eYs92aMUlxAhOWZanA/0"
                alt="">
        </div>
        <div class="b_name" id="b_name">
            客都文旅信息科技
        </div>
        <div class="col_box">
            <div class="col">
                <div class="lab">产品名称</div>
                <div id="p_name" class="ct">产品名称</div>
            </div>
            <div class="col">
                <div class="lab">购买数量</div>
                <div id="count" class="ct">3</div>
            </div>
            <div class="col">
                <div class="lab">实付金额</div>
                <div id="price" class="ct price">¥</div>
            </div>
        </div>
        <div class="btns">
            <div id="backHome" class="btn home">返回首页</div>
            <div id="toOrder" class="btn detail">查看详情</div>
        </div>
    </div>

    <script>
        //初始化console
        var vConsole = new VConsole();
        //获取返回页面参数
        function getQueryString(name) {
            var query = window.location.search.substring(1);
            var vars = query.split("&");
            for (var i = 0; i < vars.length; i++) {
                var pair = vars[i].split("=");
                if (pair[0] == name) {
                    return pair[1];
                }
            }
            return null;
        };
        //获取参数
        var sub_mch_id = getQueryString("sub_mch_id"); //特约商户号
        console.log("sub_mch_id is " + sub_mch_id)
        var out_trade_no = getQueryString("out_trade_no"); //商户订单号
        console.log("out_trade_no is " + out_trade_no)
        var check_code = getQueryString("check_code"); //md5 校验码
        console.log("check_code is " + check_code)



        $.ajax({
            type: "GET",
            url: "/api/TradeCommon/GetTradeInfoAfterWxPay",
            data: {
                sub_mch_id: sub_mch_id,
                out_trade_no: out_trade_no
            },
            dataType: "json",
            success: function (data) {
                console.log(data)
                if (data.status == "success") {
                    var info = data.data;
                    var homeLink = "https://xxx.com";
                    var detailLink = "https://xxx/tradeInfo?trade_id=xxx";
                    $("#b_avt").src = info.merchantIcon
                    $("#b_name").html(info.company)
                    $("#p_name").html(info.goodsName + "-" + info.skuName)
                    $("#count").html(info.num)
                    $("#price").html(info.payment)
                    //初始化小票
                    var initData = {
                        action: 'onIframeReady',
                        displayStyle: 'SHOW_CUSTOM_PAGE'
                    }
                    var initPostData = JSON.stringify(initData)
                    parent.postMessage(initPostData, 'https://payapp.weixin.qq.com')

                    //注册点击事件(去详情)
                    document.getElementById("toOrder").onclick = function () {
                        var mchData = {
                            action: 'jumpOut',
                            jumpOutUrl: detailLink //跳转的页面
                        }
                        var postData = JSON.stringify(mchData)
                        parent.postMessage(postData, 'https://payapp.weixin.qq.com')
                    }
                    //注册点击事件(去首页)
                    document.getElementById("backHome").onclick = function () {
                        var mchData = {
                            action: 'jumpOut',
                            jumpOutUrl: homeLink //跳转的页面
                        }
                        var postData = JSON.stringify(mchData)
                        parent.postMessage(postData, 'https://payapp.weixin.qq.com')
                    }
                }

            }
        });
    </script>
</body>

</html>